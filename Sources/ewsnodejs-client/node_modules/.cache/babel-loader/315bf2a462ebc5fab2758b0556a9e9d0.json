{"ast":null,"code":"import map from \"./map\";\nexport default function () {\n  var keys = [],\n      _sortKeys = [],\n      _sortValues,\n      _rollup,\n      nest;\n\n  function apply(array, depth, createResult, setResult) {\n    if (depth >= keys.length) {\n      if (_sortValues != null) array.sort(_sortValues);\n      return _rollup != null ? _rollup(array) : array;\n    }\n\n    var i = -1,\n        n = array.length,\n        key = keys[depth++],\n        keyValue,\n        value,\n        valuesByKey = map(),\n        values,\n        result = createResult();\n\n    while (++i < n) {\n      if (values = valuesByKey.get(keyValue = key(value = array[i]) + \"\")) {\n        values.push(value);\n      } else {\n        valuesByKey.set(keyValue, [value]);\n      }\n    }\n\n    valuesByKey.each(function (values, key) {\n      setResult(result, key, apply(values, depth, createResult, setResult));\n    });\n    return result;\n  }\n\n  function _entries(map, depth) {\n    if (++depth > keys.length) return map;\n    var array,\n        sortKey = _sortKeys[depth - 1];\n    if (_rollup != null && depth >= keys.length) array = map.entries();else array = [], map.each(function (v, k) {\n      array.push({\n        key: k,\n        values: _entries(v, depth)\n      });\n    });\n    return sortKey != null ? array.sort(function (a, b) {\n      return sortKey(a.key, b.key);\n    }) : array;\n  }\n\n  return nest = {\n    object: function object(array) {\n      return apply(array, 0, createObject, setObject);\n    },\n    map: function map(array) {\n      return apply(array, 0, createMap, setMap);\n    },\n    entries: function entries(array) {\n      return _entries(apply(array, 0, createMap, setMap), 0);\n    },\n    key: function key(d) {\n      keys.push(d);\n      return nest;\n    },\n    sortKeys: function sortKeys(order) {\n      _sortKeys[keys.length - 1] = order;\n      return nest;\n    },\n    sortValues: function sortValues(order) {\n      _sortValues = order;\n      return nest;\n    },\n    rollup: function rollup(f) {\n      _rollup = f;\n      return nest;\n    }\n  };\n}\n\nfunction createObject() {\n  return {};\n}\n\nfunction setObject(object, key, value) {\n  object[key] = value;\n}\n\nfunction createMap() {\n  return map();\n}\n\nfunction setMap(map, key, value) {\n  map.set(key, value);\n}","map":{"version":3,"sources":["/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/d3-collection/src/nest.js"],"names":["map","keys","sortKeys","sortValues","rollup","nest","apply","array","depth","createResult","setResult","length","sort","i","n","key","keyValue","value","valuesByKey","values","result","get","push","set","each","entries","sortKey","v","k","a","b","object","createObject","setObject","createMap","setMap","d","order","f"],"mappings":"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","sourcesContent":["import map from \"./map\";\n\nexport default function() {\n  var keys = [],\n      sortKeys = [],\n      sortValues,\n      rollup,\n      nest;\n\n  function apply(array, depth, createResult, setResult) {\n    if (depth >= keys.length) {\n      if (sortValues != null) array.sort(sortValues);\n      return rollup != null ? rollup(array) : array;\n    }\n\n    var i = -1,\n        n = array.length,\n        key = keys[depth++],\n        keyValue,\n        value,\n        valuesByKey = map(),\n        values,\n        result = createResult();\n\n    while (++i < n) {\n      if (values = valuesByKey.get(keyValue = key(value = array[i]) + \"\")) {\n        values.push(value);\n      } else {\n        valuesByKey.set(keyValue, [value]);\n      }\n    }\n\n    valuesByKey.each(function(values, key) {\n      setResult(result, key, apply(values, depth, createResult, setResult));\n    });\n\n    return result;\n  }\n\n  function entries(map, depth) {\n    if (++depth > keys.length) return map;\n    var array, sortKey = sortKeys[depth - 1];\n    if (rollup != null && depth >= keys.length) array = map.entries();\n    else array = [], map.each(function(v, k) { array.push({key: k, values: entries(v, depth)}); });\n    return sortKey != null ? array.sort(function(a, b) { return sortKey(a.key, b.key); }) : array;\n  }\n\n  return nest = {\n    object: function(array) { return apply(array, 0, createObject, setObject); },\n    map: function(array) { return apply(array, 0, createMap, setMap); },\n    entries: function(array) { return entries(apply(array, 0, createMap, setMap), 0); },\n    key: function(d) { keys.push(d); return nest; },\n    sortKeys: function(order) { sortKeys[keys.length - 1] = order; return nest; },\n    sortValues: function(order) { sortValues = order; return nest; },\n    rollup: function(f) { rollup = f; return nest; }\n  };\n}\n\nfunction createObject() {\n  return {};\n}\n\nfunction setObject(object, key, value) {\n  object[key] = value;\n}\n\nfunction createMap() {\n  return map();\n}\n\nfunction setMap(map, key, value) {\n  map.set(key, value);\n}\n"]},"metadata":{},"sourceType":"module"}