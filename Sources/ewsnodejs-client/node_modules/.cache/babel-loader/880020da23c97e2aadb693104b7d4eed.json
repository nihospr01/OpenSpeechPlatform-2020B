{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport React, { Component, forwardRef } from 'react';\nimport { getPosX, throttle } from './utils';\n\nvar ProgressBar = function (_Component) {\n  _inheritsLoose(ProgressBar, _Component);\n\n  function ProgressBar() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _Component.call.apply(_Component, [this].concat(args)) || this;\n\n    _defineProperty(_assertThisInitialized(_this), \"audio\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"timeOnMouseMove\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"hasAddedAudioEventListener\", false);\n\n    _defineProperty(_assertThisInitialized(_this), \"downloadProgressAnimationTimer\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      isDraggingProgress: false,\n      currentTimePos: '0%',\n      hasDownloadProgressAnimation: false,\n      downloadProgressArr: [],\n      waitingForSeekCallback: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getCurrentProgress\", function (event) {\n      var _this$props = _this.props,\n          audio = _this$props.audio,\n          progressBar = _this$props.progressBar;\n      var isSingleFileProgressiveDownload = audio.src.indexOf('blob:') !== 0 && typeof _this.props.srcDuration === 'undefined';\n\n      if (isSingleFileProgressiveDownload && (!audio.src || !isFinite(audio.currentTime) || !progressBar.current)) {\n        return {\n          currentTime: 0,\n          currentTimePos: '0%'\n        };\n      }\n\n      var progressBarRect = progressBar.current.getBoundingClientRect();\n      var maxRelativePos = progressBarRect.width;\n      var relativePos = getPosX(event) - progressBarRect.left;\n\n      if (relativePos < 0) {\n        relativePos = 0;\n      } else if (relativePos > maxRelativePos) {\n        relativePos = maxRelativePos;\n      }\n\n      var duration = _this.getDuration();\n\n      var currentTime = duration * relativePos / maxRelativePos;\n      return {\n        currentTime: currentTime,\n        currentTimePos: (relativePos / maxRelativePos * 100).toFixed(2) + \"%\"\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleContextMenu\", function (event) {\n      event.preventDefault();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleMouseDownOrTouchStartProgressBar\", function (event) {\n      event.stopPropagation();\n\n      var _this$getCurrentProgr = _this.getCurrentProgress(event.nativeEvent),\n          currentTime = _this$getCurrentProgr.currentTime,\n          currentTimePos = _this$getCurrentProgr.currentTimePos;\n\n      if (isFinite(currentTime)) {\n        _this.timeOnMouseMove = currentTime;\n\n        _this.setState({\n          isDraggingProgress: true,\n          currentTimePos: currentTimePos\n        });\n\n        if (event.nativeEvent instanceof MouseEvent) {\n          window.addEventListener('mousemove', _this.handleWindowMouseOrTouchMove);\n          window.addEventListener('mouseup', _this.handleWindowMouseOrTouchUp);\n        } else {\n          window.addEventListener('touchmove', _this.handleWindowMouseOrTouchMove);\n          window.addEventListener('touchend', _this.handleWindowMouseOrTouchUp);\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleWindowMouseOrTouchMove\", function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n      var windowSelection = window.getSelection();\n\n      if (windowSelection && windowSelection.type === 'Range') {\n        windowSelection.empty();\n      }\n\n      var isDraggingProgress = _this.state.isDraggingProgress;\n\n      if (isDraggingProgress) {\n        var _this$getCurrentProgr2 = _this.getCurrentProgress(event),\n            currentTime = _this$getCurrentProgr2.currentTime,\n            currentTimePos = _this$getCurrentProgr2.currentTimePos;\n\n        _this.timeOnMouseMove = currentTime;\n\n        _this.setState({\n          currentTimePos: currentTimePos\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleWindowMouseOrTouchUp\", function (event) {\n      event.stopPropagation();\n      var newTime = _this.timeOnMouseMove;\n      var onSeek = _this.props.onSeek;\n\n      if (onSeek) {\n        _this.setState({\n          isDraggingProgress: false,\n          waitingForSeekCallback: true\n        }, function () {\n          onSeek(_this.props.audio, newTime).then(function () {\n            return _this.setState({\n              waitingForSeekCallback: false\n            });\n          });\n        });\n      } else {\n        if (isFinite(newTime)) {\n          _this.props.audio.currentTime = newTime;\n        }\n\n        _this.setState({\n          isDraggingProgress: false\n        });\n      }\n\n      if (event instanceof MouseEvent) {\n        window.removeEventListener('mousemove', _this.handleWindowMouseOrTouchMove);\n        window.removeEventListener('mouseup', _this.handleWindowMouseOrTouchUp);\n      } else {\n        window.removeEventListener('touchmove', _this.handleWindowMouseOrTouchMove);\n        window.removeEventListener('touchend', _this.handleWindowMouseOrTouchUp);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleAudioTimeUpdate\", throttle(function (e) {\n      var isDraggingProgress = _this.state.isDraggingProgress;\n      var audio = e.target;\n      if (isDraggingProgress || _this.state.waitingForSeekCallback === true) return;\n      var currentTime = audio.currentTime;\n\n      var duration = _this.getDuration();\n\n      _this.setState({\n        currentTimePos: (currentTime / duration * 100 || 0).toFixed(2) + \"%\"\n      });\n    }, _this.props.progressUpdateInterval));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleAudioDownloadProgressUpdate\", function (e) {\n      var audio = e.target;\n\n      var duration = _this.getDuration();\n\n      var downloadProgressArr = [];\n\n      for (var i = 0; i < audio.buffered.length; i++) {\n        var bufferedStart = audio.buffered.start(i);\n        var bufferedEnd = audio.buffered.end(i);\n        downloadProgressArr.push({\n          left: (Math.round(100 / duration * bufferedStart) || 0) + \"%\",\n          width: (Math.round(100 / duration * (bufferedEnd - bufferedStart)) || 0) + \"%\"\n        });\n      }\n\n      clearTimeout(_this.downloadProgressAnimationTimer);\n\n      _this.setState({\n        downloadProgressArr: downloadProgressArr,\n        hasDownloadProgressAnimation: true\n      });\n\n      _this.downloadProgressAnimationTimer = setTimeout(function () {\n        _this.setState({\n          hasDownloadProgressAnimation: false\n        });\n      }, 200);\n    });\n\n    return _this;\n  }\n\n  var _proto = ProgressBar.prototype;\n\n  _proto.getDuration = function getDuration() {\n    var _this$props2 = this.props,\n        audio = _this$props2.audio,\n        srcDuration = _this$props2.srcDuration;\n    return typeof srcDuration === 'undefined' ? audio.duration : srcDuration;\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate() {\n    var audio = this.props.audio;\n\n    if (audio && !this.hasAddedAudioEventListener) {\n      this.audio = audio;\n      this.hasAddedAudioEventListener = true;\n      audio.addEventListener('timeupdate', this.handleAudioTimeUpdate);\n      audio.addEventListener('progress', this.handleAudioDownloadProgressUpdate);\n    }\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    if (this.audio && this.hasAddedAudioEventListener) {\n      this.audio.removeEventListener('timeupdate', this.handleAudioTimeUpdate);\n      this.audio.removeEventListener('progress', this.handleAudioDownloadProgressUpdate);\n    }\n\n    clearTimeout(this.downloadProgressAnimationTimer);\n  };\n\n  _proto.render = function render() {\n    var _this$props3 = this.props,\n        showDownloadProgress = _this$props3.showDownloadProgress,\n        showFilledProgress = _this$props3.showFilledProgress,\n        progressBar = _this$props3.progressBar;\n    var _this$state = this.state,\n        currentTimePos = _this$state.currentTimePos,\n        downloadProgressArr = _this$state.downloadProgressArr,\n        hasDownloadProgressAnimation = _this$state.hasDownloadProgressAnimation;\n    return React.createElement(\"div\", {\n      className: \"rhap_progress-container\",\n      ref: progressBar,\n      \"aria-label\": \"Audio Progress Control\",\n      role: \"progressbar\",\n      \"aria-valuemin\": 0,\n      \"aria-valuemax\": 100,\n      \"aria-valuenow\": Number(currentTimePos.split('%')[0]),\n      tabIndex: 0,\n      onMouseDown: this.handleMouseDownOrTouchStartProgressBar,\n      onTouchStart: this.handleMouseDownOrTouchStartProgressBar,\n      onContextMenu: this.handleContextMenu\n    }, React.createElement(\"div\", {\n      className: \"rhap_progress-bar \" + (showDownloadProgress ? 'rhap_progress-bar-show-download' : '')\n    }, React.createElement(\"div\", {\n      className: \"rhap_progress-indicator\",\n      style: {\n        left: currentTimePos\n      }\n    }), showFilledProgress && React.createElement(\"div\", {\n      className: \"rhap_progress-filled\",\n      style: {\n        width: currentTimePos\n      }\n    }), showDownloadProgress && downloadProgressArr.map(function (_ref, i) {\n      var left = _ref.left,\n          width = _ref.width;\n      return React.createElement(\"div\", {\n        key: i,\n        className: \"rhap_download-progress\",\n        style: {\n          left: left,\n          width: width,\n          transitionDuration: hasDownloadProgressAnimation ? '.2s' : '0s'\n        }\n      });\n    })));\n  };\n\n  return ProgressBar;\n}(Component);\n\nvar ProgressBarForwardRef = function ProgressBarForwardRef(props, ref) {\n  return React.createElement(ProgressBar, _extends({}, props, {\n    progressBar: ref\n  }));\n};\n\nexport default forwardRef(ProgressBarForwardRef);\nexport { ProgressBar, ProgressBarForwardRef };","map":{"version":3,"sources":["/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/react-h5-audio-player/es/ProgressBar.js"],"names":["_extends","_assertThisInitialized","_inheritsLoose","_defineProperty","React","Component","forwardRef","getPosX","throttle","ProgressBar","_Component","_this","_len","arguments","length","args","Array","_key","call","apply","concat","isDraggingProgress","currentTimePos","hasDownloadProgressAnimation","downloadProgressArr","waitingForSeekCallback","event","_this$props","props","audio","progressBar","isSingleFileProgressiveDownload","src","indexOf","srcDuration","isFinite","currentTime","current","progressBarRect","getBoundingClientRect","maxRelativePos","width","relativePos","left","duration","getDuration","toFixed","preventDefault","stopPropagation","_this$getCurrentProgr","getCurrentProgress","nativeEvent","timeOnMouseMove","setState","MouseEvent","window","addEventListener","handleWindowMouseOrTouchMove","handleWindowMouseOrTouchUp","windowSelection","getSelection","type","empty","state","_this$getCurrentProgr2","newTime","onSeek","then","removeEventListener","e","target","progressUpdateInterval","i","buffered","bufferedStart","start","bufferedEnd","end","push","Math","round","clearTimeout","downloadProgressAnimationTimer","setTimeout","_proto","prototype","_this$props2","componentDidUpdate","hasAddedAudioEventListener","handleAudioTimeUpdate","handleAudioDownloadProgressUpdate","componentWillUnmount","render","_this$props3","showDownloadProgress","showFilledProgress","_this$state","createElement","className","ref","role","Number","split","tabIndex","onMouseDown","handleMouseDownOrTouchStartProgressBar","onTouchStart","onContextMenu","handleContextMenu","style","map","_ref","key","transitionDuration","ProgressBarForwardRef"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/extends\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport React, { Component, forwardRef } from 'react';\nimport { getPosX, throttle } from './utils';\n\nvar ProgressBar = function (_Component) {\n  _inheritsLoose(ProgressBar, _Component);\n\n  function ProgressBar() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _Component.call.apply(_Component, [this].concat(args)) || this;\n\n    _defineProperty(_assertThisInitialized(_this), \"audio\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"timeOnMouseMove\", 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"hasAddedAudioEventListener\", false);\n\n    _defineProperty(_assertThisInitialized(_this), \"downloadProgressAnimationTimer\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      isDraggingProgress: false,\n      currentTimePos: '0%',\n      hasDownloadProgressAnimation: false,\n      downloadProgressArr: [],\n      waitingForSeekCallback: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getCurrentProgress\", function (event) {\n      var _this$props = _this.props,\n          audio = _this$props.audio,\n          progressBar = _this$props.progressBar;\n      var isSingleFileProgressiveDownload = audio.src.indexOf('blob:') !== 0 && typeof _this.props.srcDuration === 'undefined';\n\n      if (isSingleFileProgressiveDownload && (!audio.src || !isFinite(audio.currentTime) || !progressBar.current)) {\n        return {\n          currentTime: 0,\n          currentTimePos: '0%'\n        };\n      }\n\n      var progressBarRect = progressBar.current.getBoundingClientRect();\n      var maxRelativePos = progressBarRect.width;\n      var relativePos = getPosX(event) - progressBarRect.left;\n\n      if (relativePos < 0) {\n        relativePos = 0;\n      } else if (relativePos > maxRelativePos) {\n        relativePos = maxRelativePos;\n      }\n\n      var duration = _this.getDuration();\n\n      var currentTime = duration * relativePos / maxRelativePos;\n      return {\n        currentTime: currentTime,\n        currentTimePos: (relativePos / maxRelativePos * 100).toFixed(2) + \"%\"\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleContextMenu\", function (event) {\n      event.preventDefault();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleMouseDownOrTouchStartProgressBar\", function (event) {\n      event.stopPropagation();\n\n      var _this$getCurrentProgr = _this.getCurrentProgress(event.nativeEvent),\n          currentTime = _this$getCurrentProgr.currentTime,\n          currentTimePos = _this$getCurrentProgr.currentTimePos;\n\n      if (isFinite(currentTime)) {\n        _this.timeOnMouseMove = currentTime;\n\n        _this.setState({\n          isDraggingProgress: true,\n          currentTimePos: currentTimePos\n        });\n\n        if (event.nativeEvent instanceof MouseEvent) {\n          window.addEventListener('mousemove', _this.handleWindowMouseOrTouchMove);\n          window.addEventListener('mouseup', _this.handleWindowMouseOrTouchUp);\n        } else {\n          window.addEventListener('touchmove', _this.handleWindowMouseOrTouchMove);\n          window.addEventListener('touchend', _this.handleWindowMouseOrTouchUp);\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleWindowMouseOrTouchMove\", function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n      var windowSelection = window.getSelection();\n\n      if (windowSelection && windowSelection.type === 'Range') {\n        windowSelection.empty();\n      }\n\n      var isDraggingProgress = _this.state.isDraggingProgress;\n\n      if (isDraggingProgress) {\n        var _this$getCurrentProgr2 = _this.getCurrentProgress(event),\n            currentTime = _this$getCurrentProgr2.currentTime,\n            currentTimePos = _this$getCurrentProgr2.currentTimePos;\n\n        _this.timeOnMouseMove = currentTime;\n\n        _this.setState({\n          currentTimePos: currentTimePos\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleWindowMouseOrTouchUp\", function (event) {\n      event.stopPropagation();\n      var newTime = _this.timeOnMouseMove;\n      var onSeek = _this.props.onSeek;\n\n      if (onSeek) {\n        _this.setState({\n          isDraggingProgress: false,\n          waitingForSeekCallback: true\n        }, function () {\n          onSeek(_this.props.audio, newTime).then(function () {\n            return _this.setState({\n              waitingForSeekCallback: false\n            });\n          });\n        });\n      } else {\n        if (isFinite(newTime)) {\n          _this.props.audio.currentTime = newTime;\n        }\n\n        _this.setState({\n          isDraggingProgress: false\n        });\n      }\n\n      if (event instanceof MouseEvent) {\n        window.removeEventListener('mousemove', _this.handleWindowMouseOrTouchMove);\n        window.removeEventListener('mouseup', _this.handleWindowMouseOrTouchUp);\n      } else {\n        window.removeEventListener('touchmove', _this.handleWindowMouseOrTouchMove);\n        window.removeEventListener('touchend', _this.handleWindowMouseOrTouchUp);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleAudioTimeUpdate\", throttle(function (e) {\n      var isDraggingProgress = _this.state.isDraggingProgress;\n      var audio = e.target;\n      if (isDraggingProgress || _this.state.waitingForSeekCallback === true) return;\n      var currentTime = audio.currentTime;\n\n      var duration = _this.getDuration();\n\n      _this.setState({\n        currentTimePos: (currentTime / duration * 100 || 0).toFixed(2) + \"%\"\n      });\n    }, _this.props.progressUpdateInterval));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleAudioDownloadProgressUpdate\", function (e) {\n      var audio = e.target;\n\n      var duration = _this.getDuration();\n\n      var downloadProgressArr = [];\n\n      for (var i = 0; i < audio.buffered.length; i++) {\n        var bufferedStart = audio.buffered.start(i);\n        var bufferedEnd = audio.buffered.end(i);\n        downloadProgressArr.push({\n          left: (Math.round(100 / duration * bufferedStart) || 0) + \"%\",\n          width: (Math.round(100 / duration * (bufferedEnd - bufferedStart)) || 0) + \"%\"\n        });\n      }\n\n      clearTimeout(_this.downloadProgressAnimationTimer);\n\n      _this.setState({\n        downloadProgressArr: downloadProgressArr,\n        hasDownloadProgressAnimation: true\n      });\n\n      _this.downloadProgressAnimationTimer = setTimeout(function () {\n        _this.setState({\n          hasDownloadProgressAnimation: false\n        });\n      }, 200);\n    });\n\n    return _this;\n  }\n\n  var _proto = ProgressBar.prototype;\n\n  _proto.getDuration = function getDuration() {\n    var _this$props2 = this.props,\n        audio = _this$props2.audio,\n        srcDuration = _this$props2.srcDuration;\n    return typeof srcDuration === 'undefined' ? audio.duration : srcDuration;\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate() {\n    var audio = this.props.audio;\n\n    if (audio && !this.hasAddedAudioEventListener) {\n      this.audio = audio;\n      this.hasAddedAudioEventListener = true;\n      audio.addEventListener('timeupdate', this.handleAudioTimeUpdate);\n      audio.addEventListener('progress', this.handleAudioDownloadProgressUpdate);\n    }\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    if (this.audio && this.hasAddedAudioEventListener) {\n      this.audio.removeEventListener('timeupdate', this.handleAudioTimeUpdate);\n      this.audio.removeEventListener('progress', this.handleAudioDownloadProgressUpdate);\n    }\n\n    clearTimeout(this.downloadProgressAnimationTimer);\n  };\n\n  _proto.render = function render() {\n    var _this$props3 = this.props,\n        showDownloadProgress = _this$props3.showDownloadProgress,\n        showFilledProgress = _this$props3.showFilledProgress,\n        progressBar = _this$props3.progressBar;\n    var _this$state = this.state,\n        currentTimePos = _this$state.currentTimePos,\n        downloadProgressArr = _this$state.downloadProgressArr,\n        hasDownloadProgressAnimation = _this$state.hasDownloadProgressAnimation;\n    return React.createElement(\"div\", {\n      className: \"rhap_progress-container\",\n      ref: progressBar,\n      \"aria-label\": \"Audio Progress Control\",\n      role: \"progressbar\",\n      \"aria-valuemin\": 0,\n      \"aria-valuemax\": 100,\n      \"aria-valuenow\": Number(currentTimePos.split('%')[0]),\n      tabIndex: 0,\n      onMouseDown: this.handleMouseDownOrTouchStartProgressBar,\n      onTouchStart: this.handleMouseDownOrTouchStartProgressBar,\n      onContextMenu: this.handleContextMenu\n    }, React.createElement(\"div\", {\n      className: \"rhap_progress-bar \" + (showDownloadProgress ? 'rhap_progress-bar-show-download' : '')\n    }, React.createElement(\"div\", {\n      className: \"rhap_progress-indicator\",\n      style: {\n        left: currentTimePos\n      }\n    }), showFilledProgress && React.createElement(\"div\", {\n      className: \"rhap_progress-filled\",\n      style: {\n        width: currentTimePos\n      }\n    }), showDownloadProgress && downloadProgressArr.map(function (_ref, i) {\n      var left = _ref.left,\n          width = _ref.width;\n      return React.createElement(\"div\", {\n        key: i,\n        className: \"rhap_download-progress\",\n        style: {\n          left: left,\n          width: width,\n          transitionDuration: hasDownloadProgressAnimation ? '.2s' : '0s'\n        }\n      });\n    })));\n  };\n\n  return ProgressBar;\n}(Component);\n\nvar ProgressBarForwardRef = function ProgressBarForwardRef(props, ref) {\n  return React.createElement(ProgressBar, _extends({}, props, {\n    progressBar: ref\n  }));\n};\n\nexport default forwardRef(ProgressBarForwardRef);\nexport { ProgressBar, ProgressBarForwardRef };"]},"metadata":{},"sourceType":"module"}