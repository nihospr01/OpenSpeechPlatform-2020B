{"ast":null,"code":"import _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport set from 'lodash/set';\nimport createFormField, { isFormField } from './createFormField';\nimport { hasRules, flattenFields, getErrorStrs, startsWith } from './utils';\n\nfunction partOf(a, b) {\n  return b.indexOf(a) === 0 && ['.', '['].indexOf(b[a.length]) !== -1;\n}\n\nfunction internalFlattenFields(fields) {\n  return flattenFields(fields, function (_, node) {\n    return isFormField(node);\n  }, 'You must wrap field data with `createFormField`.');\n}\n\nvar FieldsStore = function () {\n  function FieldsStore(fields) {\n    _classCallCheck(this, FieldsStore);\n\n    _initialiseProps.call(this);\n\n    this.fields = internalFlattenFields(fields);\n    this.fieldsMeta = {};\n  }\n\n  _createClass(FieldsStore, [{\n    key: 'updateFields',\n    value: function updateFields(fields) {\n      this.fields = internalFlattenFields(fields);\n    }\n  }, {\n    key: 'flattenRegisteredFields',\n    value: function flattenRegisteredFields(fields) {\n      var validFieldsName = this.getAllFieldsName();\n      return flattenFields(fields, function (path) {\n        return validFieldsName.indexOf(path) >= 0;\n      }, 'You cannot set a form field before rendering a field associated with the value.');\n    }\n  }, {\n    key: 'setFields',\n    value: function setFields(fields) {\n      var _this = this;\n\n      var fieldsMeta = this.fieldsMeta;\n\n      var nowFields = _extends({}, this.fields, fields);\n\n      var nowValues = {};\n      Object.keys(fieldsMeta).forEach(function (f) {\n        nowValues[f] = _this.getValueFromFields(f, nowFields);\n      });\n      Object.keys(nowValues).forEach(function (f) {\n        var value = nowValues[f];\n\n        var fieldMeta = _this.getFieldMeta(f);\n\n        if (fieldMeta && fieldMeta.normalize) {\n          var nowValue = fieldMeta.normalize(value, _this.getValueFromFields(f, _this.fields), nowValues);\n\n          if (nowValue !== value) {\n            nowFields[f] = _extends({}, nowFields[f], {\n              value: nowValue\n            });\n          }\n        }\n      });\n      this.fields = nowFields;\n    }\n  }, {\n    key: 'resetFields',\n    value: function resetFields(ns) {\n      var fields = this.fields;\n      var names = ns ? this.getValidFieldsFullName(ns) : this.getAllFieldsName();\n      return names.reduce(function (acc, name) {\n        var field = fields[name];\n\n        if (field && 'value' in field) {\n          acc[name] = {};\n        }\n\n        return acc;\n      }, {});\n    }\n  }, {\n    key: 'setFieldMeta',\n    value: function setFieldMeta(name, meta) {\n      this.fieldsMeta[name] = meta;\n    }\n  }, {\n    key: 'setFieldsAsDirty',\n    value: function setFieldsAsDirty() {\n      var _this2 = this;\n\n      Object.keys(this.fields).forEach(function (name) {\n        var field = _this2.fields[name];\n        var fieldMeta = _this2.fieldsMeta[name];\n\n        if (field && fieldMeta && hasRules(fieldMeta.validate)) {\n          _this2.fields[name] = _extends({}, field, {\n            dirty: true\n          });\n        }\n      });\n    }\n  }, {\n    key: 'getFieldMeta',\n    value: function getFieldMeta(name) {\n      this.fieldsMeta[name] = this.fieldsMeta[name] || {};\n      return this.fieldsMeta[name];\n    }\n  }, {\n    key: 'getValueFromFields',\n    value: function getValueFromFields(name, fields) {\n      var field = fields[name];\n\n      if (field && 'value' in field) {\n        return field.value;\n      }\n\n      var fieldMeta = this.getFieldMeta(name);\n      return fieldMeta && fieldMeta.initialValue;\n    }\n  }, {\n    key: 'getValidFieldsName',\n    value: function getValidFieldsName() {\n      var _this3 = this;\n\n      var fieldsMeta = this.fieldsMeta;\n      return fieldsMeta ? Object.keys(fieldsMeta).filter(function (name) {\n        return !_this3.getFieldMeta(name).hidden;\n      }) : [];\n    }\n  }, {\n    key: 'getAllFieldsName',\n    value: function getAllFieldsName() {\n      var fieldsMeta = this.fieldsMeta;\n      return fieldsMeta ? Object.keys(fieldsMeta) : [];\n    }\n  }, {\n    key: 'getValidFieldsFullName',\n    value: function getValidFieldsFullName(maybePartialName) {\n      var maybePartialNames = Array.isArray(maybePartialName) ? maybePartialName : [maybePartialName];\n      return this.getValidFieldsName().filter(function (fullName) {\n        return maybePartialNames.some(function (partialName) {\n          return fullName === partialName || startsWith(fullName, partialName) && ['.', '['].indexOf(fullName[partialName.length]) >= 0;\n        });\n      });\n    }\n  }, {\n    key: 'getFieldValuePropValue',\n    value: function getFieldValuePropValue(fieldMeta) {\n      var name = fieldMeta.name,\n          getValueProps = fieldMeta.getValueProps,\n          valuePropName = fieldMeta.valuePropName;\n      var field = this.getField(name);\n      var fieldValue = 'value' in field ? field.value : fieldMeta.initialValue;\n\n      if (getValueProps) {\n        return getValueProps(fieldValue);\n      }\n\n      return _defineProperty({}, valuePropName, fieldValue);\n    }\n  }, {\n    key: 'getField',\n    value: function getField(name) {\n      return _extends({}, this.fields[name], {\n        name: name\n      });\n    }\n  }, {\n    key: 'getNotCollectedFields',\n    value: function getNotCollectedFields() {\n      var _this4 = this;\n\n      var fieldsName = this.getValidFieldsName();\n      return fieldsName.filter(function (name) {\n        return !_this4.fields[name];\n      }).map(function (name) {\n        return {\n          name: name,\n          dirty: false,\n          value: _this4.getFieldMeta(name).initialValue\n        };\n      }).reduce(function (acc, field) {\n        return set(acc, field.name, createFormField(field));\n      }, {});\n    }\n  }, {\n    key: 'getNestedAllFields',\n    value: function getNestedAllFields() {\n      var _this5 = this;\n\n      return Object.keys(this.fields).reduce(function (acc, name) {\n        return set(acc, name, createFormField(_this5.fields[name]));\n      }, this.getNotCollectedFields());\n    }\n  }, {\n    key: 'getFieldMember',\n    value: function getFieldMember(name, member) {\n      return this.getField(name)[member];\n    }\n  }, {\n    key: 'getNestedFields',\n    value: function getNestedFields(names, getter) {\n      var fields = names || this.getValidFieldsName();\n      return fields.reduce(function (acc, f) {\n        return set(acc, f, getter(f));\n      }, {});\n    }\n  }, {\n    key: 'getNestedField',\n    value: function getNestedField(name, getter) {\n      var fullNames = this.getValidFieldsFullName(name);\n\n      if (fullNames.length === 0 || // Not registered\n      fullNames.length === 1 && fullNames[0] === name // Name already is full name.\n      ) {\n          return getter(name);\n        }\n\n      var isArrayValue = fullNames[0][name.length] === '[';\n      var suffixNameStartIndex = isArrayValue ? name.length : name.length + 1;\n      return fullNames.reduce(function (acc, fullName) {\n        return set(acc, fullName.slice(suffixNameStartIndex), getter(fullName));\n      }, isArrayValue ? [] : {});\n    }\n  }, {\n    key: 'isValidNestedFieldName',\n    // @private\n    // BG: `a` and `a.b` cannot be use in the same form\n    value: function isValidNestedFieldName(name) {\n      var names = this.getAllFieldsName();\n      return names.every(function (n) {\n        return !partOf(n, name) && !partOf(name, n);\n      });\n    }\n  }, {\n    key: 'clearField',\n    value: function clearField(name) {\n      delete this.fields[name];\n      delete this.fieldsMeta[name];\n    }\n  }]);\n\n  return FieldsStore;\n}();\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this6 = this;\n\n  this.setFieldsInitialValue = function (initialValues) {\n    var flattenedInitialValues = _this6.flattenRegisteredFields(initialValues);\n\n    var fieldsMeta = _this6.fieldsMeta;\n    Object.keys(flattenedInitialValues).forEach(function (name) {\n      if (fieldsMeta[name]) {\n        _this6.setFieldMeta(name, _extends({}, _this6.getFieldMeta(name), {\n          initialValue: flattenedInitialValues[name]\n        }));\n      }\n    });\n  };\n\n  this.getAllValues = function () {\n    var fieldsMeta = _this6.fieldsMeta,\n        fields = _this6.fields;\n    return Object.keys(fieldsMeta).reduce(function (acc, name) {\n      return set(acc, name, _this6.getValueFromFields(name, fields));\n    }, {});\n  };\n\n  this.getFieldsValue = function (names) {\n    return _this6.getNestedFields(names, _this6.getFieldValue);\n  };\n\n  this.getFieldValue = function (name) {\n    var fields = _this6.fields;\n    return _this6.getNestedField(name, function (fullName) {\n      return _this6.getValueFromFields(fullName, fields);\n    });\n  };\n\n  this.getFieldsError = function (names) {\n    return _this6.getNestedFields(names, _this6.getFieldError);\n  };\n\n  this.getFieldError = function (name) {\n    return _this6.getNestedField(name, function (fullName) {\n      return getErrorStrs(_this6.getFieldMember(fullName, 'errors'));\n    });\n  };\n\n  this.isFieldValidating = function (name) {\n    return _this6.getFieldMember(name, 'validating');\n  };\n\n  this.isFieldsValidating = function (ns) {\n    var names = ns || _this6.getValidFieldsName();\n\n    return names.some(function (n) {\n      return _this6.isFieldValidating(n);\n    });\n  };\n\n  this.isFieldTouched = function (name) {\n    return _this6.getFieldMember(name, 'touched');\n  };\n\n  this.isFieldsTouched = function (ns) {\n    var names = ns || _this6.getValidFieldsName();\n\n    return names.some(function (n) {\n      return _this6.isFieldTouched(n);\n    });\n  };\n};\n\nexport default function createFieldsStore(fields) {\n  return new FieldsStore(fields);\n}","map":{"version":3,"sources":["/opt/osp/ewsnodejs-client/node_modules/rc-form/es/createFieldsStore.js"],"names":["_defineProperty","_extends","_classCallCheck","_createClass","set","createFormField","isFormField","hasRules","flattenFields","getErrorStrs","startsWith","partOf","a","b","indexOf","length","internalFlattenFields","fields","_","node","FieldsStore","_initialiseProps","call","fieldsMeta","key","value","updateFields","flattenRegisteredFields","validFieldsName","getAllFieldsName","path","setFields","_this","nowFields","nowValues","Object","keys","forEach","f","getValueFromFields","fieldMeta","getFieldMeta","normalize","nowValue","resetFields","ns","names","getValidFieldsFullName","reduce","acc","name","field","setFieldMeta","meta","setFieldsAsDirty","_this2","validate","dirty","initialValue","getValidFieldsName","_this3","filter","hidden","maybePartialName","maybePartialNames","Array","isArray","fullName","some","partialName","getFieldValuePropValue","getValueProps","valuePropName","getField","fieldValue","getNotCollectedFields","_this4","fieldsName","map","getNestedAllFields","_this5","getFieldMember","member","getNestedFields","getter","getNestedField","fullNames","isArrayValue","suffixNameStartIndex","slice","isValidNestedFieldName","every","n","clearField","_this6","setFieldsInitialValue","initialValues","flattenedInitialValues","getAllValues","getFieldsValue","getFieldValue","getFieldsError","getFieldError","isFieldValidating","isFieldsValidating","isFieldTouched","isFieldsTouched","createFieldsStore"],"mappings":"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","sourcesContent":["import _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport set from 'lodash/set';\nimport createFormField, { isFormField } from './createFormField';\nimport { hasRules, flattenFields, getErrorStrs, startsWith } from './utils';\n\nfunction partOf(a, b) {\n  return b.indexOf(a) === 0 && ['.', '['].indexOf(b[a.length]) !== -1;\n}\n\nfunction internalFlattenFields(fields) {\n  return flattenFields(fields, function (_, node) {\n    return isFormField(node);\n  }, 'You must wrap field data with `createFormField`.');\n}\n\nvar FieldsStore = function () {\n  function FieldsStore(fields) {\n    _classCallCheck(this, FieldsStore);\n\n    _initialiseProps.call(this);\n\n    this.fields = internalFlattenFields(fields);\n    this.fieldsMeta = {};\n  }\n\n  _createClass(FieldsStore, [{\n    key: 'updateFields',\n    value: function updateFields(fields) {\n      this.fields = internalFlattenFields(fields);\n    }\n  }, {\n    key: 'flattenRegisteredFields',\n    value: function flattenRegisteredFields(fields) {\n      var validFieldsName = this.getAllFieldsName();\n      return flattenFields(fields, function (path) {\n        return validFieldsName.indexOf(path) >= 0;\n      }, 'You cannot set a form field before rendering a field associated with the value.');\n    }\n  }, {\n    key: 'setFields',\n    value: function setFields(fields) {\n      var _this = this;\n\n      var fieldsMeta = this.fieldsMeta;\n      var nowFields = _extends({}, this.fields, fields);\n      var nowValues = {};\n      Object.keys(fieldsMeta).forEach(function (f) {\n        nowValues[f] = _this.getValueFromFields(f, nowFields);\n      });\n      Object.keys(nowValues).forEach(function (f) {\n        var value = nowValues[f];\n        var fieldMeta = _this.getFieldMeta(f);\n        if (fieldMeta && fieldMeta.normalize) {\n          var nowValue = fieldMeta.normalize(value, _this.getValueFromFields(f, _this.fields), nowValues);\n          if (nowValue !== value) {\n            nowFields[f] = _extends({}, nowFields[f], {\n              value: nowValue\n            });\n          }\n        }\n      });\n      this.fields = nowFields;\n    }\n  }, {\n    key: 'resetFields',\n    value: function resetFields(ns) {\n      var fields = this.fields;\n\n      var names = ns ? this.getValidFieldsFullName(ns) : this.getAllFieldsName();\n      return names.reduce(function (acc, name) {\n        var field = fields[name];\n        if (field && 'value' in field) {\n          acc[name] = {};\n        }\n        return acc;\n      }, {});\n    }\n  }, {\n    key: 'setFieldMeta',\n    value: function setFieldMeta(name, meta) {\n      this.fieldsMeta[name] = meta;\n    }\n  }, {\n    key: 'setFieldsAsDirty',\n    value: function setFieldsAsDirty() {\n      var _this2 = this;\n\n      Object.keys(this.fields).forEach(function (name) {\n        var field = _this2.fields[name];\n        var fieldMeta = _this2.fieldsMeta[name];\n        if (field && fieldMeta && hasRules(fieldMeta.validate)) {\n          _this2.fields[name] = _extends({}, field, {\n            dirty: true\n          });\n        }\n      });\n    }\n  }, {\n    key: 'getFieldMeta',\n    value: function getFieldMeta(name) {\n      this.fieldsMeta[name] = this.fieldsMeta[name] || {};\n      return this.fieldsMeta[name];\n    }\n  }, {\n    key: 'getValueFromFields',\n    value: function getValueFromFields(name, fields) {\n      var field = fields[name];\n      if (field && 'value' in field) {\n        return field.value;\n      }\n      var fieldMeta = this.getFieldMeta(name);\n      return fieldMeta && fieldMeta.initialValue;\n    }\n  }, {\n    key: 'getValidFieldsName',\n    value: function getValidFieldsName() {\n      var _this3 = this;\n\n      var fieldsMeta = this.fieldsMeta;\n\n      return fieldsMeta ? Object.keys(fieldsMeta).filter(function (name) {\n        return !_this3.getFieldMeta(name).hidden;\n      }) : [];\n    }\n  }, {\n    key: 'getAllFieldsName',\n    value: function getAllFieldsName() {\n      var fieldsMeta = this.fieldsMeta;\n\n      return fieldsMeta ? Object.keys(fieldsMeta) : [];\n    }\n  }, {\n    key: 'getValidFieldsFullName',\n    value: function getValidFieldsFullName(maybePartialName) {\n      var maybePartialNames = Array.isArray(maybePartialName) ? maybePartialName : [maybePartialName];\n      return this.getValidFieldsName().filter(function (fullName) {\n        return maybePartialNames.some(function (partialName) {\n          return fullName === partialName || startsWith(fullName, partialName) && ['.', '['].indexOf(fullName[partialName.length]) >= 0;\n        });\n      });\n    }\n  }, {\n    key: 'getFieldValuePropValue',\n    value: function getFieldValuePropValue(fieldMeta) {\n      var name = fieldMeta.name,\n          getValueProps = fieldMeta.getValueProps,\n          valuePropName = fieldMeta.valuePropName;\n\n      var field = this.getField(name);\n      var fieldValue = 'value' in field ? field.value : fieldMeta.initialValue;\n      if (getValueProps) {\n        return getValueProps(fieldValue);\n      }\n      return _defineProperty({}, valuePropName, fieldValue);\n    }\n  }, {\n    key: 'getField',\n    value: function getField(name) {\n      return _extends({}, this.fields[name], {\n        name: name\n      });\n    }\n  }, {\n    key: 'getNotCollectedFields',\n    value: function getNotCollectedFields() {\n      var _this4 = this;\n\n      var fieldsName = this.getValidFieldsName();\n      return fieldsName.filter(function (name) {\n        return !_this4.fields[name];\n      }).map(function (name) {\n        return {\n          name: name,\n          dirty: false,\n          value: _this4.getFieldMeta(name).initialValue\n        };\n      }).reduce(function (acc, field) {\n        return set(acc, field.name, createFormField(field));\n      }, {});\n    }\n  }, {\n    key: 'getNestedAllFields',\n    value: function getNestedAllFields() {\n      var _this5 = this;\n\n      return Object.keys(this.fields).reduce(function (acc, name) {\n        return set(acc, name, createFormField(_this5.fields[name]));\n      }, this.getNotCollectedFields());\n    }\n  }, {\n    key: 'getFieldMember',\n    value: function getFieldMember(name, member) {\n      return this.getField(name)[member];\n    }\n  }, {\n    key: 'getNestedFields',\n    value: function getNestedFields(names, getter) {\n      var fields = names || this.getValidFieldsName();\n      return fields.reduce(function (acc, f) {\n        return set(acc, f, getter(f));\n      }, {});\n    }\n  }, {\n    key: 'getNestedField',\n    value: function getNestedField(name, getter) {\n      var fullNames = this.getValidFieldsFullName(name);\n      if (fullNames.length === 0 || // Not registered\n      fullNames.length === 1 && fullNames[0] === name // Name already is full name.\n      ) {\n          return getter(name);\n        }\n      var isArrayValue = fullNames[0][name.length] === '[';\n      var suffixNameStartIndex = isArrayValue ? name.length : name.length + 1;\n      return fullNames.reduce(function (acc, fullName) {\n        return set(acc, fullName.slice(suffixNameStartIndex), getter(fullName));\n      }, isArrayValue ? [] : {});\n    }\n  }, {\n    key: 'isValidNestedFieldName',\n\n\n    // @private\n    // BG: `a` and `a.b` cannot be use in the same form\n    value: function isValidNestedFieldName(name) {\n      var names = this.getAllFieldsName();\n      return names.every(function (n) {\n        return !partOf(n, name) && !partOf(name, n);\n      });\n    }\n  }, {\n    key: 'clearField',\n    value: function clearField(name) {\n      delete this.fields[name];\n      delete this.fieldsMeta[name];\n    }\n  }]);\n\n  return FieldsStore;\n}();\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this6 = this;\n\n  this.setFieldsInitialValue = function (initialValues) {\n    var flattenedInitialValues = _this6.flattenRegisteredFields(initialValues);\n    var fieldsMeta = _this6.fieldsMeta;\n    Object.keys(flattenedInitialValues).forEach(function (name) {\n      if (fieldsMeta[name]) {\n        _this6.setFieldMeta(name, _extends({}, _this6.getFieldMeta(name), {\n          initialValue: flattenedInitialValues[name]\n        }));\n      }\n    });\n  };\n\n  this.getAllValues = function () {\n    var fieldsMeta = _this6.fieldsMeta,\n        fields = _this6.fields;\n\n    return Object.keys(fieldsMeta).reduce(function (acc, name) {\n      return set(acc, name, _this6.getValueFromFields(name, fields));\n    }, {});\n  };\n\n  this.getFieldsValue = function (names) {\n    return _this6.getNestedFields(names, _this6.getFieldValue);\n  };\n\n  this.getFieldValue = function (name) {\n    var fields = _this6.fields;\n\n    return _this6.getNestedField(name, function (fullName) {\n      return _this6.getValueFromFields(fullName, fields);\n    });\n  };\n\n  this.getFieldsError = function (names) {\n    return _this6.getNestedFields(names, _this6.getFieldError);\n  };\n\n  this.getFieldError = function (name) {\n    return _this6.getNestedField(name, function (fullName) {\n      return getErrorStrs(_this6.getFieldMember(fullName, 'errors'));\n    });\n  };\n\n  this.isFieldValidating = function (name) {\n    return _this6.getFieldMember(name, 'validating');\n  };\n\n  this.isFieldsValidating = function (ns) {\n    var names = ns || _this6.getValidFieldsName();\n    return names.some(function (n) {\n      return _this6.isFieldValidating(n);\n    });\n  };\n\n  this.isFieldTouched = function (name) {\n    return _this6.getFieldMember(name, 'touched');\n  };\n\n  this.isFieldsTouched = function (ns) {\n    var names = ns || _this6.getValidFieldsName();\n    return names.some(function (n) {\n      return _this6.isFieldTouched(n);\n    });\n  };\n};\n\nexport default function createFieldsStore(fields) {\n  return new FieldsStore(fields);\n}"]},"metadata":{},"sourceType":"module"}