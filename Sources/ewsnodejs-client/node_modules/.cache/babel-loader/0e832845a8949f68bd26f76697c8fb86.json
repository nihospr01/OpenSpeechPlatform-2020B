{"ast":null,"code":"import _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport { decode } from 'draft-js/lib/DraftOffsetKey';\nimport Animate from 'rc-animate';\nimport cx from 'classnames';\nimport scrollIntoView from 'dom-scroll-into-view';\nimport Nav from './Nav.react';\nimport SuggetionWrapper from './SuggestionWrapper.react';\nimport insertMention from '../utils/insertMention';\nimport clearMention from '../utils/clearMention';\nimport getOffset from '../utils/getOffset';\nimport getMentions from '../utils/getMentions';\nimport getSearchWord from '../utils/getSearchWord';\n\nvar isNotFalse = function isNotFalse(i) {\n  return i !== false;\n};\n\nvar Suggestions = function (_React$Component) {\n  _inherits(Suggestions, _React$Component);\n\n  function Suggestions() {\n    _classCallCheck(this, Suggestions);\n\n    var _this = _possibleConstructorReturn(this, _React$Component.call(this));\n\n    _this.onEditorStateChange = function (editorState) {\n      var offset = _this.props.store.getOffset();\n\n      if (offset.size === 0) {\n        _this.closeDropDown();\n\n        return editorState;\n      }\n\n      var selection = editorState.getSelection(); // 修复: 焦点移出再移入时, dropdown 会闪动一下\n      // 原因: https://github.com/facebook/draft-js/blob/67c5e69499e3b0c149ce83b004872afdf4180463/src/component/handlers/edit/editOnFocus.js#L33\n      // 此处强制 update 了一下,因此 onEditorStateChange 会 call 两次\n\n      if (!_this.props.callbacks.getEditorState().getSelection().getHasFocus() && selection.getHasFocus()) {\n        return editorState;\n      }\n\n      var _getSearchWord = getSearchWord(editorState, selection),\n          word = _getSearchWord.word;\n\n      if (!word) {\n        _this.closeDropDown();\n\n        return editorState;\n      }\n\n      var selectionInsideMention = offset.map(function (_ref) {\n        var offsetKey = _ref.offsetKey;\n\n        var _decode = decode(offsetKey),\n            blockKey = _decode.blockKey,\n            decoratorKey = _decode.decoratorKey,\n            leafKey = _decode.leafKey;\n\n        if (blockKey !== selection.anchorKey) {\n          return false;\n        }\n\n        var leaf = editorState.getBlockTree(blockKey).getIn([decoratorKey, 'leaves', leafKey]);\n\n        if (!leaf) {\n          return false;\n        }\n\n        var startKey = leaf.get('start');\n        var endKey = leaf.get('end'); // 处理只有一个 `@` 符号时的情况\n\n        if (!word) {\n          return false;\n        }\n\n        if (startKey === endKey - 1) {\n          return selection.anchorOffset >= startKey + 1 && selection.anchorOffset <= endKey ? offsetKey : false;\n        }\n\n        return selection.anchorOffset > startKey + 1 && selection.anchorOffset <= endKey ? offsetKey : false;\n      });\n      var selectionInText = selectionInsideMention.some(isNotFalse);\n      _this.activeOffsetKey = selectionInsideMention.find(isNotFalse) || _this.activeOffsetKey;\n\n      var trigger = _this.props.store.getTrigger(_this.activeOffsetKey);\n\n      if (!selectionInText || !selection.getHasFocus()) {\n        _this.closeDropDown();\n\n        return editorState;\n      }\n\n      var searchValue = word.substring(trigger.length, word.length);\n\n      if (_this.lastSearchValue !== searchValue || _this.lastTrigger !== trigger) {\n        _this.lastSearchValue = searchValue;\n        _this.lastTrigger = trigger;\n\n        _this.props.onSearchChange(searchValue, trigger);\n      }\n\n      if (!_this.state.active) {\n        // 特例处理 https://github.com/ant-design/ant-design/issues/7838\n        // 暂时没有更优雅的方法\n        if (!trigger || word.indexOf(trigger) !== -1) {\n          _this.openDropDown();\n        }\n      }\n\n      return editorState;\n    };\n\n    _this.onUpArrow = function (ev) {\n      ev.preventDefault();\n\n      if (_this.props.suggestions.length > 0) {\n        var newIndex = _this.state.focusedIndex - 1;\n\n        _this.setState({\n          focusedIndex: Math.max(newIndex, 0)\n        });\n      }\n    };\n\n    _this.onBlur = function (ev) {\n      ev.preventDefault();\n\n      _this.closeDropDown();\n    };\n\n    _this.onDownArrow = function (ev) {\n      ev.preventDefault();\n      var newIndex = _this.state.focusedIndex + 1;\n\n      _this.setState({\n        focusedIndex: newIndex >= _this.props.suggestions.length ? 0 : newIndex\n      });\n    };\n\n    _this.getContainer = function () {\n      var popupContainer = document.createElement('div');\n      var mountNode = void 0;\n\n      if (_this.props.getSuggestionContainer) {\n        mountNode = _this.props.getSuggestionContainer();\n        popupContainer.style.position = 'relative';\n      } else {\n        mountNode = document.body;\n      }\n\n      mountNode.appendChild(popupContainer);\n      return popupContainer;\n    };\n\n    _this.handleKeyBinding = function (command) {\n      return command === 'split-block';\n    };\n\n    _this.handleReturn = function (ev) {\n      ev.preventDefault();\n      var selectedSuggestion = _this.props.suggestions[_this.state.focusedIndex];\n\n      if (selectedSuggestion) {\n        if (React.isValidElement(selectedSuggestion)) {\n          _this.onMentionSelect(selectedSuggestion.props.value, selectedSuggestion.props.data);\n        } else {\n          _this.onMentionSelect(selectedSuggestion);\n        }\n\n        _this.lastSearchValue = null;\n        _this.lastTrigger = null;\n        return true;\n      }\n\n      return false;\n    };\n\n    _this.renderReady = function () {\n      var container = _this.dropdownContainer;\n\n      if (!container) {\n        return;\n      }\n\n      var active = _this.state.active;\n      var activeOffsetKey = _this.activeOffsetKey;\n\n      var offset = _this.props.store.getOffset();\n\n      var dropDownPosition = offset.get(activeOffsetKey);\n\n      if (active && dropDownPosition) {\n        var placement = _this.props.placement;\n\n        var dropDownStyle = _this.getPositionStyle(true, dropDownPosition.position()); // Check if the above space is crowded\n\n\n        var isTopCrowded = parseFloat(dropDownStyle.top) - window.scrollY - container.offsetHeight < 0; // Check if the under space is crowded\n\n        var isBottomCrowded = (window.innerHeight || document.documentElement.clientHeight) - (parseFloat(dropDownStyle.top) - window.scrollY) - container.offsetHeight < 0;\n\n        if (placement === 'top' && !isTopCrowded) {\n          // The above space isn't crowded\n          dropDownStyle.top = (parseFloat(dropDownStyle.top) - container.offsetHeight || 0) + 'px';\n        }\n\n        if (placement === 'bottom' && isBottomCrowded && !isTopCrowded) {\n          // The above space isn't crowded and the under space is crowded.\n          dropDownStyle.top = (parseFloat(dropDownStyle.top) - container.offsetHeight || 0) + 'px';\n        }\n\n        Object.keys(dropDownStyle).forEach(function (key) {\n          container.style[key] = dropDownStyle[key];\n        });\n      }\n\n      if (!_this.focusItem) {\n        return;\n      }\n\n      scrollIntoView(ReactDOM.findDOMNode(_this.focusItem), container, {\n        onlyScrollIfNeeded: true\n      });\n    };\n\n    _this.getNavigations = function () {\n      var _this$props = _this.props,\n          prefixCls = _this$props.prefixCls,\n          suggestions = _this$props.suggestions;\n      var focusedIndex = _this.state.focusedIndex;\n      return suggestions.length ? React.Children.map(suggestions, function (element, index) {\n        var focusItem = index === focusedIndex;\n        var ref = focusItem ? function (node) {\n          _this.focusItem = node;\n        } : null;\n        var mentionClass = cx(prefixCls + '-dropdown-item', {\n          focus: focusItem\n        });\n\n        if (React.isValidElement(element)) {\n          return React.cloneElement(element, {\n            className: mentionClass,\n            onMouseDown: function onMouseDown() {\n              return _this.onDropdownMentionSelect(element.props.value, element.props.data);\n            },\n            ref: ref\n          });\n        }\n\n        return React.createElement(Nav, {\n          ref: ref,\n          className: mentionClass,\n          onMouseDown: function onMouseDown() {\n            return _this.onDropdownMentionSelect(element);\n          }\n        }, element);\n      }, _this) : React.createElement('div', {\n        className: prefixCls + '-dropdown-notfound ' + prefixCls + '-dropdown-item'\n      }, _this.props.notFoundContent);\n    };\n\n    _this.state = {\n      isActive: false,\n      focusedIndex: 0,\n      container: false\n    };\n    return _this;\n  }\n\n  Suggestions.prototype.componentDidMount = function componentDidMount() {\n    this.props.callbacks.onChange = this.onEditorStateChange;\n  };\n\n  Suggestions.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    if (nextProps.suggestions.length !== this.props.suggestions.length) {\n      this.setState({\n        focusedIndex: 0\n      });\n    }\n  };\n\n  Suggestions.prototype.onDropdownMentionSelect = function onDropdownMentionSelect(mention, data) {\n    var _this2 = this;\n\n    setTimeout(function () {\n      _this2.onMentionSelect(mention, data);\n    }, 100);\n  };\n\n  Suggestions.prototype.onMentionSelect = function onMentionSelect(mention, data) {\n    var editorState = this.props.callbacks.getEditorState();\n    var _props = this.props,\n        store = _props.store,\n        onSelect = _props.onSelect;\n    var trigger = store.getTrigger(this.activeOffsetKey);\n\n    if (onSelect) {\n      onSelect(mention, data || mention);\n    }\n\n    if (this.props.noRedup) {\n      var mentions = getMentions(editorState.getCurrentContent(), trigger);\n\n      if (mentions.indexOf('' + trigger + mention) !== -1) {\n        // eslint-disable-next-line\n        console.warn('you have specified `noRedup` props but have duplicated mentions.');\n        this.closeDropDown();\n        this.props.callbacks.setEditorState(clearMention(editorState));\n        return;\n      }\n    }\n\n    this.props.callbacks.setEditorState(insertMention(editorState, '' + trigger + mention, data, this.props.mode), true);\n    this.closeDropDown();\n  };\n\n  Suggestions.prototype.getPositionStyle = function getPositionStyle(isActive, position) {\n    if (this.props.getSuggestionStyle) {\n      return this.props.getSuggestionStyle(isActive, position);\n    }\n\n    var container = this.props.getSuggestionContainer ? this.state.container : document.body;\n    var offset = getOffset(container);\n    return position ? _extends({\n      position: 'absolute',\n      left: position.left - offset.left + 'px',\n      top: position.top - offset.top + 'px'\n    }, this.props.style) : {};\n  };\n\n  Suggestions.prototype.openDropDown = function openDropDown() {\n    this.props.callbacks.onUpArrow = this.onUpArrow;\n    this.props.callbacks.handleReturn = this.handleReturn;\n    this.props.callbacks.handleKeyBinding = this.handleKeyBinding;\n    this.props.callbacks.onDownArrow = this.onDownArrow;\n    this.props.callbacks.onBlur = this.onBlur;\n    this.setState({\n      active: true,\n      container: this.state.container || this.getContainer()\n    });\n  };\n\n  Suggestions.prototype.closeDropDown = function closeDropDown() {\n    this.props.callbacks.onUpArrow = null;\n    this.props.callbacks.handleReturn = null;\n    this.props.callbacks.handleKeyBinding = null;\n    this.props.callbacks.onDownArrow = null;\n    this.props.callbacks.onBlur = null;\n    this.setState({\n      active: false\n    });\n  };\n\n  Suggestions.prototype.render = function render() {\n    var _extends2,\n        _this3 = this;\n\n    var _props2 = this.props,\n        prefixCls = _props2.prefixCls,\n        className = _props2.className,\n        placement = _props2.placement;\n    var _state = this.state,\n        container = _state.container,\n        active = _state.active;\n    var cls = cx(_extends((_extends2 = {}, _extends2[prefixCls + '-dropdown'] = true, _extends2[prefixCls + '-dropdown-placement-' + placement] = true, _extends2), className));\n    var transitionName = placement === 'top' ? 'slide-down' : 'slide-up';\n    var navigations = this.getNavigations();\n    return container ? React.createElement(SuggetionWrapper, {\n      renderReady: this.renderReady,\n      container: container\n    }, React.createElement(Animate, {\n      transitionName: transitionName\n    }, active ? React.createElement('div', {\n      className: cls,\n      ref: function ref(node) {\n        _this3.dropdownContainer = node;\n      }\n    }, navigations) : null)) : null;\n  };\n\n  return Suggestions;\n}(React.Component);\n\nexport default Suggestions;\nSuggestions.propTypes = {\n  callbacks: PropTypes.object,\n  suggestions: PropTypes.array,\n  store: PropTypes.object,\n  onSearchChange: PropTypes.func,\n  prefixCls: PropTypes.string,\n  mode: PropTypes.string,\n  style: PropTypes.object,\n  onSelect: PropTypes.func,\n  getSuggestionContainer: PropTypes.func,\n  notFoundContent: PropTypes.any,\n  getSuggestionStyle: PropTypes.func,\n  className: PropTypes.string,\n  noRedup: PropTypes.bool,\n  placement: PropTypes.string\n};","map":{"version":3,"sources":["/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/rc-editor-mention/es/component/Suggestions.react.js"],"names":["_extends","_classCallCheck","_possibleConstructorReturn","_inherits","React","ReactDOM","PropTypes","decode","Animate","cx","scrollIntoView","Nav","SuggetionWrapper","insertMention","clearMention","getOffset","getMentions","getSearchWord","isNotFalse","i","Suggestions","_React$Component","_this","call","onEditorStateChange","editorState","offset","props","store","size","closeDropDown","selection","getSelection","callbacks","getEditorState","getHasFocus","_getSearchWord","word","selectionInsideMention","map","_ref","offsetKey","_decode","blockKey","decoratorKey","leafKey","anchorKey","leaf","getBlockTree","getIn","startKey","get","endKey","anchorOffset","selectionInText","some","activeOffsetKey","find","trigger","getTrigger","searchValue","substring","length","lastSearchValue","lastTrigger","onSearchChange","state","active","indexOf","openDropDown","onUpArrow","ev","preventDefault","suggestions","newIndex","focusedIndex","setState","Math","max","onBlur","onDownArrow","getContainer","popupContainer","document","createElement","mountNode","getSuggestionContainer","style","position","body","appendChild","handleKeyBinding","command","handleReturn","selectedSuggestion","isValidElement","onMentionSelect","value","data","renderReady","container","dropdownContainer","dropDownPosition","placement","dropDownStyle","getPositionStyle","isTopCrowded","parseFloat","top","window","scrollY","offsetHeight","isBottomCrowded","innerHeight","documentElement","clientHeight","Object","keys","forEach","key","focusItem","findDOMNode","onlyScrollIfNeeded","getNavigations","_this$props","prefixCls","Children","element","index","ref","node","mentionClass","focus","cloneElement","className","onMouseDown","onDropdownMentionSelect","notFoundContent","isActive","prototype","componentDidMount","onChange","componentWillReceiveProps","nextProps","mention","_this2","setTimeout","_props","onSelect","noRedup","mentions","getCurrentContent","console","warn","setEditorState","mode","getSuggestionStyle","left","render","_extends2","_this3","_props2","_state","cls","transitionName","navigations","Component","propTypes","object","array","func","string","any","bool"],"mappings":"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","sourcesContent":["import _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport { decode } from 'draft-js/lib/DraftOffsetKey';\nimport Animate from 'rc-animate';\n\nimport cx from 'classnames';\nimport scrollIntoView from 'dom-scroll-into-view';\n\nimport Nav from './Nav.react';\nimport SuggetionWrapper from './SuggestionWrapper.react';\n\nimport insertMention from '../utils/insertMention';\nimport clearMention from '../utils/clearMention';\nimport getOffset from '../utils/getOffset';\nimport getMentions from '../utils/getMentions';\nimport getSearchWord from '../utils/getSearchWord';\n\nvar isNotFalse = function isNotFalse(i) {\n  return i !== false;\n};\n\nvar Suggestions = function (_React$Component) {\n  _inherits(Suggestions, _React$Component);\n\n  function Suggestions() {\n    _classCallCheck(this, Suggestions);\n\n    var _this = _possibleConstructorReturn(this, _React$Component.call(this));\n\n    _this.onEditorStateChange = function (editorState) {\n      var offset = _this.props.store.getOffset();\n      if (offset.size === 0) {\n        _this.closeDropDown();\n        return editorState;\n      }\n      var selection = editorState.getSelection();\n\n      // 修复: 焦点移出再移入时, dropdown 会闪动一下\n      // 原因: https://github.com/facebook/draft-js/blob/67c5e69499e3b0c149ce83b004872afdf4180463/src/component/handlers/edit/editOnFocus.js#L33\n      // 此处强制 update 了一下,因此 onEditorStateChange 会 call 两次\n      if (!_this.props.callbacks.getEditorState().getSelection().getHasFocus() && selection.getHasFocus()) {\n        return editorState;\n      }\n\n      var _getSearchWord = getSearchWord(editorState, selection),\n          word = _getSearchWord.word;\n\n      if (!word) {\n        _this.closeDropDown();\n        return editorState;\n      }\n      var selectionInsideMention = offset.map(function (_ref) {\n        var offsetKey = _ref.offsetKey;\n\n        var _decode = decode(offsetKey),\n            blockKey = _decode.blockKey,\n            decoratorKey = _decode.decoratorKey,\n            leafKey = _decode.leafKey;\n\n        if (blockKey !== selection.anchorKey) {\n          return false;\n        }\n        var leaf = editorState.getBlockTree(blockKey).getIn([decoratorKey, 'leaves', leafKey]);\n        if (!leaf) {\n          return false;\n        }\n        var startKey = leaf.get('start');\n        var endKey = leaf.get('end');\n        // 处理只有一个 `@` 符号时的情况\n        if (!word) {\n          return false;\n        }\n        if (startKey === endKey - 1) {\n          return selection.anchorOffset >= startKey + 1 && selection.anchorOffset <= endKey ? offsetKey : false;\n        }\n        return selection.anchorOffset > startKey + 1 && selection.anchorOffset <= endKey ? offsetKey : false;\n      });\n\n      var selectionInText = selectionInsideMention.some(isNotFalse);\n      _this.activeOffsetKey = selectionInsideMention.find(isNotFalse) || _this.activeOffsetKey;\n      var trigger = _this.props.store.getTrigger(_this.activeOffsetKey);\n\n      if (!selectionInText || !selection.getHasFocus()) {\n        _this.closeDropDown();\n        return editorState;\n      }\n      var searchValue = word.substring(trigger.length, word.length);\n      if (_this.lastSearchValue !== searchValue || _this.lastTrigger !== trigger) {\n        _this.lastSearchValue = searchValue;\n        _this.lastTrigger = trigger;\n        _this.props.onSearchChange(searchValue, trigger);\n      }\n      if (!_this.state.active) {\n        // 特例处理 https://github.com/ant-design/ant-design/issues/7838\n        // 暂时没有更优雅的方法\n        if (!trigger || word.indexOf(trigger) !== -1) {\n          _this.openDropDown();\n        }\n      }\n      return editorState;\n    };\n\n    _this.onUpArrow = function (ev) {\n      ev.preventDefault();\n      if (_this.props.suggestions.length > 0) {\n        var newIndex = _this.state.focusedIndex - 1;\n        _this.setState({\n          focusedIndex: Math.max(newIndex, 0)\n        });\n      }\n    };\n\n    _this.onBlur = function (ev) {\n      ev.preventDefault();\n      _this.closeDropDown();\n    };\n\n    _this.onDownArrow = function (ev) {\n      ev.preventDefault();\n      var newIndex = _this.state.focusedIndex + 1;\n      _this.setState({\n        focusedIndex: newIndex >= _this.props.suggestions.length ? 0 : newIndex\n      });\n    };\n\n    _this.getContainer = function () {\n      var popupContainer = document.createElement('div');\n      var mountNode = void 0;\n      if (_this.props.getSuggestionContainer) {\n        mountNode = _this.props.getSuggestionContainer();\n        popupContainer.style.position = 'relative';\n      } else {\n        mountNode = document.body;\n      }\n      mountNode.appendChild(popupContainer);\n      return popupContainer;\n    };\n\n    _this.handleKeyBinding = function (command) {\n      return command === 'split-block';\n    };\n\n    _this.handleReturn = function (ev) {\n      ev.preventDefault();\n      var selectedSuggestion = _this.props.suggestions[_this.state.focusedIndex];\n      if (selectedSuggestion) {\n        if (React.isValidElement(selectedSuggestion)) {\n          _this.onMentionSelect(selectedSuggestion.props.value, selectedSuggestion.props.data);\n        } else {\n          _this.onMentionSelect(selectedSuggestion);\n        }\n        _this.lastSearchValue = null;\n        _this.lastTrigger = null;\n        return true;\n      }\n      return false;\n    };\n\n    _this.renderReady = function () {\n      var container = _this.dropdownContainer;\n      if (!container) {\n        return;\n      }\n      var active = _this.state.active;\n      var activeOffsetKey = _this.activeOffsetKey;\n\n      var offset = _this.props.store.getOffset();\n      var dropDownPosition = offset.get(activeOffsetKey);\n\n      if (active && dropDownPosition) {\n        var placement = _this.props.placement;\n        var dropDownStyle = _this.getPositionStyle(true, dropDownPosition.position());\n\n        // Check if the above space is crowded\n        var isTopCrowded = parseFloat(dropDownStyle.top) - window.scrollY - container.offsetHeight < 0;\n        // Check if the under space is crowded\n        var isBottomCrowded = (window.innerHeight || document.documentElement.clientHeight) - (parseFloat(dropDownStyle.top) - window.scrollY) - container.offsetHeight < 0;\n\n        if (placement === 'top' && !isTopCrowded) {\n          // The above space isn't crowded\n          dropDownStyle.top = (parseFloat(dropDownStyle.top) - container.offsetHeight || 0) + 'px';\n        }\n\n        if (placement === 'bottom' && isBottomCrowded && !isTopCrowded) {\n          // The above space isn't crowded and the under space is crowded.\n          dropDownStyle.top = (parseFloat(dropDownStyle.top) - container.offsetHeight || 0) + 'px';\n        }\n\n        Object.keys(dropDownStyle).forEach(function (key) {\n          container.style[key] = dropDownStyle[key];\n        });\n      }\n\n      if (!_this.focusItem) {\n        return;\n      }\n      scrollIntoView(ReactDOM.findDOMNode(_this.focusItem), container, {\n        onlyScrollIfNeeded: true\n      });\n    };\n\n    _this.getNavigations = function () {\n      var _this$props = _this.props,\n          prefixCls = _this$props.prefixCls,\n          suggestions = _this$props.suggestions;\n      var focusedIndex = _this.state.focusedIndex;\n\n      return suggestions.length ? React.Children.map(suggestions, function (element, index) {\n        var focusItem = index === focusedIndex;\n        var ref = focusItem ? function (node) {\n          _this.focusItem = node;\n        } : null;\n        var mentionClass = cx(prefixCls + '-dropdown-item', {\n          focus: focusItem\n        });\n        if (React.isValidElement(element)) {\n          return React.cloneElement(element, {\n            className: mentionClass,\n            onMouseDown: function onMouseDown() {\n              return _this.onDropdownMentionSelect(element.props.value, element.props.data);\n            },\n            ref: ref\n          });\n        }\n        return React.createElement(\n          Nav,\n          {\n            ref: ref,\n            className: mentionClass,\n            onMouseDown: function onMouseDown() {\n              return _this.onDropdownMentionSelect(element);\n            }\n          },\n          element\n        );\n      }, _this) : React.createElement(\n        'div',\n        { className: prefixCls + '-dropdown-notfound ' + prefixCls + '-dropdown-item' },\n        _this.props.notFoundContent\n      );\n    };\n\n    _this.state = {\n      isActive: false,\n      focusedIndex: 0,\n      container: false\n    };\n    return _this;\n  }\n\n  Suggestions.prototype.componentDidMount = function componentDidMount() {\n    this.props.callbacks.onChange = this.onEditorStateChange;\n  };\n\n  Suggestions.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    if (nextProps.suggestions.length !== this.props.suggestions.length) {\n      this.setState({\n        focusedIndex: 0\n      });\n    }\n  };\n\n  Suggestions.prototype.onDropdownMentionSelect = function onDropdownMentionSelect(mention, data) {\n    var _this2 = this;\n\n    setTimeout(function () {\n      _this2.onMentionSelect(mention, data);\n    }, 100);\n  };\n\n  Suggestions.prototype.onMentionSelect = function onMentionSelect(mention, data) {\n    var editorState = this.props.callbacks.getEditorState();\n    var _props = this.props,\n        store = _props.store,\n        onSelect = _props.onSelect;\n\n    var trigger = store.getTrigger(this.activeOffsetKey);\n    if (onSelect) {\n      onSelect(mention, data || mention);\n    }\n    if (this.props.noRedup) {\n      var mentions = getMentions(editorState.getCurrentContent(), trigger);\n      if (mentions.indexOf('' + trigger + mention) !== -1) {\n        // eslint-disable-next-line\n        console.warn('you have specified `noRedup` props but have duplicated mentions.');\n        this.closeDropDown();\n        this.props.callbacks.setEditorState(clearMention(editorState));\n        return;\n      }\n    }\n    this.props.callbacks.setEditorState(insertMention(editorState, '' + trigger + mention, data, this.props.mode), true);\n    this.closeDropDown();\n  };\n\n  Suggestions.prototype.getPositionStyle = function getPositionStyle(isActive, position) {\n    if (this.props.getSuggestionStyle) {\n      return this.props.getSuggestionStyle(isActive, position);\n    }\n    var container = this.props.getSuggestionContainer ? this.state.container : document.body;\n    var offset = getOffset(container);\n    return position ? _extends({\n      position: 'absolute',\n      left: position.left - offset.left + 'px',\n      top: position.top - offset.top + 'px'\n    }, this.props.style) : {};\n  };\n\n  Suggestions.prototype.openDropDown = function openDropDown() {\n    this.props.callbacks.onUpArrow = this.onUpArrow;\n    this.props.callbacks.handleReturn = this.handleReturn;\n    this.props.callbacks.handleKeyBinding = this.handleKeyBinding;\n    this.props.callbacks.onDownArrow = this.onDownArrow;\n    this.props.callbacks.onBlur = this.onBlur;\n    this.setState({\n      active: true,\n      container: this.state.container || this.getContainer()\n    });\n  };\n\n  Suggestions.prototype.closeDropDown = function closeDropDown() {\n    this.props.callbacks.onUpArrow = null;\n    this.props.callbacks.handleReturn = null;\n    this.props.callbacks.handleKeyBinding = null;\n    this.props.callbacks.onDownArrow = null;\n    this.props.callbacks.onBlur = null;\n    this.setState({\n      active: false\n    });\n  };\n\n  Suggestions.prototype.render = function render() {\n    var _extends2,\n        _this3 = this;\n\n    var _props2 = this.props,\n        prefixCls = _props2.prefixCls,\n        className = _props2.className,\n        placement = _props2.placement;\n    var _state = this.state,\n        container = _state.container,\n        active = _state.active;\n\n    var cls = cx(_extends((_extends2 = {}, _extends2[prefixCls + '-dropdown'] = true, _extends2[prefixCls + '-dropdown-placement-' + placement] = true, _extends2), className));\n    var transitionName = placement === 'top' ? 'slide-down' : 'slide-up';\n\n    var navigations = this.getNavigations();\n\n    return container ? React.createElement(\n      SuggetionWrapper,\n      { renderReady: this.renderReady, container: container },\n      React.createElement(\n        Animate,\n        { transitionName: transitionName },\n        active ? React.createElement(\n          'div',\n          { className: cls, ref: function ref(node) {\n              _this3.dropdownContainer = node;\n            } },\n          navigations\n        ) : null\n      )\n    ) : null;\n  };\n\n  return Suggestions;\n}(React.Component);\n\nexport default Suggestions;\n\n\nSuggestions.propTypes = {\n  callbacks: PropTypes.object,\n  suggestions: PropTypes.array,\n  store: PropTypes.object,\n  onSearchChange: PropTypes.func,\n  prefixCls: PropTypes.string,\n  mode: PropTypes.string,\n  style: PropTypes.object,\n  onSelect: PropTypes.func,\n  getSuggestionContainer: PropTypes.func,\n  notFoundContent: PropTypes.any,\n  getSuggestionStyle: PropTypes.func,\n  className: PropTypes.string,\n  noRedup: PropTypes.bool,\n  placement: PropTypes.string\n};"]},"metadata":{},"sourceType":"module"}