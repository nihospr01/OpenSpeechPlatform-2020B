{"ast":null,"code":"import _toConsumableArray from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{axios}from\"utils/utils\";import{withRouter,Link}from\"react-router-dom\";import withUserAuth from\"context/withUserAuth\";import{compose}from\"recompose\";import{withStyles}from\"@material-ui/styles\";import Grid from'@material-ui/core/Grid';import Typography from'@material-ui/core/Typography';import Paper from\"@material-ui/core/Paper\";import Slider from'@material-ui/core/Slider';import Input from'@material-ui/core/Input';import Button from'@material-ui/core/Button';import SettingsIcon from'@material-ui/icons/Settings';import DialogTitle from'@material-ui/core/DialogTitle';import Dialog from'@material-ui/core/Dialog';import Select from'@material-ui/core/Select';import MenuItem from'@material-ui/core/MenuItem';import TextField from'@material-ui/core/TextField';import AudioFilePlayer from\"components/audioFilePlayer\";var styles=function styles(theme){return{root:{flexGrow:1},background:{display:'flex',flexDirection:'column',alignItems:'center'},container:{width:500,display:'flex',flexDirection:'column',alignItems:'center',padding:20},iconHover:{float:'right','&:hover':{color:\"grey\"},// alignItems: \"right\",\ncolor:\"inherit\"},sliderLabel:{display:'flex',flexDirection:'row',alignItems:'center',justifyContent:'space-between',width:350,marginTop:20},sliderRow:{display:'flex',flexDirection:'row',alignItems:'center',justifyContent:'center',width:'100%'},title:{marginTop:40},freqLabel:{width:100,marginRight:10},inputField:{width:100,marginLeft:20},bottomButtonArea:{marginTop:30,display:'flex',width:\"100%\",flexDirection:'row',justifyContent:'space-between',alignItmes:'center'},submitButton:{width:200},settingsBar:{display:'flex',flexDirection:'row',justifyContent:'flex-end',width:\"100%\"},settingsWindow:{width:400,paddingLeft:30,paddingRight:30,paddingBottom:30,display:'flex',flexDirection:'column',justifyContent:'flex-start'},volumeTitle:{display:'flex',flexDirection:'row',justifyContent:'space-between'},saveSettingsButton:{alignSelf:'center'},alertWindow:{width:400,display:'flex',justifyContent:'center',paddingLeft:30,paddingRight:30,paddingBottom:20},switchMsgWindow:{display:'flex',flexDirection:'column',alignItems:'center',padding:20}};};var sixBandFreq=['250','500','1000','2000','4000','8000'];var tenBandFreq=['250','500','750','1000','1500','2000','3000','4000','6000','8000'];var bandLimit=3;var gainSliderMarks=[{value:-20,label:'-20'},{value:10,label:'10'}];var FreppingDemo=/*#__PURE__*/function(_Component){_inherits(FreppingDemo,_Component);var _super=_createSuper(FreppingDemo);function FreppingDemo(props){var _this;_classCallCheck(this,FreppingDemo);_this=_super.call(this,props);// Don't call this.setState() here!\n_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _this.updateParam();case 2:case\"end\":return _context.stop();}}},_callee);}));_this.updateParam=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post(\"/api/param/getparam\");case 3:response=_context2.sent;data=response.data;console.log(data);_this.checkBandLimit(data.left.freping_alpha);_this.setState({freppingAlpha:_toConsumableArray(data.left.freping_alpha),gain:data.left.gain});_context2.next=14;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);_this.handleAlertOpen();throw _context2.t0;case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));_this.handleAlertClose=function(){_this.setState({showAlert:false});};_this.handleAlertOpen=function(){_this.setState({showAlert:true});};_this.checkBandLimit=function(arr){var count=0;var i;for(i=0;i<arr.length;i++){if(arr[i]!=0){count++;}}_this.setState({bandsWarped:count,reachedFrepLimit:count>=3?true:false});};_this.handleInputChange=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(event){var idx,value,newValue,tempArray,oldAlpha;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:idx=event.target.id;value=event.target.value;if(value){newValue=Number(value);if(newValue>_this.state.maxAlpha){newValue=_this.state.maxAlpha;}else if(newValue<_this.state.minAlpha){newValue=_this.state.minAlpha;}}else{newValue=0;}tempArray=_this.state.freppingAlpha;oldAlpha=tempArray[idx];tempArray[idx]=newValue;_this.setState(function(prevState){console.log(prevState);// Why is this prevState the same as the new state?\n_this.checkFreppingLimit(oldAlpha,newValue);return{freppingAlpha:tempArray};},_this.onClickSubmit);case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x){return _ref3.apply(this,arguments);};}();_this.handleSliderChange=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(event,newValue){var idx,tempArray,oldAlpha;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:// console.log(newValue);\n// console.log(event.target.id);\nidx=event.target.id;tempArray=_this.state.freppingAlpha;oldAlpha=tempArray[idx];tempArray[idx]=newValue;_this.setState(function(prevState){_this.checkFreppingLimit(oldAlpha,newValue);return{freppingAlpha:tempArray};},_this.onClickSubmit);case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x2,_x3){return _ref4.apply(this,arguments);};}();_this.checkFreppingLimit=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(oldValue,newValue){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:// console.log(oldValue.toString() + ' ' + newValue.toString());\nif(oldValue===0&&newValue!==0){_this.setState(function(prevState){return{bandsWarped:prevState.bandsWarped+1};},function(){console.log('bandsWarped: '+_this.state.bandsWarped.toString());if(_this.state.bandsWarped===bandLimit){_this.setState({reachedFrepLimit:true});}});}else if(oldValue!==0&&newValue===0){_this.setState(function(prevState){return{bandsWarped:prevState.bandsWarped===0?0:prevState.bandsWarped-1};},function(){console.log('bandsWarped: '+_this.state.bandsWarped.toString());_this.setState({reachedFrepLimit:false});});}case 1:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x4,_x5){return _ref5.apply(this,arguments);};}();_this.onClickSubmit=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var freppingAlpha,params,response;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:freppingAlpha=_this.state.freppingAlpha;params={left:{freping:1,freping_alpha:freppingAlpha},right:{freping:1,freping_alpha:freppingAlpha}};_context6.prev=2;_context6.next=5;return axios.post(\"/api/param/setparam\",{method:\"set\",data:params});case 5:response=_context6.sent;console.log(response.data);_context6.next=13;break;case 9:_context6.prev=9;_context6.t0=_context6[\"catch\"](2);_this.handleAlertOpen();console.log(_context6.t0.response.data);case 13:case\"end\":return _context6.stop();}}},_callee6,null,[[2,9]]);}));_this.handleSettingsClose=function(){_this.setState({openSettings:false});// Check whether any alpha value is out of the updated Range\n_this.checkOutOfRange();};_this.handleSettingsClick=function(){_this.setState({openSettings:true});};_this.checkOutOfRange=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var temp,i;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:temp=_this.state.freppingAlpha;for(i=0;i<temp.length;i++){if(temp[i]<_this.state.minAlpha){temp[i]=_this.state.minAlpha;}else if(temp[i]>_this.state.maxAlpha){temp[i]=_this.state.maxAlpha;}}_this.setState({freppingAlpha:temp},_this.onClickSubmit);case 3:case\"end\":return _context7.stop();}}},_callee7);}));_this.handleBandSwitch=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(event){var response;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:if(event.target.value){_this.setState({freppingAlpha:[0,0,0,0,0,0,0,0,0,0]});}else{_this.setState({freppingAlpha:[0,0,0,0,0,0]});}_this.setState({tenBand:event.target.value,bandsWarped:0,reachedFrepLimit:false});_this.handleSwitchMsgOpen();_context8.prev=3;_context8.next=6;return axios.post(\"/api/researcher/restartRTMHA\",{data:event.target.value});case 6:response=_context8.sent;console.log(response.data);_context8.next=13;break;case 10:_context8.prev=10;_context8.t0=_context8[\"catch\"](3);console.log(_context8.t0);case 13:case\"end\":return _context8.stop();}}},_callee8,null,[[3,10]]);}));return function(_x6){return _ref8.apply(this,arguments);};}();_this.handleSwitchMsgClose=function(){_this.setState({showBandSwitchMsg:false});};_this.handleSwitchMsgOpen=function(){_this.setState({showBandSwitchMsg:true});};_this.handleGainChange=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(event,newValue){var params,response;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_this.setState({gain:newValue});params={left:{gain:newValue},right:{gain:newValue}};_context9.prev=2;_context9.next=5;return axios.post(\"/api/param/setparam\",{method:\"set\",data:params});case 5:response=_context9.sent;console.log(response.data);_context9.next=13;break;case 9:_context9.prev=9;_context9.t0=_context9[\"catch\"](2);_this.handleAlertOpen();console.log(_context9.t0.response.data);case 13:case\"end\":return _context9.stop();}}},_callee9,null,[[2,9]]);}));return function(_x7,_x8){return _ref9.apply(this,arguments);};}();_this.handleAlphaRangeChange=function(event,newValue){if(newValue[0]>=0||newValue[1]<=0){return;}if(newValue[1]-newValue[0]<0.2){return;}_this.setState({alphaRange:newValue,minAlpha:newValue[0],maxAlpha:newValue[1]});};_this.state={showAlert:false,freppingAlpha:[0,0,0,0,0,0],bandsWarped:0,reachedFrepLimit:false,openSettings:false,tenBand:false,gain:0,showBandSwitchMsg:false,minAlpha:-0.5,maxAlpha:0.5,alphaRange:[-0.5,0.5]};return _this;}_createClass(FreppingDemo,[{key:\"render\",value:function render(){var _this2=this;var classes=this.props.classes;var _this$state=this.state,freppingAlpha=_this$state.freppingAlpha,tenBand=_this$state.tenBand,gain=_this$state.gain,showAlert=_this$state.showAlert,showBandSwitchMsg=_this$state.showBandSwitchMsg,alphaRange=_this$state.alphaRange,minAlpha=_this$state.minAlpha,maxAlpha=_this$state.maxAlpha;var alphaRangeSliderMarks=[{value:alphaRange[0],label:alphaRange[0].toString()},{value:alphaRange[1],label:alphaRange[1].toString()}];var sliderMarks=[{value:0,label:'0'},{value:minAlpha,label:minAlpha.toString()},{value:maxAlpha,label:maxAlpha.toString()}];return/*#__PURE__*/React.createElement(\"div\",{className:classes.root},/*#__PURE__*/React.createElement(Paper,{className:classes.background},/*#__PURE__*/React.createElement(Dialog,{open:showAlert,onClose:this.handleAlertClose},/*#__PURE__*/React.createElement(DialogTitle,null,\"Error\"),/*#__PURE__*/React.createElement(Grid,{container:true,className:classes.alertWindow},/*#__PURE__*/React.createElement(Typography,null,\"RT-MHA is not running. Please make sure RT-MHA is running before fetching or sending parameters\"),/*#__PURE__*/React.createElement(Button,{onClick:this.handleAlertClose,color:\"primary\",variant:\"contained\"},\"OK\"))),/*#__PURE__*/React.createElement(\"div\",{className:classes.settingsBar},/*#__PURE__*/React.createElement(SettingsIcon,{className:classes.iconHover,fontSize:\"large\",onClick:this.handleSettingsClick})),/*#__PURE__*/React.createElement(Dialog,{open:this.state.openSettings,onClose:this.handleSettingsClose},/*#__PURE__*/React.createElement(DialogTitle,null,\"Settings\"),/*#__PURE__*/React.createElement(Grid,{container:true,spacing:3,className:classes.settingsWindow},/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Typography,null,\"Select the number of bands of your device\"),/*#__PURE__*/React.createElement(Select,{value:tenBand,onChange:this.handleBandSwitch},/*#__PURE__*/React.createElement(MenuItem,{value:false},\"Six Band\"),/*#__PURE__*/React.createElement(MenuItem,{value:true},\"Ten Band\")),/*#__PURE__*/React.createElement(Dialog,{open:showBandSwitchMsg,onClose:this.handleSwitchMsgClose},/*#__PURE__*/React.createElement(Grid,{container:true,className:classes.switchMsgWindow},/*#__PURE__*/React.createElement(Typography,{style:{marginBottom:10}},\"Successfully switched to the \",tenBand?\"ten band\":\"six band\",\" mode\"),/*#__PURE__*/React.createElement(Button,{onClick:this.handleSwitchMsgClose,color:\"primary\",variant:\"contained\"},\"OK\")))),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Typography,null,\"Adjust the range of Alpha (the span shouldn't be smaller than 0.2)\"),/*#__PURE__*/React.createElement(Slider,{min:-0.5,max:0.5,value:alphaRange,step:0.01,onChange:this.handleAlphaRangeChange,marks:alphaRangeSliderMarks})),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Grid,{className:classes.volumeTitle},/*#__PURE__*/React.createElement(Typography,null,\"Volume\"),/*#__PURE__*/React.createElement(Button,{color:\"primary\",onClick:this.updateParam},\"Update Volume\")),/*#__PURE__*/React.createElement(Slider,{min:-20,max:10,step:1,defaultValue:0,valueLabelDisplay:\"auto\",value:gain,onChange:this.handleGainChange,marks:gainSliderMarks})),/*#__PURE__*/React.createElement(Grid,{item:true,className:classes.saveSettingsButton},/*#__PURE__*/React.createElement(Button,{color:\"primary\",variant:\"contained\",onClick:this.handleSettingsClose},\"Done\")))),/*#__PURE__*/React.createElement(AudioFilePlayer,null),/*#__PURE__*/React.createElement(Grid,{container:true,className:classes.container,spacing:3},/*#__PURE__*/React.createElement(Typography,{className:classes.title},\"Alpha for different frequencies\"),/*#__PURE__*/React.createElement(Typography,null,\"You can warp up to 3 bands at a time.\"),/*#__PURE__*/React.createElement(Grid,{item:true,className:classes.sliderLabel},/*#__PURE__*/React.createElement(Typography,null,\"Compression\"),/*#__PURE__*/React.createElement(Typography,null,\"Expansion\")),(tenBand?tenBandFreq:sixBandFreq).map(function(currAlpha,index){return/*#__PURE__*/React.createElement(Grid,{item:true,className:classes.sliderRow},/*#__PURE__*/React.createElement(Typography,{className:classes.freqLabel},currAlpha+\" Hz\"),/*#__PURE__*/React.createElement(Slider,{id:index,min:minAlpha,max:maxAlpha,step:0.01,defaultValue:0,value:freppingAlpha[index],onChange:_this2.handleSliderChange,valueLabelDisplay:\"auto\",track:false,disabled:_this2.state.reachedFrepLimit&&freppingAlpha[index]===0,marks:sliderMarks}),/*#__PURE__*/React.createElement(TextField,{className:classes.inputField,margin:\"dense\",value:freppingAlpha[index],id:index,onChange:_this2.handleInputChange,inputProps:{step:0.01,min:-minAlpha,max:maxAlpha,type:'number'// 'aria-labelledby': 'input-slider',\n},disabled:_this2.state.reachedFrepLimit&&freppingAlpha[index]===0// error={freppingAlpha[index]>0.5||freppingAlpha[index]<-0.5}\n// helperText=\"Entry.\"\n}));}),/*#__PURE__*/React.createElement(Grid,{item:true,className:classes.bottomButtonArea},/*#__PURE__*/React.createElement(Button,{className:classes.submitButton,variant:\"contained\",color:\"primary\",onClick:this.onClickSubmit},\"Save\"),/*#__PURE__*/React.createElement(Button,{className:classes.submitButton,variant:\"contained\",color:\"primary\",onClick:this.updateParam},\"Update Parameters\")))));}}]);return FreppingDemo;}(Component);export default compose(withUserAuth,withRouter,withStyles(styles))(FreppingDemo);","map":{"version":3,"sources":["/opt/osp/ewsnodejs-client/src/pages/demo/freppingDemo.jsx"],"names":["React","Component","axios","withRouter","Link","withUserAuth","compose","withStyles","Grid","Typography","Paper","Slider","Input","Button","SettingsIcon","DialogTitle","Dialog","Select","MenuItem","TextField","AudioFilePlayer","styles","theme","root","flexGrow","background","display","flexDirection","alignItems","container","width","padding","iconHover","float","color","sliderLabel","justifyContent","marginTop","sliderRow","title","freqLabel","marginRight","inputField","marginLeft","bottomButtonArea","alignItmes","submitButton","settingsBar","settingsWindow","paddingLeft","paddingRight","paddingBottom","volumeTitle","saveSettingsButton","alignSelf","alertWindow","switchMsgWindow","sixBandFreq","tenBandFreq","bandLimit","gainSliderMarks","value","label","FreppingDemo","props","componentDidMount","updateParam","post","response","data","console","log","checkBandLimit","left","freping_alpha","setState","freppingAlpha","gain","handleAlertOpen","handleAlertClose","showAlert","arr","count","i","length","bandsWarped","reachedFrepLimit","handleInputChange","event","idx","target","id","newValue","Number","state","maxAlpha","minAlpha","tempArray","oldAlpha","prevState","checkFreppingLimit","onClickSubmit","handleSliderChange","oldValue","toString","params","freping","right","method","handleSettingsClose","openSettings","checkOutOfRange","handleSettingsClick","temp","handleBandSwitch","tenBand","handleSwitchMsgOpen","handleSwitchMsgClose","showBandSwitchMsg","handleGainChange","handleAlphaRangeChange","alphaRange","classes","alphaRangeSliderMarks","sliderMarks","marginBottom","map","currAlpha","index","step","min","max","type"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { axios } from \"utils/utils\";\nimport { withRouter, Link } from \"react-router-dom\";\nimport withUserAuth from \"context/withUserAuth\";\nimport { compose } from \"recompose\";\nimport { withStyles } from \"@material-ui/styles\";\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport Paper from \"@material-ui/core/Paper\";\nimport Slider from '@material-ui/core/Slider';\nimport Input from '@material-ui/core/Input';\nimport Button from '@material-ui/core/Button';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Dialog from '@material-ui/core/Dialog';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport TextField from '@material-ui/core/TextField';\n\nimport AudioFilePlayer from \"components/audioFilePlayer\"\n\nconst styles = (theme) => ({\n    root: {\n        flexGrow: 1,\n    },\n    background: {\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n    },\n    container: {\n        width: 500,\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        padding: 20\n    },\n    iconHover: {\n        float: 'right',\n        '&:hover': {\n          color: \"grey\",\n        },\n        // alignItems: \"right\",\n        color: \"inherit\",\n    },\n    sliderLabel: {\n        display: 'flex',\n        flexDirection: 'row',\n        alignItems: 'center',\n        justifyContent: 'space-between',\n        width: 350,\n        marginTop: 20\n    },\n    sliderRow: {\n        display: 'flex',\n        flexDirection: 'row',\n        alignItems: 'center',\n        justifyContent: 'center',\n        width: '100%',\n    },\n    title: {\n        marginTop: 40,\n    },\n    freqLabel: {\n        width: 100,\n        marginRight: 10\n    },\n    inputField: {\n        width: 100,\n        marginLeft: 20,\n    },\n    bottomButtonArea: {\n        marginTop: 30,\n        display: 'flex',\n        width: \"100%\",\n        flexDirection: 'row',\n        justifyContent: 'space-between',\n        alignItmes: 'center'\n    },\n    submitButton: {\n        width: 200\n    },\n    settingsBar: {\n        display: 'flex',\n        flexDirection: 'row',\n        justifyContent: 'flex-end',\n        width: \"100%\"\n    },\n    settingsWindow: {\n        width: 400,\n        paddingLeft: 30,\n        paddingRight: 30,\n        paddingBottom: 30,\n        display: 'flex',\n        flexDirection: 'column',\n        justifyContent: 'flex-start'\n    },\n    volumeTitle: {\n        display: 'flex',\n        flexDirection: 'row',\n        justifyContent: 'space-between'\n    },\n    saveSettingsButton: {\n        alignSelf: 'center'\n    },\n    alertWindow: {\n        width: 400,\n        display: 'flex',\n        justifyContent: 'center',\n        paddingLeft: 30,\n        paddingRight: 30,\n        paddingBottom: 20\n    },\n    switchMsgWindow: {\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        padding: 20,\n    }\n});\n\nconst sixBandFreq = ['250', '500', '1000', '2000', '4000', '8000'];\nconst tenBandFreq = ['250', '500', '750', '1000', '1500', '2000', '3000', '4000', '6000', '8000'];\nconst bandLimit = 3;\nconst gainSliderMarks = [{value: -20, label: '-20'}, {value: 10, label: '10'}];\n\nclass FreppingDemo extends Component {\n    constructor(props) {\n        super(props);\n        // Don't call this.setState() here!\n        this.state = {\n            showAlert: false,\n            freppingAlpha: [0, 0, 0, 0, 0, 0],\n            bandsWarped: 0,\n            reachedFrepLimit: false,\n            openSettings: false,\n            tenBand: false,\n            gain: 0,\n            showBandSwitchMsg: false,\n            minAlpha: -0.5,\n            maxAlpha: 0.5,\n            alphaRange: [-0.5, 0.5]\n        };\n      }\n\n    componentDidMount = async () => {\n        await this.updateParam();\n    }\n\n    updateParam = async () => {\n        try {\n            const response = await axios.post(\"/api/param/getparam\");\n            let data = response.data;\n            console.log(data);\n            this.checkBandLimit(data.left.freping_alpha);\n            this.setState({\n                freppingAlpha: [...data.left.freping_alpha],\n                gain: data.left.gain\n            });\n        } catch (error) {\n            this.handleAlertOpen();\n            throw error;\n        }\n    }\n\n    // fixPrecision = (array) => {\n    //     let i;\n    //     for (i = 0; i < array.length; i++) {\n    //         if (array[i] )\n    //     }\n    // }\n\n    handleAlertClose = () => {\n        this.setState({showAlert: false});\n    }\n\n    handleAlertOpen = () => {\n        this.setState({showAlert: true});\n    }\n\n    checkBandLimit = (arr) => {\n        let count = 0;\n        let i;\n        for (i = 0; i < arr.length; i++) {\n            if (arr[i] != 0) {\n                count++;\n            }\n        }\n        this.setState({\n            bandsWarped: count,\n            reachedFrepLimit: count >= 3 ? true : false\n        });\n    }\n\n    handleInputChange = async (event) => {\n        const idx = event.target.id;\n        const value = event.target.value;\n        let newValue;\n        if (value) {\n            newValue = Number(value);\n            if (newValue > this.state.maxAlpha) {\n                newValue = this.state.maxAlpha;\n            } else if (newValue < this.state.minAlpha) {\n                newValue = this.state.minAlpha;\n            }\n        } else {\n            newValue = 0;\n        }\n        let tempArray = this.state.freppingAlpha;\n        const oldAlpha = tempArray[idx];\n        tempArray[idx] = newValue;\n        this.setState((prevState) => {\n            console.log(prevState);    // Why is this prevState the same as the new state?\n            this.checkFreppingLimit(oldAlpha, newValue);\n            return {freppingAlpha: tempArray}\n        }, this.onClickSubmit);\n    }\n\n    handleSliderChange = async (event, newValue) => {\n        // console.log(newValue);\n        // console.log(event.target.id);\n        const idx = event.target.id;\n        let tempArray = this.state.freppingAlpha;\n        const oldAlpha = tempArray[idx];\n        tempArray[idx] = newValue;\n        this.setState((prevState) => {\n            this.checkFreppingLimit(oldAlpha, newValue);\n            return {freppingAlpha: tempArray};\n        }, this.onClickSubmit);\n    }\n\n    checkFreppingLimit = async (oldValue, newValue) => {\n        // console.log(oldValue.toString() + ' ' + newValue.toString());\n        if (oldValue === 0 && newValue !== 0) {\n            this.setState((prevState) => {\n                return {bandsWarped: prevState.bandsWarped + 1};\n            }, () => {\n                console.log('bandsWarped: ' + this.state.bandsWarped.toString());\n                if (this.state.bandsWarped === bandLimit) {\n                    this.setState({\n                        reachedFrepLimit: true\n                    });\n                }\n            });\n        } else if (oldValue !== 0 && newValue === 0) {\n            this.setState((prevState) => {\n                return {bandsWarped: prevState.bandsWarped === 0 ? 0 : prevState.bandsWarped - 1};\n            }, () => {\n                console.log('bandsWarped: ' + this.state.bandsWarped.toString());\n                this.setState({\n                    reachedFrepLimit: false\n                });\n            });\n        }\n    }\n\n    onClickSubmit = async () => {\n        const {freppingAlpha} = this.state;\n        const params = {\n            left: {\n                freping: 1,\n                freping_alpha: freppingAlpha\n            },\n            right: {\n                freping: 1,\n                freping_alpha: freppingAlpha\n            }\n        };\n\n        try {\n            const response = await axios.post(\"/api/param/setparam\", {\n                method: \"set\",\n                data: params,\n            });\n            console.log(response.data);\n        } catch (error) {\n            this.handleAlertOpen();\n            console.log(error.response.data);\n        }\n    }\n\n    handleSettingsClose = () => {\n        this.setState({\n            openSettings: false\n        });\n\n        // Check whether any alpha value is out of the updated Range\n        this.checkOutOfRange();\n    }\n\n    handleSettingsClick = () => {\n        this.setState({\n            openSettings: true\n        });\n    }\n\n    checkOutOfRange = async () => {\n        let temp = this.state.freppingAlpha;\n        let i;\n        for (i = 0; i < temp.length; i++) {\n            if (temp[i] < this.state.minAlpha) {\n                temp[i] = this.state.minAlpha;\n            } else if (temp[i] > this.state.maxAlpha) {\n                temp[i] = this.state.maxAlpha;\n            }\n        }\n        this.setState({\n            freppingAlpha: temp\n        }, this.onClickSubmit);\n    }\n\n    handleBandSwitch = async (event) => {\n        if (event.target.value) {\n            this.setState({\n                freppingAlpha: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n            });\n        } else {\n            this.setState({\n                freppingAlpha: [0, 0, 0, 0, 0, 0]\n            });\n        }\n\n        this.setState({\n            tenBand: event.target.value,\n            bandsWarped: 0,\n            reachedFrepLimit: false\n        });\n\n        this.handleSwitchMsgOpen();\n        try {\n            const response = await axios.post(\"/api/researcher/restartRTMHA\", {data: event.target.value});\n            console.log(response.data);\n        } catch (error) {\n            console.log(error);\n        }\n    }\n\n    handleSwitchMsgClose = () => {\n        this.setState({\n            showBandSwitchMsg: false\n        });\n    }\n\n    handleSwitchMsgOpen = () => {\n        this.setState({\n            showBandSwitchMsg: true\n        });\n    }\n\n    handleGainChange = async (event, newValue) => {\n        this.setState({\n            gain: newValue\n        });\n\n        const params = {\n            left: {\n                gain: newValue\n            }, \n            right: {\n                gain: newValue\n            }\n        };\n\n        try {\n            const response = await axios.post(\"/api/param/setparam\", {\n                method: \"set\",\n                data: params,\n            });\n            console.log(response.data);\n        } catch (error) {\n            this.handleAlertOpen();\n            console.log(error.response.data);\n        }\n    }\n\n    handleAlphaRangeChange = (event, newValue) => {\n        if (newValue[0] >= 0 || newValue[1] <= 0) {\n            return;\n        }\n        if (newValue[1] - newValue[0] < 0.2) {\n            return;\n        }\n        this.setState({\n            alphaRange: newValue,\n            minAlpha: newValue[0],\n            maxAlpha: newValue[1]\n        });\n    }\n\n    render() {\n        const { classes } = this.props; \n        const { freppingAlpha, tenBand, gain, showAlert, showBandSwitchMsg, alphaRange,\n                minAlpha, maxAlpha } = this.state;\n        let alphaRangeSliderMarks = [\n            {value: alphaRange[0], label: alphaRange[0].toString()},\n            {value: alphaRange[1], label: alphaRange[1].toString()}\n        ];\n        let sliderMarks = [\n            {value: 0, label: '0'},\n            {value: minAlpha, label: minAlpha.toString()},\n            {value: maxAlpha, label: maxAlpha.toString()}\n        ];\n        return(\n            <div className={classes.root}>\n                <Paper className={classes.background}>\n                    <Dialog open={showAlert} onClose={this.handleAlertClose}>\n                        <DialogTitle>Error</DialogTitle>\n                        <Grid container className={classes.alertWindow}>\n                            <Typography>RT-MHA is not running. Please make sure RT-MHA is running before fetching or sending parameters</Typography>\n                            <Button onClick={this.handleAlertClose} color=\"primary\" variant=\"contained\">OK</Button>\n                        </Grid>\n                    </Dialog>\n\n                    <div className={classes.settingsBar}>\n                        <SettingsIcon className={classes.iconHover} fontSize=\"large\" onClick={this.handleSettingsClick}></SettingsIcon>\n                    </div>\n\n                    <Dialog open={this.state.openSettings} onClose={this.handleSettingsClose}>\n                        <DialogTitle>Settings</DialogTitle>\n                        <Grid container spacing={3}  className={classes.settingsWindow}>\n                            <Grid item>\n                                <Typography>Select the number of bands of your device</Typography>\n                                <Select\n                                    value={tenBand}\n                                    onChange={this.handleBandSwitch}\n                                >\n                                    <MenuItem value={false}>Six Band</MenuItem>\n                                    <MenuItem value={true}>Ten Band</MenuItem>\n                                </Select>\n                                <Dialog open={showBandSwitchMsg} onClose={this.handleSwitchMsgClose}>\n                                    <Grid container className={classes.switchMsgWindow}>\n                                        <Typography style={{marginBottom: 10}}>\n                                            Successfully switched to the {tenBand ? \"ten band\" : \"six band\"} mode\n                                        </Typography>\n                                        <Button onClick={this.handleSwitchMsgClose} color=\"primary\" variant=\"contained\">OK</Button>\n                                    </Grid>\n                                </Dialog>\n                            </Grid>\n\n                            <Grid item>\n                                <Typography>Adjust the range of Alpha (the span shouldn't be smaller than 0.2)</Typography>\n                                <Slider\n                                    min={-0.5}\n                                    max={0.5}\n                                    value={alphaRange}\n                                    step={0.01}\n                                    onChange={this.handleAlphaRangeChange}\n                                    marks={alphaRangeSliderMarks}\n                                />\n                            </Grid>\n\n                            <Grid item>\n                                <Grid className={classes.volumeTitle}>\n                                    <Typography>Volume</Typography>\n                                    <Button\n                                        color=\"primary\"\n                                        onClick={this.updateParam}\n                                    >\n                                        Update Volume\n                                    </Button>\n                                </Grid>\n                                <Slider\n                                    min={-20}\n                                    max={10}\n                                    step={1}\n                                    defaultValue={0}\n                                    valueLabelDisplay='auto'\n                                    value={gain}\n                                    onChange={this.handleGainChange}\n                                    marks={gainSliderMarks}\n                                />\n                            </Grid>\n                            <Grid item className={classes.saveSettingsButton}>\n                                <Button color='primary' variant=\"contained\" onClick={this.handleSettingsClose}>Done</Button>\n                            </Grid>\n                        </Grid>\n                    </Dialog>\n\n                    <AudioFilePlayer/>\n\n                    <Grid container className={classes.container} spacing={3}>\n                        <Typography className={classes.title}>\n                            Alpha for different frequencies\n                        </Typography>\n                        <Typography>\n                            You can warp up to 3 bands at a time.\n                        </Typography>\n\n                        <Grid item className={classes.sliderLabel}>\n                            <Typography>Compression</Typography>\n                            <Typography>Expansion</Typography>\n                        </Grid>\n\n                        {(tenBand ? tenBandFreq : sixBandFreq).map(\n                            (currAlpha, index) => {\n                                return (\n                                    <Grid item className={classes.sliderRow}>\n                                        <Typography className={classes.freqLabel}>{currAlpha + \" Hz\"}</Typography>\n                                        <Slider\n                                            id={index}\n                                            min={minAlpha}\n                                            max={maxAlpha}\n                                            step={0.01}\n                                            defaultValue={0}\n                                            value={freppingAlpha[index]}\n                                            onChange={this.handleSliderChange}\n                                            valueLabelDisplay=\"auto\"\n                                            track={false}\n                                            disabled={this.state.reachedFrepLimit && freppingAlpha[index] === 0}\n                                            marks={sliderMarks}\n                                        />\n                                        <TextField\n                                            className={classes.inputField}\n                                            margin='dense'\n                                            value={freppingAlpha[index]}\n                                            id={index}\n                                            onChange={this.handleInputChange}\n                                            inputProps={{\n                                                step: 0.01,\n                                                min: -minAlpha,\n                                                max: maxAlpha,\n                                                type: 'number',\n                                                // 'aria-labelledby': 'input-slider',\n                                            }}\n                                            disabled={this.state.reachedFrepLimit && freppingAlpha[index] === 0}\n                                            // error={freppingAlpha[index]>0.5||freppingAlpha[index]<-0.5}\n                                            // helperText=\"Entry.\"\n                                        />\n                                    </Grid>\n                                )\n                            }\n                        )}\n\n                        <Grid item className={classes.bottomButtonArea}>\n                            <Button\n                                className={classes.submitButton}\n                                variant=\"contained\"\n                                color=\"primary\"\n                                onClick={this.onClickSubmit}\n                            >\n                                    Save\n                            </Button>\n                            <Button\n                                className={classes.submitButton}\n                                variant=\"contained\"\n                                color=\"primary\"\n                                onClick={this.updateParam}\n                            >\n                                    Update Parameters\n                            </Button>\n                        </Grid>\n\n                    </Grid>\n\n                </Paper>\n            </div>\n        );\n    }\n}\n\nexport default compose(\n    withUserAuth,\n    withRouter,\n    withStyles(styles)\n)(FreppingDemo);"]},"metadata":{},"sourceType":"module"}