{"ast":null,"code":"var _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nimport { DefaultDraftInlineStyle } from \"draft-js\";\nimport { OrderedSet, is } from 'immutable';\nimport isUnitlessNumber from './isUnitlessNumber';\nexport var EMPTY_SET = OrderedSet();\nexport var DEFAULT_ELEMENT = 'span';\nexport var DEFAULT_INLINE_STYLE = DefaultDraftInlineStyle;\n\nfunction encodeContent(text) {\n  return text.split('&').join('&amp;').split('<').join('&lt;').split('>').join('&gt;').split('\\xA0').join('&nbsp;').split('\\n').join('<br >' + '\\n');\n}\n\nfunction encodeAttr(text) {\n  return text.split('&').join('&amp;').split('<').join('&lt;').split('>').join('&gt;').split('\"').join('&quot;');\n}\n\nvar VENDOR_PREFIX = /^(moz|ms|o|webkit)-/;\nvar NUMERIC_STRING = /^\\d+$/;\nvar UPPERCASE_PATTERN = /([A-Z])/g; // Lifted from: https://github.com/facebook/react/blob/master/src/renderers/dom/shared/CSSPropertyOperations.js\n\nfunction processStyleName(name) {\n  return name.replace(UPPERCASE_PATTERN, '-$1').toLowerCase().replace(VENDOR_PREFIX, '-$1-');\n} // Lifted from: https://github.com/facebook/react/blob/master/src/renderers/dom/shared/dangerousStyleValue.js\n\n\nfunction processStyleValue(name, value) {\n  var isNumeric = void 0;\n\n  if (typeof value === 'string') {\n    isNumeric = NUMERIC_STRING.test(value);\n  } else {\n    isNumeric = true;\n    value = String(value);\n  }\n\n  if (!isNumeric || value === '0' || isUnitlessNumber[name] === true) {\n    return value;\n  } else {\n    return value + 'px';\n  }\n}\n\nfunction getStyleText(styleObject) {\n  if (!styleObject) {\n    return '';\n  }\n\n  return Object.keys(styleObject).map(function (name) {\n    var styleName = processStyleName(name);\n    var styleValue = processStyleValue(name, styleObject[name]);\n    return styleName + ':' + styleValue;\n  }).join(';');\n}\n\nfunction getEntityContent(contentState, entityKey, content) {\n  if (entityKey) {\n    var entity = contentState.getEntity(entityKey);\n    var entityData = entity.getData();\n\n    if (entityData && entityData['export']) {\n      return entityData['export'](content, entityData);\n    }\n  }\n\n  return content;\n}\n\nexport default function GetHTML(configStore) {\n  return function exportHtml(editorState) {\n    var contentState = editorState.getCurrentContent();\n    var blockMap = contentState.getBlockMap();\n    var customStyleMap = configStore.get('customStyleMap') || {};\n    var customBlockRenderMap = configStore.get('blockRenderMap') || {};\n    var customStyleFn = configStore.get('customStyleFn');\n    var toHTMLList = configStore.get('toHTMLList');\n\n    _extends(customStyleMap, DEFAULT_INLINE_STYLE);\n\n    return blockMap.map(function (block) {\n      var resultText = '<div>';\n      var closeTag = '</div>';\n      var lastPosition = 0;\n      var text = block.getText();\n      var blockType = block.getType();\n      var blockRender = customBlockRenderMap.get(blockType);\n\n      if (blockRender) {\n        var element = typeof blockRender.element === 'function' ? blockRender.elementTag || 'div' : 'div';\n        resultText = '<' + (element || 'div') + ' style=\"' + getStyleText(customBlockRenderMap.get(blockType).style || {}) + '\">';\n        closeTag = '</' + (element || 'div') + '>';\n      }\n\n      var charMetaList = block.getCharacterList();\n      var charEntity = null;\n      var prevCharEntity = null;\n      var ranges = [];\n      var rangeStart = 0;\n\n      for (var i = 0, len = text.length; i < len; i++) {\n        prevCharEntity = charEntity;\n        var meta = charMetaList.get(i);\n        charEntity = meta ? meta.getEntity() : null;\n\n        if (i > 0 && charEntity !== prevCharEntity) {\n          ranges.push([prevCharEntity, getStyleRanges(text.slice(rangeStart, i), charMetaList.slice(rangeStart, i))]);\n          rangeStart = i;\n        }\n      }\n\n      ranges.push([charEntity, getStyleRanges(text.slice(rangeStart), charMetaList.slice(rangeStart))]);\n      ranges.map(function (_ref) {\n        var entityKey = _ref[0],\n            stylePieces = _ref[1];\n        var element = DEFAULT_ELEMENT;\n        var rawContent = stylePieces.map(function (_ref2) {\n          var text = _ref2[0];\n          return text;\n        }).join('');\n        var content = stylePieces.map(function (_ref3) {\n          var text = _ref3[0],\n              styleSet = _ref3[1];\n          var encodedContent = encodeContent(text);\n\n          if (styleSet.size) {\n            var inlineStyle = {};\n            styleSet.forEach(function (item) {\n              if (customStyleMap.hasOwnProperty(item)) {\n                var currentStyle = customStyleMap[item];\n                inlineStyle = _extends(inlineStyle, currentStyle);\n              }\n            });\n            var customedStyle = customStyleFn(styleSet);\n            inlineStyle = _extends(inlineStyle, customedStyle);\n            return '<span style=\"' + getStyleText(inlineStyle) + '\">' + encodedContent + '</span>';\n          }\n\n          return '<span>' + encodedContent + '</span>';\n        }).join('');\n\n        if (entityKey) {\n          var entity = contentState.getEntity(entityKey);\n          var entityData = entity.getData();\n\n          if (entityData && entityData['export']) {\n            resultText += entityData['export'](content, entityData);\n          } else {\n            var HTMLText = '';\n            toHTMLList.forEach(function (toHTML) {\n              var text = toHTML(rawContent, entity, contentState);\n\n              if (text) {\n                HTMLText = text;\n              }\n            });\n\n            if (HTMLText) {\n              resultText += HTMLText;\n            }\n          }\n        } else {\n          resultText += content;\n        }\n      });\n      resultText += closeTag;\n      return resultText;\n    }).join('\\n');\n  };\n}\n\nfunction getStyleRanges(text, charMetaList) {\n  var charStyle = EMPTY_SET;\n  var prevCharStyle = EMPTY_SET;\n  var ranges = [];\n  var rangeStart = 0;\n\n  for (var i = 0, len = text.length; i < len; i++) {\n    prevCharStyle = charStyle;\n    var meta = charMetaList.get(i);\n    charStyle = meta ? meta.getStyle() : EMPTY_SET;\n\n    if (i > 0 && !is(charStyle, prevCharStyle)) {\n      ranges.push([text.slice(rangeStart, i), prevCharStyle]);\n      rangeStart = i;\n    }\n  }\n\n  ranges.push([text.slice(rangeStart), charStyle]);\n  return ranges;\n}","map":{"version":3,"sources":["/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/rc-editor-core/es/EditorCore/export/getHTML.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","DefaultDraftInlineStyle","OrderedSet","is","isUnitlessNumber","EMPTY_SET","DEFAULT_ELEMENT","DEFAULT_INLINE_STYLE","encodeContent","text","split","join","encodeAttr","VENDOR_PREFIX","NUMERIC_STRING","UPPERCASE_PATTERN","processStyleName","name","replace","toLowerCase","processStyleValue","value","isNumeric","test","String","getStyleText","styleObject","keys","map","styleName","styleValue","getEntityContent","contentState","entityKey","content","entity","getEntity","entityData","getData","GetHTML","configStore","exportHtml","editorState","getCurrentContent","blockMap","getBlockMap","customStyleMap","get","customBlockRenderMap","customStyleFn","toHTMLList","block","resultText","closeTag","lastPosition","getText","blockType","getType","blockRender","element","elementTag","style","charMetaList","getCharacterList","charEntity","prevCharEntity","ranges","rangeStart","len","meta","push","getStyleRanges","slice","_ref","stylePieces","rawContent","_ref2","_ref3","styleSet","encodedContent","size","inlineStyle","forEach","item","currentStyle","customedStyle","HTMLText","toHTML","charStyle","prevCharStyle","getStyle"],"mappings":"AAAA,IAAIA,QAAQ,GAAGC,MAAM,CAACC,MAAP,IAAiB,UAAUC,MAAV,EAAkB;AAAE,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,SAAS,CAACC,MAA9B,EAAsCF,CAAC,EAAvC,EAA2C;AAAE,QAAIG,MAAM,GAAGF,SAAS,CAACD,CAAD,CAAtB;;AAA2B,SAAK,IAAII,GAAT,IAAgBD,MAAhB,EAAwB;AAAE,UAAIN,MAAM,CAACQ,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCJ,MAArC,EAA6CC,GAA7C,CAAJ,EAAuD;AAAEL,QAAAA,MAAM,CAACK,GAAD,CAAN,GAAcD,MAAM,CAACC,GAAD,CAApB;AAA4B;AAAE;AAAE;;AAAC,SAAOL,MAAP;AAAgB,CAAhQ;;AAEA,SAASS,uBAAT,QAAwC,UAAxC;AACA,SAASC,UAAT,EAAqBC,EAArB,QAA+B,WAA/B;AACA,OAAOC,gBAAP,MAA6B,oBAA7B;AACA,OAAO,IAAIC,SAAS,GAAGH,UAAU,EAA1B;AACP,OAAO,IAAII,eAAe,GAAG,MAAtB;AACP,OAAO,IAAIC,oBAAoB,GAAGN,uBAA3B;;AACP,SAASO,aAAT,CAAuBC,IAAvB,EAA6B;AACzB,SAAOA,IAAI,CAACC,KAAL,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,OAArB,EAA8BD,KAA9B,CAAoC,GAApC,EAAyCC,IAAzC,CAA8C,MAA9C,EAAsDD,KAAtD,CAA4D,GAA5D,EAAiEC,IAAjE,CAAsE,MAAtE,EAA8ED,KAA9E,CAAoF,MAApF,EAA4FC,IAA5F,CAAiG,QAAjG,EAA2GD,KAA3G,CAAiH,IAAjH,EAAuHC,IAAvH,CAA4H,UAAU,IAAtI,CAAP;AACH;;AACD,SAASC,UAAT,CAAoBH,IAApB,EAA0B;AACtB,SAAOA,IAAI,CAACC,KAAL,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,OAArB,EAA8BD,KAA9B,CAAoC,GAApC,EAAyCC,IAAzC,CAA8C,MAA9C,EAAsDD,KAAtD,CAA4D,GAA5D,EAAiEC,IAAjE,CAAsE,MAAtE,EAA8ED,KAA9E,CAAoF,GAApF,EAAyFC,IAAzF,CAA8F,QAA9F,CAAP;AACH;;AACD,IAAIE,aAAa,GAAG,qBAApB;AACA,IAAIC,cAAc,GAAG,OAArB;AACA,IAAIC,iBAAiB,GAAG,UAAxB,C,CACA;;AACA,SAASC,gBAAT,CAA0BC,IAA1B,EAAgC;AAC5B,SAAOA,IAAI,CAACC,OAAL,CAAaH,iBAAb,EAAgC,KAAhC,EAAuCI,WAAvC,GAAqDD,OAArD,CAA6DL,aAA7D,EAA4E,MAA5E,CAAP;AACH,C,CACD;;;AACA,SAASO,iBAAT,CAA2BH,IAA3B,EAAiCI,KAAjC,EAAwC;AACpC,MAAIC,SAAS,GAAG,KAAK,CAArB;;AACA,MAAI,OAAOD,KAAP,KAAiB,QAArB,EAA+B;AAC3BC,IAAAA,SAAS,GAAGR,cAAc,CAACS,IAAf,CAAoBF,KAApB,CAAZ;AACH,GAFD,MAEO;AACHC,IAAAA,SAAS,GAAG,IAAZ;AACAD,IAAAA,KAAK,GAAGG,MAAM,CAACH,KAAD,CAAd;AACH;;AACD,MAAI,CAACC,SAAD,IAAcD,KAAK,KAAK,GAAxB,IAA+BjB,gBAAgB,CAACa,IAAD,CAAhB,KAA2B,IAA9D,EAAoE;AAChE,WAAOI,KAAP;AACH,GAFD,MAEO;AACH,WAAOA,KAAK,GAAG,IAAf;AACH;AACJ;;AACD,SAASI,YAAT,CAAsBC,WAAtB,EAAmC;AAC/B,MAAI,CAACA,WAAL,EAAkB;AACd,WAAO,EAAP;AACH;;AACD,SAAOpC,MAAM,CAACqC,IAAP,CAAYD,WAAZ,EAAyBE,GAAzB,CAA6B,UAAUX,IAAV,EAAgB;AAChD,QAAIY,SAAS,GAAGb,gBAAgB,CAACC,IAAD,CAAhC;AACA,QAAIa,UAAU,GAAGV,iBAAiB,CAACH,IAAD,EAAOS,WAAW,CAACT,IAAD,CAAlB,CAAlC;AACA,WAAOY,SAAS,GAAG,GAAZ,GAAkBC,UAAzB;AACH,GAJM,EAIJnB,IAJI,CAIC,GAJD,CAAP;AAKH;;AACD,SAASoB,gBAAT,CAA0BC,YAA1B,EAAwCC,SAAxC,EAAmDC,OAAnD,EAA4D;AACxD,MAAID,SAAJ,EAAe;AACX,QAAIE,MAAM,GAAGH,YAAY,CAACI,SAAb,CAAuBH,SAAvB,CAAb;AACA,QAAII,UAAU,GAAGF,MAAM,CAACG,OAAP,EAAjB;;AACA,QAAID,UAAU,IAAIA,UAAU,CAAC,QAAD,CAA5B,EAAwC;AACpC,aAAOA,UAAU,CAAC,QAAD,CAAV,CAAqBH,OAArB,EAA8BG,UAA9B,CAAP;AACH;AACJ;;AACD,SAAOH,OAAP;AACH;;AACD,eAAe,SAASK,OAAT,CAAiBC,WAAjB,EAA8B;AACzC,SAAO,SAASC,UAAT,CAAoBC,WAApB,EAAiC;AACpC,QAAIV,YAAY,GAAGU,WAAW,CAACC,iBAAZ,EAAnB;AACA,QAAIC,QAAQ,GAAGZ,YAAY,CAACa,WAAb,EAAf;AACA,QAAIC,cAAc,GAAGN,WAAW,CAACO,GAAZ,CAAgB,gBAAhB,KAAqC,EAA1D;AACA,QAAIC,oBAAoB,GAAGR,WAAW,CAACO,GAAZ,CAAgB,gBAAhB,KAAqC,EAAhE;AACA,QAAIE,aAAa,GAAGT,WAAW,CAACO,GAAZ,CAAgB,eAAhB,CAApB;AACA,QAAIG,UAAU,GAAGV,WAAW,CAACO,GAAZ,CAAgB,YAAhB,CAAjB;;AACA1D,IAAAA,QAAQ,CAACyD,cAAD,EAAiBvC,oBAAjB,CAAR;;AACA,WAAOqC,QAAQ,CAAChB,GAAT,CAAa,UAAUuB,KAAV,EAAiB;AACjC,UAAIC,UAAU,GAAG,OAAjB;AACA,UAAIC,QAAQ,GAAG,QAAf;AACA,UAAIC,YAAY,GAAG,CAAnB;AACA,UAAI7C,IAAI,GAAG0C,KAAK,CAACI,OAAN,EAAX;AACA,UAAIC,SAAS,GAAGL,KAAK,CAACM,OAAN,EAAhB;AACA,UAAIC,WAAW,GAAGV,oBAAoB,CAACD,GAArB,CAAyBS,SAAzB,CAAlB;;AACA,UAAIE,WAAJ,EAAiB;AACb,YAAIC,OAAO,GAAG,OAAOD,WAAW,CAACC,OAAnB,KAA+B,UAA/B,GAA4CD,WAAW,CAACE,UAAZ,IAA0B,KAAtE,GAA8E,KAA5F;AACAR,QAAAA,UAAU,GAAG,OAAOO,OAAO,IAAI,KAAlB,IAA2B,UAA3B,GAAwClC,YAAY,CAACuB,oBAAoB,CAACD,GAArB,CAAyBS,SAAzB,EAAoCK,KAApC,IAA6C,EAA9C,CAApD,GAAwG,IAArH;AACAR,QAAAA,QAAQ,GAAG,QAAQM,OAAO,IAAI,KAAnB,IAA4B,GAAvC;AACH;;AACD,UAAIG,YAAY,GAAGX,KAAK,CAACY,gBAAN,EAAnB;AACA,UAAIC,UAAU,GAAG,IAAjB;AACA,UAAIC,cAAc,GAAG,IAArB;AACA,UAAIC,MAAM,GAAG,EAAb;AACA,UAAIC,UAAU,GAAG,CAAjB;;AACA,WAAK,IAAI1E,CAAC,GAAG,CAAR,EAAW2E,GAAG,GAAG3D,IAAI,CAACd,MAA3B,EAAmCF,CAAC,GAAG2E,GAAvC,EAA4C3E,CAAC,EAA7C,EAAiD;AAC7CwE,QAAAA,cAAc,GAAGD,UAAjB;AACA,YAAIK,IAAI,GAAGP,YAAY,CAACf,GAAb,CAAiBtD,CAAjB,CAAX;AACAuE,QAAAA,UAAU,GAAGK,IAAI,GAAGA,IAAI,CAACjC,SAAL,EAAH,GAAsB,IAAvC;;AACA,YAAI3C,CAAC,GAAG,CAAJ,IAASuE,UAAU,KAAKC,cAA5B,EAA4C;AACxCC,UAAAA,MAAM,CAACI,IAAP,CAAY,CAACL,cAAD,EAAiBM,cAAc,CAAC9D,IAAI,CAAC+D,KAAL,CAAWL,UAAX,EAAuB1E,CAAvB,CAAD,EAA4BqE,YAAY,CAACU,KAAb,CAAmBL,UAAnB,EAA+B1E,CAA/B,CAA5B,CAA/B,CAAZ;AACA0E,UAAAA,UAAU,GAAG1E,CAAb;AACH;AACJ;;AACDyE,MAAAA,MAAM,CAACI,IAAP,CAAY,CAACN,UAAD,EAAaO,cAAc,CAAC9D,IAAI,CAAC+D,KAAL,CAAWL,UAAX,CAAD,EAAyBL,YAAY,CAACU,KAAb,CAAmBL,UAAnB,CAAzB,CAA3B,CAAZ;AACAD,MAAAA,MAAM,CAACtC,GAAP,CAAW,UAAU6C,IAAV,EAAgB;AACvB,YAAIxC,SAAS,GAAGwC,IAAI,CAAC,CAAD,CAApB;AAAA,YACIC,WAAW,GAAGD,IAAI,CAAC,CAAD,CADtB;AAGA,YAAId,OAAO,GAAGrD,eAAd;AACA,YAAIqE,UAAU,GAAGD,WAAW,CAAC9C,GAAZ,CAAgB,UAAUgD,KAAV,EAAiB;AAC9C,cAAInE,IAAI,GAAGmE,KAAK,CAAC,CAAD,CAAhB;AACA,iBAAOnE,IAAP;AACH,SAHgB,EAGdE,IAHc,CAGT,EAHS,CAAjB;AAIA,YAAIuB,OAAO,GAAGwC,WAAW,CAAC9C,GAAZ,CAAgB,UAAUiD,KAAV,EAAiB;AAC3C,cAAIpE,IAAI,GAAGoE,KAAK,CAAC,CAAD,CAAhB;AAAA,cACIC,QAAQ,GAAGD,KAAK,CAAC,CAAD,CADpB;AAGA,cAAIE,cAAc,GAAGvE,aAAa,CAACC,IAAD,CAAlC;;AACA,cAAIqE,QAAQ,CAACE,IAAb,EAAmB;AACf,gBAAIC,WAAW,GAAG,EAAlB;AACAH,YAAAA,QAAQ,CAACI,OAAT,CAAiB,UAAUC,IAAV,EAAgB;AAC7B,kBAAIrC,cAAc,CAAC/C,cAAf,CAA8BoF,IAA9B,CAAJ,EAAyC;AACrC,oBAAIC,YAAY,GAAGtC,cAAc,CAACqC,IAAD,CAAjC;AACAF,gBAAAA,WAAW,GAAG5F,QAAQ,CAAC4F,WAAD,EAAcG,YAAd,CAAtB;AACH;AACJ,aALD;AAMA,gBAAIC,aAAa,GAAGpC,aAAa,CAAC6B,QAAD,CAAjC;AACAG,YAAAA,WAAW,GAAG5F,QAAQ,CAAC4F,WAAD,EAAcI,aAAd,CAAtB;AACA,mBAAO,kBAAkB5D,YAAY,CAACwD,WAAD,CAA9B,GAA8C,IAA9C,GAAqDF,cAArD,GAAsE,SAA7E;AACH;;AACD,iBAAO,WAAWA,cAAX,GAA4B,SAAnC;AACH,SAlBa,EAkBXpE,IAlBW,CAkBN,EAlBM,CAAd;;AAmBA,YAAIsB,SAAJ,EAAe;AACX,cAAIE,MAAM,GAAGH,YAAY,CAACI,SAAb,CAAuBH,SAAvB,CAAb;AACA,cAAII,UAAU,GAAGF,MAAM,CAACG,OAAP,EAAjB;;AACA,cAAID,UAAU,IAAIA,UAAU,CAAC,QAAD,CAA5B,EAAwC;AACpCe,YAAAA,UAAU,IAAIf,UAAU,CAAC,QAAD,CAAV,CAAqBH,OAArB,EAA8BG,UAA9B,CAAd;AACH,WAFD,MAEO;AACH,gBAAIiD,QAAQ,GAAG,EAAf;AACApC,YAAAA,UAAU,CAACgC,OAAX,CAAmB,UAAUK,MAAV,EAAkB;AACjC,kBAAI9E,IAAI,GAAG8E,MAAM,CAACZ,UAAD,EAAaxC,MAAb,EAAqBH,YAArB,CAAjB;;AACA,kBAAIvB,IAAJ,EAAU;AACN6E,gBAAAA,QAAQ,GAAG7E,IAAX;AACH;AACJ,aALD;;AAMA,gBAAI6E,QAAJ,EAAc;AACVlC,cAAAA,UAAU,IAAIkC,QAAd;AACH;AACJ;AACJ,SAjBD,MAiBO;AACHlC,UAAAA,UAAU,IAAIlB,OAAd;AACH;AACJ,OAhDD;AAiDAkB,MAAAA,UAAU,IAAIC,QAAd;AACA,aAAOD,UAAP;AACH,KA9EM,EA8EJzC,IA9EI,CA8EC,IA9ED,CAAP;AA+EH,GAvFD;AAwFH;;AACD,SAAS4D,cAAT,CAAwB9D,IAAxB,EAA8BqD,YAA9B,EAA4C;AACxC,MAAI0B,SAAS,GAAGnF,SAAhB;AACA,MAAIoF,aAAa,GAAGpF,SAApB;AACA,MAAI6D,MAAM,GAAG,EAAb;AACA,MAAIC,UAAU,GAAG,CAAjB;;AACA,OAAK,IAAI1E,CAAC,GAAG,CAAR,EAAW2E,GAAG,GAAG3D,IAAI,CAACd,MAA3B,EAAmCF,CAAC,GAAG2E,GAAvC,EAA4C3E,CAAC,EAA7C,EAAiD;AAC7CgG,IAAAA,aAAa,GAAGD,SAAhB;AACA,QAAInB,IAAI,GAAGP,YAAY,CAACf,GAAb,CAAiBtD,CAAjB,CAAX;AACA+F,IAAAA,SAAS,GAAGnB,IAAI,GAAGA,IAAI,CAACqB,QAAL,EAAH,GAAqBrF,SAArC;;AACA,QAAIZ,CAAC,GAAG,CAAJ,IAAS,CAACU,EAAE,CAACqF,SAAD,EAAYC,aAAZ,CAAhB,EAA4C;AACxCvB,MAAAA,MAAM,CAACI,IAAP,CAAY,CAAC7D,IAAI,CAAC+D,KAAL,CAAWL,UAAX,EAAuB1E,CAAvB,CAAD,EAA4BgG,aAA5B,CAAZ;AACAtB,MAAAA,UAAU,GAAG1E,CAAb;AACH;AACJ;;AACDyE,EAAAA,MAAM,CAACI,IAAP,CAAY,CAAC7D,IAAI,CAAC+D,KAAL,CAAWL,UAAX,CAAD,EAAyBqB,SAAzB,CAAZ;AACA,SAAOtB,MAAP;AACH","sourcesContent":["var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nimport { DefaultDraftInlineStyle } from \"draft-js\";\nimport { OrderedSet, is } from 'immutable';\nimport isUnitlessNumber from './isUnitlessNumber';\nexport var EMPTY_SET = OrderedSet();\nexport var DEFAULT_ELEMENT = 'span';\nexport var DEFAULT_INLINE_STYLE = DefaultDraftInlineStyle;\nfunction encodeContent(text) {\n    return text.split('&').join('&amp;').split('<').join('&lt;').split('>').join('&gt;').split('\\xA0').join('&nbsp;').split('\\n').join('<br >' + '\\n');\n}\nfunction encodeAttr(text) {\n    return text.split('&').join('&amp;').split('<').join('&lt;').split('>').join('&gt;').split('\"').join('&quot;');\n}\nvar VENDOR_PREFIX = /^(moz|ms|o|webkit)-/;\nvar NUMERIC_STRING = /^\\d+$/;\nvar UPPERCASE_PATTERN = /([A-Z])/g;\n// Lifted from: https://github.com/facebook/react/blob/master/src/renderers/dom/shared/CSSPropertyOperations.js\nfunction processStyleName(name) {\n    return name.replace(UPPERCASE_PATTERN, '-$1').toLowerCase().replace(VENDOR_PREFIX, '-$1-');\n}\n// Lifted from: https://github.com/facebook/react/blob/master/src/renderers/dom/shared/dangerousStyleValue.js\nfunction processStyleValue(name, value) {\n    var isNumeric = void 0;\n    if (typeof value === 'string') {\n        isNumeric = NUMERIC_STRING.test(value);\n    } else {\n        isNumeric = true;\n        value = String(value);\n    }\n    if (!isNumeric || value === '0' || isUnitlessNumber[name] === true) {\n        return value;\n    } else {\n        return value + 'px';\n    }\n}\nfunction getStyleText(styleObject) {\n    if (!styleObject) {\n        return '';\n    }\n    return Object.keys(styleObject).map(function (name) {\n        var styleName = processStyleName(name);\n        var styleValue = processStyleValue(name, styleObject[name]);\n        return styleName + ':' + styleValue;\n    }).join(';');\n}\nfunction getEntityContent(contentState, entityKey, content) {\n    if (entityKey) {\n        var entity = contentState.getEntity(entityKey);\n        var entityData = entity.getData();\n        if (entityData && entityData['export']) {\n            return entityData['export'](content, entityData);\n        }\n    }\n    return content;\n}\nexport default function GetHTML(configStore) {\n    return function exportHtml(editorState) {\n        var contentState = editorState.getCurrentContent();\n        var blockMap = contentState.getBlockMap();\n        var customStyleMap = configStore.get('customStyleMap') || {};\n        var customBlockRenderMap = configStore.get('blockRenderMap') || {};\n        var customStyleFn = configStore.get('customStyleFn');\n        var toHTMLList = configStore.get('toHTMLList');\n        _extends(customStyleMap, DEFAULT_INLINE_STYLE);\n        return blockMap.map(function (block) {\n            var resultText = '<div>';\n            var closeTag = '</div>';\n            var lastPosition = 0;\n            var text = block.getText();\n            var blockType = block.getType();\n            var blockRender = customBlockRenderMap.get(blockType);\n            if (blockRender) {\n                var element = typeof blockRender.element === 'function' ? blockRender.elementTag || 'div' : 'div';\n                resultText = '<' + (element || 'div') + ' style=\"' + getStyleText(customBlockRenderMap.get(blockType).style || {}) + '\">';\n                closeTag = '</' + (element || 'div') + '>';\n            }\n            var charMetaList = block.getCharacterList();\n            var charEntity = null;\n            var prevCharEntity = null;\n            var ranges = [];\n            var rangeStart = 0;\n            for (var i = 0, len = text.length; i < len; i++) {\n                prevCharEntity = charEntity;\n                var meta = charMetaList.get(i);\n                charEntity = meta ? meta.getEntity() : null;\n                if (i > 0 && charEntity !== prevCharEntity) {\n                    ranges.push([prevCharEntity, getStyleRanges(text.slice(rangeStart, i), charMetaList.slice(rangeStart, i))]);\n                    rangeStart = i;\n                }\n            }\n            ranges.push([charEntity, getStyleRanges(text.slice(rangeStart), charMetaList.slice(rangeStart))]);\n            ranges.map(function (_ref) {\n                var entityKey = _ref[0],\n                    stylePieces = _ref[1];\n\n                var element = DEFAULT_ELEMENT;\n                var rawContent = stylePieces.map(function (_ref2) {\n                    var text = _ref2[0];\n                    return text;\n                }).join('');\n                var content = stylePieces.map(function (_ref3) {\n                    var text = _ref3[0],\n                        styleSet = _ref3[1];\n\n                    var encodedContent = encodeContent(text);\n                    if (styleSet.size) {\n                        var inlineStyle = {};\n                        styleSet.forEach(function (item) {\n                            if (customStyleMap.hasOwnProperty(item)) {\n                                var currentStyle = customStyleMap[item];\n                                inlineStyle = _extends(inlineStyle, currentStyle);\n                            }\n                        });\n                        var customedStyle = customStyleFn(styleSet);\n                        inlineStyle = _extends(inlineStyle, customedStyle);\n                        return '<span style=\"' + getStyleText(inlineStyle) + '\">' + encodedContent + '</span>';\n                    }\n                    return '<span>' + encodedContent + '</span>';\n                }).join('');\n                if (entityKey) {\n                    var entity = contentState.getEntity(entityKey);\n                    var entityData = entity.getData();\n                    if (entityData && entityData['export']) {\n                        resultText += entityData['export'](content, entityData);\n                    } else {\n                        var HTMLText = '';\n                        toHTMLList.forEach(function (toHTML) {\n                            var text = toHTML(rawContent, entity, contentState);\n                            if (text) {\n                                HTMLText = text;\n                            }\n                        });\n                        if (HTMLText) {\n                            resultText += HTMLText;\n                        }\n                    }\n                } else {\n                    resultText += content;\n                }\n            });\n            resultText += closeTag;\n            return resultText;\n        }).join('\\n');\n    };\n}\nfunction getStyleRanges(text, charMetaList) {\n    var charStyle = EMPTY_SET;\n    var prevCharStyle = EMPTY_SET;\n    var ranges = [];\n    var rangeStart = 0;\n    for (var i = 0, len = text.length; i < len; i++) {\n        prevCharStyle = charStyle;\n        var meta = charMetaList.get(i);\n        charStyle = meta ? meta.getStyle() : EMPTY_SET;\n        if (i > 0 && !is(charStyle, prevCharStyle)) {\n            ranges.push([text.slice(rangeStart, i), prevCharStyle]);\n            rangeStart = i;\n        }\n    }\n    ranges.push([text.slice(rangeStart), charStyle]);\n    return ranges;\n}"]},"metadata":{},"sourceType":"module"}