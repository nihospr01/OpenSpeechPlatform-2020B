{"ast":null,"code":"/**\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule DraftEditorDragHandler\n * @format\n * \n */\n'use strict';\n\nvar DataTransfer = require('fbjs/lib/DataTransfer');\n\nvar DraftModifier = require('./DraftModifier');\n\nvar EditorState = require('./EditorState');\n\nvar findAncestorOffsetKey = require('./findAncestorOffsetKey');\n\nvar getTextContentFromFiles = require('./getTextContentFromFiles');\n\nvar getUpdatedSelectionState = require('./getUpdatedSelectionState');\n\nvar isEventHandled = require('./isEventHandled');\n\nvar nullthrows = require('fbjs/lib/nullthrows');\n/**\n * Get a SelectionState for the supplied mouse event.\n */\n\n\nfunction getSelectionForEvent(event, editorState) {\n  var node = null;\n  var offset = null;\n\n  if (typeof document.caretRangeFromPoint === 'function') {\n    var dropRange = document.caretRangeFromPoint(event.x, event.y);\n    node = dropRange.startContainer;\n    offset = dropRange.startOffset;\n  } else if (event.rangeParent) {\n    node = event.rangeParent;\n    offset = event.rangeOffset;\n  } else {\n    return null;\n  }\n\n  node = nullthrows(node);\n  offset = nullthrows(offset);\n  var offsetKey = nullthrows(findAncestorOffsetKey(node));\n  return getUpdatedSelectionState(editorState, offsetKey, offset, offsetKey, offset);\n}\n\nvar DraftEditorDragHandler = {\n  /**\n   * Drag originating from input terminated.\n   */\n  onDragEnd: function onDragEnd(editor) {\n    editor.exitCurrentMode();\n  },\n\n  /**\n   * Handle data being dropped.\n   */\n  onDrop: function onDrop(editor, e) {\n    var data = new DataTransfer(e.nativeEvent.dataTransfer);\n    var editorState = editor._latestEditorState;\n    var dropSelection = getSelectionForEvent(e.nativeEvent, editorState);\n    e.preventDefault();\n    editor.exitCurrentMode();\n\n    if (dropSelection == null) {\n      return;\n    }\n\n    var files = data.getFiles();\n\n    if (files.length > 0) {\n      if (editor.props.handleDroppedFiles && isEventHandled(editor.props.handleDroppedFiles(dropSelection, files))) {\n        return;\n      }\n\n      getTextContentFromFiles(files, function (fileText) {\n        fileText && editor.update(insertTextAtSelection(editorState, dropSelection, fileText));\n      });\n      return;\n    }\n\n    var dragType = editor._internalDrag ? 'internal' : 'external';\n\n    if (editor.props.handleDrop && isEventHandled(editor.props.handleDrop(dropSelection, data, dragType))) {\n      return;\n    }\n\n    if (editor._internalDrag) {\n      editor.update(moveText(editorState, dropSelection));\n      return;\n    }\n\n    editor.update(insertTextAtSelection(editorState, dropSelection, data.getText()));\n  }\n};\n\nfunction moveText(editorState, targetSelection) {\n  var newContentState = DraftModifier.moveText(editorState.getCurrentContent(), editorState.getSelection(), targetSelection);\n  return EditorState.push(editorState, newContentState, 'insert-fragment');\n}\n/**\n * Insert text at a specified selection.\n */\n\n\nfunction insertTextAtSelection(editorState, selection, text) {\n  var newContentState = DraftModifier.insertText(editorState.getCurrentContent(), selection, text, editorState.getCurrentInlineStyle());\n  return EditorState.push(editorState, newContentState, 'insert-fragment');\n}\n\nmodule.exports = DraftEditorDragHandler;","map":{"version":3,"sources":["/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/draft-js/lib/DraftEditorDragHandler.js"],"names":["DataTransfer","require","DraftModifier","EditorState","findAncestorOffsetKey","getTextContentFromFiles","getUpdatedSelectionState","isEventHandled","nullthrows","getSelectionForEvent","event","editorState","node","offset","document","caretRangeFromPoint","dropRange","x","y","startContainer","startOffset","rangeParent","rangeOffset","offsetKey","DraftEditorDragHandler","onDragEnd","editor","exitCurrentMode","onDrop","e","data","nativeEvent","dataTransfer","_latestEditorState","dropSelection","preventDefault","files","getFiles","length","props","handleDroppedFiles","fileText","update","insertTextAtSelection","dragType","_internalDrag","handleDrop","moveText","getText","targetSelection","newContentState","getCurrentContent","getSelection","push","selection","text","insertText","getCurrentInlineStyle","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule DraftEditorDragHandler\n * @format\n * \n */\n\n'use strict';\n\nvar DataTransfer = require('fbjs/lib/DataTransfer');\nvar DraftModifier = require('./DraftModifier');\nvar EditorState = require('./EditorState');\n\nvar findAncestorOffsetKey = require('./findAncestorOffsetKey');\nvar getTextContentFromFiles = require('./getTextContentFromFiles');\nvar getUpdatedSelectionState = require('./getUpdatedSelectionState');\nvar isEventHandled = require('./isEventHandled');\nvar nullthrows = require('fbjs/lib/nullthrows');\n\n/**\n * Get a SelectionState for the supplied mouse event.\n */\nfunction getSelectionForEvent(event, editorState) {\n  var node = null;\n  var offset = null;\n\n  if (typeof document.caretRangeFromPoint === 'function') {\n    var dropRange = document.caretRangeFromPoint(event.x, event.y);\n    node = dropRange.startContainer;\n    offset = dropRange.startOffset;\n  } else if (event.rangeParent) {\n    node = event.rangeParent;\n    offset = event.rangeOffset;\n  } else {\n    return null;\n  }\n\n  node = nullthrows(node);\n  offset = nullthrows(offset);\n  var offsetKey = nullthrows(findAncestorOffsetKey(node));\n\n  return getUpdatedSelectionState(editorState, offsetKey, offset, offsetKey, offset);\n}\n\nvar DraftEditorDragHandler = {\n  /**\n   * Drag originating from input terminated.\n   */\n  onDragEnd: function onDragEnd(editor) {\n    editor.exitCurrentMode();\n  },\n\n  /**\n   * Handle data being dropped.\n   */\n  onDrop: function onDrop(editor, e) {\n    var data = new DataTransfer(e.nativeEvent.dataTransfer);\n\n    var editorState = editor._latestEditorState;\n    var dropSelection = getSelectionForEvent(e.nativeEvent, editorState);\n\n    e.preventDefault();\n    editor.exitCurrentMode();\n\n    if (dropSelection == null) {\n      return;\n    }\n\n    var files = data.getFiles();\n    if (files.length > 0) {\n      if (editor.props.handleDroppedFiles && isEventHandled(editor.props.handleDroppedFiles(dropSelection, files))) {\n        return;\n      }\n\n      getTextContentFromFiles(files, function (fileText) {\n        fileText && editor.update(insertTextAtSelection(editorState, dropSelection, fileText));\n      });\n      return;\n    }\n\n    var dragType = editor._internalDrag ? 'internal' : 'external';\n    if (editor.props.handleDrop && isEventHandled(editor.props.handleDrop(dropSelection, data, dragType))) {\n      return;\n    }\n\n    if (editor._internalDrag) {\n      editor.update(moveText(editorState, dropSelection));\n      return;\n    }\n\n    editor.update(insertTextAtSelection(editorState, dropSelection, data.getText()));\n  }\n};\n\nfunction moveText(editorState, targetSelection) {\n  var newContentState = DraftModifier.moveText(editorState.getCurrentContent(), editorState.getSelection(), targetSelection);\n  return EditorState.push(editorState, newContentState, 'insert-fragment');\n}\n\n/**\n * Insert text at a specified selection.\n */\nfunction insertTextAtSelection(editorState, selection, text) {\n  var newContentState = DraftModifier.insertText(editorState.getCurrentContent(), selection, text, editorState.getCurrentInlineStyle());\n  return EditorState.push(editorState, newContentState, 'insert-fragment');\n}\n\nmodule.exports = DraftEditorDragHandler;"]},"metadata":{},"sourceType":"script"}