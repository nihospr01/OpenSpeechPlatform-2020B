{"ast":null,"code":"import { cartesian } from \"../cartesian.js\";\nimport { abs, asin, atan2, cos, epsilon, radians, sqrt } from \"../math.js\";\nimport { transformer } from \"../transform.js\";\nvar maxDepth = 16,\n    // maximum depth of subdivision\ncosMinDistance = cos(30 * radians); // cos(minimum angular distance)\n\nexport default function (project, delta2) {\n  return +delta2 ? resample(project, delta2) : resampleNone(project);\n}\n\nfunction resampleNone(project) {\n  return transformer({\n    point: function point(x, y) {\n      x = project(x, y);\n      this.stream.point(x[0], x[1]);\n    }\n  });\n}\n\nfunction resample(project, delta2) {\n  function resampleLineTo(x0, y0, lambda0, a0, b0, c0, x1, y1, lambda1, a1, b1, c1, depth, stream) {\n    var dx = x1 - x0,\n        dy = y1 - y0,\n        d2 = dx * dx + dy * dy;\n\n    if (d2 > 4 * delta2 && depth--) {\n      var a = a0 + a1,\n          b = b0 + b1,\n          c = c0 + c1,\n          m = sqrt(a * a + b * b + c * c),\n          phi2 = asin(c /= m),\n          lambda2 = abs(abs(c) - 1) < epsilon || abs(lambda0 - lambda1) < epsilon ? (lambda0 + lambda1) / 2 : atan2(b, a),\n          p = project(lambda2, phi2),\n          x2 = p[0],\n          y2 = p[1],\n          dx2 = x2 - x0,\n          dy2 = y2 - y0,\n          dz = dy * dx2 - dx * dy2;\n\n      if (dz * dz / d2 > delta2 // perpendicular projected distance\n      || abs((dx * dx2 + dy * dy2) / d2 - 0.5) > 0.3 // midpoint close to an end\n      || a0 * a1 + b0 * b1 + c0 * c1 < cosMinDistance) {\n        // angular distance\n        resampleLineTo(x0, y0, lambda0, a0, b0, c0, x2, y2, lambda2, a /= m, b /= m, c, depth, stream);\n        stream.point(x2, y2);\n        resampleLineTo(x2, y2, lambda2, a, b, c, x1, y1, lambda1, a1, b1, c1, depth, stream);\n      }\n    }\n  }\n\n  return function (stream) {\n    var lambda00, x00, y00, a00, b00, c00, // first point\n    lambda0, x0, y0, a0, b0, c0; // previous point\n\n    var resampleStream = {\n      point: point,\n      lineStart: lineStart,\n      lineEnd: lineEnd,\n      polygonStart: function polygonStart() {\n        stream.polygonStart();\n        resampleStream.lineStart = ringStart;\n      },\n      polygonEnd: function polygonEnd() {\n        stream.polygonEnd();\n        resampleStream.lineStart = lineStart;\n      }\n    };\n\n    function point(x, y) {\n      x = project(x, y);\n      stream.point(x[0], x[1]);\n    }\n\n    function lineStart() {\n      x0 = NaN;\n      resampleStream.point = linePoint;\n      stream.lineStart();\n    }\n\n    function linePoint(lambda, phi) {\n      var c = cartesian([lambda, phi]),\n          p = project(lambda, phi);\n      resampleLineTo(x0, y0, lambda0, a0, b0, c0, x0 = p[0], y0 = p[1], lambda0 = lambda, a0 = c[0], b0 = c[1], c0 = c[2], maxDepth, stream);\n      stream.point(x0, y0);\n    }\n\n    function lineEnd() {\n      resampleStream.point = point;\n      stream.lineEnd();\n    }\n\n    function ringStart() {\n      lineStart();\n      resampleStream.point = ringPoint;\n      resampleStream.lineEnd = ringEnd;\n    }\n\n    function ringPoint(lambda, phi) {\n      linePoint(lambda00 = lambda, phi), x00 = x0, y00 = y0, a00 = a0, b00 = b0, c00 = c0;\n      resampleStream.point = linePoint;\n    }\n\n    function ringEnd() {\n      resampleLineTo(x0, y0, lambda0, a0, b0, c0, x00, y00, lambda00, a00, b00, c00, maxDepth, stream);\n      resampleStream.lineEnd = lineEnd;\n      lineEnd();\n    }\n\n    return resampleStream;\n  };\n}","map":{"version":3,"sources":["/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/d3-geo/src/projection/resample.js"],"names":["cartesian","abs","asin","atan2","cos","epsilon","radians","sqrt","transformer","maxDepth","cosMinDistance","project","delta2","resample","resampleNone","point","x","y","stream","resampleLineTo","x0","y0","lambda0","a0","b0","c0","x1","y1","lambda1","a1","b1","c1","depth","dx","dy","d2","a","b","c","m","phi2","lambda2","p","x2","y2","dx2","dy2","dz","lambda00","x00","y00","a00","b00","c00","resampleStream","lineStart","lineEnd","polygonStart","ringStart","polygonEnd","NaN","linePoint","lambda","phi","ringPoint","ringEnd"],"mappings":"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","sourcesContent":["import {cartesian} from \"../cartesian.js\";\nimport {abs, asin, atan2, cos, epsilon, radians, sqrt} from \"../math.js\";\nimport {transformer} from \"../transform.js\";\n\nvar maxDepth = 16, // maximum depth of subdivision\n    cosMinDistance = cos(30 * radians); // cos(minimum angular distance)\n\nexport default function(project, delta2) {\n  return +delta2 ? resample(project, delta2) : resampleNone(project);\n}\n\nfunction resampleNone(project) {\n  return transformer({\n    point: function(x, y) {\n      x = project(x, y);\n      this.stream.point(x[0], x[1]);\n    }\n  });\n}\n\nfunction resample(project, delta2) {\n\n  function resampleLineTo(x0, y0, lambda0, a0, b0, c0, x1, y1, lambda1, a1, b1, c1, depth, stream) {\n    var dx = x1 - x0,\n        dy = y1 - y0,\n        d2 = dx * dx + dy * dy;\n    if (d2 > 4 * delta2 && depth--) {\n      var a = a0 + a1,\n          b = b0 + b1,\n          c = c0 + c1,\n          m = sqrt(a * a + b * b + c * c),\n          phi2 = asin(c /= m),\n          lambda2 = abs(abs(c) - 1) < epsilon || abs(lambda0 - lambda1) < epsilon ? (lambda0 + lambda1) / 2 : atan2(b, a),\n          p = project(lambda2, phi2),\n          x2 = p[0],\n          y2 = p[1],\n          dx2 = x2 - x0,\n          dy2 = y2 - y0,\n          dz = dy * dx2 - dx * dy2;\n      if (dz * dz / d2 > delta2 // perpendicular projected distance\n          || abs((dx * dx2 + dy * dy2) / d2 - 0.5) > 0.3 // midpoint close to an end\n          || a0 * a1 + b0 * b1 + c0 * c1 < cosMinDistance) { // angular distance\n        resampleLineTo(x0, y0, lambda0, a0, b0, c0, x2, y2, lambda2, a /= m, b /= m, c, depth, stream);\n        stream.point(x2, y2);\n        resampleLineTo(x2, y2, lambda2, a, b, c, x1, y1, lambda1, a1, b1, c1, depth, stream);\n      }\n    }\n  }\n  return function(stream) {\n    var lambda00, x00, y00, a00, b00, c00, // first point\n        lambda0, x0, y0, a0, b0, c0; // previous point\n\n    var resampleStream = {\n      point: point,\n      lineStart: lineStart,\n      lineEnd: lineEnd,\n      polygonStart: function() { stream.polygonStart(); resampleStream.lineStart = ringStart; },\n      polygonEnd: function() { stream.polygonEnd(); resampleStream.lineStart = lineStart; }\n    };\n\n    function point(x, y) {\n      x = project(x, y);\n      stream.point(x[0], x[1]);\n    }\n\n    function lineStart() {\n      x0 = NaN;\n      resampleStream.point = linePoint;\n      stream.lineStart();\n    }\n\n    function linePoint(lambda, phi) {\n      var c = cartesian([lambda, phi]), p = project(lambda, phi);\n      resampleLineTo(x0, y0, lambda0, a0, b0, c0, x0 = p[0], y0 = p[1], lambda0 = lambda, a0 = c[0], b0 = c[1], c0 = c[2], maxDepth, stream);\n      stream.point(x0, y0);\n    }\n\n    function lineEnd() {\n      resampleStream.point = point;\n      stream.lineEnd();\n    }\n\n    function ringStart() {\n      lineStart();\n      resampleStream.point = ringPoint;\n      resampleStream.lineEnd = ringEnd;\n    }\n\n    function ringPoint(lambda, phi) {\n      linePoint(lambda00 = lambda, phi), x00 = x0, y00 = y0, a00 = a0, b00 = b0, c00 = c0;\n      resampleStream.point = linePoint;\n    }\n\n    function ringEnd() {\n      resampleLineTo(x0, y0, lambda0, a0, b0, c0, x00, y00, lambda00, a00, b00, c00, maxDepth, stream);\n      resampleStream.lineEnd = lineEnd;\n      lineEnd();\n    }\n\n    return resampleStream;\n  };\n}\n"]},"metadata":{},"sourceType":"module"}