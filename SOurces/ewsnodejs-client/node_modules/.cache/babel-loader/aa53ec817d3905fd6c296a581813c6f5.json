{"ast":null,"code":"import _regeneratorRuntime from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{withStyles}from'@material-ui/styles';import Paper from'@material-ui/core/Paper';import Grid from'@material-ui/core/Grid';import Button from'@material-ui/core/Button';import ButtonGroup from'@material-ui/core/ButtonGroup';import PlayCircleOutlineIcon from'@material-ui/icons/PlayCircleOutline';import*as d3 from'd3';import treeGraph from'utils/BST/treeGraph.csv';import treeNodes from'utils/BST/treeNodes.csv';import{parseTreeNodeSingleEar}from'utils/BST/BSTUtil';import withUserAuth from'context/withUserAuth';import{withRouter}from'react-router-dom';import{compose}from'recompose';import{Link}from'react-router-dom';import{logBoarder,axios}from'utils/utils';import clsx from'clsx';import{makeStyles}from'@material-ui/core/styles';import IconButton from'@material-ui/core/IconButton';import Input from'@material-ui/core/Input';import FilledInput from'@material-ui/core/FilledInput';import OutlinedInput from'@material-ui/core/OutlinedInput';import InputLabel from'@material-ui/core/InputLabel';import InputAdornment from'@material-ui/core/InputAdornment';import FormHelperText from'@material-ui/core/FormHelperText';import FormControl from'@material-ui/core/FormControl';import TextField from'@material-ui/core/TextField';import Card from'@material-ui/core/Card';import Typography from'@material-ui/core/Typography';import CardActions from'@material-ui/core/CardActions';import CardContent from'@material-ui/core/CardContent';var styles=function styles(theme){return{root:{flexGrow:1},cardRoot:{minWidth:100},bullet:{display:'inline-block',margin:'0 2px',transform:'scale(0.8)'},pos:{marginBottom:12},paper:{minHeight:'90vh'},title:{fontSize:14},button:{minWidth:250,height:50,margin:10},grid:{marginLeft:10,fontSize:16},margin:{margin:10},extendedIcon:{marginRight:8},buttonGroup:{width:'40vw',height:100,marginTop:30,marginBottom:30}};};var AssessmentPage=/*#__PURE__*/function(_Component){_inherits(AssessmentPage,_Component);var _super=_createSuper(AssessmentPage);function AssessmentPage(){var _this$state;var _this;_classCallCheck(this,AssessmentPage);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state=(_this$state={numIteration:1,low:-20,high:0,directoin:0,diff:0,alpha:0,New:0,Now:0,switchingTime:2.5,currPlaying:0,switchingParamIntervalId:null,controlMode:0,playCurrent:true,completed:false,isSetup:false},_defineProperty(_this$state,\"controlMode\",null),_defineProperty(_this$state,\"inputMode\",null),_this$state);_this.reset=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(backToMenu){var dataInput,response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dataInput={left:{alpha:0.0},right:{alpha:0.0}};_context.prev=1;_context.next=4;return axios.post(\"/api/param/setparam\",{method:'set',data:dataInput});case 4:response=_context.sent;data=response.data;console.log(data);_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);alert(_context.t0.response.data);case 12:_this.setState({low:-20,high:0});if(backToMenu){_this.setState({isSetup:false});}case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);}));return function(_x){return _ref.apply(this,arguments);};}();_this.playFile=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _this$state2,high,low,inputMode,controlMode,switchingTime,path,response,dataInput,mid,newDiff,newNew,newNow,param,Id;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$state2=_this.state,high=_this$state2.high,low=_this$state2.low,inputMode=_this$state2.inputMode,controlMode=_this$state2.controlMode,switchingTime=_this$state2.switchingTime;console.log('high: '+high);console.log('low: '+low);console.log(controlMode);console.log('inputMode: '+inputMode==='0'?'live audio':'file stimulus');console.log('control: '+controlMode==='0'?'auto':'manual');path=\"\";_context2.prev=7;_context2.next=10;return axios.get(\"/api/researcher/audioPath\");case 10:response=_context2.sent;path=path.concat(response.data);_context2.next=17;break;case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](7);alert(_context2.t0.response.data);case 17:path=path.concat('test.wav');dataInput={left:{audio_filename:path,audio_reset:1,audio_repeat:1,audio_play:1,alpha:1.0,afc:0},right:{audio_filename:path,audio_reset:1,audio_repeat:1,audio_play:1,alpha:1.0,afc:0}};_this.setState({isSetup:true});mid=(Number(low)+Number(high))*0.5;newDiff=Math.abs(high-low)*0.25;newNew=Number(mid)+Number(newDiff);newNow=Number(mid)-Number(newDiff);// this.setState({\n//     low: newNow,\n//     high: newNew,\n//     diff: newDiff,\n//     New: newNew,\n//     Now: newNow,\n// })\n// try {\n//     const response = await axios.post(\"/api/param/setparam\", {\n//         method: 'set',\n//         data: dataInput,\n//     });\n//     const data = response.data;\n//     console.log(data);\n// }\n// catch(error) {\n//     alert(error.response.data);\n// }\nif(controlMode==0){param=_this.getParam(newNow);_this.transmitParams(param);Id=null;Id=setInterval(function(){return _this.switchParam(newNow);},switchingTime*1000);_this.setState({switchingParamIntervalId:Id});}_this.setState({low:newNow,high:newNew,diff:newDiff,New:newNew,Now:newNow});console.log(\"Current: \"+_this.state.Now);console.log(\"New: \"+_this.state.New);case 28:case\"end\":return _context2.stop();}}},_callee2,null,[[7,14]]);}));_this.switchParam=function(value){var playCurrent=_this.state.playCurrent;if(playCurrent){var param=_this.getParam(value);_this.transmitParams(param);_this.setState({playCurrent:false});}else{var _param=_this.getParam(value);_this.transmitParams(_param);_this.setState({playCurrent:true});}};_this.getParam=function(value){return{'left':{'g50':[value,value,value,value,value,value],'g80':[value,value,value,value,value,value]},'right':{'g50':[value,value,value,value,value,value],'g80':[value,value,value,value,value,value]}};};_this.transmitParams=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(param){var response,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return axios.post(\"/api/param/setparam\",{method:'set',data:param});case 3:response=_context3.sent;data=response.data;console.log(data);_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);alert(_context3.t0.response.data);case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function(_x2){return _ref3.apply(this,arguments);};}();_this.handlePlay=function(isCurrent){var _this$state3=_this.state,New=_this$state3.New,Now=_this$state3.Now;var param=isCurrent?_this.getParam(Now):_this.getParam(New);_this.transmitParams(param);_this.setState({playCurrent:isCurrent});console.log(isCurrent?\"Current: \"+param['left']['g50'][0]:\"New: \"+param['left']['g50'][0]);};_this.calculateNew=function(choice){var _this$state4=_this.state,high=_this$state4.high,low=_this$state4.low,diff=_this$state4.diff,New=_this$state4.New;var newLow=0;var newDiff=0;var newNew=0;var newHigh=0;if(Math.abs(choice-high)<Math.abs(choice-low)){newLow=Number(low)+Number(diff);newDiff=Math.abs(high-low)*0.25;newNew=Number(high)-Number(newDiff);return[newNew,[newLow,'l'],newDiff];// this.setState({\n//     low: newLow,\n//     diff: newDiff,\n//     New: newNew,\n// }, () => {\n//     console.log(this.state.New);\n// });\n}else{newHigh=Number(high)-Number(diff);newDiff=Math.abs(high-low)*0.25;newNew=Number(low)+Number(newDiff);return[newNew,[newHigh,'h'],newDiff];}};_this.handleNewBetter=function(){var _this$state5=_this.state,New=_this$state5.New,numIteration=_this$state5.numIteration;_this.setState({Now:New});var param=_this.getParam(New);_this.transmitParams(param);var tmp=_this.calculateNew(New);if(tmp[1][1]==='h'){_this.setState({New:tmp[0],diff:tmp[2],high:tmp[1][0],numIteration:numIteration+1});}else{_this.setState({New:tmp[0],diff:tmp[2],low:tmp[1][0],numIteration:numIteration+1});}// console.log(\"Current: \" + this.state.Now);\n// console.log(\"New: \" + this.state.New);\n};_this.handleEqual=function(){var switchingParamIntervalId=_this.state.switchingParamIntervalId;if(switchingParamIntervalId!=null){clearInterval(switchingParamIntervalId);}_this.reset(false);_this.setState({completed:true});};_this.handleCurrBetter=function(){var _this$state6=_this.state,Now=_this$state6.Now,numIteration=_this$state6.numIteration;var tmp=_this.calculateNew(Now);var param=_this.getParam(Now);_this.transmitParams(param);if(tmp[1][1]==='h'){_this.setState({New:tmp[0],diff:tmp[2],high:tmp[1][0],numIteration:numIteration+1});}else{_this.setState({New:tmp[0],diff:tmp[2],low:tmp[1][0],numIteration:numIteration+1});}};return _this;}_createClass(AssessmentPage,[{key:\"handleChangeMin\",value:function handleChangeMin(event){var low=this.state.low;this.setState({low:event.target.value});}},{key:\"handleChangeMax\",value:function handleChangeMax(event){var high=this.state.high;this.setState({high:event.target.value});}},{key:\"handleChangeInputMode\",value:function handleChangeInputMode(event){var inputMode=this.state.inputMode;this.setState({inputMode:event.target.value});}},{key:\"handleChangeControlMode\",value:function handleChangeControlMode(event){var controlMode=this.state.controlMode;this.setState({controlMode:event.target.value});}},{key:\"render\",//TODO  \nvalue:function render(){var _this2=this;var classes=this.props.classes;var _this$state7=this.state,completed=_this$state7.completed,Now=_this$state7.Now,New=_this$state7.New,numIteration=_this$state7.numIteration,playCurrent=_this$state7.playCurrent,isSetup=_this$state7.isSetup;return/*#__PURE__*/React.createElement(Paper,{className:classes.paper},isSetup?[/*#__PURE__*/React.createElement(Grid,{container:true,spacing:1},/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,className:classes.grid},\"Please click the one you think is better:\"),/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"row\",justify:\"space-around\",alignItems:\"center\"},/*#__PURE__*/React.createElement(ButtonGroup,{size:\"large\",color:\"primary\",\"aria-label\":\"large outlined primary button group\"},/*#__PURE__*/React.createElement(Button,{className:classes.buttonGroup,variant:!playCurrent?\"outlined\":\"contained\",startIcon:/*#__PURE__*/React.createElement(PlayCircleOutlineIcon,null),onClick:function onClick(){return _this2.handlePlay(true);}},\"Current\"),/*#__PURE__*/React.createElement(Button,{className:classes.buttonGroup,variant:playCurrent?\"outlined\":\"contained\",startIcon:/*#__PURE__*/React.createElement(PlayCircleOutlineIcon,null),onClick:function onClick(){return _this2.handlePlay(false);}},\"New\"))),!completed?[/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"column\",justify:\"flex-end\",alignItems:\"center\",key:\"options\"},/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:function onClick(){return _this2.handleNewBetter();}},\"New is Better than Current\"),/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:function onClick(){return _this2.handleEqual();}},\"New is the Same as Current\"),/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:function onClick(){return _this2.handleCurrBetter();}},\"New is Worse than Current\"))]:[/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"column\",justify:\"flex-end\",alignItems:\"center\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"p\",null,\"Congrats!! You've finished the user assessment!\\\"\",/*#__PURE__*/React.createElement(\"br\",null),\"The overall gain is:   \",Now,/*#__PURE__*/React.createElement(\"br\",null),\"The difference between two stimulus:  \",Math.abs(New-Now),\".\",/*#__PURE__*/React.createElement(\"br\",null),\"The number of iterations is:  \",numIteration,\".\")),/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:function onClick(){return _this2.reset(true);}// component={Link}\n// to={`/qualityAssessmentDemo/`}\n},\"exit\"))])]:[/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\"}},/*#__PURE__*/React.createElement(\"h1\",{class:\"display-5\"},\"Search Example\")),/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\"}},/*#__PURE__*/React.createElement(\"p\",{class:\"text-secondary\",id:\"description\"},\"Choose between two set of changing parameters to find your optimal setting.\")),/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\"}},/*#__PURE__*/React.createElement(FormControl,{className:clsx(classes.margin,classes.withoutLabel,classes.textField)},/*#__PURE__*/React.createElement(Input,{id:\"minVolume\",value:this.state.low,onChange:this.handleChangeMin.bind(this),endAdornment:/*#__PURE__*/React.createElement(InputAdornment,{position:\"end\"},\"dB\"),inputProps:{'aria-label':'Min'}}),/*#__PURE__*/React.createElement(FormHelperText,{id:\"minVolume\"},\"Min\"))),/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\"}},/*#__PURE__*/React.createElement(FormControl,{className:clsx(classes.margin,classes.withoutLabel,classes.textField)},/*#__PURE__*/React.createElement(Input,{id:\"maxVolume\",value:this.state.high,onChange:this.handleChangeMax.bind(this),endAdornment:/*#__PURE__*/React.createElement(InputAdornment,{position:\"end\"},\"dB\")//aria-describedby=\"standard-weight-helper-text\"\n,inputProps:{'aria-label':'Max'}}),/*#__PURE__*/React.createElement(FormHelperText,{id:\"maxVolume\"},\"Max\"))),/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\"}},/*#__PURE__*/React.createElement(\"input\",{type:\"radio\",value:\"0\",name:\"inputType\",onChange:this.handleChangeControlMode.bind(this)}),\"Auto\"),/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\"}},/*#__PURE__*/React.createElement(\"input\",{type:\"radio\",value:\"1\",name:\"inputType\",onChange:this.handleChangeControlMode.bind(this)}),\"Manual\"),/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"column\",justify:\"flex-end\",alignItems:\"center\",key:\"options\"},/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"contained\",color:\"primary\",onClick:this.playFile},\"start\"),/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:function onClick(){return _this2.reset(false);},component:Link,to:\"/listenermanagement/\"},\"exit\")))]);}}]);return AssessmentPage;}(Component);export default compose(withUserAuth,withRouter,withStyles(styles))(AssessmentPage);","map":{"version":3,"sources":["/opt/osp/ewsnodejs-client/src/pages/demo/qualityAssessmentDemo.jsx"],"names":["React","Component","withStyles","Paper","Grid","Button","ButtonGroup","PlayCircleOutlineIcon","d3","treeGraph","treeNodes","parseTreeNodeSingleEar","withUserAuth","withRouter","compose","Link","logBoarder","axios","clsx","makeStyles","IconButton","Input","FilledInput","OutlinedInput","InputLabel","InputAdornment","FormHelperText","FormControl","TextField","Card","Typography","CardActions","CardContent","styles","theme","root","flexGrow","cardRoot","minWidth","bullet","display","margin","transform","pos","marginBottom","paper","minHeight","title","fontSize","button","height","grid","marginLeft","extendedIcon","marginRight","buttonGroup","width","marginTop","AssessmentPage","state","numIteration","low","high","directoin","diff","alpha","New","Now","switchingTime","currPlaying","switchingParamIntervalId","controlMode","playCurrent","completed","isSetup","reset","backToMenu","dataInput","left","right","post","method","data","response","console","log","alert","setState","playFile","inputMode","path","get","concat","audio_filename","audio_reset","audio_repeat","audio_play","afc","mid","Number","newDiff","Math","abs","newNew","newNow","param","getParam","transmitParams","Id","setInterval","switchParam","value","handlePlay","isCurrent","calculateNew","choice","newLow","newHigh","handleNewBetter","tmp","handleEqual","clearInterval","handleCurrBetter","event","target","classes","props","justifyContent","alignItems","withoutLabel","textField","handleChangeMin","bind","handleChangeMax","handleChangeControlMode"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { withStyles } from '@material-ui/styles';\nimport Paper from '@material-ui/core/Paper';\nimport Grid from '@material-ui/core/Grid';\nimport Button from '@material-ui/core/Button';\nimport ButtonGroup from '@material-ui/core/ButtonGroup';\nimport PlayCircleOutlineIcon from '@material-ui/icons/PlayCircleOutline';\nimport * as d3 from 'd3';\nimport treeGraph from 'utils/BST/treeGraph.csv'\nimport treeNodes from 'utils/BST/treeNodes.csv'\nimport { parseTreeNodeSingleEar } from 'utils/BST/BSTUtil';\nimport withUserAuth from 'context/withUserAuth';\nimport { withRouter } from 'react-router-dom';\nimport { compose } from 'recompose';\nimport { Link } from 'react-router-dom';\nimport { logBoarder, axios } from 'utils/utils';\nimport PropTypes from 'prop-types';\nimport clsx from 'clsx';\nimport { makeStyles } from '@material-ui/core/styles';\nimport IconButton from '@material-ui/core/IconButton';\nimport Input from '@material-ui/core/Input';\nimport FilledInput from '@material-ui/core/FilledInput';\nimport OutlinedInput from '@material-ui/core/OutlinedInput';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport FormControl from '@material-ui/core/FormControl';\nimport TextField from '@material-ui/core/TextField';\nimport Card from '@material-ui/core/Card';\nimport Typography from '@material-ui/core/Typography';\nimport CardActions from '@material-ui/core/CardActions';\nimport CardContent from '@material-ui/core/CardContent';\n\nconst styles = (theme) => ({\n    root: {\n        flexGrow: 1,\n    },\n    cardRoot: {\n        minWidth: 100\n    },\n    bullet: {\n        display: 'inline-block',\n        margin: '0 2px',\n        transform: 'scale(0.8)',\n    },\n    pos: {\n        marginBottom: 12\n    },\n    paper: {\n        minHeight: '90vh',\n    },\n    title: {\n        fontSize: 14,\n    },\n    button: {\n        minWidth: 250,\n        height: 50,\n        margin: 10,\n    },\n    grid: {\n        marginLeft: 10,\n        fontSize: 16,\n    },\n    margin: {\n        margin: 10,\n    },\n    extendedIcon: {\n        marginRight: 8,\n    },\n    buttonGroup: {\n        width: '40vw',\n        height: 100,\n        marginTop: 30,\n        marginBottom: 30,\n    },\n});\n\nclass AssessmentPage extends Component {\n    state = {\n        numIteration: 1,\n        low: -20,\n        high: 0,\n        directoin: 0,\n        diff: 0,\n        alpha: 0,\n        New: 0,\n        Now: 0,\n        switchingTime: 2.5,\n        currPlaying: 0,\n        switchingParamIntervalId: null,\n        controlMode: 0,\n        playCurrent: true,\n        completed: false,\n        isSetup: false,\n        controlMode: null,\n        inputMode: null,\n    };\n\n    handleChangeMin (event) {\n        const low = this.state.low;\n        this.setState({\n            low: event.target.value\n        });\n    }\n    handleChangeMax (event) {\n        const high = this.state.high;\n        this.setState({\n            high: event.target.value\n        });\n    }\n    handleChangeInputMode (event) {\n        const inputMode = this.state.inputMode;\n        this.setState({\n            inputMode: event.target.value\n        });\n    }\n    handleChangeControlMode (event){\n        const controlMode = this.state.controlMode;\n        this.setState({\n            controlMode: event.target.value\n        });\n    }\n    reset = async (backToMenu) => {\n        const dataInput ={\n            left: {\n                alpha: 0.0,\n            },\n            right: {\n                alpha: 0.0,\n            },\n        };\n        try {\n            const response = await axios.post(\"/api/param/setparam\", {\n                method: 'set',\n                data: dataInput,\n            });\n            const data = response.data;\n            console.log(data);\n        }\n        catch(error) {\n            alert(error.response.data);\n        }\n        this.setState({\n            low: -20,\n            high: 0\n        });\n        if (backToMenu){\n            this.setState({ isSetup: false});\n        }\n    }\n\n    playFile = async () => {\n        const {high, low, inputMode, controlMode, switchingTime} = this.state;\n        console.log('high: ' + high);\n        console.log('low: ' + low);\n        console.log(controlMode);\n        console.log('inputMode: ' + inputMode === '0' ? 'live audio' : 'file stimulus');\n        console.log('control: ' + controlMode === '0' ? 'auto': 'manual');\n        let path = \"\";\n        try {\n            const response = await axios.get(\"/api/researcher/audioPath\");\n            path = path.concat(response.data);\n        }\n        catch(error) {\n            alert(error.response.data);\n        }\n        path = path.concat('test.wav')\n        const dataInput ={\n            left: {\n                audio_filename: path,\n                audio_reset: 1,\n                audio_repeat: 1,\n                audio_play: 1,\n                alpha: 1.0,\n                afc: 0,\n            },\n            right: {\n                audio_filename: path,\n                audio_reset: 1,\n                audio_repeat: 1,\n                audio_play: 1,\n                alpha: 1.0,\n                afc: 0,\n            },\n        };\n        this.setState({\n            isSetup: true\n        })\n        \n        let mid = (Number(low) + Number(high)) * 0.5;\n        let newDiff = Math.abs(high - low) * 0.25;\n        let newNew = Number(mid) + Number(newDiff);\n        let newNow = Number(mid) - Number(newDiff);\n        // this.setState({\n        //     low: newNow,\n        //     high: newNew,\n        //     diff: newDiff,\n        //     New: newNew,\n        //     Now: newNow,\n        // })\n        // try {\n        //     const response = await axios.post(\"/api/param/setparam\", {\n        //         method: 'set',\n        //         data: dataInput,\n        //     });\n        //     const data = response.data;\n        //     console.log(data);\n        // }\n        // catch(error) {\n        //     alert(error.response.data);\n        // }\n\n        if (controlMode == 0){\n            let param = this.getParam(newNow);\n            this.transmitParams(param);\n            let Id = null;\n            Id = setInterval(() => this.switchParam(newNow), switchingTime*1000);\n            this.setState({ switchingParamIntervalId: Id});\n        }\n\n        this.setState({\n            low: newNow,\n            high: newNew,\n            diff: newDiff,\n            New: newNew,\n            Now: newNow,\n        })\n\n        console.log(\"Current: \" + this.state.Now);\n        console.log(\"New: \" + this.state.New);        \n    }\n\n    switchParam = (value) => {\n        const {playCurrent} = this.state;\n        if (playCurrent){\n            let param = this.getParam(value);\n            this.transmitParams(param);\n            this.setState({ playCurrent: false});\n        }\n        else {\n            let param = this.getParam(value);\n            this.transmitParams(param);\n            this.setState({ playCurrent: true});\n        }\n    }\n\n    getParam = (value) =>{\n        return {\n            'left':{\n                'g50': [value, value, value, value, value, value],\n                'g80': [value, value, value, value, value, value]\n            },\n            'right':{\n                'g50': [value, value, value, value, value, value],\n                'g80': [value, value, value, value, value, value]\n            }  \n        }\n    }\n\n    transmitParams = async(param) =>{\n        try {\n            const response = await axios.post(\"/api/param/setparam\", {\n                method: 'set',\n                data: param,\n            });\n            const data = response.data;\n            console.log(data);\n        }\n        catch(error) {\n            alert(error.response.data);\n        }\n    }\n\n    handlePlay = (isCurrent) => {       \n        const { New, Now } = this.state;      \n        let param = isCurrent ? this.getParam(Now) : this.getParam(New);\n        this.transmitParams(param);\n        this.setState({ playCurrent: isCurrent });\n        console.log(isCurrent ? \"Current: \" + param['left']['g50'][0]: \"New: \" + param['left']['g50'][0])\n    }\n\n    calculateNew = (choice) => {\n        const {high, low, diff, New} = this.state;\n        let newLow = 0;\n        let newDiff = 0;\n        let newNew = 0;\n        let newHigh = 0;\n\n        if (Math.abs(choice - high) < Math.abs(choice - low)) {\n            newLow = Number(low) + Number(diff);\n            newDiff = Math.abs(high - low)*0.25;\n            newNew = Number(high) - Number(newDiff);\n            return [newNew, [newLow, 'l'], newDiff]\n            // this.setState({\n            //     low: newLow,\n            //     diff: newDiff,\n            //     New: newNew,\n            // }, () => {\n            //     console.log(this.state.New);\n            // });\n        }\n        else {\n            newHigh = Number(high) - Number(diff);\n            newDiff = Math.abs(high - low)*0.25;\n            newNew = Number(low) + Number(newDiff);\n            return [newNew,  [newHigh, 'h'], newDiff]\n        }\n\n    }\n\n    handleNewBetter = () => {\n        const {New, numIteration} = this.state;\n        this.setState({Now: New});\n        let param = this.getParam(New);\n        this.transmitParams(param);\n        let tmp = this.calculateNew(New);\n        if (tmp[1][1] === 'h'){\n            this.setState({\n                New: tmp[0],\n                diff: tmp[2],\n                high: tmp[1][0],\n                numIteration: numIteration + 1,\n            })\n        }\n        else{\n            this.setState({\n                New: tmp[0],\n                diff: tmp[2],\n                low: tmp[1][0],\n                numIteration: numIteration + 1,\n            })\n        }\n        // console.log(\"Current: \" + this.state.Now);\n        // console.log(\"New: \" + this.state.New);\n    }\n\n    handleEqual = () =>{\n        const {switchingParamIntervalId} = this.state;\n        if (switchingParamIntervalId != null){\n            clearInterval(switchingParamIntervalId);\n        }\n        this.reset(false);\n        this.setState({\n            completed: true\n        });\n    }\n\n    handleCurrBetter = () =>{\n        const {Now, numIteration} = this.state;\n        let tmp = this.calculateNew(Now);\n        let param = this.getParam(Now);\n        this.transmitParams(param);\n        if (tmp[1][1] === 'h'){\n            this.setState({\n                New: tmp[0],\n                diff: tmp[2],\n                high: tmp[1][0],\n                numIteration: numIteration + 1,\n            })\n        }\n        else{\n            this.setState({\n                New: tmp[0],\n                diff: tmp[2],\n                low: tmp[1][0],\n                numIteration: numIteration + 1,\n            })\n        }\n    }\n\n//TODO  \n    render() {\n        const { classes } = this.props;\n        const { completed, Now, New, numIteration, playCurrent, isSetup } = this.state;\n\n        return (\n            <Paper className={classes.paper}>\n                { isSetup ?\n                [\n                <Grid container spacing={1}>\n                    <Grid item xs={12} className={classes.grid}>\n                        Please click the one you think is better:\n                    </Grid>\n                    <Grid \n                        container\n                        direction=\"row\"\n                        justify=\"space-around\"\n                        alignItems=\"center\"\n                    >\n                        <ButtonGroup \n                            size=\"large\" \n                            color=\"primary\" \n                            aria-label=\"large outlined primary button group\"\n                        >\n                            <Button \n                                className={classes.buttonGroup}\n                                variant={!playCurrent ? \"outlined\" : \"contained\"} \n                                startIcon={<PlayCircleOutlineIcon/>}\n                                onClick={() => this.handlePlay(true)}\n                            > \n                                Current\n                            </Button>\n                            <Button \n                                className={classes.buttonGroup}\n                                variant={playCurrent ? \"outlined\" : \"contained\"}\n                                startIcon={<PlayCircleOutlineIcon/>}\n                                onClick={() => this.handlePlay(false)}\n                            >\n                                New\n                            </Button>\n                        </ButtonGroup>\n                    </Grid>\n                    {\n                        !completed ? \n                        [\n                            <Grid \n                                container\n                                direction=\"column\"\n                                justify=\"flex-end\"\n                                alignItems=\"center\"\n                                key=\"options\"\n                            >\n                                <Button\n                                    className={classes.button} \n                                    variant=\"outlined\" \n                                    color=\"primary\"\n                                    onClick={() => this.handleNewBetter()}\n                                >\n                                    New is Better than Current\n                                </Button>\n                                <Button\n                                    className={classes.button} \n                                    variant=\"outlined\" \n                                    color=\"primary\"\n                                    onClick={() => this.handleEqual()}\n                                >\n                                    New is the Same as Current \n                                </Button>\n                                <Button\n                                    className={classes.button} \n                                    variant=\"outlined\" \n                                    color=\"primary\"\n                                    onClick={() => this.handleCurrBetter()}\n                                >\n                                    New is Worse than Current\n                                </Button>\n                            </Grid>,\n                        ] :\n                        [\n                        <Grid \n                            container\n                            direction=\"column\"\n                            justify=\"flex-end\"\n                            alignItems=\"center\"\n                        >\n                            <div>\n                                <p>\n                                Congrats!! You've finished the user assessment!\"<br />\n                                The overall gain is:   {Now}<br />\n                                The difference between two stimulus:  {Math.abs(New - Now)}.<br />\n                                The number of iterations is:  {numIteration}.\n                                </p>\n                            </div>\n                            <Button\n                                className={classes.button}\n                                variant=\"outlined\" \n                                color=\"primary\"\n                                onClick={()=>this.reset(true)}\n                                // component={Link}\n                                // to={`/qualityAssessmentDemo/`}\n                            >\n                                exit\n                            </Button>\n                        </Grid> \n                        ]\n                    }\n                </Grid>\n                ] : \n                [\n                    <>\n                    <div style={{\n                        display: \"flex\",\n                        justifyContent: \"center\",\n                        alignItems: \"center\",\n                    }}>\n                        <h1 class=\"display-5\">\n                                Search Example\n                        </h1>\n                    </div>\n                    <div style={{\n                        display: \"flex\",\n                        justifyContent: \"center\",\n                        alignItems: \"center\",\n                    }}>\n                        <p class=\"text-secondary\" id=\"description\">\n                                Choose between two set of changing parameters to find your optimal setting.\n                        </p>\n                    </div>\n\n                    {/* <div style={{\n                        display: \"flex\",\n                        justifyContent: \"center\",\n                        alignItems: \"center\",\n                    }}>\n                        <input \n                            type=\"radio\"\n                            value=\"0\" \n                            name=\"gender\"\n                            onChange={this.handleChangeInputMode.bind(this)}\n                        />\n                            Use Live Audio\n                    </div> */}\n\n                    {/* <div style={{\n                        display: \"flex\",\n                        justifyContent: \"center\",\n                        alignItems: \"center\",\n                    }}>\n                        <input \n                            type=\"radio\"\n                            value=\"1\" \n                            name=\"gender\"\n                            onChange={this.handleChangeInputMode.bind(this)}\n                        />\n                            Use File Stimulus\n                    </div>                     */}\n                    <div style={{\n                        display: \"flex\",\n                        justifyContent: \"center\",\n                        alignItems: \"center\",\n                    }}>\n\n                        <FormControl className={clsx(classes.margin, classes.withoutLabel, classes.textField)}>\n                            <Input\n                                id=\"minVolume\"\n                                value= {this.state.low}\n                                onChange={this.handleChangeMin.bind(this)}\n                                endAdornment={<InputAdornment position=\"end\">dB</InputAdornment>}\n                                inputProps={{\n                                'aria-label': 'Min',\n                                }}\n                            />\n                            <FormHelperText id=\"minVolume\">Min</FormHelperText>\n                        </FormControl>\n                    </div>\n                    <div style={{\n                        display: \"flex\",\n                        justifyContent: \"center\",\n                        alignItems: \"center\",\n                    }}>\n\n                        <FormControl className={clsx(classes.margin, classes.withoutLabel, classes.textField)}>\n                            <Input\n                                id=\"maxVolume\"\n                                value= {this.state.high}\n                                onChange={this.handleChangeMax.bind(this)}\n                                endAdornment={<InputAdornment position=\"end\">dB</InputAdornment>}\n                                //aria-describedby=\"standard-weight-helper-text\"\n                                inputProps={{\n                                'aria-label': 'Max',\n                                }}\n                            />\n                            <FormHelperText id=\"maxVolume\">Max</FormHelperText>\n                        </FormControl>\n                    </div>\n                    <div style={{\n                        display: \"flex\",\n                        justifyContent: \"center\",\n                        alignItems: \"center\",\n                    }}>\n                        <input \n                            type=\"radio\"\n                            value=\"0\" \n                            name=\"inputType\"\n                            onChange={this.handleChangeControlMode.bind(this)}\n                        />\n                            Auto\n                    </div>\n\n                    <div style={{\n                        display: \"flex\",\n                        justifyContent: \"center\",\n                        alignItems: \"center\",\n                    }}>\n                        <input \n                            type=\"radio\"\n                            value=\"1\" \n                            name=\"inputType\"\n                            onChange={this.handleChangeControlMode.bind(this)}\n                        />\n                            Manual\n                    </div>\n                    <Grid \n                        container\n                        direction=\"column\"\n                        justify=\"flex-end\"\n                        alignItems=\"center\"\n                        key=\"options\"\n                    >\n                        <Button\n                            className={classes.button}\n                            variant=\"contained\" \n                            color=\"primary\"\n                            onClick={this.playFile}\n                        >\n                            start\n                        </Button>\n                        <Button\n                            className={classes.button}\n                            variant=\"outlined\" \n                            color=\"primary\"\n                            onClick={() => this.reset(false)}\n                            component={Link}\n                            to={`/listenermanagement/`}\n                        >\n                            exit\n                        </Button>\n                    </Grid>\n                    </>\n                    ]\n            }\n            </Paper>\n        );\n    }\n}\n\n\nAssessmentPage.propTypes = {\n    showNodeNumber: PropTypes.bool.isRequired,\n};\n\nexport default compose(\n    withUserAuth,\n    withRouter,\n    withStyles(styles)\n)(AssessmentPage);"]},"metadata":{},"sourceType":"module"}