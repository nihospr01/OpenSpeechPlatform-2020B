{"ast":null,"code":"import _defineProperty from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{axios}from\"utils/utils\";import{withRouter,Link}from\"react-router-dom\";import withUserAuth from\"context/withUserAuth\";import{compose}from\"recompose\";import{withStyles}from\"@material-ui/styles\";import Paper from\"@material-ui/core/Paper\";import Grid from\"@material-ui/core/Grid\";import Button from\"@material-ui/core/Button\";import Stepper from\"@material-ui/core/Stepper\";import Step from\"@material-ui/core/Step\";import StepLabel from\"@material-ui/core/StepLabel\";import StepContent from\"@material-ui/core/StepContent\";import FormControlLabel from\"@material-ui/core/FormControlLabel\";import Radio from\"@material-ui/core/Radio\";import RadioGroup from\"@material-ui/core/RadioGroup\";import IconButton from\"@material-ui/core/IconButton\";import PlayCircleFilledIcon from'@material-ui/icons/PlayCircleFilled';import MobileStepper from'@material-ui/core/MobileStepper';import KeyboardArrowLeft from'@material-ui/icons/KeyboardArrowLeft';import KeyboardArrowRight from'@material-ui/icons/KeyboardArrowRight';import*as d3 from\"d3\";import treeNodes from\"utils/BST/treeNodes.csv\";import{parseTreeNode}from\"utils/BST/BSTUtil\";import{optionDescriptions,optionImages,optionOccupancies,optionLossImages}from'../../utils/utils';import AudioFilePlayer from\"components/audioFilePlayer\";import{findLastIndex}from\"lodash\";var styles=function styles(theme){return{slider:{width:\"60vw\",marginLeft:30,marginRight:30},icon:{maxWidth:\"10vw\",marginBottom:20},title:{margin:10},img:{height:\"auto\",width:\"40vw\"},optionImg:{height:\"auto\",width:\"30vw\"},button:{margin:10}};};var lossRadioColor=['#0026f5','#367b21','#eb3223','#54bcbe','#a72cb0'];var lossProfileNames=[\"Normal\",\"Mild\",\"Medium\",\"Severe\",\"Profound\"];var CoarseFitDemo=/*#__PURE__*/function(_Component){_inherits(CoarseFitDemo,_Component);var _super=_createSuper(CoarseFitDemo);function CoarseFitDemo(){var _this;_classCallCheck(this,CoarseFitDemo);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={step:0,loss:0,option:0,stimulus:0,currentIsLeft:true,nodes:{},subStep:0,// Substeps in step 2: getting hearing loss root node\nmaxSubstepReached:0,// Since the user can go back to previous iterations, we want to keep track of how many iterations the user has went through so far.\nchoicesMade:[-1,-1,-1,-1,-1],audioFilesChosen:[\"\",\"\",\"\",\"\",\"\"]};_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var newChoicesMade;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this.getWorseEar(_this.props.match.params.time);_context.next=3;return _this.constructGraph();case 3:// Default choice for the first iteration is \"Normal\"\nnewChoicesMade=[0,-1,-1,-1,-1];_this.setState({choicesMade:newChoicesMade});case 5:case\"end\":return _context.stop();}}},_callee);}));_this.getWorseEar=function(time){var leftEarIsWorse=_this.props.context.leftEarIsWorse;console.log(leftEarIsWorse);_this.setState({currentIsLeft:time===\"first\"?leftEarIsWorse:!leftEarIsWorse,time:time});};_this.constructGraph=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var nodes;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:nodes={};_context2.next=3;return d3.csv(treeNodes,function(treeNode){nodes[treeNode[\"NodeNo\"]]=parseTreeNode(treeNode);});case 3:_this.setState({nodes:nodes});case 4:case\"end\":return _context2.stop();}}},_callee2);}));_this.setRootNode=function(){var _this$state=_this.state,option=_this$state.option,loss=_this$state.loss;// Set value for getting root node in user assessment\n// Add 1 to match the root number in the .csv file\nsessionStorage.setItem('rootNode',Number(loss)+1);sessionStorage.setItem('option',Number(option));};_this.sendHAParam=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _this$state2,loss,nodes,node_data,response,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this$state2=_this.state,loss=_this$state2.loss,nodes=_this$state2.nodes;node_data=nodes[Number(loss)+1];console.log(node_data);_context3.prev=3;_context3.next=6;return axios.post(\"/api/param/setparam\",{method:\"set\",data:{left:_objectSpread({audio_reset:1,audio_repeat:0,audio_play:1,alpha:1.0},node_data.left),right:_objectSpread({audio_reset:1,audio_repeat:0,audio_play:1,alpha:1.0},node_data.right)}});case 6:response=_context3.sent;data=response.data;console.log(data);_context3.next=14;break;case 11:_context3.prev=11;_context3.t0=_context3[\"catch\"](3);alert(_context3.t0);case 14:case\"end\":return _context3.stop();}}},_callee3,null,[[3,11]]);}));_this.handleRadioChange=function(key,event){// console.log(key);\n// console.log(event.target.value);\nvar value=Number(event.target.value);_this.setState(_defineProperty({},key,value),_this.sendHAParam);if(key===\"loss\"){var newChoicesMade=_this.state.choicesMade;newChoicesMade[_this.state.subStep]=value;_this.setState({choicesMade:newChoicesMade},function(){console.log(_this.state.choicesMade);});}};_this.getSettingOption=function(){var classes=_this.props.classes;var option=_this.state.option;return/*#__PURE__*/React.createElement(Grid,{container:true,spacing:1},/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,className:classes.title},\"Please choose one among three settings:\"),/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"row\"},/*#__PURE__*/React.createElement(RadioGroup,{value:option,onChange:function onChange(e){return _this.handleRadioChange(\"option\",e);},row:true},[\"Option1\",\"Option2\",\"Option3\"].map(function(currOption,index){return/*#__PURE__*/React.createElement(FormControlLabel,{key:\"\".concat(currOption,\"-radio\"),value:index,control:/*#__PURE__*/React.createElement(Radio,null),label:currOption});}))),/*#__PURE__*/React.createElement(Grid,{item:true,xs:6},optionDescriptions[option]),/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"row\"},/*#__PURE__*/React.createElement(\"img\",{src:optionImages[option],alt:\"option_image\",className:classes.optionImg}),/*#__PURE__*/React.createElement(\"img\",{src:optionOccupancies[option],alt:\"option_occupancy_image\",className:classes.optionImg})));};_this.handleNext=function(){_this.setState(function(prevState){return{subStep:prevState.subStep+1};},function(){// If the current substep/iteration is bigger than the maxSubsteps the user has\n// reached so far, it means that the user reaches a new iteration. So we want to\n// let the loss option inherit the previous since the user hasn't changed it.\nif(_this.state.subStep===_this.state.maxSubstepReached){var newChoicesMade=_this.state.choicesMade;newChoicesMade[_this.state.subStep]=_this.state.loss;_this.setState({choicesMade:newChoicesMade});}});};_this.handleBack=function(){_this.setState(function(prevState){return{subStep:prevState.subStep-1};});};_this.setProceedSignal=function(){if(_this.state.subStep===_this.state.maxSubstepReached){_this.setState(function(prevState){return{maxSubstepReached:prevState.maxSubstepReached+1};});}};_this.updateFilesChosen=function(currentFile){var subStep=_this.state.subStep;var newAudioFilesChosen=_this.state.audioFilesChosen;newAudioFilesChosen[subStep]=currentFile;_this.setState({audioFilesChosen:newAudioFilesChosen});};_this.getLossAssessment=function(){var classes=_this.props.classes;var _this$state3=_this.state,loss=_this$state3.loss,option=_this$state3.option,subStep=_this$state3.subStep,maxSubstepReached=_this$state3.maxSubstepReached;return/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"column\",spacing:1},/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,className:classes.title},\"Please adjust the hearing loss:\"),/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"row\"},/*#__PURE__*/React.createElement(RadioGroup,{value:loss,onChange:function onChange(e){return _this.handleRadioChange(\"loss\",e);},row:true},lossProfileNames.map(function(currLoss,index){return/*#__PURE__*/React.createElement(FormControlLabel,{style:{color:lossRadioColor[index]},key:\"\".concat(currLoss,\"-radio\"),value:index,control:/*#__PURE__*/React.createElement(Radio,null),label:currLoss});}))),/*#__PURE__*/React.createElement(Grid,{container:true},/*#__PURE__*/React.createElement(AudioFilePlayer,{key:_this.state.subStep,preparePlay:_this.setProceedSignal,onChangeAudioFile:_this.updateFilesChosen})),/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"row\"},/*#__PURE__*/React.createElement(\"img\",{src:optionLossImages[option][loss],alt:\"option_loss_image\",className:classes.img})),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(\"p\",null,\"Hearing loss levels chosen so far:\"),_this.state.choicesMade.map(function(choiceIdx,index){if(choiceIdx===-1){return;}var currLossName=lossProfileNames[choiceIdx];var currLossColor=lossRadioColor[choiceIdx];return/*#__PURE__*/React.createElement(\"p\",null,\"Iteration \",index,\"------ Audio file chosen:\",\" \",!_this.state.audioFilesChosen[index]?\"None\":_this.state.audioFilesChosen[index],\"------ Hearing loss level:\",\" \",/*#__PURE__*/React.createElement(\"font\",{color:currLossColor},currLossName));})),/*#__PURE__*/React.createElement(MobileStepper,{style:{width:500,marginBottom:10},variant:\"progress\",steps:5,position:\"static\",activeStep:subStep,nextButton:/*#__PURE__*/React.createElement(Button,{size:\"small\",onClick:_this.handleNext,disabled:subStep===4||subStep===maxSubstepReached},\"Next\",/*#__PURE__*/React.createElement(KeyboardArrowRight,null)),backButton:/*#__PURE__*/React.createElement(Button,{size:\"small\",onClick:_this.handleBack,disabled:subStep===0},/*#__PURE__*/React.createElement(KeyboardArrowLeft,null),\"Back\")}));};_this.getStimulusOption=function(){var classes=_this.props.classes;var stimulus=_this.state.stimulus;return/*#__PURE__*/React.createElement(Grid,{container:true,spacing:1},/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,className:classes.title},\"Please choose the stimulus option for the BST fine tuning:\"),/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"row\"},/*#__PURE__*/React.createElement(RadioGroup,{value:stimulus,onChange:function onChange(e){return _this.handleRadioChange(\"stimulus\",e);},row:true},[\"Live data\",\"Audio file\"].map(function(option,index){return/*#__PURE__*/React.createElement(FormControlLabel,{key:\"\".concat(option,\"-radio\"),value:index,control:/*#__PURE__*/React.createElement(Radio,null),label:option});}))));};_this.getStepContent=function(index){switch(index){case 1:return _this.getLossAssessment();case 2:return _this.getStimulusOption();case 0:return _this.getSettingOption();default:return;}};_this.handleStepChange=function(change){_this.setState(function(prevState){return{step:prevState.step+change};});};return _this;}_createClass(CoarseFitDemo,[{key:\"componentWillUnmount\",value:function componentWillUnmount(){this._isMounted=false;}//TODO: CONTSTRUCT GRAPH BASED ON THE OPTION \n},{key:\"render\",value:function render(){var _this2=this;var classes=this.props.classes;var _this$state4=this.state,step=_this$state4.step,currentIsLeft=_this$state4.currentIsLeft;return/*#__PURE__*/React.createElement(Paper,{className:classes.paper},/*#__PURE__*/React.createElement(Stepper,{orientation:\"vertical\",activeStep:step},[\"Setting option\",\"Loss Assessment\",\"Stimulus Option\"].map(function(label,index){return/*#__PURE__*/React.createElement(Step,{key:label},/*#__PURE__*/React.createElement(StepLabel,null,label),/*#__PURE__*/React.createElement(StepContent,null,_this2.getStepContent(index),/*#__PURE__*/React.createElement(\"div\",{className:classes.actionsContainer,style:{display:'flex',flexDirection:'row'}},/*#__PURE__*/React.createElement(Button,{disabled:step===0,onClick:function onClick(){return _this2.handleStepChange(-1);},className:classes.button},\"Back\"),step===2?/*#__PURE__*/React.createElement(Button,{variant:\"contained\",color:\"primary\",className:classes.button,component:Link,onClick:_this2.setRootNode,to:\"/assessmentPage/\".concat(currentIsLeft)},\"Submit\"):/*#__PURE__*/React.createElement(Button,{variant:\"contained\",color:\"primary\",disabled:step===1&&_this2.state.maxSubstepReached<5,onClick:function onClick(){return _this2.handleStepChange(1);},className:classes.button},\"Next\"),step===1?/*#__PURE__*/React.createElement(\"p\",{style:{margin:'auto'}},\"Please complete all 5 iterations of coarse fits to go to the next step.\"):/*#__PURE__*/React.createElement(\"p\",null))));})));}}]);return CoarseFitDemo;}(Component);export default compose(withUserAuth,withRouter,withStyles(styles))(CoarseFitDemo);","map":{"version":3,"sources":["/opt/osp/ewsnodejs-client/src/pages/demo/coarseFitDemo.jsx"],"names":["React","Component","axios","withRouter","Link","withUserAuth","compose","withStyles","Paper","Grid","Button","Stepper","Step","StepLabel","StepContent","FormControlLabel","Radio","RadioGroup","IconButton","PlayCircleFilledIcon","MobileStepper","KeyboardArrowLeft","KeyboardArrowRight","d3","treeNodes","parseTreeNode","optionDescriptions","optionImages","optionOccupancies","optionLossImages","AudioFilePlayer","findLastIndex","styles","theme","slider","width","marginLeft","marginRight","icon","maxWidth","marginBottom","title","margin","img","height","optionImg","button","lossRadioColor","lossProfileNames","CoarseFitDemo","state","step","loss","option","stimulus","currentIsLeft","nodes","subStep","maxSubstepReached","choicesMade","audioFilesChosen","componentDidMount","getWorseEar","props","match","params","time","constructGraph","newChoicesMade","setState","leftEarIsWorse","context","console","log","csv","treeNode","setRootNode","sessionStorage","setItem","Number","sendHAParam","node_data","post","method","data","left","audio_reset","audio_repeat","audio_play","alpha","right","response","alert","handleRadioChange","key","event","value","target","getSettingOption","classes","e","map","currOption","index","handleNext","prevState","handleBack","setProceedSignal","updateFilesChosen","currentFile","newAudioFilesChosen","getLossAssessment","currLoss","color","choiceIdx","currLossName","currLossColor","getStimulusOption","getStepContent","handleStepChange","change","_isMounted","paper","label","actionsContainer","display","flexDirection"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { axios } from \"utils/utils\";\nimport { withRouter, Link } from \"react-router-dom\";\nimport withUserAuth from \"context/withUserAuth\";\nimport { compose } from \"recompose\";\nimport { withStyles } from \"@material-ui/styles\";\nimport Paper from \"@material-ui/core/Paper\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Button from \"@material-ui/core/Button\";\nimport Stepper from \"@material-ui/core/Stepper\";\nimport Step from \"@material-ui/core/Step\";\nimport StepLabel from \"@material-ui/core/StepLabel\";\nimport StepContent from \"@material-ui/core/StepContent\";\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\nimport Radio from \"@material-ui/core/Radio\";\nimport RadioGroup from \"@material-ui/core/RadioGroup\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport PlayCircleFilledIcon from '@material-ui/icons/PlayCircleFilled';\nimport MobileStepper from '@material-ui/core/MobileStepper';\nimport KeyboardArrowLeft from '@material-ui/icons/KeyboardArrowLeft';\nimport KeyboardArrowRight from '@material-ui/icons/KeyboardArrowRight';\nimport * as d3 from \"d3\";\nimport treeNodes from \"utils/BST/treeNodes.csv\";\nimport { parseTreeNode } from \"utils/BST/BSTUtil\";\n\nimport { optionDescriptions, optionImages, optionOccupancies, optionLossImages }from '../../utils/utils';\n\nimport AudioFilePlayer from \"components/audioFilePlayer\"\nimport { findLastIndex } from \"lodash\";\n\nconst styles = (theme) => ({\n    slider: {\n        width: \"60vw\",\n        marginLeft: 30,\n        marginRight: 30,\n    },\n    icon: {\n        maxWidth: \"10vw\",\n        marginBottom: 20,\n    },\n    title: {\n        margin: 10,\n    },\n    img: {\n        height: \"auto\",\n        width: \"40vw\",\n    },\n    optionImg: {\n        height: \"auto\",\n        width: \"30vw\",\n    },\n    button: {\n        margin: 10,\n    },\n});\n\nconst lossRadioColor = ['#0026f5', '#367b21', '#eb3223', '#54bcbe','#a72cb0'];\nconst lossProfileNames = [\"Normal\", \"Mild\", \"Medium\", \"Severe\", \"Profound\"];\nclass CoarseFitDemo extends Component {\n    state = {\n        step: 0,\n        loss: 0,\n        option: 0,\n        stimulus: 0,\n        currentIsLeft: true,\n        nodes:{},\n        subStep: 0, // Substeps in step 2: getting hearing loss root node\n        maxSubstepReached: 0, // Since the user can go back to previous iterations, we want to keep track of how many iterations the user has went through so far.\n        choicesMade: [-1, -1, -1, -1, -1],\n        audioFilesChosen: [\"\", \"\", \"\", \"\", \"\"]\n    };\n\n    componentDidMount = async () => {\n        this.getWorseEar(this.props.match.params.time);\n        await this.constructGraph();\n\n        // Default choice for the first iteration is \"Normal\"\n        const newChoicesMade = [0, -1, -1, -1, -1];\n        this.setState({\n            choicesMade: newChoicesMade\n        });\n    }\n\n\n    getWorseEar = (time) => {\n        const { leftEarIsWorse } = this.props.context;\n        console.log(leftEarIsWorse)\n        this.setState({\n            currentIsLeft: time === \"first\" ? leftEarIsWorse : !leftEarIsWorse,\n            time: time,\n        });\n    };\n\n    componentWillUnmount() {\n        this._isMounted = false;\n    }\n\n    //TODO: CONTSTRUCT GRAPH BASED ON THE OPTION \n    constructGraph = async () => {\n        let nodes = {};\n    \n        await d3.csv(treeNodes, (treeNode) => {\n            nodes[treeNode[\"NodeNo\"]] = parseTreeNode(treeNode);\n        });\n\n        this.setState({ nodes });\n\n    };\n\n    setRootNode = () => {\n        const { option, loss } = this.state;\n        // Set value for getting root node in user assessment\n        // Add 1 to match the root number in the .csv file\n        sessionStorage.setItem('rootNode',Number(loss) + 1);\n        sessionStorage.setItem('option',Number(option));\n    }\n\n    //TODO: SEND ROOT NODE BASED ON THE OPTION\n    sendHAParam = async () => {\n        const { loss, nodes } = this.state;\n        let node_data = nodes[Number(loss)+1];\n        console.log(node_data)\n        try {\n            const response = await axios.post(\"/api/param/setparam\", {\n                method: \"set\",\n                data: {\n                    left: {\n                        audio_reset: 1,\n                        audio_repeat: 0,\n                        audio_play: 1,\n                        alpha: 1.0,\n                        ...node_data.left,\n                    },\n                    right: {\n                        audio_reset: 1,\n                        audio_repeat: 0,\n                        audio_play: 1,\n                        alpha: 1.0,\n                        ...node_data.right,\n                    },\n\n                }\n            });\n            const data = response.data;\n            console.log(data);\n        } catch (error) {\n            alert(error);\n        }\n    };\n\n\n    // Handle value for changes for all radio buttons\n    handleRadioChange = (key, event) => {\n        // console.log(key);\n        // console.log(event.target.value);\n        const value = Number(event.target.value);\n        this.setState({\n            [key]: value,\n        }, this.sendHAParam);\n\n        if (key === \"loss\") {\n            const newChoicesMade = this.state.choicesMade;\n            newChoicesMade[this.state.subStep] = value;\n            this.setState({\n                choicesMade: newChoicesMade,\n            }, () => {\n                console.log(this.state.choicesMade);\n            });\n            \n        }\n    };\n\n    // Step 1: choose between different setting\n    getSettingOption = () => {\n        const { classes } = this.props;\n        const { option } = this.state;\n\n        return (\n            <Grid container spacing={1}>\n                <Grid item xs={12} className={classes.title}>\n                    Please choose one among three settings:\n                </Grid>\n                <Grid container direction=\"row\">\n                    <RadioGroup\n                        value={option}\n                        onChange={(e) => this.handleRadioChange(\"option\", e)}\n                        row\n                    >\n                        {[\"Option1\", \"Option2\", \"Option3\"].map(\n                            (currOption, index) => {\n                                return (\n                                    <FormControlLabel\n                                        key={`${currOption}-radio`}\n                                        value={index}\n                                        control={<Radio />}\n                                        label={currOption}\n                                    />\n                                );\n                            }\n                        )}\n                    </RadioGroup>\n\n                </Grid>\n                <Grid item xs={6} >\n                    {optionDescriptions[option]}\n                </Grid>\n                <Grid container direction=\"row\">\n                    <img\n                        src={optionImages[option]}\n                        alt={`option_image`}\n                        className={classes.optionImg}\n                    />\n                    <img\n                        src={optionOccupancies[option]}\n                        alt={`option_occupancy_image`}\n                        className={classes.optionImg}\n                    />\n                </Grid>\n            </Grid>\n        );\n    };\n\n    // Step 2: generate different graph based on the step 1 setting and the loss level\n\n    // Helper funcitons\n    handleNext = () => {\n        this.setState((prevState) => ({\n            subStep: prevState.subStep + 1,\n        }), () => {\n            // If the current substep/iteration is bigger than the maxSubsteps the user has\n            // reached so far, it means that the user reaches a new iteration. So we want to\n            // let the loss option inherit the previous since the user hasn't changed it.\n            if (this.state.subStep === this.state.maxSubstepReached) {\n                let newChoicesMade = this.state.choicesMade;\n                newChoicesMade[this.state.subStep] = this.state.loss;\n                this.setState({\n                    choicesMade: newChoicesMade,\n                });\n            }\n        });\n    };\n\n    handleBack = () => {\n        this.setState((prevState) => ({\n            subStep: prevState.subStep - 1\n        }));\n    };\n\n    // This function allows the user to click 'Next' for each iteration of coarse fit.\n    // This function is sent to the audio file player. Whenever after the user clicks\n    // the play button and plays some file, we allow the user to proceed to the next\n    // iteration.\n    setProceedSignal = () => {\n        if (this.state.subStep === this.state.maxSubstepReached){\n            this.setState((prevState) => ({\n                maxSubstepReached: prevState.maxSubstepReached + 1,\n            }));\n        }\n    }\n\n    updateFilesChosen = (currentFile) => {\n        const subStep = this.state.subStep;\n        let newAudioFilesChosen = this.state.audioFilesChosen;\n        newAudioFilesChosen[subStep] = currentFile;\n        this.setState({\n            audioFilesChosen: newAudioFilesChosen\n        });\n    }\n\n    getLossAssessment = () => {\n        const { classes } = this.props;\n        const { loss, option, subStep, maxSubstepReached } = this.state;\n\n        return (\n                <Grid container direction=\"column\" spacing={1}>\n                    <Grid item xs={12} className={classes.title}>\n                        Please adjust the hearing loss:\n                    </Grid>\n\n                    <Grid container direction=\"row\">\n                        <RadioGroup\n                            value={loss}\n                            onChange={(e) => this.handleRadioChange(\"loss\", e)}\n                            row\n                        >\n                            {lossProfileNames.map(\n                                (currLoss, index) => {\n                                    return (\n                                        <FormControlLabel\n                                            style={{color:lossRadioColor[index]}}\n                                            key={`${currLoss}-radio`}\n                                            value={index}\n                                            control={<Radio />}\n                                            label={currLoss}\n                                        />\n                                    );\n                                }\n                            )}\n                        </RadioGroup>\n                    </Grid>\n\n                    <Grid container>\n                        {/* <IconButton\n                            variant={\"contained\"}\n                            onClick={() => this.handlePlay()}\n                        >\n                            <PlayCircleFilledIcon/>\n                        </IconButton> */}\n                        <AudioFilePlayer\n                            key={this.state.subStep}\n                            preparePlay={this.setProceedSignal}\n                            onChangeAudioFile={this.updateFilesChosen}\n                        />\n                    </Grid>\n\n                    <Grid container direction=\"row\">\n                        <img\n                            src={optionLossImages[option][loss]}\n                            alt={`option_loss_image`}\n                            className={classes.img}\n                        />\n                    </Grid>\n\n                    <Grid item>\n                        <p>Hearing loss levels chosen so far:</p>\n                        {this.state.choicesMade.map(\n                            (choiceIdx, index) => {\n                                if (choiceIdx === -1) {\n                                    return;\n                                }\n                                const currLossName = lossProfileNames[choiceIdx];\n                                const currLossColor = lossRadioColor[choiceIdx];\n                                return (\n                                    <p>\n                                        Iteration {index}------\n                                        Audio file chosen:{\" \"}\n                                        {!this.state.audioFilesChosen[index] ?\n                                            \"None\" :\n                                            this.state.audioFilesChosen[index]\n                                        }------\n                                        Hearing loss level:{\" \"}\n                                        <font color={currLossColor}>{currLossName}</font>\n                                    </p>\n                                );\n                            }\n                        )}\n                    </Grid>\n\n                    <MobileStepper\n                        style={{width: 500, marginBottom: 10}}\n                        variant=\"progress\"\n                        steps={5}\n                        position=\"static\"\n                        activeStep={subStep}\n                        nextButton={\n                            <Button size=\"small\" onClick={this.handleNext} disabled={subStep === 4 || subStep === maxSubstepReached}>\n                                Next\n                            <KeyboardArrowRight />\n                            </Button>\n                        }\n                        backButton={\n                            <Button size=\"small\" onClick={this.handleBack} disabled={subStep === 0}>\n                            <KeyboardArrowLeft />\n                                Back\n                            </Button>\n                        }\n                    />\n                </Grid>\n        );\n    };\n\n\n    // Step3: Stimulus option (not support yet)\n    getStimulusOption = () => {\n        const { classes } = this.props;\n        const { stimulus } = this.state;\n\n        return (\n            <Grid container spacing={1}>\n                <Grid item xs={12} className={classes.title}>\n                    Please choose the stimulus option for the BST fine tuning:\n                </Grid>\n                <Grid container direction=\"row\">\n                    <RadioGroup\n                        value={stimulus}\n                        onChange={(e) => this.handleRadioChange(\"stimulus\", e)}\n                        row\n                    >\n                        {[\"Live data\", \"Audio file\"].map((option, index) => {\n                            return (\n                                <FormControlLabel\n                                    key={`${option}-radio`}\n                                    value={index}\n                                    control={<Radio />}\n                                    label={option}\n                                />\n                            );\n                        })}\n                    </RadioGroup>\n                </Grid>\n            </Grid>\n        );\n    };\n\n    getStepContent = (index) => {\n        switch (index) {\n            case 1:\n                return this.getLossAssessment();\n            case 2:\n                return this.getStimulusOption();\n            case 0:\n                return this.getSettingOption();\n            default:\n                return;\n        }\n    };\n\n    handleStepChange = (change) => {\n        this.setState((prevState) => ({\n            step: prevState.step + change,\n        }));\n    };\n\n    render() {\n        const { classes } = this.props;\n        const { step, currentIsLeft } = this.state;\n\n        return (\n            <Paper className={classes.paper}>\n                <Stepper orientation=\"vertical\" activeStep={step}>\n                    {[\n                        \"Setting option\",\n                        \"Loss Assessment\",\n                        \"Stimulus Option\",\n                    ].map((label, index) => (\n                        <Step key={label}>\n                            <StepLabel>{label}</StepLabel>\n                            <StepContent>\n                                {this.getStepContent(index)}\n                                <div className={classes.actionsContainer} style={{display: 'flex', flexDirection: 'row'}}>\n                                    <Button\n                                        disabled={step === 0}\n                                        onClick={() =>\n                                            this.handleStepChange(-1)\n                                        }\n                                        className={classes.button}\n                                    >\n                                        Back\n                                    </Button>\n\n                                    {step === 2 ? (\n                                        <Button\n                                            variant=\"contained\"\n                                            color=\"primary\"\n                                            className={classes.button}\n                                            component={Link} \n                                            onClick={this.setRootNode}\n                                            to={`/assessmentPage/${currentIsLeft}`}\n                                        >\n                                            Submit\n                                        </Button>\n                                    ) : (\n                                        <Button\n                                            variant=\"contained\"\n                                            color=\"primary\"\n                                            disabled={step === 1 && this.state.maxSubstepReached < 5}\n                                            onClick={() =>\n                                                this.handleStepChange(1)\n                                            }\n                                            className={classes.button}\n                                        >\n                                            Next\n                                        </Button>\n                                    )}\n\n                                    {step === 1 ? (\n                                        <p style={{margin: 'auto'}}>\n                                            Please complete all 5 iterations of coarse fits to go to the next step.\n                                        </p>\n                                    ) : (\n                                        <p></p>\n                                    )}\n                                </div>\n                            </StepContent>\n                        </Step>\n                    ))}\n                </Stepper>\n            </Paper>\n        );\n    }\n}\n\nexport default compose(\n    withUserAuth,\n    withRouter,\n    withStyles(styles)\n)(CoarseFitDemo);\n"]},"metadata":{},"sourceType":"module"}