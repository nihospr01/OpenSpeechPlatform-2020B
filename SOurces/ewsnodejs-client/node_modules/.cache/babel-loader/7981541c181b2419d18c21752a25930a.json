{"ast":null,"code":"import _regeneratorRuntime from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{withStyles}from'@material-ui/styles';import Paper from'@material-ui/core/Paper';import Grid from'@material-ui/core/Grid';import Button from'@material-ui/core/Button';import PlayCircleOutlineIcon from'@material-ui/icons/PlayCircleOutline';import IconButton from'@material-ui/core/IconButton';import{axios}from'utils/utils';import{Link}from'react-router-dom';import withUserAuth from'context/withUserAuth';import{withRouter}from'react-router-dom';import{compose}from'recompose';import HelpIcon from\"@material-ui/icons/Help\";import Tooltip from\"@material-ui/core/Tooltip\";var styles=function styles(theme){return{root:{flexGrow:1},paper:{height:'90vh'},button:{width:'80vw',height:50,margin:10},grid:{marginLeft:10,fontSize:16},margin:{margin:10},extendedIcon:{marginRight:8},buttonGroup:{width:100,height:100}};};var fourAFCPage=/*#__PURE__*/function(_Component){_inherits(fourAFCPage,_Component);var _super=_createSuper(fourAFCPage);function fourAFCPage(){var _this;_classCallCheck(this,fourAFCPage);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={completed:false,currentWord:'',audioConfig:[],audioPath:'',currentAudioFile:'',currentOptions:['','','',''],currentCount:0,logs:[]};_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this$props$context,user,loginMode,parameterResponse,configResponse,audioConfig,pathResponse,audioPath;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_this$props$context=_this.props.context,user=_this$props$context.user,loginMode=_this$props$context.loginMode;if(!(loginMode!=='researcher')){_context.next=7;break;}_context.next=5;return axios.get(\"/api/listener/getParameters/\".concat(user));case 5:parameterResponse=_context.sent;_this.apply(parameterResponse.data);case 7:_context.next=9;return axios.get(\"/api/researcher/4AFCConfig\");case 9:configResponse=_context.sent;audioConfig=configResponse.data[\"words\"];_context.next=13;return axios.get(\"/api/researcher/audioPath\");case 13:pathResponse=_context.sent;audioPath=pathResponse.data;_context.next=17;return _this.setState({audioConfig:audioConfig,audioPath:audioPath});case 17:_this.fetchWord();_context.next=24;break;case 20:_context.prev=20;_context.t0=_context[\"catch\"](0);console.log(_context.t0);alert(_context.t0.response.data);case 24:case\"end\":return _context.stop();}}},_callee,null,[[0,20]]);}));_this.apply=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(parameters){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(parameters==='')){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:_context2.prev=2;_context2.next=5;return axios.post(\"/api/param/setparam\",{method:'set',data:parameters});case 5:response=_context2.sent;data=response.data;console.log(data);_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](2);alert(_context2.t0.response.data);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[2,10]]);}));return function(_x){return _ref2.apply(this,arguments);};}();_this.handlePlay=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _this$state,audioPath,currentAudioFile,dataInput,response,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this$state=_this.state,audioPath=_this$state.audioPath,currentAudioFile=_this$state.currentAudioFile;dataInput={left:{audio_filename:audioPath.concat(currentAudioFile),audio_reset:1,audio_repeat:0,audio_play:1,alpha:1.0},right:{audio_filename:audioPath.concat(currentAudioFile),audio_reset:1,audio_repeat:0,audio_play:1,alpha:1.0}};_context3.prev=2;_context3.next=5;return axios.post(\"/api/param/setparam\",{method:'set',data:dataInput});case 5:response=_context3.sent;data=response.data;console.log(data);_context3.next=13;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](2);alert(_context3.t0.response.data);case 13:case\"end\":return _context3.stop();}}},_callee3,null,[[2,10]]);}));_this.fetchWord=function(){var audioConfig=_this.state.audioConfig;console.log(audioConfig);var index=Math.floor(Math.random()*audioConfig.length);var currentOption=audioConfig[index];audioConfig.splice(index,1);_this.setState({audioConfig:audioConfig,currentWord:currentOption[\"answer\"],currentOptions:[currentOption[\"option_A\"],currentOption[\"option_B\"],currentOption[\"option_C\"],currentOption[\"option_D\"]],currentCount:_this.state.currentCount+1,currentAudioFile:currentOption[\"filename\"]});};_this.handleContinue=function(option){var _this$state2=_this.state,currentCount=_this$state2.currentCount,currentOptions=_this$state2.currentOptions,currentWord=_this$state2.currentWord,logs=_this$state2.logs;console.log(logs);logs.push({currentOptions:currentOptions,currentWord:currentWord,option:option});_this.setState({logs:logs});if(currentCount>=5){_this.setState({completed:true});}else{_this.fetchWord();}};_this.handleSubmit=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _this$props$context2,updateUser,user,loginMode,logs;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_this$props$context2=_this.props.context,updateUser=_this$props$context2.updateUser,user=_this$props$context2.user,loginMode=_this$props$context2.loginMode;logs=_this.state.logs;if(!(loginMode===\"researcher\")){_context4.next=4;break;}return _context4.abrupt(\"return\");case 4:_context4.prev=4;console.log(logs);_context4.next=8;return axios.post(\"/api/listener/addLog\",{listenerID:user,newLog:{AFC:{logOn:new Date().toLocaleString(),log:logs}},flag:'AFCDone',flagValue:true});case 8:_context4.next=14;break;case 10:_context4.prev=10;_context4.t0=_context4[\"catch\"](4);alert(_context4.t0.message);console.log(_context4.t0);case 14:sessionStorage.setItem('AFCDone',true);updateUser();case 16:case\"end\":return _context4.stop();}}},_callee4,null,[[4,10]]);}));return _this;}_createClass(fourAFCPage,[{key:\"render\",value:function render(){var _this2=this;var classes=this.props.classes;var _this$state3=this.state,completed=_this$state3.completed,currentOptions=_this$state3.currentOptions;return/*#__PURE__*/React.createElement(Paper,{className:classes.paper},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:1},/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,className:classes.grid},\"Please click the word you heard:\",/*#__PURE__*/React.createElement(Tooltip,{title:\"In this section, hit the play button, then choose the word that matches best to the audio\"},/*#__PURE__*/React.createElement(IconButton,{\"aria-label\":\"help\"},/*#__PURE__*/React.createElement(HelpIcon,null)))),/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"row\",justify:\"space-around\",alignItems:\"center\"},/*#__PURE__*/React.createElement(IconButton,{variant:\"contained\",onClick:function onClick(){return _this2.handlePlay();}},/*#__PURE__*/React.createElement(PlayCircleOutlineIcon,{className:classes.buttonGroup}))),!completed?/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"column\",justify:\"flex-end\",alignItems:\"center\"},/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:function onClick(){return _this2.handleContinue('A');}},currentOptions[0]),/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:function onClick(){return _this2.handleContinue('B');}},currentOptions[1]),/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:function onClick(){return _this2.handleContinue('C');}},currentOptions[2]),/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:function onClick(){return _this2.handleContinue('D');}},currentOptions[3])):/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"column\",justify:\"flex-end\",alignItems:\"center\"},\"You are finished.\",/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:this.handleSubmit,component:Link,to:\"/researcherpage\"},\"Back to main menu\"))));}}]);return fourAFCPage;}(Component);export default compose(withUserAuth,withRouter,withStyles(styles))(fourAFCPage);","map":{"version":3,"sources":["/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/src/pages/BST/fourAFCPage.jsx"],"names":["React","Component","withStyles","Paper","Grid","Button","PlayCircleOutlineIcon","IconButton","axios","Link","withUserAuth","withRouter","compose","HelpIcon","Tooltip","styles","theme","root","flexGrow","paper","height","button","width","margin","grid","marginLeft","fontSize","extendedIcon","marginRight","buttonGroup","fourAFCPage","state","completed","currentWord","audioConfig","audioPath","currentAudioFile","currentOptions","currentCount","logs","componentDidMount","props","context","user","loginMode","get","parameterResponse","apply","data","configResponse","pathResponse","setState","fetchWord","console","log","alert","response","parameters","post","method","handlePlay","dataInput","left","audio_filename","concat","audio_reset","audio_repeat","audio_play","alpha","right","index","Math","floor","random","length","currentOption","splice","handleContinue","option","push","handleSubmit","updateUser","listenerID","newLog","AFC","logOn","Date","toLocaleString","flag","flagValue","message","sessionStorage","setItem","classes"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { withStyles } from '@material-ui/styles';\nimport Paper from '@material-ui/core/Paper';\nimport Grid from '@material-ui/core/Grid';\nimport Button from '@material-ui/core/Button';\nimport PlayCircleOutlineIcon from '@material-ui/icons/PlayCircleOutline';\nimport IconButton from '@material-ui/core/IconButton';\nimport { axios } from 'utils/utils';\nimport { Link } from 'react-router-dom';\nimport withUserAuth from 'context/withUserAuth';\nimport { withRouter } from 'react-router-dom';\nimport { compose } from 'recompose';\nimport HelpIcon from \"@material-ui/icons/Help\";\nimport Tooltip from \"@material-ui/core/Tooltip\";\n\nconst styles = (theme) => ({\n    root: {\n        flexGrow: 1,\n    },\n    paper: {\n        height: '90vh',\n    },\n    button: {\n        width: '80vw',\n        height: 50,\n        margin: 10,\n    },\n    grid: {\n        marginLeft: 10,\n        fontSize: 16,\n    },\n    margin: {\n        margin: 10,\n    },\n    extendedIcon: {\n        marginRight: 8,\n    },\n    buttonGroup: {\n        width: 100,\n        height: 100,\n    },\n});\n\nclass fourAFCPage extends Component {\n    state = {\n        completed: false,\n        currentWord: '',\n        audioConfig: [],\n        audioPath: '',\n        currentAudioFile: '',\n        currentOptions: ['', '', '', ''],\n        currentCount: 0,\n        logs: []\n    };\n\n    componentDidMount = async () => {\n        try {\n            const { user, loginMode } = this.props.context;\n            if (loginMode !== 'researcher') {\n                const parameterResponse = await axios.get(`/api/listener/getParameters/${user}`);\n                this.apply(parameterResponse.data);\n            }\n            const configResponse = await axios.get(\"/api/researcher/4AFCConfig\");\n            const audioConfig = configResponse.data[\"words\"];\n            const pathResponse = await axios.get(\"/api/researcher/audioPath\");\n            const audioPath = pathResponse.data;\n            await this.setState({ audioConfig, audioPath });\n            this.fetchWord();\n        }\n        catch(error) {\n            console.log(error);\n            alert(error.response.data);\n        }\n    }\n\n    apply = async (parameters) => {\n        if (parameters === '') {\n            return;\n        }\n        try {\n            const response = await axios.post(\"/api/param/setparam\", {\n                method: 'set',\n                data: parameters,\n            });\n            const data = response.data;\n            console.log(data);\n        }\n        catch(error) {\n            alert(error.response.data);\n        }\n    }\n\n    handlePlay = async () => {\n        const {\n            audioPath,\n            currentAudioFile,\n        } = this.state;\n        const dataInput ={\n            left: {\n                audio_filename: audioPath.concat(currentAudioFile),\n                audio_reset: 1,\n                audio_repeat: 0,\n                audio_play: 1,\n                alpha: 1.0,\n            },\n            right: {\n                audio_filename: audioPath.concat(currentAudioFile),\n                audio_reset: 1,\n                audio_repeat: 0,\n                audio_play: 1,\n                alpha: 1.0,\n            },\n        };\n        try {\n            const response = await axios.post(\"/api/param/setparam\", {\n                method: 'set',\n                data: dataInput,\n            });\n            const data = response.data;\n            console.log(data);\n        }\n        catch(error) {\n            alert(error.response.data);\n        }\n    }\n\n    fetchWord = () => {\n        const {\n            audioConfig,\n        } = this.state;\n        console.log(audioConfig)\n        const index = Math.floor(Math.random()*audioConfig.length);\n        const currentOption = audioConfig[index];\n        audioConfig.splice(index, 1);\n        this.setState({\n            audioConfig: audioConfig,\n            currentWord: currentOption[\"answer\"],\n            currentOptions: [\n                currentOption[\"option_A\"],\n                currentOption[\"option_B\"],\n                currentOption[\"option_C\"],\n                currentOption[\"option_D\"],\n            ],\n            currentCount: this.state.currentCount + 1,\n            currentAudioFile: currentOption[\"filename\"],\n        });\n    }\n\n    handleContinue = (option) => {\n        let {\n            currentCount,\n            currentOptions,\n            currentWord,\n            logs,\n        } = this.state;\n        console.log(logs)\n        logs.push({\n            currentOptions,\n            currentWord,\n            option\n        });\n        this.setState({\n            logs,\n        })\n        if (currentCount >= 5) {\n            this.setState({\n                completed: true,\n            });\n        } else {\n            this.fetchWord();\n        }\n    }\n\n    handleSubmit = async () => {\n        const { updateUser, user, loginMode } = this.props.context;\n        const { logs } = this.state;\n        if (loginMode === \"researcher\") {\n            return;\n        }\n        try {\n            console.log(logs)\n            await axios.post(\"/api/listener/addLog\", {\n                listenerID: user,\n                newLog: {\n                    AFC: {\n                        logOn:new Date().toLocaleString(),\n                        log: logs\n                    }\n                },\n                flag: 'AFCDone',\n                flagValue: true,\n            });\n        }\n        catch (error) {\n            alert(error.message);\n            console.log(error);\n        }\n        sessionStorage.setItem('AFCDone', true);\n        updateUser();\n    }\n\n    render() {\n        const { classes } = this.props;\n        const { \n            completed,\n            currentOptions,\n        } = this.state;\n\n        return (\n            <Paper className={classes.paper}>\n                <Grid container spacing={1}>\n                    <Grid item xs={12} className={classes.grid}>\n                        Please click the word you heard:\n                        <Tooltip title=\"In this section, hit the play button, then choose the word that matches best to the audio\">\n              <IconButton aria-label=\"help\">\n                <HelpIcon />\n              </IconButton>\n            </Tooltip>\n                    </Grid>\n                    <Grid \n                        container\n                        direction=\"row\"\n                        justify=\"space-around\"\n                        alignItems=\"center\"\n                    >\n                        <IconButton \n                            variant={\"contained\"} \n                            onClick={() => this.handlePlay()}\n                        >\n                            <PlayCircleOutlineIcon className={classes.buttonGroup}/>\n                        </IconButton>\n                    </Grid>\n                    {\n                        !completed ? \n                        <Grid \n                            container\n                            direction=\"column\"\n                            justify=\"flex-end\"\n                            alignItems=\"center\"\n                        >\n                            <Button\n                                className={classes.button} \n                                variant=\"outlined\" \n                                color=\"primary\"\n                                onClick={() => this.handleContinue('A')}\n                            >\n                                {currentOptions[0]}\n                            </Button>\n                            <Button\n                                className={classes.button} \n                                variant=\"outlined\" \n                                color=\"primary\"\n                                onClick={() => this.handleContinue('B')}\n                            >\n                                {currentOptions[1]}\n                            </Button>\n                            <Button\n                                className={classes.button} \n                                variant=\"outlined\" \n                                color=\"primary\"\n                                onClick={() => this.handleContinue('C')}\n                            >\n                                {currentOptions[2]}\n                            </Button>\n                            <Button\n                                className={classes.button} \n                                variant=\"outlined\" \n                                color=\"primary\"\n                                onClick={() => this.handleContinue('D')}\n                            >\n                                {currentOptions[3]}\n                            </Button>\n                        </Grid> :\n                        <Grid \n                            container\n                            direction=\"column\"\n                            justify=\"flex-end\"\n                            alignItems=\"center\"\n                        >\n                            You are finished.\n                            {\n                                <Button\n                                    className={classes.button} \n                                    variant=\"outlined\" \n                                    color=\"primary\"\n                                    onClick={this.handleSubmit}\n                                    component={Link}\n                                    to=\"/researcherpage\"\n                                >\n                                    Back to main menu\n                                </Button>\n                            }\n                        </Grid>\n                    }\n                </Grid>\n            </Paper>\n        );\n    }\n}\n\nexport default compose(\n    withUserAuth,\n    withRouter,\n    withStyles(styles)\n)(fourAFCPage);\n"]},"metadata":{},"sourceType":"module"}