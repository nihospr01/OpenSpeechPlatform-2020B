{"ast":null,"code":"import { dispatch } from \"d3-dispatch\";\nimport { event, customEvent, select, mouse, touch } from \"d3-selection\";\nimport nodrag, { yesdrag } from \"./nodrag.js\";\nimport noevent, { nopropagation } from \"./noevent.js\";\nimport constant from \"./constant.js\";\nimport DragEvent from \"./event.js\"; // Ignore right-click, since that should open the context menu.\n\nfunction defaultFilter() {\n  return !event.ctrlKey && !event.button;\n}\n\nfunction defaultContainer() {\n  return this.parentNode;\n}\n\nfunction defaultSubject(d) {\n  return d == null ? {\n    x: event.x,\n    y: event.y\n  } : d;\n}\n\nfunction defaultTouchable() {\n  return navigator.maxTouchPoints || \"ontouchstart\" in this;\n}\n\nexport default function () {\n  var filter = defaultFilter,\n      container = defaultContainer,\n      subject = defaultSubject,\n      touchable = defaultTouchable,\n      gestures = {},\n      listeners = dispatch(\"start\", \"drag\", \"end\"),\n      active = 0,\n      mousedownx,\n      mousedowny,\n      mousemoving,\n      touchending,\n      clickDistance2 = 0;\n\n  function drag(selection) {\n    selection.on(\"mousedown.drag\", mousedowned).filter(touchable).on(\"touchstart.drag\", touchstarted).on(\"touchmove.drag\", touchmoved).on(\"touchend.drag touchcancel.drag\", touchended).style(\"touch-action\", \"none\").style(\"-webkit-tap-highlight-color\", \"rgba(0,0,0,0)\");\n  }\n\n  function mousedowned() {\n    if (touchending || !filter.apply(this, arguments)) return;\n    var gesture = beforestart(\"mouse\", container.apply(this, arguments), mouse, this, arguments);\n    if (!gesture) return;\n    select(event.view).on(\"mousemove.drag\", mousemoved, true).on(\"mouseup.drag\", mouseupped, true);\n    nodrag(event.view);\n    nopropagation();\n    mousemoving = false;\n    mousedownx = event.clientX;\n    mousedowny = event.clientY;\n    gesture(\"start\");\n  }\n\n  function mousemoved() {\n    noevent();\n\n    if (!mousemoving) {\n      var dx = event.clientX - mousedownx,\n          dy = event.clientY - mousedowny;\n      mousemoving = dx * dx + dy * dy > clickDistance2;\n    }\n\n    gestures.mouse(\"drag\");\n  }\n\n  function mouseupped() {\n    select(event.view).on(\"mousemove.drag mouseup.drag\", null);\n    yesdrag(event.view, mousemoving);\n    noevent();\n    gestures.mouse(\"end\");\n  }\n\n  function touchstarted() {\n    if (!filter.apply(this, arguments)) return;\n    var touches = event.changedTouches,\n        c = container.apply(this, arguments),\n        n = touches.length,\n        i,\n        gesture;\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = beforestart(touches[i].identifier, c, touch, this, arguments)) {\n        nopropagation();\n        gesture(\"start\");\n      }\n    }\n  }\n\n  function touchmoved() {\n    var touches = event.changedTouches,\n        n = touches.length,\n        i,\n        gesture;\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = gestures[touches[i].identifier]) {\n        noevent();\n        gesture(\"drag\");\n      }\n    }\n  }\n\n  function touchended() {\n    var touches = event.changedTouches,\n        n = touches.length,\n        i,\n        gesture;\n    if (touchending) clearTimeout(touchending);\n    touchending = setTimeout(function () {\n      touchending = null;\n    }, 500); // Ghost clicks are delayed!\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = gestures[touches[i].identifier]) {\n        nopropagation();\n        gesture(\"end\");\n      }\n    }\n  }\n\n  function beforestart(id, container, point, that, args) {\n    var p = point(container, id),\n        s,\n        dx,\n        dy,\n        sublisteners = listeners.copy();\n    if (!customEvent(new DragEvent(drag, \"beforestart\", s, id, active, p[0], p[1], 0, 0, sublisteners), function () {\n      if ((event.subject = s = subject.apply(that, args)) == null) return false;\n      dx = s.x - p[0] || 0;\n      dy = s.y - p[1] || 0;\n      return true;\n    })) return;\n    return function gesture(type) {\n      var p0 = p,\n          n;\n\n      switch (type) {\n        case \"start\":\n          gestures[id] = gesture, n = active++;\n          break;\n\n        case \"end\":\n          delete gestures[id], --active;\n        // nobreak\n\n        case \"drag\":\n          p = point(container, id), n = active;\n          break;\n      }\n\n      customEvent(new DragEvent(drag, type, s, id, n, p[0] + dx, p[1] + dy, p[0] - p0[0], p[1] - p0[1], sublisteners), sublisteners.apply, sublisteners, [type, that, args]);\n    };\n  }\n\n  drag.filter = function (_) {\n    return arguments.length ? (filter = typeof _ === \"function\" ? _ : constant(!!_), drag) : filter;\n  };\n\n  drag.container = function (_) {\n    return arguments.length ? (container = typeof _ === \"function\" ? _ : constant(_), drag) : container;\n  };\n\n  drag.subject = function (_) {\n    return arguments.length ? (subject = typeof _ === \"function\" ? _ : constant(_), drag) : subject;\n  };\n\n  drag.touchable = function (_) {\n    return arguments.length ? (touchable = typeof _ === \"function\" ? _ : constant(!!_), drag) : touchable;\n  };\n\n  drag.on = function () {\n    var value = listeners.on.apply(listeners, arguments);\n    return value === listeners ? drag : value;\n  };\n\n  drag.clickDistance = function (_) {\n    return arguments.length ? (clickDistance2 = (_ = +_) * _, drag) : Math.sqrt(clickDistance2);\n  };\n\n  return drag;\n}","map":{"version":3,"sources":["/opt/osp/ewsnodejs-client/node_modules/d3-drag/src/drag.js"],"names":["dispatch","event","customEvent","select","mouse","touch","nodrag","yesdrag","noevent","nopropagation","constant","DragEvent","defaultFilter","ctrlKey","button","defaultContainer","parentNode","defaultSubject","d","x","y","defaultTouchable","navigator","maxTouchPoints","filter","container","subject","touchable","gestures","listeners","active","mousedownx","mousedowny","mousemoving","touchending","clickDistance2","drag","selection","on","mousedowned","touchstarted","touchmoved","touchended","style","apply","arguments","gesture","beforestart","view","mousemoved","mouseupped","clientX","clientY","dx","dy","touches","changedTouches","c","n","length","i","identifier","clearTimeout","setTimeout","id","point","that","args","p","s","sublisteners","copy","type","p0","_","value","clickDistance","Math","sqrt"],"mappings":"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","sourcesContent":["import {dispatch} from \"d3-dispatch\";\nimport {event, customEvent, select, mouse, touch} from \"d3-selection\";\nimport nodrag, {yesdrag} from \"./nodrag.js\";\nimport noevent, {nopropagation} from \"./noevent.js\";\nimport constant from \"./constant.js\";\nimport DragEvent from \"./event.js\";\n\n// Ignore right-click, since that should open the context menu.\nfunction defaultFilter() {\n  return !event.ctrlKey && !event.button;\n}\n\nfunction defaultContainer() {\n  return this.parentNode;\n}\n\nfunction defaultSubject(d) {\n  return d == null ? {x: event.x, y: event.y} : d;\n}\n\nfunction defaultTouchable() {\n  return navigator.maxTouchPoints || (\"ontouchstart\" in this);\n}\n\nexport default function() {\n  var filter = defaultFilter,\n      container = defaultContainer,\n      subject = defaultSubject,\n      touchable = defaultTouchable,\n      gestures = {},\n      listeners = dispatch(\"start\", \"drag\", \"end\"),\n      active = 0,\n      mousedownx,\n      mousedowny,\n      mousemoving,\n      touchending,\n      clickDistance2 = 0;\n\n  function drag(selection) {\n    selection\n        .on(\"mousedown.drag\", mousedowned)\n      .filter(touchable)\n        .on(\"touchstart.drag\", touchstarted)\n        .on(\"touchmove.drag\", touchmoved)\n        .on(\"touchend.drag touchcancel.drag\", touchended)\n        .style(\"touch-action\", \"none\")\n        .style(\"-webkit-tap-highlight-color\", \"rgba(0,0,0,0)\");\n  }\n\n  function mousedowned() {\n    if (touchending || !filter.apply(this, arguments)) return;\n    var gesture = beforestart(\"mouse\", container.apply(this, arguments), mouse, this, arguments);\n    if (!gesture) return;\n    select(event.view).on(\"mousemove.drag\", mousemoved, true).on(\"mouseup.drag\", mouseupped, true);\n    nodrag(event.view);\n    nopropagation();\n    mousemoving = false;\n    mousedownx = event.clientX;\n    mousedowny = event.clientY;\n    gesture(\"start\");\n  }\n\n  function mousemoved() {\n    noevent();\n    if (!mousemoving) {\n      var dx = event.clientX - mousedownx, dy = event.clientY - mousedowny;\n      mousemoving = dx * dx + dy * dy > clickDistance2;\n    }\n    gestures.mouse(\"drag\");\n  }\n\n  function mouseupped() {\n    select(event.view).on(\"mousemove.drag mouseup.drag\", null);\n    yesdrag(event.view, mousemoving);\n    noevent();\n    gestures.mouse(\"end\");\n  }\n\n  function touchstarted() {\n    if (!filter.apply(this, arguments)) return;\n    var touches = event.changedTouches,\n        c = container.apply(this, arguments),\n        n = touches.length, i, gesture;\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = beforestart(touches[i].identifier, c, touch, this, arguments)) {\n        nopropagation();\n        gesture(\"start\");\n      }\n    }\n  }\n\n  function touchmoved() {\n    var touches = event.changedTouches,\n        n = touches.length, i, gesture;\n\n    for (i = 0; i < n; ++i) {\n      if (gesture = gestures[touches[i].identifier]) {\n        noevent();\n        gesture(\"drag\");\n      }\n    }\n  }\n\n  function touchended() {\n    var touches = event.changedTouches,\n        n = touches.length, i, gesture;\n\n    if (touchending) clearTimeout(touchending);\n    touchending = setTimeout(function() { touchending = null; }, 500); // Ghost clicks are delayed!\n    for (i = 0; i < n; ++i) {\n      if (gesture = gestures[touches[i].identifier]) {\n        nopropagation();\n        gesture(\"end\");\n      }\n    }\n  }\n\n  function beforestart(id, container, point, that, args) {\n    var p = point(container, id), s, dx, dy,\n        sublisteners = listeners.copy();\n\n    if (!customEvent(new DragEvent(drag, \"beforestart\", s, id, active, p[0], p[1], 0, 0, sublisteners), function() {\n      if ((event.subject = s = subject.apply(that, args)) == null) return false;\n      dx = s.x - p[0] || 0;\n      dy = s.y - p[1] || 0;\n      return true;\n    })) return;\n\n    return function gesture(type) {\n      var p0 = p, n;\n      switch (type) {\n        case \"start\": gestures[id] = gesture, n = active++; break;\n        case \"end\": delete gestures[id], --active; // nobreak\n        case \"drag\": p = point(container, id), n = active; break;\n      }\n      customEvent(new DragEvent(drag, type, s, id, n, p[0] + dx, p[1] + dy, p[0] - p0[0], p[1] - p0[1], sublisteners), sublisteners.apply, sublisteners, [type, that, args]);\n    };\n  }\n\n  drag.filter = function(_) {\n    return arguments.length ? (filter = typeof _ === \"function\" ? _ : constant(!!_), drag) : filter;\n  };\n\n  drag.container = function(_) {\n    return arguments.length ? (container = typeof _ === \"function\" ? _ : constant(_), drag) : container;\n  };\n\n  drag.subject = function(_) {\n    return arguments.length ? (subject = typeof _ === \"function\" ? _ : constant(_), drag) : subject;\n  };\n\n  drag.touchable = function(_) {\n    return arguments.length ? (touchable = typeof _ === \"function\" ? _ : constant(!!_), drag) : touchable;\n  };\n\n  drag.on = function() {\n    var value = listeners.on.apply(listeners, arguments);\n    return value === listeners ? drag : value;\n  };\n\n  drag.clickDistance = function(_) {\n    return arguments.length ? (clickDistance2 = (_ = +_) * _, drag) : Math.sqrt(clickDistance2);\n  };\n\n  return drag;\n}\n"]},"metadata":{},"sourceType":"module"}