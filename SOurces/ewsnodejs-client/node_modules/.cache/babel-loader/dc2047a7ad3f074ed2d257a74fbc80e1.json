{"ast":null,"code":"/**\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule setDraftEditorSelection\n * @format\n * \n */\n'use strict';\n\nvar DraftJsDebugLogging = require('./DraftJsDebugLogging');\n\nvar containsNode = require('fbjs/lib/containsNode');\n\nvar getActiveElement = require('fbjs/lib/getActiveElement');\n\nvar invariant = require('fbjs/lib/invariant');\n\nfunction getAnonymizedDOM(node, getNodeLabels) {\n  if (!node) {\n    return '[empty]';\n  }\n\n  var anonymized = anonymizeTextWithin(node, getNodeLabels);\n\n  if (anonymized.nodeType === Node.TEXT_NODE) {\n    return anonymized.textContent;\n  }\n\n  !(anonymized instanceof Element) ? process.env.NODE_ENV !== 'production' ? invariant(false, 'Node must be an Element if it is not a text node.') : invariant(false) : void 0;\n  return anonymized.outerHTML;\n}\n\nfunction anonymizeTextWithin(node, getNodeLabels) {\n  var labels = getNodeLabels !== undefined ? getNodeLabels(node) : [];\n\n  if (node.nodeType === Node.TEXT_NODE) {\n    var length = node.textContent.length;\n    return document.createTextNode('[text ' + length + (labels.length ? ' | ' + labels.join(', ') : '') + ']');\n  }\n\n  var clone = node.cloneNode();\n\n  if (clone.nodeType === 1 && labels.length) {\n    clone.setAttribute('data-labels', labels.join(', '));\n  }\n\n  var childNodes = node.childNodes;\n\n  for (var ii = 0; ii < childNodes.length; ii++) {\n    clone.appendChild(anonymizeTextWithin(childNodes[ii], getNodeLabels));\n  }\n\n  return clone;\n}\n\nfunction getAnonymizedEditorDOM(node, getNodeLabels) {\n  // grabbing the DOM content of the Draft editor\n  var currentNode = node;\n\n  while (currentNode) {\n    if (currentNode instanceof Element && currentNode.hasAttribute('contenteditable')) {\n      // found the Draft editor container\n      return getAnonymizedDOM(currentNode, getNodeLabels);\n    } else {\n      currentNode = currentNode.parentNode;\n    }\n  }\n\n  return 'Could not find contentEditable parent of node';\n}\n\nfunction getNodeLength(node) {\n  return node.nodeValue === null ? node.childNodes.length : node.nodeValue.length;\n}\n/**\n * In modern non-IE browsers, we can support both forward and backward\n * selections.\n *\n * Note: IE10+ supports the Selection object, but it does not support\n * the `extend` method, which means that even in modern IE, it's not possible\n * to programatically create a backward selection. Thus, for all IE\n * versions, we use the old IE API to create our selections.\n */\n\n\nfunction setDraftEditorSelection(selectionState, node, blockKey, nodeStart, nodeEnd) {\n  // It's possible that the editor has been removed from the DOM but\n  // our selection code doesn't know it yet. Forcing selection in\n  // this case may lead to errors, so just bail now.\n  if (!containsNode(document.documentElement, node)) {\n    return;\n  }\n\n  var selection = global.getSelection();\n  var anchorKey = selectionState.getAnchorKey();\n  var anchorOffset = selectionState.getAnchorOffset();\n  var focusKey = selectionState.getFocusKey();\n  var focusOffset = selectionState.getFocusOffset();\n  var isBackward = selectionState.getIsBackward(); // IE doesn't support backward selection. Swap key/offset pairs.\n\n  if (!selection.extend && isBackward) {\n    var tempKey = anchorKey;\n    var tempOffset = anchorOffset;\n    anchorKey = focusKey;\n    anchorOffset = focusOffset;\n    focusKey = tempKey;\n    focusOffset = tempOffset;\n    isBackward = false;\n  }\n\n  var hasAnchor = anchorKey === blockKey && nodeStart <= anchorOffset && nodeEnd >= anchorOffset;\n  var hasFocus = focusKey === blockKey && nodeStart <= focusOffset && nodeEnd >= focusOffset; // If the selection is entirely bound within this node, set the selection\n  // and be done.\n\n  if (hasAnchor && hasFocus) {\n    selection.removeAllRanges();\n    addPointToSelection(selection, node, anchorOffset - nodeStart, selectionState);\n    addFocusToSelection(selection, node, focusOffset - nodeStart, selectionState);\n    return;\n  }\n\n  if (!isBackward) {\n    // If the anchor is within this node, set the range start.\n    if (hasAnchor) {\n      selection.removeAllRanges();\n      addPointToSelection(selection, node, anchorOffset - nodeStart, selectionState);\n    } // If the focus is within this node, we can assume that we have\n    // already set the appropriate start range on the selection, and\n    // can simply extend the selection.\n\n\n    if (hasFocus) {\n      addFocusToSelection(selection, node, focusOffset - nodeStart, selectionState);\n    }\n  } else {\n    // If this node has the focus, set the selection range to be a\n    // collapsed range beginning here. Later, when we encounter the anchor,\n    // we'll use this information to extend the selection.\n    if (hasFocus) {\n      selection.removeAllRanges();\n      addPointToSelection(selection, node, focusOffset - nodeStart, selectionState);\n    } // If this node has the anchor, we may assume that the correct\n    // focus information is already stored on the selection object.\n    // We keep track of it, reset the selection range, and extend it\n    // back to the focus point.\n\n\n    if (hasAnchor) {\n      var storedFocusNode = selection.focusNode;\n      var storedFocusOffset = selection.focusOffset;\n      selection.removeAllRanges();\n      addPointToSelection(selection, node, anchorOffset - nodeStart, selectionState);\n      addFocusToSelection(selection, storedFocusNode, storedFocusOffset, selectionState);\n    }\n  }\n}\n/**\n * Extend selection towards focus point.\n */\n\n\nfunction addFocusToSelection(selection, node, offset, selectionState) {\n  var activeElement = getActiveElement();\n\n  if (selection.extend && containsNode(activeElement, node)) {\n    // If `extend` is called while another element has focus, an error is\n    // thrown. We therefore disable `extend` if the active element is somewhere\n    // other than the node we are selecting. This should only occur in Firefox,\n    // since it is the only browser to support multiple selections.\n    // See https://bugzilla.mozilla.org/show_bug.cgi?id=921444.\n    // logging to catch bug that is being reported in t16250795\n    if (offset > getNodeLength(node)) {\n      // the call to 'selection.extend' is about to throw\n      DraftJsDebugLogging.logSelectionStateFailure({\n        anonymizedDom: getAnonymizedEditorDOM(node),\n        extraParams: JSON.stringify({\n          offset: offset\n        }),\n        selectionState: JSON.stringify(selectionState.toJS())\n      });\n    } // logging to catch bug that is being reported in t18110632\n\n\n    var nodeWasFocus = node === selection.focusNode;\n\n    try {\n      selection.extend(node, offset);\n    } catch (e) {\n      DraftJsDebugLogging.logSelectionStateFailure({\n        anonymizedDom: getAnonymizedEditorDOM(node, function (n) {\n          var labels = [];\n\n          if (n === activeElement) {\n            labels.push('active element');\n          }\n\n          if (n === selection.anchorNode) {\n            labels.push('selection anchor node');\n          }\n\n          if (n === selection.focusNode) {\n            labels.push('selection focus node');\n          }\n\n          return labels;\n        }),\n        extraParams: JSON.stringify({\n          activeElementName: activeElement ? activeElement.nodeName : null,\n          nodeIsFocus: node === selection.focusNode,\n          nodeWasFocus: nodeWasFocus,\n          selectionRangeCount: selection.rangeCount,\n          selectionAnchorNodeName: selection.anchorNode ? selection.anchorNode.nodeName : null,\n          selectionAnchorOffset: selection.anchorOffset,\n          selectionFocusNodeName: selection.focusNode ? selection.focusNode.nodeName : null,\n          selectionFocusOffset: selection.focusOffset,\n          message: e ? '' + e : null,\n          offset: offset\n        }, null, 2),\n        selectionState: JSON.stringify(selectionState.toJS(), null, 2)\n      }); // allow the error to be thrown -\n      // better than continuing in a broken state\n\n      throw e;\n    }\n  } else {\n    // IE doesn't support extend. This will mean no backward selection.\n    // Extract the existing selection range and add focus to it.\n    // Additionally, clone the selection range. IE11 throws an\n    // InvalidStateError when attempting to access selection properties\n    // after the range is detached.\n    var range = selection.getRangeAt(0);\n    range.setEnd(node, offset);\n    selection.addRange(range.cloneRange());\n  }\n}\n\nfunction addPointToSelection(selection, node, offset, selectionState) {\n  var range = document.createRange(); // logging to catch bug that is being reported in t16250795\n\n  if (offset > getNodeLength(node)) {\n    // in this case we know that the call to 'range.setStart' is about to throw\n    DraftJsDebugLogging.logSelectionStateFailure({\n      anonymizedDom: getAnonymizedEditorDOM(node),\n      extraParams: JSON.stringify({\n        offset: offset\n      }),\n      selectionState: JSON.stringify(selectionState.toJS())\n    });\n  }\n\n  range.setStart(node, offset);\n  selection.addRange(range);\n}\n\nmodule.exports = setDraftEditorSelection;","map":{"version":3,"sources":["/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/draft-js/lib/setDraftEditorSelection.js"],"names":["DraftJsDebugLogging","require","containsNode","getActiveElement","invariant","getAnonymizedDOM","node","getNodeLabels","anonymized","anonymizeTextWithin","nodeType","Node","TEXT_NODE","textContent","Element","process","env","NODE_ENV","outerHTML","labels","undefined","length","document","createTextNode","join","clone","cloneNode","setAttribute","childNodes","ii","appendChild","getAnonymizedEditorDOM","currentNode","hasAttribute","parentNode","getNodeLength","nodeValue","setDraftEditorSelection","selectionState","blockKey","nodeStart","nodeEnd","documentElement","selection","global","getSelection","anchorKey","getAnchorKey","anchorOffset","getAnchorOffset","focusKey","getFocusKey","focusOffset","getFocusOffset","isBackward","getIsBackward","extend","tempKey","tempOffset","hasAnchor","hasFocus","removeAllRanges","addPointToSelection","addFocusToSelection","storedFocusNode","focusNode","storedFocusOffset","offset","activeElement","logSelectionStateFailure","anonymizedDom","extraParams","JSON","stringify","toJS","nodeWasFocus","e","n","push","anchorNode","activeElementName","nodeName","nodeIsFocus","selectionRangeCount","rangeCount","selectionAnchorNodeName","selectionAnchorOffset","selectionFocusNodeName","selectionFocusOffset","message","range","getRangeAt","setEnd","addRange","cloneRange","createRange","setStart","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule setDraftEditorSelection\n * @format\n * \n */\n\n'use strict';\n\nvar DraftJsDebugLogging = require('./DraftJsDebugLogging');\n\nvar containsNode = require('fbjs/lib/containsNode');\nvar getActiveElement = require('fbjs/lib/getActiveElement');\nvar invariant = require('fbjs/lib/invariant');\n\nfunction getAnonymizedDOM(node, getNodeLabels) {\n  if (!node) {\n    return '[empty]';\n  }\n\n  var anonymized = anonymizeTextWithin(node, getNodeLabels);\n  if (anonymized.nodeType === Node.TEXT_NODE) {\n    return anonymized.textContent;\n  }\n\n  !(anonymized instanceof Element) ? process.env.NODE_ENV !== 'production' ? invariant(false, 'Node must be an Element if it is not a text node.') : invariant(false) : void 0;\n  return anonymized.outerHTML;\n}\n\nfunction anonymizeTextWithin(node, getNodeLabels) {\n  var labels = getNodeLabels !== undefined ? getNodeLabels(node) : [];\n\n  if (node.nodeType === Node.TEXT_NODE) {\n    var length = node.textContent.length;\n    return document.createTextNode('[text ' + length + (labels.length ? ' | ' + labels.join(', ') : '') + ']');\n  }\n\n  var clone = node.cloneNode();\n  if (clone.nodeType === 1 && labels.length) {\n    clone.setAttribute('data-labels', labels.join(', '));\n  }\n  var childNodes = node.childNodes;\n  for (var ii = 0; ii < childNodes.length; ii++) {\n    clone.appendChild(anonymizeTextWithin(childNodes[ii], getNodeLabels));\n  }\n\n  return clone;\n}\n\nfunction getAnonymizedEditorDOM(node, getNodeLabels) {\n  // grabbing the DOM content of the Draft editor\n  var currentNode = node;\n  while (currentNode) {\n    if (currentNode instanceof Element && currentNode.hasAttribute('contenteditable')) {\n      // found the Draft editor container\n      return getAnonymizedDOM(currentNode, getNodeLabels);\n    } else {\n      currentNode = currentNode.parentNode;\n    }\n  }\n  return 'Could not find contentEditable parent of node';\n}\n\nfunction getNodeLength(node) {\n  return node.nodeValue === null ? node.childNodes.length : node.nodeValue.length;\n}\n\n/**\n * In modern non-IE browsers, we can support both forward and backward\n * selections.\n *\n * Note: IE10+ supports the Selection object, but it does not support\n * the `extend` method, which means that even in modern IE, it's not possible\n * to programatically create a backward selection. Thus, for all IE\n * versions, we use the old IE API to create our selections.\n */\nfunction setDraftEditorSelection(selectionState, node, blockKey, nodeStart, nodeEnd) {\n  // It's possible that the editor has been removed from the DOM but\n  // our selection code doesn't know it yet. Forcing selection in\n  // this case may lead to errors, so just bail now.\n  if (!containsNode(document.documentElement, node)) {\n    return;\n  }\n\n  var selection = global.getSelection();\n  var anchorKey = selectionState.getAnchorKey();\n  var anchorOffset = selectionState.getAnchorOffset();\n  var focusKey = selectionState.getFocusKey();\n  var focusOffset = selectionState.getFocusOffset();\n  var isBackward = selectionState.getIsBackward();\n\n  // IE doesn't support backward selection. Swap key/offset pairs.\n  if (!selection.extend && isBackward) {\n    var tempKey = anchorKey;\n    var tempOffset = anchorOffset;\n    anchorKey = focusKey;\n    anchorOffset = focusOffset;\n    focusKey = tempKey;\n    focusOffset = tempOffset;\n    isBackward = false;\n  }\n\n  var hasAnchor = anchorKey === blockKey && nodeStart <= anchorOffset && nodeEnd >= anchorOffset;\n\n  var hasFocus = focusKey === blockKey && nodeStart <= focusOffset && nodeEnd >= focusOffset;\n\n  // If the selection is entirely bound within this node, set the selection\n  // and be done.\n  if (hasAnchor && hasFocus) {\n    selection.removeAllRanges();\n    addPointToSelection(selection, node, anchorOffset - nodeStart, selectionState);\n    addFocusToSelection(selection, node, focusOffset - nodeStart, selectionState);\n    return;\n  }\n\n  if (!isBackward) {\n    // If the anchor is within this node, set the range start.\n    if (hasAnchor) {\n      selection.removeAllRanges();\n      addPointToSelection(selection, node, anchorOffset - nodeStart, selectionState);\n    }\n\n    // If the focus is within this node, we can assume that we have\n    // already set the appropriate start range on the selection, and\n    // can simply extend the selection.\n    if (hasFocus) {\n      addFocusToSelection(selection, node, focusOffset - nodeStart, selectionState);\n    }\n  } else {\n    // If this node has the focus, set the selection range to be a\n    // collapsed range beginning here. Later, when we encounter the anchor,\n    // we'll use this information to extend the selection.\n    if (hasFocus) {\n      selection.removeAllRanges();\n      addPointToSelection(selection, node, focusOffset - nodeStart, selectionState);\n    }\n\n    // If this node has the anchor, we may assume that the correct\n    // focus information is already stored on the selection object.\n    // We keep track of it, reset the selection range, and extend it\n    // back to the focus point.\n    if (hasAnchor) {\n      var storedFocusNode = selection.focusNode;\n      var storedFocusOffset = selection.focusOffset;\n\n      selection.removeAllRanges();\n      addPointToSelection(selection, node, anchorOffset - nodeStart, selectionState);\n      addFocusToSelection(selection, storedFocusNode, storedFocusOffset, selectionState);\n    }\n  }\n}\n\n/**\n * Extend selection towards focus point.\n */\nfunction addFocusToSelection(selection, node, offset, selectionState) {\n  var activeElement = getActiveElement();\n  if (selection.extend && containsNode(activeElement, node)) {\n    // If `extend` is called while another element has focus, an error is\n    // thrown. We therefore disable `extend` if the active element is somewhere\n    // other than the node we are selecting. This should only occur in Firefox,\n    // since it is the only browser to support multiple selections.\n    // See https://bugzilla.mozilla.org/show_bug.cgi?id=921444.\n\n    // logging to catch bug that is being reported in t16250795\n    if (offset > getNodeLength(node)) {\n      // the call to 'selection.extend' is about to throw\n      DraftJsDebugLogging.logSelectionStateFailure({\n        anonymizedDom: getAnonymizedEditorDOM(node),\n        extraParams: JSON.stringify({ offset: offset }),\n        selectionState: JSON.stringify(selectionState.toJS())\n      });\n    }\n\n    // logging to catch bug that is being reported in t18110632\n    var nodeWasFocus = node === selection.focusNode;\n    try {\n      selection.extend(node, offset);\n    } catch (e) {\n      DraftJsDebugLogging.logSelectionStateFailure({\n        anonymizedDom: getAnonymizedEditorDOM(node, function (n) {\n          var labels = [];\n          if (n === activeElement) {\n            labels.push('active element');\n          }\n          if (n === selection.anchorNode) {\n            labels.push('selection anchor node');\n          }\n          if (n === selection.focusNode) {\n            labels.push('selection focus node');\n          }\n          return labels;\n        }),\n        extraParams: JSON.stringify({\n          activeElementName: activeElement ? activeElement.nodeName : null,\n          nodeIsFocus: node === selection.focusNode,\n          nodeWasFocus: nodeWasFocus,\n          selectionRangeCount: selection.rangeCount,\n          selectionAnchorNodeName: selection.anchorNode ? selection.anchorNode.nodeName : null,\n          selectionAnchorOffset: selection.anchorOffset,\n          selectionFocusNodeName: selection.focusNode ? selection.focusNode.nodeName : null,\n          selectionFocusOffset: selection.focusOffset,\n          message: e ? '' + e : null,\n          offset: offset\n        }, null, 2),\n        selectionState: JSON.stringify(selectionState.toJS(), null, 2)\n      });\n      // allow the error to be thrown -\n      // better than continuing in a broken state\n      throw e;\n    }\n  } else {\n    // IE doesn't support extend. This will mean no backward selection.\n    // Extract the existing selection range and add focus to it.\n    // Additionally, clone the selection range. IE11 throws an\n    // InvalidStateError when attempting to access selection properties\n    // after the range is detached.\n    var range = selection.getRangeAt(0);\n    range.setEnd(node, offset);\n    selection.addRange(range.cloneRange());\n  }\n}\n\nfunction addPointToSelection(selection, node, offset, selectionState) {\n  var range = document.createRange();\n  // logging to catch bug that is being reported in t16250795\n  if (offset > getNodeLength(node)) {\n    // in this case we know that the call to 'range.setStart' is about to throw\n    DraftJsDebugLogging.logSelectionStateFailure({\n      anonymizedDom: getAnonymizedEditorDOM(node),\n      extraParams: JSON.stringify({ offset: offset }),\n      selectionState: JSON.stringify(selectionState.toJS())\n    });\n  }\n  range.setStart(node, offset);\n  selection.addRange(range);\n}\n\nmodule.exports = setDraftEditorSelection;"]},"metadata":{},"sourceType":"script"}