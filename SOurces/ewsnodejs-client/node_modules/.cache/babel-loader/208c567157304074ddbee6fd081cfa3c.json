{"ast":null,"code":"import _regeneratorRuntime from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{axios}from\"utils/utils\";import{withStyles}from\"@material-ui/core/styles\";import Paper from\"@material-ui/core/Paper\";import Grid from\"@material-ui/core/Grid\";import Button from\"@material-ui/core/Button\";import IconButton from\"@material-ui/core/IconButton\";import VolumeUpIcon from\"@material-ui/icons/VolumeUp\";import AddCircleOutlineIcon from\"@material-ui/icons/AddCircleOutline\";import RemoveCircleOutlineIcon from\"@material-ui/icons/RemoveCircleOutline\";import PlayCircleOutlineIcon from\"@material-ui/icons/PlayCircleOutline\";import*as d3 from\"d3\";import treeNodes from\"utils/BST/treeNodes.csv\";import rootNodes from\"utils/BST/rootNodes.csv\";import{parseTreeNode}from\"utils/BST/BSTUtil\";import withUserAuth from\"context/withUserAuth\";import{withRouter,Link}from\"react-router-dom\";import{compose}from\"recompose\";import LinearProgress from\"@material-ui/core/LinearProgress\";import HelpIcon from\"@material-ui/icons/Help\";import Tooltip from\"@material-ui/core/Tooltip\";var BorderLinearProgress=withStyles({root:{height:10},bar:{borderRadius:20}})(LinearProgress);var styles=function styles(theme){return{slider:{width:\"60vw\",marginLeft:30,marginRight:30},icon:{maxWidth:\"10vw\",marginRight:10},title:{margin:10},img:{height:\"auto\",width:\"60vw\"},button:{margin:10},iconButton:{height:50,width:50},buttonGroup:{width:200,height:200}};};var AssessmentSetup=/*#__PURE__*/function(_Component){_inherits(AssessmentSetup,_Component);var _super=_createSuper(AssessmentSetup);function AssessmentSetup(){var _this;_classCallCheck(this,AssessmentSetup);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={nodes:{},options:{},currentNode:1,currentIsLeft:true,time:\"first\"};_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var options;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this._isMounted=true;options=_this.state.options;_context.next=4;return _this.getWorseEar(_this.props.match.params.time);case 4:if(!(Object.keys(options).length===0)){_context.next=9;break;}_context.next=7;return _this.constructGraph();case 7:_context.next=9;return _this.handleApply();case 9:case\"end\":return _context.stop();}}},_callee);}));_this.getWorseEar=function(time){var leftEarIsWorse=_this.props.context.leftEarIsWorse;_this.setState({currentIsLeft:time===\"first\"?leftEarIsWorse:!leftEarIsWorse,time:time});};_this.constructGraph=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var nodes,options,optionSetting,lossLevel;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:nodes={};options={};_context2.next=4;return d3.csv(rootNodes,function(rootNode){options[rootNode[\"NodeNo\"]]=rootNode[\"HearingLoss\"];});case 4:_context2.next=6;return d3.csv(treeNodes,function(treeNode){nodes[treeNode[\"NodeNo\"]]=parseTreeNode(treeNode);});case 6:// Get option and loss level \noptionSetting=sessionStorage.getItem('option');lossLevel=sessionStorage.getItem('rootNode');if(_this._isMounted){_this.setState({options:options,nodes:nodes,currentNode:Number(lossLevel)});}case 9:case\"end\":return _context2.stop();}}},_callee2);}));_this.decreaseSound=function(){_this.setState({currentNode:_this.state.currentNode>1?_this.state.currentNode-1:1},_this.handleApply);};_this.increaseSound=function(){_this.setState({currentNode:_this.state.currentNode<5?_this.state.currentNode+1:5},_this.handleApply);};_this.handleApply=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _this$state,currentNode,nodes,response,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this$state=_this.state,currentNode=_this$state.currentNode,nodes=_this$state.nodes;_context3.prev=1;_context3.next=4;return axios.post(\"/api/param/setparam\",{method:\"set\",data:nodes[currentNode]});case 4:response=_context3.sent;data=response.data;console.log(data);_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);alert(_context3.t0.response.data);case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[1,9]]);}));_this.earDone=function(){var currentNode=_this.state.currentNode;sessionStorage.setItem(\"rootNode\",parseInt(currentNode));// this.setState({ currentIsLeft: false, currentNode: 1 });\n};_this.handlePlay=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var path,response,dataInput,_response,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:path=\"\";_context4.prev=1;_context4.next=4;return axios.get(\"/api/researcher/audioPath\");case 4:response=_context4.sent;path=response.data;_context4.next=11;break;case 8:_context4.prev=8;_context4.t0=_context4[\"catch\"](1);alert(_context4.t0.response.data);case 11:path=path.concat(\"test.wav\");console.log(path);dataInput={left:{audio_filename:path,audio_reset:1,audio_repeat:0,audio_play:1,alpha:1.0},right:{audio_filename:path,audio_reset:1,audio_repeat:0,audio_play:1,alpha:1.0}};_context4.prev=14;_context4.next=17;return axios.post(\"/api/param/setparam\",{method:\"set\",data:dataInput});case 17:_response=_context4.sent;data=_response.data;console.log(data);_context4.next=25;break;case 22:_context4.prev=22;_context4.t1=_context4[\"catch\"](14);alert(_context4.t1.response.data);case 25:case\"end\":return _context4.stop();}}},_callee4,null,[[1,8],[14,22]]);}));return _this;}_createClass(AssessmentSetup,[{key:\"componentWillUnmount\",value:function componentWillUnmount(){this._isMounted=false;}},{key:\"render\",value:function render(){var _this2=this;var classes=this.props.classes;var _this$state2=this.state,currentNode=_this$state2.currentNode,options=_this$state2.options,currentIsLeft=_this$state2.currentIsLeft;return/*#__PURE__*/React.createElement(Paper,{className:classes.paper},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:1},/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,className:classes.title},\"Please adjust the volume for your \".concat(currentIsLeft?\"LEFT\":\"RIGHT\",\" ear\"),/*#__PURE__*/React.createElement(Tooltip,{title:\"In this section, first adjust volumn, then choose the audio that you think is better. The process is repeated for both right ear and left ear\"},/*#__PURE__*/React.createElement(IconButton,{\"aria-label\":\"help\"},/*#__PURE__*/React.createElement(HelpIcon,null)))),/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"row\",justify:\"center\",alignItems:\"center\"},/*#__PURE__*/React.createElement(VolumeUpIcon,{className:classes.icon}),options?/*#__PURE__*/React.createElement(BorderLinearProgress,{variant:\"determinate\",value:(currentNode-1)*25,style:{flex:0.3}}):null,/*#__PURE__*/React.createElement(\"div\",{style:{marginLeft:10,fontSize:16}},(currentNode-1)*25+\"%\")),/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"row\",justify:\"center\",alignItems:\"center\"},/*#__PURE__*/React.createElement(IconButton,{\"aria-label\":\"remove\",onClick:this.decreaseSound,className:classes.iconButtonMarginLeft,disabled:currentNode===1},/*#__PURE__*/React.createElement(RemoveCircleOutlineIcon,{className:classes.iconButton})),/*#__PURE__*/React.createElement(IconButton,{\"aria-label\":\"add\",onClick:this.increaseSound,className:classes.iconButtonMarginRight,disabled:currentNode===5},/*#__PURE__*/React.createElement(AddCircleOutlineIcon,{className:classes.iconButton}))),/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"row\",justify:\"space-around\",alignItems:\"center\"},/*#__PURE__*/React.createElement(IconButton,{variant:\"contained\",onClick:function onClick(){return _this2.handlePlay();}},/*#__PURE__*/React.createElement(PlayCircleOutlineIcon,{className:classes.buttonGroup}))),/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"row\",justify:\"flex-end\",alignItems:\"center\"},/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:this.earDone,component:Link,to:\"/assessmentPage/\".concat(currentIsLeft)},\"Continue\"),\"}\")));}}]);return AssessmentSetup;}(Component);export default compose(withUserAuth,withRouter,withStyles(styles))(AssessmentSetup);","map":{"version":3,"sources":["/opt/osp/ewsnodejs-client/src/pages/BST/assessment/assessmentSetup.jsx"],"names":["React","Component","axios","withStyles","Paper","Grid","Button","IconButton","VolumeUpIcon","AddCircleOutlineIcon","RemoveCircleOutlineIcon","PlayCircleOutlineIcon","d3","treeNodes","rootNodes","parseTreeNode","withUserAuth","withRouter","Link","compose","LinearProgress","HelpIcon","Tooltip","BorderLinearProgress","root","height","bar","borderRadius","styles","theme","slider","width","marginLeft","marginRight","icon","maxWidth","title","margin","img","button","iconButton","buttonGroup","AssessmentSetup","state","nodes","options","currentNode","currentIsLeft","time","componentDidMount","_isMounted","getWorseEar","props","match","params","Object","keys","length","constructGraph","handleApply","leftEarIsWorse","context","setState","csv","rootNode","treeNode","optionSetting","sessionStorage","getItem","lossLevel","Number","decreaseSound","increaseSound","post","method","data","response","console","log","alert","earDone","setItem","parseInt","handlePlay","path","get","concat","dataInput","left","audio_filename","audio_reset","audio_repeat","audio_play","alpha","right","classes","paper","flex","fontSize","iconButtonMarginLeft","iconButtonMarginRight"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { axios } from \"utils/utils\";\nimport {  withStyles } from \"@material-ui/core/styles\";\nimport Paper from \"@material-ui/core/Paper\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Button from \"@material-ui/core/Button\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport VolumeUpIcon from \"@material-ui/icons/VolumeUp\";\nimport AddCircleOutlineIcon from \"@material-ui/icons/AddCircleOutline\";\nimport RemoveCircleOutlineIcon from \"@material-ui/icons/RemoveCircleOutline\";\nimport PlayCircleOutlineIcon from \"@material-ui/icons/PlayCircleOutline\";\nimport * as d3 from \"d3\";\nimport treeNodes from \"utils/BST/treeNodes.csv\";\nimport rootNodes from \"utils/BST/rootNodes.csv\";\nimport { parseTreeNode } from \"utils/BST/BSTUtil\";\nimport withUserAuth from \"context/withUserAuth\";\nimport { withRouter, Link } from \"react-router-dom\";\nimport { compose } from \"recompose\";\n\nimport LinearProgress from \"@material-ui/core/LinearProgress\";\nimport HelpIcon from \"@material-ui/icons/Help\";\nimport Tooltip from \"@material-ui/core/Tooltip\";\n\nconst BorderLinearProgress = withStyles({\n    root: {\n        height: 10,\n    },\n    bar: {\n        borderRadius: 20,\n    },\n})(LinearProgress);\n\nconst styles = (theme) => ({\n    slider: {\n        width: \"60vw\",\n        marginLeft: 30,\n        marginRight: 30,\n    },\n    icon: {\n        maxWidth: \"10vw\",\n\n        marginRight: 10,\n    },\n    title: {\n        margin: 10,\n    },\n    img: {\n        height: \"auto\",\n        width: \"60vw\",\n    },\n    button: {\n        margin: 10,\n    },\n    iconButton: {\n        height: 50,\n        width: 50,\n    },\n    buttonGroup: {\n        width: 200,\n        height: 200,\n    },\n});\n\nclass AssessmentSetup extends Component {\n    state = {\n        nodes: {},\n        options: {},\n        currentNode: 1,\n        currentIsLeft: true,\n        time: \"first\",\n    };\n\n    componentDidMount = async () => {\n        this._isMounted = true;\n        const { options } = this.state;\n        await this.getWorseEar(this.props.match.params.time);\n        if (Object.keys(options).length === 0) {\n            await this.constructGraph();\n            await this.handleApply();\n        }\n    };\n\n    componentWillUnmount() {\n        this._isMounted = false;\n    }\n\n    getWorseEar = (time) => {\n        const { leftEarIsWorse } = this.props.context;\n        this.setState({\n            currentIsLeft: time === \"first\" ? leftEarIsWorse : !leftEarIsWorse,\n            time: time,\n        });\n    };\n\n    //TODO: CONSTRUCT GRAPH BASED ON OPTION\n    constructGraph = async () => {\n        const nodes = {};\n        const options = {};\n\n        await d3.csv(rootNodes, (rootNode) => {\n            options[rootNode[\"NodeNo\"]] = rootNode[\"HearingLoss\"];\n        });\n\n        await d3.csv(treeNodes, (treeNode) => {\n            nodes[treeNode[\"NodeNo\"]] = parseTreeNode(treeNode);\n        });\n\n        // Get option and loss level \n        let optionSetting = sessionStorage.getItem('option');\n        let lossLevel = sessionStorage.getItem('rootNode');\n\n        if (this._isMounted) {\n            this.setState({ options, nodes, currentNode: Number(lossLevel) });\n        }\n    };\n\n    decreaseSound = () => {\n        this.setState(\n            {\n                currentNode:\n                    this.state.currentNode > 1 ? this.state.currentNode - 1 : 1,\n            },\n            this.handleApply\n        );\n    };\n\n    increaseSound = () => {\n        this.setState(\n            {\n                currentNode:\n                    this.state.currentNode < 5 ? this.state.currentNode + 1 : 5,\n            },\n            this.handleApply\n        );\n    };\n\n    handleApply = async () => {\n        const { currentNode, nodes } = this.state;\n        try {\n            const response = await axios.post(\"/api/param/setparam\", {\n                method: \"set\",\n                data: nodes[currentNode],\n            });\n            const data = response.data;\n            console.log(data);\n        } catch (error) {\n            alert(error.response.data);\n        }\n    };\n\n    earDone = () => {\n        const { currentNode } = this.state;\n        sessionStorage.setItem(\"rootNode\", parseInt(currentNode));\n        // this.setState({ currentIsLeft: false, currentNode: 1 });\n    };\n\n    handlePlay = async () => {\n        let path = \"\";\n        try {\n            const response = await axios.get(\"/api/researcher/audioPath\");\n            path = response.data;\n        } catch (error) {\n            alert(error.response.data);\n        }\n        path = path.concat(\"test.wav\");\n\n        console.log(path);\n        const dataInput = {\n            left: {\n                audio_filename: path,\n                audio_reset: 1,\n                audio_repeat: 0,\n                audio_play: 1,\n                alpha: 1.0,\n            },\n            right: {\n                audio_filename: path,\n                audio_reset: 1,\n                audio_repeat: 0,\n                audio_play: 1,\n                alpha: 1.0,\n            },\n        };\n        try {\n            const response = await axios.post(\"/api/param/setparam\", {\n                method: \"set\",\n                data: dataInput,\n            });\n            const data = response.data;\n            console.log(data);\n        } catch (error) {\n            alert(error.response.data);\n        }\n    };\n\n    render() {\n        const { classes } = this.props;\n        const { currentNode, options, currentIsLeft } = this.state;\n        return (\n            <Paper className={classes.paper}>\n                <Grid container spacing={1}>\n                    <Grid item xs={12} className={classes.title}>\n                        {`Please adjust the volume for your ${\n                            currentIsLeft ? \"LEFT\" : \"RIGHT\"\n                        } ear`}\n                        <Tooltip title=\"In this section, first adjust volumn, then choose the audio that you think is better. The process is repeated for both right ear and left ear\">\n                            <IconButton aria-label=\"help\">\n                                <HelpIcon />\n                            </IconButton>\n                        </Tooltip>\n                    </Grid>\n                    <Grid\n                        container\n                        direction=\"row\"\n                        justify=\"center\"\n                        alignItems=\"center\"\n                    >\n                        {/* <VolumeDownIcon className={classes.icon}/> */}\n                        <VolumeUpIcon className={classes.icon} />\n                        {options ? (\n                            <BorderLinearProgress\n                                variant=\"determinate\"\n                                value={(currentNode - 1) * 25}\n                                style={{ flex: 0.3 }}\n                            />\n                        ) : null}\n\n                        <div style={{ marginLeft: 10, fontSize: 16 }}>\n                            {(currentNode - 1) * 25 + \"%\"}\n                        </div>\n                    </Grid>\n                    <Grid\n                        container\n                        direction=\"row\"\n                        justify=\"center\"\n                        alignItems=\"center\"\n                    >\n                        <IconButton\n                            aria-label=\"remove\"\n                            onClick={this.decreaseSound}\n                            className={classes.iconButtonMarginLeft}\n                            disabled={currentNode === 1}\n                        >\n                            <RemoveCircleOutlineIcon\n                                className={classes.iconButton}\n                            />\n                        </IconButton>\n                        <IconButton\n                            aria-label=\"add\"\n                            onClick={this.increaseSound}\n                            className={classes.iconButtonMarginRight}\n                            disabled={currentNode === 5}\n                        >\n                            <AddCircleOutlineIcon\n                                className={classes.iconButton}\n                            />\n                        </IconButton>\n                    </Grid>\n                    <Grid\n                        container\n                        direction=\"row\"\n                        justify=\"space-around\"\n                        alignItems=\"center\"\n                    >\n                        <IconButton\n                            variant={\"contained\"}\n                            onClick={() => this.handlePlay()}\n                        >\n                            <PlayCircleOutlineIcon\n                                className={classes.buttonGroup}\n                            />\n                        </IconButton>\n                    </Grid>\n                    <Grid\n                        container\n                        direction=\"row\"\n                        justify=\"flex-end\"\n                        alignItems=\"center\"\n                    >\n                        <Button\n                            className={classes.button}\n                            variant=\"outlined\"\n                            color=\"primary\"\n                            onClick={this.earDone}\n                            component={Link}\n                            to={`/assessmentPage/${currentIsLeft}`}\n                        >\n                            Continue\n                        </Button>\n                        }\n                    </Grid>\n                </Grid>\n            </Paper>\n        );\n    }\n}\n\nexport default compose(\n    withUserAuth,\n    withRouter,\n    withStyles(styles)\n)(AssessmentSetup);\n"]},"metadata":{},"sourceType":"module"}