{"ast":null,"code":"import _regeneratorRuntime from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _defineProperty from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import React,{Component}from'react';import{axios,roundOff4}from'utils/utils';import{withStyles}from'@material-ui/styles';import Grid from'@material-ui/core/Grid';import Typography from'@material-ui/core/Typography';import Button from'@material-ui/core/Button';import Input from'@material-ui/core/Input';import Slider from'@material-ui/core/Slider';import ToggleButton from'@material-ui/lab/ToggleButton';import Box from'@material-ui/core/Box';import Tooltip from'@material-ui/core/Tooltip';import IconButton from'@material-ui/core/IconButton';import HelpIcon from'@material-ui/icons/Help';import block4afc from'utils/images/4afcBlock.png';var styles=function styles(theme){return{content:_defineProperty({margin:10,maxWidth:'90%'},\"margin\",30),setting:{width:'60%',margin:2},button:{width:100,margin:10},groupButton:{width:'60%',color:'gray'},input:{width:100},helperIcon:{display:'inline-flex',verticalAlign:'middle'},explanation:{width:'80%',margin:8},img:{width:'80%',height:'auto'}};};var afc_options=['No Adaptation','FxLMS','IPNLMS','SLMS'];var FeedbackManagement=/*#__PURE__*/function(_Component){_inherits(FeedbackManagement,_Component);var _super=_createSuper(FeedbackManagement);function FeedbackManagement(){var _this;_classCallCheck(this,FeedbackManagement);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={afc_delay:0,afc_mu:0,afc_rho:0,afc_type:0};_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _this.loadParameter();case 3:_context.next=8;break;case 5:_context.prev=5;_context.t0=_context[\"catch\"](0);alert(_context.t0);case 8:case\"end\":return _context.stop();}}},_callee,null,[[0,5]]);}));_this.loadParameter=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post(\"/api/param/getparam\");case 3:response=_context2.sent;data=response.data;console.log(data);_this.setState({afc_delay:parseInt(data['left']['afc_delay']),afc_mu:parseInt(data['left']['afc_mu']),afc_rho:parseInt(data['left']['afc_rho']),afc_type:parseInt(data['left']['afc_type'])});_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);throw _context2.t0;case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9]]);}));_this.handleAllInputChange=function(type,newValue){//Blur the invalid input value based on the type\nif(type==='afc_mu'||type==='afc_rho'){newValue=newValue<=0?0:newValue>=1?1:newValue;}if(type==='afc_delay'){newValue=newValue<=0?0:newValue>=8?8:newValue;}_this.setState(_defineProperty({},type,newValue));};_this.handleTransmit=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _this$state,afc_mu,afc_rho,afc_type,afc_delay,transmitData;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this$state=_this.state,afc_mu=_this$state.afc_mu,afc_rho=_this$state.afc_rho,afc_type=_this$state.afc_type,afc_delay=_this$state.afc_delay;transmitData={afc_mu:afc_mu,afc_rho:afc_rho,afc_type:afc_type,afc_delay:afc_delay,afc_reset:0};//console.log(transmitData)\n_context3.prev=2;_context3.next=5;return axios.post(\"/api/param/setparam\",{method:'set',data:{'left':transmitData,'right':transmitData}});case 5:_context3.next=7;return _this.loadParameter();case 7:_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](2);alert(_context3.t0.response.data);case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[2,9]]);}));_this.setDelay=function(value){_this.setState({afc_delay:roundOff4(value)});};_this.setMu=function(value){_this.setState({afc_mu:roundOff4(value)});};_this.setRho=function(value){_this.setState({afc_rho:roundOff4(value)});};_this.setType=function(value){_this.setState({afc_type:value});};_this.handleReset=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _this$state2,afc_mu,afc_rho,afc_type,afc_delay;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_this$state2=_this.state,afc_mu=_this$state2.afc_mu,afc_rho=_this$state2.afc_rho,afc_type=_this$state2.afc_type,afc_delay=_this$state2.afc_delay;_context4.prev=1;_context4.next=4;return axios.post(\"/api/param/setparam\",{method:'set',data:{'left':{'afc_mu':0.005,'afc_rho':0.9,'afc_type':1,'afc_delay':4.6875,'afc_reset':1},'right':{'afc_mu':0.005,'afc_rho':0.9,'afc_type':1,'afc_delay':4.6875,'afc_reset':1}}});case 4:_context4.next=6;return _this.loadParameter();case 6:_context4.next=11;break;case 8:_context4.prev=8;_context4.t0=_context4[\"catch\"](1);alert(_context4.t0.response.data);case 11:case\"end\":return _context4.stop();}}},_callee4,null,[[1,8]]);}));return _this;}_createClass(FeedbackManagement,[{key:\"render\",value:function render(){var _this2=this;var classes=this.props.classes;var _this$state3=this.state,afc_type=_this$state3.afc_type,afc_delay=_this$state3.afc_delay,afc_mu=_this$state3.afc_mu,afc_rho=_this$state3.afc_rho;return/*#__PURE__*/React.createElement(\"div\",{className:classes.content},/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"column\",spacing:5,alignItems:\"center\",justify:\"center\"},/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"column\",justify:\"center\",alignItems:\"center\"},afc_options.map(function(value,index){return/*#__PURE__*/React.createElement(ToggleButton,{color:\"primary\",className:classes.groupButton,key:\"noise_\".concat(index),value:index,selected:index===afc_type,onClick:function onClick(){return _this2.handleAllInputChange('afc_type',index);}},value);})),/*#__PURE__*/React.createElement(Grid,{container:true,alignItems:\"center\",direction:\"row\",spacing:3,justify:\"space-between\",className:classes.setting},/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Typography,{component:\"div\"},/*#__PURE__*/React.createElement(Box,{lineHeight:2},\"Delay (ms):\"))),/*#__PURE__*/React.createElement(Grid,{container:true,item:true,xs:6},/*#__PURE__*/React.createElement(Slider,{value:afc_delay,step:0.01,min:0,max:8,onChange:function onChange(event,value){return _this2.handleAllInputChange('afc_delay',value);}})),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Input,{className:classes.input,value:afc_delay,margin:\"dense\"// onChange={this.handleDelayInputChange}\n// onBlur={this.handleBlurDelay}\n,onChange:function onChange(event){return _this2.handleAllInputChange('afc_delay',Number(event.target.value));}// onBlur={()=>this.handleTransmitParamChange('afc_delay', afc_delay)}\n,inputProps:{step:0.0001,min:0,max:8.0,type:'number'}}))),/*#__PURE__*/React.createElement(Grid,{container:true,alignItems:\"center\",direction:\"row\",spacing:3,justify:\"space-between\",className:classes.setting},/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Typography,{component:\"div\"},/*#__PURE__*/React.createElement(Box,null,\"Mu\",/*#__PURE__*/React.createElement(Tooltip,{disableFocusListener:true,title:'The step size parameter, which has to be set to '.concat('a positive value. It controls the adaptation rate of the AFC filter,',' in the sense that a larger mu is more suitable for a highlty changin ','environment. Note, however, a larger mu also leads to a higher possibility ','of instability and more artifacts.')},/*#__PURE__*/React.createElement(IconButton,{size:\"small\",className:classes.helperIcon},/*#__PURE__*/React.createElement(HelpIcon,null))),\"  :\"))),/*#__PURE__*/React.createElement(Grid,{container:true,item:true,xs:6},/*#__PURE__*/React.createElement(Slider,{value:afc_mu,step:0.001,min:0,max:1,onChange:function onChange(event,value){return _this2.handleAllInputChange('afc_mu',value);}})),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Input,{className:classes.input,value:afc_mu,margin:\"dense\",onChange:function onChange(event){return _this2.handleAllInputChange('afc_mu',Number(event.target.value));},inputProps:{step:0.0001,min:0,max:1,type:'number'}}))),/*#__PURE__*/React.createElement(Grid,{container:true,alignItems:\"center\",direction:\"row\",spacing:2,justify:\"space-between\",className:classes.setting},/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Typography,{component:\"div\"},/*#__PURE__*/React.createElement(Box,null,\"Rho\",/*#__PURE__*/React.createElement(Tooltip,{disableFocusListener:true,title:'A forgetting factor for controlling the update of the signal power estimate'.concat('. It ranges from 0-1. For speech signals, typical values of rho are around 0.9. ','If it is too large, the update of the power estimate would fail to catch up with ','speech variatios. If it is set too small, the variance of the estimate will be high, ','leading to more artifacts.')},/*#__PURE__*/React.createElement(IconButton,{size:\"small\",className:classes.helperIcon},/*#__PURE__*/React.createElement(HelpIcon,null))),\"  :\"))),/*#__PURE__*/React.createElement(Grid,{container:true,item:true,xs:6},/*#__PURE__*/React.createElement(Slider,{value:afc_rho,step:0.001,min:0,max:1,onChange:function onChange(event,value){return _this2.handleAllInputChange('afc_rho',value);}})),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Input,{className:classes.input,value:afc_rho,margin:\"dense\",onChange:function onChange(event){return _this2.handleAllInputChange('afc_rho',Number(event.target.value));},inputProps:{step:0.0001,min:0,max:1,type:'number'}}))),/*#__PURE__*/React.createElement(Grid,{container:true,justify:\"center\",direction:\"row\"},/*#__PURE__*/React.createElement(Button,{variant:\"contained\",color:\"primary\",onClick:function onClick(){return _this2.handleTransmit();},className:classes.button},\"Update\"),/*#__PURE__*/React.createElement(Button,{variant:\"contained\",color:\"default\",onClick:function onClick(event){return _this2.handleReset();},className:classes.button},\"Reset\")),/*#__PURE__*/React.createElement(Typography,{component:\"div\"},/*#__PURE__*/React.createElement(Box,{fontSize:24},\"Troubleshooting AFC\")),/*#__PURE__*/React.createElement(Typography,{component:\"div\",className:classes.explanation},/*#__PURE__*/React.createElement(Box,null,'When instability is detected by the user, he/she should press '.concat('the \"Reset” button above. This will (i) initialize AFC filter to its',' initial coefficients, obtained from average of multiple feedback path',' measurements; and (ii) reduce amplification gain in all bands by x dB. ','(Arthur to experiment and suggest value of x. Initially, x=10).'))),/*#__PURE__*/React.createElement(\"img\",{src:block4afc,alt:\"4AFC Block\",className:classes.img})));}}]);return FeedbackManagement;}(Component);export default withStyles(styles)(FeedbackManagement);","map":{"version":3,"sources":["/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/src/components/feedbackManagement.jsx"],"names":["React","Component","axios","roundOff4","withStyles","Grid","Typography","Button","Input","Slider","ToggleButton","Box","Tooltip","IconButton","HelpIcon","block4afc","styles","theme","content","margin","maxWidth","setting","width","button","groupButton","color","input","helperIcon","display","verticalAlign","explanation","img","height","afc_options","FeedbackManagement","state","afc_delay","afc_mu","afc_rho","afc_type","componentDidMount","loadParameter","alert","post","response","data","console","log","setState","parseInt","handleAllInputChange","type","newValue","handleTransmit","transmitData","afc_reset","method","setDelay","value","setMu","setRho","setType","handleReset","classes","props","map","index","event","Number","target","step","min","max","concat"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { axios, roundOff4 } from 'utils/utils';\nimport { withStyles } from '@material-ui/styles';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport Button from '@material-ui/core/Button';\nimport Input from '@material-ui/core/Input';\nimport Slider from '@material-ui/core/Slider';\nimport ToggleButton from '@material-ui/lab/ToggleButton';\nimport Box from '@material-ui/core/Box';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport IconButton from '@material-ui/core/IconButton';\nimport HelpIcon from '@material-ui/icons/Help';\nimport block4afc from 'utils/images/4afcBlock.png';\n\nconst styles = (theme) => ({\n    content: {\n        margin: 10,\n        maxWidth: '90%',\n        margin: 30,\n    },\n    setting: {\n        width: '60%',\n        margin: 2,\n    },\n    button: {\n        width: 100,\n        margin: 10,\n    },\n    groupButton: {\n        width: '60%',\n        color: 'gray',\n    },\n    input: { \n        width: 100,\n    },\n    helperIcon: {\n        display: 'inline-flex',\n        verticalAlign: 'middle',\n    },\n    explanation: {\n        width: '80%',\n        margin: 8,\n    },\n    img: {\n        width: '80%',\n        height: 'auto',\n    },\n})\n\nconst afc_options = [\n    'No Adaptation',\n    'FxLMS',\n    'IPNLMS',\n    'SLMS',\n];\n\nclass FeedbackManagement extends Component {\n    state = {\n        afc_delay: 0,\n        afc_mu: 0,\n        afc_rho: 0,\n        afc_type: 0,\n    };\n\n    componentDidMount = async () => {\n        try {\n            await this.loadParameter();\n        }\n        catch (error) {\n            alert(error);\n        }\n    }\n\n\n    loadParameter = async () => {\n        try {\n            const response = await axios.post(\"/api/param/getparam\");\n            const data = response.data;\n            console.log(data)\n            this.setState({\n                afc_delay: parseInt(data['left']['afc_delay']),\n                afc_mu: parseInt(data['left']['afc_mu']),\n                afc_rho: parseInt(data['left']['afc_rho']),\n                afc_type: parseInt(data['left']['afc_type']),\n            });\n            \n        }\n        catch (error) {\n            throw error;\n        }\n    }\n\n\n    handleAllInputChange = (type, newValue)=> {\n\n        //Blur the invalid input value based on the type\n        if(type === 'afc_mu' || type === 'afc_rho'){\n            newValue = newValue <= 0 ? 0: (newValue >= 1 ? 1 : newValue);\n        }\n        if(type === 'afc_delay'){\n            newValue = newValue <= 0 ? 0: (newValue >= 8 ? 8 : newValue);\n        }\n        this.setState({\n            [type]: newValue\n        })\n    }\n  \n    //Transmit current values when use hit enter key on input\n    handleTransmit = async() => {\n        const {\n            afc_mu,\n            afc_rho,\n            afc_type,\n            afc_delay,\n        } = this.state;\n        \n        let transmitData = {\n            afc_mu,\n            afc_rho,\n            afc_type,\n            afc_delay,\n            afc_reset:0,\n        }\n        //console.log(transmitData)\n        try {\n            await axios.post(\"/api/param/setparam\", {\n                method: 'set',\n                data: {\n                    'left': transmitData,\n                    'right': transmitData\n                },\n                \n            });\n            await this.loadParameter();\n        }\n        catch(error) {\n            alert(error.response.data);\n        }\n\n    }\n\n    setDelay = (value) => {\n        this.setState({ afc_delay: roundOff4(value) });\n    }\n\n    setMu = (value) => {\n        this.setState({ afc_mu: roundOff4(value) });\n    }\n\n    setRho = (value) => {\n        this.setState({ afc_rho: roundOff4(value) });\n    }\n\n    setType = (value) => {\n        this.setState({ afc_type: value});\n    }\n\n    handleReset = async () => {\n        const {\n            afc_mu,\n            afc_rho,\n            afc_type,\n            afc_delay,\n        } = this.state;\n        try {\n            await axios.post(\"/api/param/setparam\", {\n                method: 'set',\n                data: {\n                    'left': {\n                        'afc_mu': 0.005,\n                        'afc_rho': 0.9,\n                        'afc_type': 1,\n                        'afc_delay': 4.6875,\n                        'afc_reset': 1,\n                    },\n                    'right': {\n                        'afc_mu': 0.005,\n                        'afc_rho': 0.9,\n                        'afc_type': 1,\n                        'afc_delay': 4.6875,\n                        'afc_reset': 1,\n                    }\n                },\n            });\n            await this.loadParameter();\n        }\n        catch(error) {\n            alert(error.response.data);\n        }\n    }\n\n    render() {\n        const { classes } = this.props; \n        const { \n            afc_type,\n            afc_delay,\n            afc_mu,\n            afc_rho,\n        } = this.state;\n        return (\n            <div className={classes.content}>\n                <Grid container \n                    direction=\"column\" \n                    spacing={5} \n                    alignItems=\"center\" \n                    justify=\"center\">\n                    <Grid\n                        container\n                        direction=\"column\"\n                        justify=\"center\"\n                        alignItems=\"center\"\n                    >\n                        {\n                            afc_options.map((value, index) => (\n                                <ToggleButton \n                                    color=\"primary\"\n                                    className={classes.groupButton} \n                                    key={`noise_${index}`}\n                                    value={index} \n                                    selected={index === afc_type}\n                                    onClick={() => this.handleAllInputChange('afc_type', index)}\n                                >\n                                    {value}\n                                </ToggleButton>\n                            ))\n                        }\n                    </Grid>\n                    <Grid\n                        container\n                        alignItems=\"center\" \n                        direction='row'\n                        spacing={3}\n                        justify=\"space-between\"\n                        className={classes.setting}\n                        >\n                        <Grid item>\n                            <Typography component=\"div\">\n                                <Box lineHeight={2} >  \n                                    Delay (ms):\n                                </Box>\n                            </Typography>\n                        </Grid>\n                        <Grid container item xs={6}>\n                            <Slider\n                                value = {afc_delay}\n                                step = {0.01}\n                                min = {0}\n                                max = {8}\n                                onChange = {(event,value) => this.handleAllInputChange('afc_delay', value)}\n                            />\n                        </Grid>\n                        <Grid item>\n                            <Input\n                                className={classes.input}\n                                value={afc_delay}\n                                margin=\"dense\"\n                                // onChange={this.handleDelayInputChange}\n                                // onBlur={this.handleBlurDelay}\n                                onChange={(event) => this.handleAllInputChange('afc_delay', Number(event.target.value))}\n                                // onBlur={()=>this.handleTransmitParamChange('afc_delay', afc_delay)}\n                                inputProps={{\n                                    step: 0.0001,\n                                    min: 0,\n                                    max: 8.0,\n                                    type: 'number',\n                                }}\n                            />\n                        </Grid>\n                    </Grid>\n                    <Grid \n                        container\n                        alignItems=\"center\" \n                        direction='row'\n                        spacing={3}\n                        justify=\"space-between\"\n                        className={classes.setting}\n                    >\n                        <Grid item>\n                            <Typography component=\"div\">\n                                <Box >  \n                                    Mu \n                                    <Tooltip disableFocusListener title={\n                                         'The step size parameter, which has to be set to '.concat(\n                                            'a positive value. It controls the adaptation rate of the AFC filter,',\n                                            ' in the sense that a larger mu is more suitable for a highlty changin ',\n                                            'environment. Note, however, a larger mu also leads to a higher possibility ',\n                                            'of instability and more artifacts.',\n                                        )\n                                    }>\n                                        <IconButton size=\"small\" className={classes.helperIcon}>\n                                            <HelpIcon />\n                                        </IconButton>\n                                    </Tooltip>  :\n                                </Box>\n                            </Typography>\n                        </Grid>\n                        <Grid container item xs={6}>\n                            <Slider\n                                value = {afc_mu}\n                                step = {0.001}\n                                min = {0}\n                                max = {1}\n                                onChange = {(event,value) => this.handleAllInputChange('afc_mu', value)}\n                            />\n                        </Grid>\n                        <Grid item>\n                            <Input\n                                className={classes.input}\n                                value={afc_mu}\n                                margin=\"dense\"\n                                onChange={(event) => this.handleAllInputChange('afc_mu',Number(event.target.value))}\n                                inputProps={{\n                                    step: 0.0001,\n                                    min: 0,\n                                    max: 1,\n                                    type: 'number',\n                                }}\n                            />\n                        </Grid>\n                    </Grid>\n                    <Grid \n                        container\n                        alignItems=\"center\" \n                        direction='row'\n                        spacing={2}\n                        justify=\"space-between\"\n                        className={classes.setting}\n                    >\n                        <Grid item>\n                            <Typography component=\"div\">\n                                <Box >  \n                                    Rho\n                                    <Tooltip disableFocusListener title={\n                                         'A forgetting factor for controlling the update of the signal power estimate'.concat(\n                                             '. It ranges from 0-1. For speech signals, typical values of rho are around 0.9. ',\n                                             'If it is too large, the update of the power estimate would fail to catch up with ',\n                                             'speech variatios. If it is set too small, the variance of the estimate will be high, ',\n                                             'leading to more artifacts.' \n                                        )\n                                    }>\n                                        <IconButton size=\"small\" className={classes.helperIcon}>\n                                            <HelpIcon />\n                                        </IconButton>\n                                    </Tooltip>  :\n                                </Box>\n                            </Typography>\n                        </Grid>\n                        <Grid container item xs={6}>\n                            <Slider\n                                value = {afc_rho}\n                                step = {0.001}\n                                min = {0}\n                                max = {1}\n                                onChange = {(event,value) => this.handleAllInputChange('afc_rho', value)}\n                            />\n                        </Grid>\n                        <Grid item>\n                            <Input\n                                className={classes.input}\n                                value={afc_rho}\n                                margin=\"dense\"\n                                onChange={(event) => this.handleAllInputChange('afc_rho',Number(event.target.value))}\n                                inputProps={{\n                                    step: 0.0001,\n                                    min: 0,\n                                    max: 1,\n                                    type: 'number',\n                                }}\n                            />\n                        </Grid>\n                    </Grid>\n                    <Grid container justify=\"center\" direction='row'>\n                        <Button \n                            variant=\"contained\"\n                            color=\"primary\"\n                            onClick={() => this.handleTransmit()}\n                            className={classes.button}\n                        >\n                            Update\n                        </Button>\n                        <Button \n                            variant=\"contained\"\n                            color=\"default\"\n                            onClick={(event) => this.handleReset()}\n                            className={classes.button}\n                        >\n                            Reset\n                        </Button>\n                    </Grid>\n                    <Typography component=\"div\" >\n                        <Box fontSize={24}>  \n                            Troubleshooting AFC\n                        </Box>\n                    </Typography>\n                    <Typography component=\"div\" className={classes.explanation}>\n                        <Box>  \n                        {\n                            'When instability is detected by the user, he/she should press '.concat(\n                                'the \"Reset” button above. This will (i) initialize AFC filter to its',\n                                ' initial coefficients, obtained from average of multiple feedback path',\n                                ' measurements; and (ii) reduce amplification gain in all bands by x dB. ',\n                                '(Arthur to experiment and suggest value of x. Initially, x=10).',\n                            )\n                        }\n                        </Box>\n                    </Typography>\n                    \n                    <img\n                        src={block4afc}\n                        alt={`4AFC Block`}\n                        className={classes.img}\n                    />\n                </Grid>\n            </div>\n        );\n    }\n}\n\nexport default withStyles(styles)(FeedbackManagement);"]},"metadata":{},"sourceType":"module"}