{"ast":null,"code":"import _regeneratorRuntime from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{withStyles}from\"@material-ui/styles\";import Paper from\"@material-ui/core/Paper\";import Grid from\"@material-ui/core/Grid\";import Button from\"@material-ui/core/Button\";import ButtonGroup from\"@material-ui/core/ButtonGroup\";import PlayCircleOutlineIcon from\"@material-ui/icons/PlayCircleOutline\";import*as d3 from\"d3\";import treeGraph from\"utils/BST/treeGraph.csv\";import treeNodes from\"utils/BST/treeNodes.csv\";import{parseTreeNodeSingleEar,NUM_LEVEL}from\"utils/BST/BSTUtil\";import withUserAuth from\"context/withUserAuth\";import{withRouter}from\"react-router-dom\";import{compose}from\"recompose\";import{Link}from\"react-router-dom\";import{TextField}from\"@material-ui/core\";import{axios}from'utils/utils';import Timer from\"components/Timer.jsx\";import data from\"./test.json\";import images from\"utils/images/hearingLossDemo\";var styles=function styles(theme){return{root:{flexGrow:1},paper:{minHeight:\"90vh\"},button:{minWidth:250,height:50,margin:10},grid:{marginLeft:10,fontSize:16},margin:{margin:10},extendedIcon:{marginRight:8},buttonGroup:{width:\"40vw\",height:100,marginTop:30,marginBottom:30}};};//TODO:\n//1. compare with left and right root node wheh reaching the root node after going n levels up\n//2. read the csv file based on the option \nvar AssessmentPage=/*#__PURE__*/function(_Component){_inherits(AssessmentPage,_Component);var _super=_createSuper(AssessmentPage);function AssessmentPage(){var _this;_classCallCheck(this,AssessmentPage);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={playCurrent:true,currentNode:1,nextNode:2,rootNode:1,prevVisited:0,prevOption:0,currentDepth:0,//iterate for five times after reaching the leaf node\ncurrentIteration:1,graph:{},nodes:{},firstTimeAccess:true,completed:false,currentEar:true,audioConfig:{},currentFile:data,audioPath:\"\",log:[],numQuestion:1};_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var graph,assessmentDone,configResponse,audioConfig,pathResponse,audioPath;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:graph=_this.state.graph;assessmentDone=_this.props.context.assessmentDone;if(!(Object.keys(graph).length===0&&assessmentDone!==true)){_context2.next=24;break;}_context2.next=5;return _this.getWorseEar();case 5:_context2.next=7;return _this.constructGraph();case 7:_context2.prev=7;_context2.next=10;return axios.get(\"/api/researcher/userAssessmentConfig\");case 10:configResponse=_context2.sent;audioConfig=configResponse.data;console.log(audioConfig);_context2.next=15;return axios.get(\"/api/researcher/audioPath\");case 15:pathResponse=_context2.sent;audioPath=pathResponse.data;_this.setState({audioConfig:audioConfig,audioPath:audioPath},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _this.playFile();case 2:case\"end\":return _context.stop();}}},_callee);})));_context2.next=23;break;case 20:_context2.prev=20;_context2.t0=_context2[\"catch\"](7);alert(_context2.t0.response.data);case 23:_this.handlePlay(true);case 24:case\"end\":return _context2.stop();}}},_callee2,null,[[7,20]]);}));_this.getFilePath=function(){var _this$state=_this.state,audioConfig=_this$state.audioConfig,audioPath=_this$state.audioPath,currentEar=_this$state.currentEar;return audioPath.concat(_this.getRandom(audioConfig[currentEar?\"left\":\"right\"]));};_this.getRandom=function(filenames){return filenames[Math.floor(Math.random()*filenames.length)];};_this.playFile=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var filePath,dataInput,response,_data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:filePath=_this.getFilePath();console.log(filePath);dataInput={left:{audio_filename:filePath,audio_reset:1,audio_repeat:1,audio_play:1,alpha:1.0},right:{audio_filename:filePath,audio_reset:1,audio_repeat:1,audio_play:1,alpha:1.0}};_context3.prev=3;_context3.next=6;return axios.post(\"/api/param/setparam\",{method:\"set\",data:dataInput});case 6:response=_context3.sent;_data=response.data;console.log(_data);_context3.next=14;break;case 11:_context3.prev=11;_context3.t0=_context3[\"catch\"](3);alert(_context3.t0.response.data);case 14:case\"end\":return _context3.stop();}}},_callee3,null,[[3,11]]);}));_this.mute=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var dataInput,response,_data2;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:dataInput={left:{alpha:0.0},right:{alpha:0.0}};_context4.prev=1;_context4.next=4;return axios.post(\"/api/param/setparam\",{method:\"set\",data:dataInput});case 4:response=_context4.sent;_data2=response.data;console.log(_data2);_context4.next=12;break;case 9:_context4.prev=9;_context4.t0=_context4[\"catch\"](1);alert(_context4.t0.response.data);case 12:case\"end\":return _context4.stop();}}},_callee4,null,[[1,9]]);}));_this.getWorseEar=function(){var leftEarIsWorse=_this.props.context.leftEarIsWorse;_this.setState({currentEar:_this.props.match.params.currentIsLeft===\"true\",firstTimeAccess:leftEarIsWorse===(_this.props.match.params.currentIsLeft===\"true\")});console.log(leftEarIsWorse);};_this.constructGraph=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var graph,nodes,edges,currentNodeString,option,currentNode;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:graph={};nodes={};edges=[];_context5.next=5;return d3.csv(treeGraph,function(treeGraph){edges.push([treeGraph[\"ParentNodeNo\"],treeGraph[\"NodeNo\"]]);});case 5:edges.forEach(function(edge){graph[edge[0]]=graph[edge[0]]?graph[edge[0]]:[];graph[edge[0]].push(edge[1]);});_context5.next=8;return d3.csv(treeNodes,function(treeNode){nodes[treeNode[\"NodeNo\"]]=parseTreeNodeSingleEar(treeNode,_this.state.currentEar);});case 8:currentNodeString=sessionStorage.getItem(\"rootNode\");option=sessionStorage.getItem(\"option\");currentNode=currentNodeString?parseInt(currentNodeString):1;console.log(currentNode);_this.setState({graph:graph,nodes:nodes,currentNode:currentNode,rootNode:currentNode,// Next node is the left child\nnextNode:graph[currentNode][0],currentQueue:[currentNode]});case 13:case\"end\":return _context5.stop();}}},_callee5);}));_this.handlePlay=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(isCurrent){var _this$state2,nodes,currentNode,nextNode,response,_data3;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_this$state2=_this.state,nodes=_this$state2.nodes,currentNode=_this$state2.currentNode,nextNode=_this$state2.nextNode;_context6.prev=1;_this.setState({showMessage:!_this.state.showMessage});//console.log('I am huge')//this.state.showMessage);\n_context6.next=5;return axios.post(\"/api/param/setparam\",{method:\"set\",data:isCurrent?nodes[currentNode]:nodes[nextNode]});case 5:response=_context6.sent;_data3=response.data;console.log(_data3);_context6.next=13;break;case 10:_context6.prev=10;_context6.t0=_context6[\"catch\"](1);alert(_context6.t0.response.data);case 13:_this.setState({playCurrent:isCurrent});case 14:case\"end\":return _context6.stop();}}},_callee6,null,[[1,10]]);}));return function(_x){return _ref6.apply(this,arguments);};}();_this.handleLog=function(option,currentNode,nextNode,currentEar){var currentLog=\"\";switch(option){case 0:currentLog=currentLog.concat(\"User thinks NEW(\",nextNode,\") is better than CURRENT(\",currentNode,\") for the \",currentEar?\"LEFT ear\":\"RIGHT ear\");break;case 1:currentLog=currentLog.concat(\"User thinks NEW(\",nextNode,\") is the same as CURRENT(\",currentNode,\") for the \",currentEar?\"LEFT ear\":\"RIGHT ear\");break;case 2:currentLog=currentLog.concat(\"User thinks NEW(\",nextNode,\") is worse than CURRENT(\",currentNode,\") for the \",currentEar?\"LEFT ear\":\"RIGHT ear\");break;default:break;}return currentLog;};_this.handleContinue=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(option){var _this$state3,currentNode,nextNode,prevVisited,currentIteration,prevOption,graph,currentEar,currentDepth,rootNode,log,currentLog,reachTerminalNode;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_this$state3=_this.state,currentNode=_this$state3.currentNode,nextNode=_this$state3.nextNode,prevVisited=_this$state3.prevVisited,currentIteration=_this$state3.currentIteration,prevOption=_this$state3.prevOption,graph=_this$state3.graph,currentEar=_this$state3.currentEar,currentDepth=_this$state3.currentDepth,rootNode=_this$state3.rootNode,log=_this$state3.log;currentLog=_this.handleLog(option,currentNode,nextNode,currentEar);log.push(currentLog);reachTerminalNode=false;// Next is better than parent node, continue on next node if it is not leaf\nif(option===0){if(graph[nextNode]!=null){currentNode=nextNode;nextNode=graph[nextNode][0];currentDepth+=1;prevVisited=-1;prevOption=-1;console.log('Next node is better than the parent, next node is new parent');}else{reachTerminalNode=true;console.log('Next node is better than the parent, next node is leaf node');}}// Parent is the same with the next node\nelse if(option===1){// Current next node is right child, parent is same with both left and right child, terminal point\nif(prevVisited===currentNode&&prevOption===1){reachTerminalNode=true;console.log('Parent is same as the left child and right child, terminal point');}else if(prevVisited===currentNode&&prevOption===2){// Current next node is right child, parent is better than left the same with right child, continue with right child\ncurrentNode=nextNode;nextNode=graph[nextNode][0];currentDepth+=1;prevVisited=-1;prevOption=-1;console.log('Parent is better than left child and the same with right child, right child is the new parent');}else{// Current next node is left child, parent is same with left child, compare with the right child \nnextNode=graph[currentNode][1];prevVisited=currentNode;prevOption=option;console.log('Parent is same with the left child, right child is next node');}}else{// Current next node is right child, parent is better then right child, reach the terminal \nif(prevVisited===currentNode){reachTerminalNode=true;console.log('Parent is better than/same with right and left child, ternimal point');}else{// Current next node is left child, parent is better then left child, compare with the right child is not leaf\nnextNode=graph[currentNode][1];console.log('Parent is better than left child, right child is next node');}}// Reach terminal node, go n levels up and continue with for different stimuli\n//TODO: compare with other root nodes when reach root after going n levels up\nif(!reachTerminalNode){_context7.next=22;break;}if(!(currentIteration===5)){_context7.next=14;break;}console.log('Reach terminal node, finish 5 iterations, done');_this.setState({completed:true,log:log});_context7.next=11;return _this.mute();case 11:return _context7.abrupt(\"return\");case 14:// Get current node level\nconsole.log('Reach terminal node, go N levels up');currentDepth-=NUM_LEVEL;// after going n levels up, reach the root node, compare with other rootnode\ncurrentNode=currentDepth<0?rootNode:(Math.pow(2,currentDepth+1)-1)*5+Math.pow(2,currentDepth+1)*(rootNode-1)+1;nextNode=graph[currentNode][0];prevVisited=-1;prevOption=-1;currentDepth=currentDepth<0?0:currentDepth;currentIteration++;case 22:console.log(\"NewCurrentNode:\",currentNode,\"NewNextNode:\",nextNode);_context7.next=25;return _this.playFile();case 25:_this.setState({currentNode:currentNode,nextNode:nextNode,currentDepth:currentDepth,currentIteration:currentIteration,prevOption:prevOption,prevVisited:prevVisited,log:log},function(){return _this.handlePlay(true);});case 26:case\"end\":return _context7.stop();}}},_callee7);}));return function(_x2){return _ref7.apply(this,arguments);};}();_this.onSubmit=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var _this$props$context,updateUser,user,loginMode,_this$state4,nodes,currentEar,currentNode,log,firstTimeAccess,tmpParameters;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_this$props$context=_this.props.context,updateUser=_this$props$context.updateUser,user=_this$props$context.user,loginMode=_this$props$context.loginMode;_this$state4=_this.state,nodes=_this$state4.nodes,currentEar=_this$state4.currentEar,currentNode=_this$state4.currentNode,log=_this$state4.log,firstTimeAccess=_this$state4.firstTimeAccess;if(!(loginMode===\"researcher\")){_context8.next=4;break;}return _context8.abrupt(\"return\");case 4:_context8.prev=4;if(firstTimeAccess){_context8.next=15;break;}_context8.next=8;return axios.post(\"/api/listener/addLog\",{listenerID:user,newLog:{assessment:{logOn:new Date().toLocaleString(),log:log}},flag:\"assessmentDone\",flagValue:true});case 8:sessionStorage.setItem(\"assessmentDone\",true);updateUser();tmpParameters=sessionStorage.getItem(\"tmpParameters\");_context8.next=13;return axios.post(\"/api/listener/updateParameters\",{listenerID:user,parameters:JSON.stringify({left:currentEar===true?nodes[currentNode][\"left\"]:tmpParameters,right:currentEar===false?nodes[currentNode][\"right\"]:tmpParameters})});case 13:_context8.next=18;break;case 15:_context8.next=17;return axios.post(\"/api/listener/addLog\",{listenerID:user,newLog:{assessment:{logOn:new Date().toLocaleString(),log:log}},flag:\"assessmentDone\",flagValue:false});case 17:sessionStorage.setItem(\"tmpParameters\",currentEar===true?nodes[currentNode][\"left\"]:nodes[currentNode][\"right\"]);case 18:_context8.next=24;break;case 20:_context8.prev=20;_context8.t0=_context8[\"catch\"](4);alert(_context8.t0.message);console.log(_context8.t0);case 24:// Reset state for the new ear\n_this.setState({currentNode:1,nextNode:2,rootNode:1,currentVisited:[],currentDepth:0,currentIteration:1});case 25:case\"end\":return _context8.stop();}}},_callee8,null,[[4,20]]);}));return _this;}_createClass(AssessmentPage,[{key:\"render\",value:function render(){var _this2=this;var _this$props=this.props,classes=_this$props.classes,showNodeNumber=_this$props.showNodeNumber;var _this$state5=this.state,playCurrent=_this$state5.playCurrent,firstTimeAccess=_this$state5.firstTimeAccess,completed=_this$state5.completed,currentEar=_this$state5.currentEar,currentNode=_this$state5.currentNode,nextNode=_this$state5.nextNode,currentFile=_this$state5.currentFile;return/*#__PURE__*/React.createElement(Paper,{className:classes.paper},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:1},/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,className:classes.grid},\"Use your \",currentEar?\"LEFT\":\"RIGHT\",\" ear:\"),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,className:classes.grid},\"Please click the one you think is better:\"),/*#__PURE__*/React.createElement(Timer,{filename:currentFile}),/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"row\",justify:\"space-around\",alignItems:\"center\"},/*#__PURE__*/React.createElement(ButtonGroup,{size:\"large\",color:\"primary\",\"aria-label\":\"large outlined primary button group\"},/*#__PURE__*/React.createElement(Button,{className:classes.buttonGroup,variant:!playCurrent?\"outlined\":\"contained\",startIcon:/*#__PURE__*/React.createElement(PlayCircleOutlineIcon,null),onClick:function onClick(){return _this2.handlePlay(true);}},\"Current\"),/*#__PURE__*/React.createElement(Button,{className:classes.buttonGroup,variant:playCurrent?\"outlined\":\"contained\",startIcon:/*#__PURE__*/React.createElement(PlayCircleOutlineIcon,null),onClick:function onClick(){return _this2.handlePlay(false);}},\"Next\"))),!completed?[/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"column\",justify:\"flex-end\",alignItems:\"center\",key:\"options\"},/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:function onClick(){return _this2.handleContinue(0);}},\"New is Better than Current\"),/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:function onClick(){return _this2.handleContinue(1);}},\"New is the Same as Current\"),/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:function onClick(){return _this2.handleContinue(2);}},\"New is Worse than Current\")),showNodeNumber?/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"row\",justify:\"center\",key:\"node_helpers\"},/*#__PURE__*/React.createElement(TextField,{className:classes.buttonGroup,variant:\"outlined\",value:\"Node \".concat(currentNode),inputProps:{style:{textAlign:\"center\"}},disabled:true}),/*#__PURE__*/React.createElement(TextField,{className:classes.buttonGroup,variant:\"outlined\",value:\"Node \".concat(nextNode),inputProps:{style:{textAlign:\"center\"}},disabled:true})):null]:/*#__PURE__*/React.createElement(Grid,{container:true,direction:\"column\",justify:\"flex-end\",alignItems:\"center\"},firstTimeAccess?\"You've finished \".concat(currentEar?\"LEFT\":\"RIGHT\",\" ear.\"):\"Congrats!! You've finished the user assessment!\",firstTimeAccess&&!showNodeNumber?/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:this.onSubmit,component:Link,to:\"/assessmentpageSetup/second\"},\"Proceed to the next ear\"):/*#__PURE__*/React.createElement(Button,{className:classes.button,variant:\"outlined\",color:\"primary\",onClick:this.onSubmit,component:Link,to:\"/researcherpage\"},\"Back to main menu\"))));}}]);return AssessmentPage;}(Component);export default compose(withUserAuth,withRouter,withStyles(styles))(AssessmentPage);","map":{"version":3,"sources":["/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/src/pages/BST/assessment/assessmentPage.jsx"],"names":["React","Component","withStyles","Paper","Grid","Button","ButtonGroup","PlayCircleOutlineIcon","d3","treeGraph","treeNodes","parseTreeNodeSingleEar","NUM_LEVEL","withUserAuth","withRouter","compose","Link","TextField","axios","Timer","data","images","styles","theme","root","flexGrow","paper","minHeight","button","minWidth","height","margin","grid","marginLeft","fontSize","extendedIcon","marginRight","buttonGroup","width","marginTop","marginBottom","AssessmentPage","state","playCurrent","currentNode","nextNode","rootNode","prevVisited","prevOption","currentDepth","currentIteration","graph","nodes","firstTimeAccess","completed","currentEar","audioConfig","currentFile","audioPath","log","numQuestion","componentDidMount","assessmentDone","props","context","Object","keys","length","getWorseEar","constructGraph","get","configResponse","console","pathResponse","setState","playFile","alert","response","handlePlay","getFilePath","concat","getRandom","filenames","Math","floor","random","filePath","dataInput","left","audio_filename","audio_reset","audio_repeat","audio_play","alpha","right","post","method","mute","leftEarIsWorse","match","params","currentIsLeft","edges","csv","push","forEach","edge","treeNode","currentNodeString","sessionStorage","getItem","option","parseInt","currentQueue","isCurrent","showMessage","handleLog","currentLog","handleContinue","reachTerminalNode","pow","onSubmit","updateUser","user","loginMode","listenerID","newLog","assessment","logOn","Date","toLocaleString","flag","flagValue","setItem","tmpParameters","parameters","JSON","stringify","message","currentVisited","classes","showNodeNumber","style","textAlign"],"mappings":"2/BAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,UAAT,KAA2B,qBAA3B,CACA,MAAOC,CAAAA,KAAP,KAAkB,yBAAlB,CACA,MAAOC,CAAAA,IAAP,KAAiB,wBAAjB,CACA,MAAOC,CAAAA,MAAP,KAAmB,0BAAnB,CACA,MAAOC,CAAAA,WAAP,KAAwB,+BAAxB,CACA,MAAOC,CAAAA,qBAAP,KAAkC,sCAAlC,CACA,MAAO,GAAKC,CAAAA,EAAZ,KAAoB,IAApB,CACA,MAAOC,CAAAA,SAAP,KAAsB,yBAAtB,CACA,MAAOC,CAAAA,SAAP,KAAsB,yBAAtB,CACA,OAASC,sBAAT,CAAiCC,SAAjC,KAAkD,mBAAlD,CACA,MAAOC,CAAAA,YAAP,KAAyB,sBAAzB,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,OAAT,KAAwB,WAAxB,CACA,OAASC,IAAT,KAAqB,kBAArB,CAEA,OAASC,SAAT,KAA0B,mBAA1B,CACA,OAASC,KAAT,KAAsB,aAAtB,CAEA,MAAOC,CAAAA,KAAP,KAAkB,sBAAlB,CACA,MAAOC,CAAAA,IAAP,KAAiB,aAAjB,CACA,MAAOC,CAAAA,MAAP,KAAmB,8BAAnB,CAEA,GAAMC,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,CAAAC,KAAK,QAAK,CACvBC,IAAI,CAAE,CACJC,QAAQ,CAAE,CADN,CADiB,CAIvBC,KAAK,CAAE,CACLC,SAAS,CAAE,MADN,CAJgB,CAOvBC,MAAM,CAAE,CACNC,QAAQ,CAAE,GADJ,CAENC,MAAM,CAAE,EAFF,CAGNC,MAAM,CAAE,EAHF,CAPe,CAYvBC,IAAI,CAAE,CACJC,UAAU,CAAE,EADR,CAEJC,QAAQ,CAAE,EAFN,CAZiB,CAgBvBH,MAAM,CAAE,CACNA,MAAM,CAAE,EADF,CAhBe,CAmBvBI,YAAY,CAAE,CACZC,WAAW,CAAE,CADD,CAnBS,CAsBvBC,WAAW,CAAE,CACXC,KAAK,CAAE,MADI,CAEXR,MAAM,CAAE,GAFG,CAGXS,SAAS,CAAE,EAHA,CAIXC,YAAY,CAAE,EAJH,CAtBU,CAAL,EAApB,CA8BA;AACA;AACA;GACMC,CAAAA,c,2VACJC,K,CAAQ,CACNC,WAAW,CAAE,IADP,CAENC,WAAW,CAAE,CAFP,CAGNC,QAAQ,CAAE,CAHJ,CAINC,QAAQ,CAAE,CAJJ,CAKNC,WAAW,CAAE,CALP,CAMNC,UAAU,CAAC,CANL,CAONC,YAAY,CAAC,CAPP,CAQN;AACAC,gBAAgB,CAAE,CATZ,CAUNC,KAAK,CAAE,EAVD,CAWNC,KAAK,CAAE,EAXD,CAYNC,eAAe,CAAE,IAZX,CAaNC,SAAS,CAAE,KAbL,CAcNC,UAAU,CAAE,IAdN,CAeNC,WAAW,CAAE,EAfP,CAgBNC,WAAW,CAAErC,IAhBP,CAiBNsC,SAAS,CAAE,EAjBL,CAkBNC,GAAG,CAAE,EAlBC,CAmBNC,WAAW,CAAE,CAnBP,C,OAsBRC,iB,sEAAoB,mNACVV,KADU,CACA,MAAKT,KADL,CACVS,KADU,CAEVW,cAFU,CAES,MAAKC,KAAL,CAAWC,OAFpB,CAEVF,cAFU,MAGdG,MAAM,CAACC,IAAP,CAAYf,KAAZ,EAAmBgB,MAAnB,GAA8B,CAA9B,EAAmCL,cAAc,GAAK,IAHxC,mDAIV,OAAKM,WAAL,EAJU,+BAKV,OAAKC,cAAL,EALU,iDAOenD,CAAAA,KAAK,CAACoD,GAAN,CAC3B,sCAD2B,CAPf,SAORC,cAPQ,gBAURf,WAVQ,CAUMe,cAAc,CAACnD,IAVrB,CAWdoD,OAAO,CAACb,GAAR,CAAYH,WAAZ,EAXc,wBAYatC,CAAAA,KAAK,CAACoD,GAAN,CAAU,2BAAV,CAZb,SAYRG,YAZQ,gBAaVf,SAbU,CAaEe,YAAY,CAACrD,IAbf,CAcd,MAAKsD,QAAL,CAAc,CAAElB,WAAW,CAAXA,WAAF,CAAeE,SAAS,CAATA,SAAf,CAAd,sEAA0C,yJAClC,OAAKiB,QAAL,EADkC,uDAA1C,IAdc,qFAkBdC,KAAK,CAAC,aAAMC,QAAN,CAAezD,IAAhB,CAAL,CAlBc,QAoBhB,MAAK0D,UAAL,CAAgB,IAAhB,EApBgB,uE,SAwBpBC,W,CAAc,UAAM,iBAC6B,MAAKrC,KADlC,CACVc,WADU,aACVA,WADU,CACGE,SADH,aACGA,SADH,CACcH,UADd,aACcA,UADd,CAElB,MAAOG,CAAAA,SAAS,CAACsB,MAAV,CACL,MAAKC,SAAL,CAAezB,WAAW,CAACD,UAAU,CAAG,MAAH,CAAY,OAAvB,CAA1B,CADK,CAAP,CAGD,C,OAED0B,S,CAAY,SAAAC,SAAS,CAAI,CACvB,MAAOA,CAAAA,SAAS,CAACC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,GAAgBH,SAAS,CAACf,MAArC,CAAD,CAAhB,CACD,C,OAEDQ,Q,sEAAW,8KACHW,QADG,CACQ,MAAKP,WAAL,EADR,CAETP,OAAO,CAACb,GAAR,CAAY2B,QAAZ,EACMC,SAHG,CAGS,CAChBC,IAAI,CAAE,CACJC,cAAc,CAAEH,QADZ,CAEJI,WAAW,CAAE,CAFT,CAGJC,YAAY,CAAE,CAHV,CAIJC,UAAU,CAAE,CAJR,CAKJC,KAAK,CAAE,GALH,CADU,CAQhBC,KAAK,CAAE,CACLL,cAAc,CAAEH,QADX,CAELI,WAAW,CAAE,CAFR,CAGLC,YAAY,CAAE,CAHT,CAILC,UAAU,CAAE,CAJP,CAKLC,KAAK,CAAE,GALF,CARS,CAHT,yCAoBgB3E,CAAAA,KAAK,CAAC6E,IAAN,CAAW,qBAAX,CAAkC,CACvDC,MAAM,CAAE,KAD+C,CAEvD5E,IAAI,CAAEmE,SAFiD,CAAlC,CApBhB,QAoBDV,QApBC,gBAwBDzD,KAxBC,CAwBMyD,QAAQ,CAACzD,IAxBf,CAyBPoD,OAAO,CAACb,GAAR,CAAYvC,KAAZ,EAzBO,qFA2BPwD,KAAK,CAAC,aAAMC,QAAN,CAAezD,IAAhB,CAAL,CA3BO,uE,SA+BX6E,I,sEAAO,sKACCV,SADD,CACa,CAChBC,IAAI,CAAE,CACJK,KAAK,CAAE,GADH,CADU,CAIhBC,KAAK,CAAE,CACLD,KAAK,CAAE,GADF,CAJS,CADb,yCAUoB3E,CAAAA,KAAK,CAAC6E,IAAN,CAAW,qBAAX,CAAkC,CACvDC,MAAM,CAAE,KAD+C,CAEvD5E,IAAI,CAAEmE,SAFiD,CAAlC,CAVpB,QAUGV,QAVH,gBAcGzD,MAdH,CAcUyD,QAAQ,CAACzD,IAdnB,CAeHoD,OAAO,CAACb,GAAR,CAAYvC,MAAZ,EAfG,mFAiBHwD,KAAK,CAAC,aAAMC,QAAN,CAAezD,IAAhB,CAAL,CAjBG,sE,SAqBPgD,W,CAAc,UAAM,IACV8B,CAAAA,cADU,CACS,MAAKnC,KAAL,CAAWC,OADpB,CACVkC,cADU,CAElB,MAAKxB,QAAL,CAAc,CACZnB,UAAU,CAAE,MAAKQ,KAAL,CAAWoC,KAAX,CAAiBC,MAAjB,CAAwBC,aAAxB,GAA0C,MAD1C,CAEZhD,eAAe,CACb6C,cAAc,IAAM,MAAKnC,KAAL,CAAWoC,KAAX,CAAiBC,MAAjB,CAAwBC,aAAxB,GAA0C,MAAhD,CAHJ,CAAd,EAKA7B,OAAO,CAACb,GAAR,CAAYuC,cAAZ,EACD,C,OAID7B,c,sEAAiB,mMACTlB,KADS,CACD,EADC,CAETC,KAFS,CAED,EAFC,CAGTkD,KAHS,CAGD,EAHC,wBAIT9F,CAAAA,EAAE,CAAC+F,GAAH,CAAO9F,SAAP,CAAkB,SAAAA,SAAS,CAAI,CACnC6F,KAAK,CAACE,IAAN,CAAW,CAAC/F,SAAS,CAAC,cAAD,CAAV,CAA4BA,SAAS,CAAC,QAAD,CAArC,CAAX,EACD,CAFK,CAJS,QAOf6F,KAAK,CAACG,OAAN,CAAc,SAAAC,IAAI,CAAI,CACpBvD,KAAK,CAACuD,IAAI,CAAC,CAAD,CAAL,CAAL,CAAiBvD,KAAK,CAACuD,IAAI,CAAC,CAAD,CAAL,CAAL,CAAiBvD,KAAK,CAACuD,IAAI,CAAC,CAAD,CAAL,CAAtB,CAAkC,EAAnD,CACAvD,KAAK,CAACuD,IAAI,CAAC,CAAD,CAAL,CAAL,CAAeF,IAAf,CAAoBE,IAAI,CAAC,CAAD,CAAxB,EACD,CAHD,EAPe,uBAYTlG,CAAAA,EAAE,CAAC+F,GAAH,CAAO7F,SAAP,CAAkB,SAAAiG,QAAQ,CAAI,CAClCvD,KAAK,CAACuD,QAAQ,CAAC,QAAD,CAAT,CAAL,CAA4BhG,sBAAsB,CAChDgG,QADgD,CAEhD,MAAKjE,KAAL,CAAWa,UAFqC,CAAlD,CAID,CALK,CAZS,QAmBTqD,iBAnBS,CAmBWC,cAAc,CAACC,OAAf,CAAuB,UAAvB,CAnBX,CAoBTC,MApBS,CAoBAF,cAAc,CAACC,OAAf,CAAuB,QAAvB,CApBA,CAqBTlE,WArBS,CAqBKgE,iBAAiB,CAAGI,QAAQ,CAACJ,iBAAD,CAAX,CAAiC,CArBvD,CAsBfpC,OAAO,CAACb,GAAR,CAAYf,WAAZ,EACA,MAAK8B,QAAL,CAAc,CACZvB,KAAK,CAALA,KADY,CAEZC,KAAK,CAALA,KAFY,CAGZR,WAAW,CAAXA,WAHY,CAIZE,QAAQ,CAAEF,WAJE,CAKZ;AACAC,QAAQ,CAAEM,KAAK,CAACP,WAAD,CAAL,CAAmB,CAAnB,CANE,CAOZqE,YAAY,CAAE,CAACrE,WAAD,CAPF,CAAd,EAvBe,yD,SAkCjBkC,U,2FAAa,kBAAMoC,SAAN,+LAC8B,MAAKxE,KADnC,CACHU,KADG,cACHA,KADG,CACIR,WADJ,cACIA,WADJ,CACiBC,QADjB,cACiBA,QADjB,kBAGT,MAAK6B,QAAL,CAAc,CAAEyC,WAAW,CAAE,CAAC,MAAKzE,KAAL,CAAWyE,WAA3B,CAAd,EACA;AAJS,uBAKcjG,CAAAA,KAAK,CAAC6E,IAAN,CAAW,qBAAX,CAAkC,CACvDC,MAAM,CAAE,KAD+C,CAEvD5E,IAAI,CAAE8F,SAAS,CAAG9D,KAAK,CAACR,WAAD,CAAR,CAAwBQ,KAAK,CAACP,QAAD,CAFW,CAAlC,CALd,QAKHgC,QALG,gBASHzD,MATG,CASIyD,QAAQ,CAACzD,IATb,CAUToD,OAAO,CAACb,GAAR,CAAYvC,MAAZ,EAVS,qFAYTwD,KAAK,CAAC,aAAMC,QAAN,CAAezD,IAAhB,CAAL,CAZS,QAcX,MAAKsD,QAAL,CAAc,CAAE/B,WAAW,CAAEuE,SAAf,CAAd,EAdW,uE,sEAiBbE,S,CAAY,SAACL,MAAD,CAASnE,WAAT,CAAsBC,QAAtB,CAAgCU,UAAhC,CAA+C,CACzD,GAAI8D,CAAAA,UAAU,CAAG,EAAjB,CACA,OAAQN,MAAR,EACE,IAAK,EAAL,CACEM,UAAU,CAAGA,UAAU,CAACrC,MAAX,CACX,kBADW,CAEXnC,QAFW,CAGX,2BAHW,CAIXD,WAJW,CAKX,YALW,CAMXW,UAAU,CAAG,UAAH,CAAgB,WANf,CAAb,CAQA,MACF,IAAK,EAAL,CACE8D,UAAU,CAAGA,UAAU,CAACrC,MAAX,CACX,kBADW,CAEXnC,QAFW,CAGX,2BAHW,CAIXD,WAJW,CAKX,YALW,CAMXW,UAAU,CAAG,UAAH,CAAgB,WANf,CAAb,CAQA,MACF,IAAK,EAAL,CACE8D,UAAU,CAAGA,UAAU,CAACrC,MAAX,CACX,kBADW,CAEXnC,QAFW,CAGX,0BAHW,CAIXD,WAJW,CAKX,YALW,CAMXW,UAAU,CAAG,UAAH,CAAgB,WANf,CAAb,CAQA,MACF,QACE,MAhCJ,CAkCA,MAAO8D,CAAAA,UAAP,CAED,C,OAKDC,c,2FAAiB,kBAAMP,MAAN,yRAYX,MAAKrE,KAZM,CAEbE,WAFa,cAEbA,WAFa,CAGbC,QAHa,cAGbA,QAHa,CAIbE,WAJa,cAIbA,WAJa,CAKbG,gBALa,cAKbA,gBALa,CAMbF,UANa,cAMbA,UANa,CAObG,KAPa,cAObA,KAPa,CAQbI,UARa,cAQbA,UARa,CASbN,YATa,cASbA,YATa,CAUbH,QAVa,cAUbA,QAVa,CAWba,GAXa,cAWbA,GAXa,CAcX0D,UAdW,CAcE,MAAKD,SAAL,CAAeL,MAAf,CAAuBnE,WAAvB,CAAoCC,QAApC,CAA8CU,UAA9C,CAdF,CAefI,GAAG,CAAC6C,IAAJ,CAASa,UAAT,EAEIE,iBAjBW,CAiBS,KAjBT,CAkBf;AACA,GAAGR,MAAM,GAAK,CAAd,CAAiB,CACf,GAAG5D,KAAK,CAACN,QAAD,CAAL,EAAmB,IAAtB,CAA2B,CACzBD,WAAW,CAAGC,QAAd,CACAA,QAAQ,CAAGM,KAAK,CAACN,QAAD,CAAL,CAAgB,CAAhB,CAAX,CACAI,YAAY,EAAI,CAAhB,CACAF,WAAW,CAAG,CAAC,CAAf,CACAC,UAAU,CAAG,CAAC,CAAd,CACAwB,OAAO,CAACb,GAAR,CAAY,8DAAZ,EACD,CAPD,IAOK,CACH4D,iBAAiB,CAAG,IAApB,CACA/C,OAAO,CAACb,GAAR,CAAY,6DAAZ,EACD,CACF,CACD;AAbA,IAcK,IAAGoD,MAAM,GAAI,CAAb,CAAe,CAClB;AACA,GAAGhE,WAAW,GAAKH,WAAhB,EAA+BI,UAAU,GAAK,CAAjD,CAAmD,CACjDuE,iBAAiB,CAAG,IAApB,CACA/C,OAAO,CAACb,GAAR,CAAY,kEAAZ,EACD,CAHD,IAGM,IAAGZ,WAAW,GAAKH,WAAhB,EAA+BI,UAAU,GAAK,CAAjD,CAAmD,CACvD;AACAJ,WAAW,CAAGC,QAAd,CACAA,QAAQ,CAAGM,KAAK,CAACN,QAAD,CAAL,CAAgB,CAAhB,CAAX,CACAI,YAAY,EAAI,CAAhB,CACAF,WAAW,CAAG,CAAC,CAAf,CACAC,UAAU,CAAG,CAAC,CAAd,CACAwB,OAAO,CAACb,GAAR,CAAY,+FAAZ,EACD,CARK,IAQD,CACH;AACAd,QAAQ,CAAGM,KAAK,CAACP,WAAD,CAAL,CAAmB,CAAnB,CAAX,CACAG,WAAW,CAAGH,WAAd,CACAI,UAAU,CAAG+D,MAAb,CACAvC,OAAO,CAACb,GAAR,CAAY,8DAAZ,EACD,CACF,CApBI,IAoBA,CACH;AACA,GAAGZ,WAAW,GAAKH,WAAnB,CAAgC,CAC9B2E,iBAAiB,CAAG,IAApB,CACA/C,OAAO,CAACb,GAAR,CAAY,sEAAZ,EACD,CAHD,IAGK,CACH;AACAd,QAAQ,CAAGM,KAAK,CAACP,WAAD,CAAL,CAAmB,CAAnB,CAAX,CACA4B,OAAO,CAACb,GAAR,CAAY,4DAAZ,EACD,CACF,CAED;AACA;AAlEe,IAmEZ4D,iBAnEY,gCAoEVrE,gBAAgB,GAAK,CApEX,4BAqEXsB,OAAO,CAACb,GAAR,CAAY,gDAAZ,EACA,MAAKe,QAAL,CAAc,CACZpB,SAAS,CAAE,IADC,CAEZK,GAAG,CAAHA,GAFY,CAAd,EAtEW,wBAyEH,OAAKsC,IAAL,EAzEG,mDA4EX;AACAzB,OAAO,CAACb,GAAR,CAAY,qCAAZ,EACAV,YAAY,EAAIrC,SAAhB,CACA;AACAgC,WAAW,CAAGK,YAAY,CAAG,CAAf,CAAmBH,QAAnB,CAA6B,CAAEqC,IAAI,CAACqC,GAAL,CAAS,CAAT,CAAYvE,YAAY,CAAC,CAAzB,EAA8B,CAAhC,EAAsC,CAAtC,CAA2CkC,IAAI,CAACqC,GAAL,CAAS,CAAT,CAAYvE,YAAY,CAAC,CAAzB,GAA+BH,QAAQ,CAAE,CAAzC,CAA3C,CAAyF,CAApI,CACAD,QAAQ,CAAGM,KAAK,CAACP,WAAD,CAAL,CAAmB,CAAnB,CAAX,CACAG,WAAW,CAAG,CAAC,CAAf,CACAC,UAAU,CAAG,CAAC,CAAd,CACAC,YAAY,CAAGA,YAAY,CAAG,CAAf,CAAmB,CAAnB,CAAuBA,YAAtC,CACAC,gBAAgB,GArFL,QAwFfsB,OAAO,CAACb,GAAR,CAAY,iBAAZ,CAA8Bf,WAA9B,CAA2C,cAA3C,CAA2DC,QAA3D,EAxFe,wBAyFT,OAAK8B,QAAL,EAzFS,SA0Fb,MAAKD,QAAL,CACE,CACE9B,WAAW,CAAXA,WADF,CAEEC,QAAQ,CAARA,QAFF,CAGEI,YAAY,CAAZA,YAHF,CAIEC,gBAAgB,CAAhBA,gBAJF,CAKEF,UAAU,CAAVA,UALF,CAMED,WAAW,CAAXA,WANF,CAOEY,GAAG,CAAHA,GAPF,CADF,CAUE,iBAAM,OAAKmB,UAAL,CAAgB,IAAhB,CAAN,EAVF,EA1Fa,yD,uEAwGjB2C,Q,sEAAW,0RAC+B,MAAK1D,KAAL,CAAWC,OAD1C,CACD0D,UADC,qBACDA,UADC,CACWC,IADX,qBACWA,IADX,CACiBC,SADjB,qBACiBA,SADjB,cAQL,MAAKlF,KARA,CAGPU,KAHO,cAGPA,KAHO,CAIPG,UAJO,cAIPA,UAJO,CAKPX,WALO,cAKPA,WALO,CAMPe,GANO,cAMPA,GANO,CAOPN,eAPO,cAOPA,eAPO,MASLuE,SAAS,GAAK,YATT,wFAaFvE,eAbE,kDAcCnC,CAAAA,KAAK,CAAC6E,IAAN,CAAW,sBAAX,CAAmC,CACvC8B,UAAU,CAAEF,IAD2B,CAEvCG,MAAM,CAAE,CACNC,UAAU,CAAE,CACVC,KAAK,CAAE,GAAIC,CAAAA,IAAJ,GAAWC,cAAX,EADG,CAEVvE,GAAG,CAAHA,GAFU,CADN,CAF+B,CAQvCwE,IAAI,CAAE,gBARiC,CASvCC,SAAS,CAAE,IAT4B,CAAnC,CAdD,QAyBLvB,cAAc,CAACwB,OAAf,CAAuB,gBAAvB,CAAyC,IAAzC,EACAX,UAAU,GACJY,aA3BD,CA2BiBzB,cAAc,CAACC,OAAf,CAAuB,eAAvB,CA3BjB,yBA4BC5F,CAAAA,KAAK,CAAC6E,IAAN,CAAW,gCAAX,CAA6C,CACjD8B,UAAU,CAAEF,IADqC,CAEjDY,UAAU,CAAEC,IAAI,CAACC,SAAL,CAAe,CACzBjD,IAAI,CACFjC,UAAU,GAAK,IAAf,CACIH,KAAK,CAACR,WAAD,CAAL,CAAmB,MAAnB,CADJ,CAEI0F,aAJmB,CAKzBxC,KAAK,CACHvC,UAAU,GAAK,KAAf,CACIH,KAAK,CAACR,WAAD,CAAL,CAAmB,OAAnB,CADJ,CAEI0F,aARmB,CAAf,CAFqC,CAA7C,CA5BD,iEA0CCpH,CAAAA,KAAK,CAAC6E,IAAN,CAAW,sBAAX,CAAmC,CACvC8B,UAAU,CAAEF,IAD2B,CAEvCG,MAAM,CAAE,CACNC,UAAU,CAAE,CACVC,KAAK,CAAE,GAAIC,CAAAA,IAAJ,GAAWC,cAAX,EADG,CAEVvE,GAAG,CAAHA,GAFU,CADN,CAF+B,CAQvCwE,IAAI,CAAE,gBARiC,CASvCC,SAAS,CAAE,KAT4B,CAAnC,CA1CD,SAqDLvB,cAAc,CAACwB,OAAf,CACE,eADF,CAEE9E,UAAU,GAAK,IAAf,CACIH,KAAK,CAACR,WAAD,CAAL,CAAmB,MAAnB,CADJ,CAEIQ,KAAK,CAACR,WAAD,CAAL,CAAmB,OAAnB,CAJN,EArDK,6FA6DPgC,KAAK,CAAC,aAAM8D,OAAP,CAAL,CACAlE,OAAO,CAACb,GAAR,eA9DO,QAiET;AACA,MAAKe,QAAL,CAAc,CACZ9B,WAAW,CAAE,CADD,CAEZC,QAAQ,CAAE,CAFE,CAGZC,QAAQ,CAAE,CAHE,CAIZ6F,cAAc,CAAE,EAJJ,CAKZ1F,YAAY,CAAC,CALD,CAMZC,gBAAgB,CAAE,CANN,CAAd,EAlES,uE,mFA4EF,iCAC6B,KAAKa,KADlC,CACC6E,OADD,aACCA,OADD,CACUC,cADV,aACUA,cADV,kBAUH,KAAKnG,KAVF,CAGLC,WAHK,cAGLA,WAHK,CAILU,eAJK,cAILA,eAJK,CAKLC,SALK,cAKLA,SALK,CAMLC,UANK,cAMLA,UANK,CAOLX,WAPK,cAOLA,WAPK,CAQLC,QARK,cAQLA,QARK,CASLY,WATK,cASLA,WATK,CAYP,mBACE,oBAAC,KAAD,EAAO,SAAS,CAAEmF,OAAO,CAAClH,KAA1B,eACE,oBAAC,IAAD,EAAM,SAAS,KAAf,CAAgB,OAAO,CAAE,CAAzB,eACE,oBAAC,IAAD,EAAM,IAAI,KAAV,CAAW,EAAE,CAAE,EAAf,CAAmB,SAAS,CAAEkH,OAAO,CAAC5G,IAAtC,cACYuB,UAAU,CAAG,MAAH,CAAY,OADlC,SADF,cAIE,oBAAC,IAAD,EAAM,IAAI,KAAV,CAAW,EAAE,CAAE,EAAf,CAAmB,SAAS,CAAEqF,OAAO,CAAC5G,IAAtC,8CAJF,cAOG,oBAAC,KAAD,EAAO,QAAQ,CAAEyB,WAAjB,EAPH,cAQE,oBAAC,IAAD,EACE,SAAS,KADX,CAEE,SAAS,CAAC,KAFZ,CAGE,OAAO,CAAC,cAHV,CAIE,UAAU,CAAC,QAJb,eAME,oBAAC,WAAD,EACE,IAAI,CAAC,OADP,CAEE,KAAK,CAAC,SAFR,CAGE,aAAW,qCAHb,eAKE,oBAAC,MAAD,EACE,SAAS,CAAEmF,OAAO,CAACvG,WADrB,CAEE,OAAO,CAAE,CAACM,WAAD,CAAe,UAAf,CAA4B,WAFvC,CAGE,SAAS,cAAE,oBAAC,qBAAD,MAHb,CAIE,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACmC,UAAL,CAAgB,IAAhB,CAAN,EAJX,YALF,cAaE,oBAAC,MAAD,EACE,SAAS,CAAE8D,OAAO,CAACvG,WADrB,CAEE,OAAO,CAAEM,WAAW,CAAG,UAAH,CAAgB,WAFtC,CAGE,SAAS,cAAE,oBAAC,qBAAD,MAHb,CAIE,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACmC,UAAL,CAAgB,KAAhB,CAAN,EAJX,SAbF,CANF,CARF,CAqCG,CAACxB,SAAD,CACC,cACE,oBAAC,IAAD,EACE,SAAS,KADX,CAEE,SAAS,CAAC,QAFZ,CAGE,OAAO,CAAC,UAHV,CAIE,UAAU,CAAC,QAJb,CAKE,GAAG,CAAC,SALN,eAOE,oBAAC,MAAD,EACE,SAAS,CAAEsF,OAAO,CAAChH,MADrB,CAEE,OAAO,CAAC,UAFV,CAGE,KAAK,CAAC,SAHR,CAIE,OAAO,CAAE,yBAAM,CAAA,MAAI,CAAC0F,cAAL,CAAoB,CAApB,CAAN,EAJX,+BAPF,cAeE,oBAAC,MAAD,EACE,SAAS,CAAEsB,OAAO,CAAChH,MADrB,CAEE,OAAO,CAAC,UAFV,CAGE,KAAK,CAAC,SAHR,CAIE,OAAO,CAAE,yBAAM,CAAA,MAAI,CAAC0F,cAAL,CAAoB,CAApB,CAAN,EAJX,+BAfF,cAuBE,oBAAC,MAAD,EACE,SAAS,CAAEsB,OAAO,CAAChH,MADrB,CAEE,OAAO,CAAC,UAFV,CAGE,KAAK,CAAC,SAHR,CAIE,OAAO,CAAE,yBAAM,CAAA,MAAI,CAAC0F,cAAL,CAAoB,CAApB,CAAN,EAJX,8BAvBF,CADF,CAiCEuB,cAAc,cACZ,oBAAC,IAAD,EACE,SAAS,KADX,CAEE,SAAS,CAAC,KAFZ,CAGE,OAAO,CAAC,QAHV,CAIE,GAAG,CAAC,cAJN,eAME,oBAAC,SAAD,EACE,SAAS,CAAED,OAAO,CAACvG,WADrB,CAEE,OAAO,CAAC,UAFV,CAGE,KAAK,CAAE,QAAQ2C,MAAR,CAAepC,WAAf,CAHT,CAIE,UAAU,CAAE,CACVkG,KAAK,CAAE,CAAEC,SAAS,CAAE,QAAb,CADG,CAJd,CAOE,QAAQ,CAAE,IAPZ,EANF,cAeE,oBAAC,SAAD,EACE,SAAS,CAAEH,OAAO,CAACvG,WADrB,CAEE,OAAO,CAAC,UAFV,CAGE,KAAK,CAAE,QAAQ2C,MAAR,CAAenC,QAAf,CAHT,CAIE,UAAU,CAAE,CACViG,KAAK,CAAE,CAAEC,SAAS,CAAE,QAAb,CADG,CAJd,CAOE,QAAQ,CAAE,IAPZ,EAfF,CADY,CA0BV,IA3DN,CADD,cA+DC,oBAAC,IAAD,EACE,SAAS,KADX,CAEE,SAAS,CAAC,QAFZ,CAGE,OAAO,CAAC,UAHV,CAIE,UAAU,CAAC,QAJb,EAMG1F,eAAe,2BACOE,UAAU,CAAG,MAAH,CAAY,OAD7B,UAEZ,iDARN,CASGF,eAAe,EAAI,CAACwF,cAApB,cACC,oBAAC,MAAD,EACE,SAAS,CAAED,OAAO,CAAChH,MADrB,CAEE,OAAO,CAAC,UAFV,CAGE,KAAK,CAAC,SAHR,CAIE,OAAO,CAAE,KAAK6F,QAJhB,CAKE,SAAS,CAAEzG,IALb,CAME,EAAE,CAAC,6BANL,4BADD,cAYC,oBAAC,MAAD,EACE,SAAS,CAAE4H,OAAO,CAAChH,MADrB,CAEE,OAAO,CAAC,UAFV,CAGE,KAAK,CAAC,SAHR,CAIE,OAAO,CAAE,KAAK6F,QAJhB,CAKE,SAAS,CAAEzG,IALb,CAME,EAAE,CAAC,iBANL,sBArBJ,CApGJ,CADF,CADF,CA2ID,C,4BAniB0Bf,S,EA0iB7B,cAAec,CAAAA,OAAO,CACpBF,YADoB,CAEpBC,UAFoB,CAGpBZ,UAAU,CAACoB,MAAD,CAHU,CAAP,CAIbmB,cAJa,CAAf","sourcesContent":["import React, { Component } from \"react\";\nimport { withStyles } from \"@material-ui/styles\";\nimport Paper from \"@material-ui/core/Paper\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Button from \"@material-ui/core/Button\";\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\nimport PlayCircleOutlineIcon from \"@material-ui/icons/PlayCircleOutline\";\nimport * as d3 from \"d3\";\nimport treeGraph from \"utils/BST/treeGraph.csv\";\nimport treeNodes from \"utils/BST/treeNodes.csv\";\nimport { parseTreeNodeSingleEar, NUM_LEVEL } from \"utils/BST/BSTUtil\";\nimport withUserAuth from \"context/withUserAuth\";\nimport { withRouter } from \"react-router-dom\";\nimport { compose } from \"recompose\";\nimport { Link } from \"react-router-dom\";\nimport PropTypes from \"prop-types\";\nimport { TextField } from \"@material-ui/core\";\nimport { axios } from 'utils/utils';\n\nimport Timer from \"components/Timer.jsx\";\nimport data from \"./test.json\";\nimport images from \"utils/images/hearingLossDemo\";\n\nconst styles = theme => ({\n  root: {\n    flexGrow: 1\n  },\n  paper: {\n    minHeight: \"90vh\"\n  },\n  button: {\n    minWidth: 250,\n    height: 50,\n    margin: 10\n  },\n  grid: {\n    marginLeft: 10,\n    fontSize: 16\n  },\n  margin: {\n    margin: 10\n  },\n  extendedIcon: {\n    marginRight: 8\n  },\n  buttonGroup: {\n    width: \"40vw\",\n    height: 100,\n    marginTop: 30,\n    marginBottom: 30\n  }\n});\n\n//TODO:\n//1. compare with left and right root node wheh reaching the root node after going n levels up\n//2. read the csv file based on the option \nclass AssessmentPage extends Component {\n  state = {\n    playCurrent: true,\n    currentNode: 1,\n    nextNode: 2,\n    rootNode: 1,\n    prevVisited: 0,\n    prevOption:0,\n    currentDepth:0,\n    //iterate for five times after reaching the leaf node\n    currentIteration: 1,\n    graph: {},\n    nodes: {},\n    firstTimeAccess: true,\n    completed: false,\n    currentEar: true,\n    audioConfig: {},\n    currentFile: data,\n    audioPath: \"\",\n    log: [],\n    numQuestion: 1\n  };\n\n  componentDidMount = async () => {\n    const { graph } = this.state;\n    const { assessmentDone } = this.props.context;\n    if (Object.keys(graph).length === 0 && assessmentDone !== true) {\n      await this.getWorseEar();\n      await this.constructGraph();\n      try {\n        const configResponse = await axios.get(\n          \"/api/researcher/userAssessmentConfig\"\n        );\n        const audioConfig = configResponse.data;\n        console.log(audioConfig);  \n        const pathResponse = await axios.get(\"/api/researcher/audioPath\");\n        let audioPath = pathResponse.data;\n        this.setState({ audioConfig, audioPath }, async () => {\n          await this.playFile();\n        });\n      } catch (error) {\n        alert(error.response.data);\n      }\n      this.handlePlay(true);\n    }\n  };\n\n  getFilePath = () => {\n    const { audioConfig, audioPath, currentEar } = this.state;\n    return audioPath.concat(\n      this.getRandom(audioConfig[currentEar ? \"left\" : \"right\"])\n    );\n  };\n\n  getRandom = filenames => {\n    return filenames[Math.floor(Math.random() * filenames.length)];\n  };\n\n  playFile = async () => {\n    const filePath = this.getFilePath();\n    console.log(filePath);\n    const dataInput = {\n      left: {\n        audio_filename: filePath,\n        audio_reset: 1,\n        audio_repeat: 1,\n        audio_play: 1,\n        alpha: 1.0\n      },\n      right: {\n        audio_filename: filePath,\n        audio_reset: 1,\n        audio_repeat: 1,\n        audio_play: 1,\n        alpha: 1.0\n      }\n    };\n    try {\n      const response = await axios.post(\"/api/param/setparam\", {\n        method: \"set\",\n        data: dataInput\n      });\n      const data = response.data;\n      console.log(data);\n    } catch (error) {\n      alert(error.response.data);\n    }\n  };\n\n  mute = async () => {\n    const dataInput = {\n      left: {\n        alpha: 0.0\n      },\n      right: {\n        alpha: 0.0\n      }\n    };\n    try {\n      const response = await axios.post(\"/api/param/setparam\", {\n        method: \"set\",\n        data: dataInput\n      });\n      const data = response.data;\n      console.log(data);\n    } catch (error) {\n      alert(error.response.data);\n    }\n  };\n\n  getWorseEar = () => {\n    const { leftEarIsWorse } = this.props.context;\n    this.setState({\n      currentEar: this.props.match.params.currentIsLeft === \"true\",\n      firstTimeAccess:\n        leftEarIsWorse === (this.props.match.params.currentIsLeft === \"true\")\n    });\n    console.log(leftEarIsWorse);\n  };\n\n  // TODO: read csv file based on the option setting\n  // Construct the BST graph\n  constructGraph = async () => {\n    const graph = {};\n    const nodes = {};\n    const edges = [];\n    await d3.csv(treeGraph, treeGraph => {\n      edges.push([treeGraph[\"ParentNodeNo\"], treeGraph[\"NodeNo\"]]);\n    });\n    edges.forEach(edge => {\n      graph[edge[0]] = graph[edge[0]] ? graph[edge[0]] : [];\n      graph[edge[0]].push(edge[1]);\n    });\n\n    await d3.csv(treeNodes, treeNode => {\n      nodes[treeNode[\"NodeNo\"]] = parseTreeNodeSingleEar(\n        treeNode,\n        this.state.currentEar\n      );\n    });\n\n    const currentNodeString = sessionStorage.getItem(\"rootNode\");\n    const option = sessionStorage.getItem(\"option\");\n    const currentNode = currentNodeString ? parseInt(currentNodeString) : 1;\n    console.log(currentNode);\n    this.setState({\n      graph,\n      nodes,\n      currentNode,\n      rootNode: currentNode,\n      // Next node is the left child\n      nextNode: graph[currentNode][0],\n      currentQueue: [currentNode]\n    });\n  };\n\n  handlePlay = async isCurrent => {\n    const { nodes, currentNode, nextNode } = this.state;\n    try {\n      this.setState({ showMessage: !this.state.showMessage });\n      //console.log('I am huge')//this.state.showMessage);\n      const response = await axios.post(\"/api/param/setparam\", {\n        method: \"set\",\n        data: isCurrent ? nodes[currentNode] : nodes[nextNode]\n      });\n      const data = response.data;\n      console.log(data);\n    } catch (error) {\n      alert(error.response.data);\n    }\n    this.setState({ playCurrent: isCurrent });\n  };\n\n  handleLog = (option, currentNode, nextNode, currentEar) => {\n    let currentLog = \"\";\n    switch (option) {\n      case 0:\n        currentLog = currentLog.concat(\n          \"User thinks NEW(\",\n          nextNode,\n          \") is better than CURRENT(\",\n          currentNode,\n          \") for the \",\n          currentEar ? \"LEFT ear\" : \"RIGHT ear\"\n        );\n        break;\n      case 1:\n        currentLog = currentLog.concat(\n          \"User thinks NEW(\",\n          nextNode,\n          \") is the same as CURRENT(\",\n          currentNode,\n          \") for the \",\n          currentEar ? \"LEFT ear\" : \"RIGHT ear\"\n        );\n        break;\n      case 2:\n        currentLog = currentLog.concat(\n          \"User thinks NEW(\",\n          nextNode,\n          \") is worse than CURRENT(\",\n          currentNode,\n          \") for the \",\n          currentEar ? \"LEFT ear\" : \"RIGHT ear\"\n        );\n        break;\n      default:\n        break;\n    }\n    return currentLog;\n\n  }\n\n  // Option: 0, Next is better than parent\n  // Option: 1, Parent is the same with next\n  // Option 2: Parent is better then next\n  handleContinue = async option => {\n    let {\n      currentNode,\n      nextNode,\n      prevVisited,\n      currentIteration,\n      prevOption,\n      graph,\n      currentEar,\n      currentDepth,\n      rootNode,\n      log,\n    } = this.state;\n\n    let currentLog = this.handleLog(option, currentNode, nextNode, currentEar);\n    log.push(currentLog);\n\n    let reachTerminalNode = false;\n    // Next is better than parent node, continue on next node if it is not leaf\n    if(option === 0 ){\n      if(graph[nextNode] != null){\n        currentNode = nextNode;\n        nextNode = graph[nextNode][0];\n        currentDepth += 1;\n        prevVisited = -1;\n        prevOption = -1;\n        console.log('Next node is better than the parent, next node is new parent');\n      }else{\n        reachTerminalNode = true;\n        console.log('Next node is better than the parent, next node is leaf node');\n      }\n    }\n    // Parent is the same with the next node\n    else if(option ===1){\n      // Current next node is right child, parent is same with both left and right child, terminal point\n      if(prevVisited === currentNode && prevOption === 1){\n        reachTerminalNode = true;\n        console.log('Parent is same as the left child and right child, terminal point');\n      }else if(prevVisited === currentNode && prevOption === 2){\n        // Current next node is right child, parent is better than left the same with right child, continue with right child\n        currentNode = nextNode;\n        nextNode = graph[nextNode][0];\n        currentDepth += 1;\n        prevVisited = -1;\n        prevOption = -1;\n        console.log('Parent is better than left child and the same with right child, right child is the new parent');\n      }else{\n        // Current next node is left child, parent is same with left child, compare with the right child \n        nextNode = graph[currentNode][1];\n        prevVisited = currentNode;\n        prevOption = option;\n        console.log('Parent is same with the left child, right child is next node');\n      }\n    }else{\n      // Current next node is right child, parent is better then right child, reach the terminal \n      if(prevVisited === currentNode ){\n        reachTerminalNode = true;\n        console.log('Parent is better than/same with right and left child, ternimal point');\n      }else{\n        // Current next node is left child, parent is better then left child, compare with the right child is not leaf\n        nextNode = graph[currentNode][1];\n        console.log('Parent is better than left child, right child is next node');\n      }\n    }\n\n    // Reach terminal node, go n levels up and continue with for different stimuli\n    //TODO: compare with other root nodes when reach root after going n levels up\n    if(reachTerminalNode){\n      if(currentIteration === 5){\n        console.log('Reach terminal node, finish 5 iterations, done');\n        this.setState({ \n          completed: true,\n          log });\n          await this.mute();\n        return;\n      }else{\n        // Get current node level\n        console.log('Reach terminal node, go N levels up');\n        currentDepth -= NUM_LEVEL;\n        // after going n levels up, reach the root node, compare with other rootnode\n        currentNode = currentDepth < 0 ? rootNode: ( Math.pow(2, currentDepth+1) - 1 ) * 5 +  Math.pow(2, currentDepth+1) * (rootNode -1) + 1;\n        nextNode = graph[currentNode][0];\n        prevVisited = -1;\n        prevOption = -1;\n        currentDepth = currentDepth < 0 ? 0 : currentDepth;\n        currentIteration++;\n      }\n    }\n    console.log(\"NewCurrentNode:\",currentNode, \"NewNextNode:\", nextNode);\n    await this.playFile();\n      this.setState(\n        {\n          currentNode,\n          nextNode,\n          currentDepth,\n          currentIteration,\n          prevOption,\n          prevVisited,\n          log\n        },\n        () => this.handlePlay(true)\n      );\n  };\n\n  onSubmit = async () => {\n    const { updateUser, user, loginMode } = this.props.context;\n    const {\n      nodes,\n      currentEar,\n      currentNode,\n      log,\n      firstTimeAccess\n    } = this.state;\n    if (loginMode === \"researcher\") {\n      return;\n    }\n    try {\n      if (!firstTimeAccess) {\n        await axios.post(\"/api/listener/addLog\", {\n          listenerID: user,\n          newLog: {\n            assessment: {\n              logOn: new Date().toLocaleString(),\n              log\n            }\n          },\n          flag: \"assessmentDone\",\n          flagValue: true\n        });\n        sessionStorage.setItem(\"assessmentDone\", true);\n        updateUser();\n        const tmpParameters = sessionStorage.getItem(\"tmpParameters\");\n        await axios.post(\"/api/listener/updateParameters\", {\n          listenerID: user,\n          parameters: JSON.stringify({\n            left:\n              currentEar === true\n                ? nodes[currentNode][\"left\"]\n                : tmpParameters,\n            right:\n              currentEar === false\n                ? nodes[currentNode][\"right\"]\n                : tmpParameters\n          })\n        });\n      } else {\n        await axios.post(\"/api/listener/addLog\", {\n          listenerID: user,\n          newLog: {\n            assessment: {\n              logOn: new Date().toLocaleString(),\n              log\n            }\n          },\n          flag: \"assessmentDone\",\n          flagValue: false\n        });\n        sessionStorage.setItem(\n          \"tmpParameters\",\n          currentEar === true\n            ? nodes[currentNode][\"left\"]\n            : nodes[currentNode][\"right\"]\n        );\n      }\n    } catch (error) {\n      alert(error.message);\n      console.log(error);\n    }\n\n    // Reset state for the new ear\n    this.setState({\n      currentNode: 1,\n      nextNode: 2,\n      rootNode: 1,\n      currentVisited: [],\n      currentDepth:0,\n      currentIteration: 1,\n    })\n  };\n\n  render() {\n    const { classes, showNodeNumber } = this.props;\n    const {\n      playCurrent,\n      firstTimeAccess,\n      completed,\n      currentEar,\n      currentNode,\n      nextNode,\n      currentFile,\n    } = this.state;\n\n    return (\n      <Paper className={classes.paper}>\n        <Grid container spacing={1}>\n          <Grid item xs={12} className={classes.grid}>\n            Use your {currentEar ? \"LEFT\" : \"RIGHT\"} ear:\n          </Grid>\n          <Grid item xs={12} className={classes.grid}>\n            Please click the one you think is better:\n          </Grid>\n          {<Timer filename={currentFile} />}\n          <Grid\n            container\n            direction=\"row\"\n            justify=\"space-around\"\n            alignItems=\"center\"\n          >\n            <ButtonGroup\n              size=\"large\"\n              color=\"primary\"\n              aria-label=\"large outlined primary button group\"\n            >\n              <Button\n                className={classes.buttonGroup}\n                variant={!playCurrent ? \"outlined\" : \"contained\"}\n                startIcon={<PlayCircleOutlineIcon />}\n                onClick={() => this.handlePlay(true)}\n              >\n                Current\n              </Button>\n              <Button\n                className={classes.buttonGroup}\n                variant={playCurrent ? \"outlined\" : \"contained\"}\n                startIcon={<PlayCircleOutlineIcon />}\n                onClick={() => this.handlePlay(false)}\n              >\n                Next\n              </Button>\n            </ButtonGroup>\n          </Grid>\n          {!completed ? (\n            [\n              <Grid\n                container\n                direction=\"column\"\n                justify=\"flex-end\"\n                alignItems=\"center\"\n                key=\"options\"\n              >\n                <Button\n                  className={classes.button}\n                  variant=\"outlined\"\n                  color=\"primary\"\n                  onClick={() => this.handleContinue(0)}\n                >\n                  New is Better than Current\n                </Button>\n                <Button\n                  className={classes.button}\n                  variant=\"outlined\"\n                  color=\"primary\"\n                  onClick={() => this.handleContinue(1)}\n                >\n                  New is the Same as Current\n                </Button>\n                <Button\n                  className={classes.button}\n                  variant=\"outlined\"\n                  color=\"primary\"\n                  onClick={() => this.handleContinue(2)}\n                >\n                  New is Worse than Current\n                </Button>\n              </Grid>,\n              showNodeNumber ? (\n                <Grid\n                  container\n                  direction=\"row\"\n                  justify=\"center\"\n                  key=\"node_helpers\"\n                >\n                  <TextField\n                    className={classes.buttonGroup}\n                    variant=\"outlined\"\n                    value={\"Node \".concat(currentNode)}\n                    inputProps={{\n                      style: { textAlign: \"center\" }\n                    }}\n                    disabled={true}\n                  />\n                  <TextField\n                    className={classes.buttonGroup}\n                    variant=\"outlined\"\n                    value={\"Node \".concat(nextNode)}\n                    inputProps={{\n                      style: { textAlign: \"center\" }\n                    }}\n                    disabled={true}\n                  />\n                </Grid>\n              ) : null\n            ]\n          ) : (\n            <Grid\n              container\n              direction=\"column\"\n              justify=\"flex-end\"\n              alignItems=\"center\"\n            >\n              {firstTimeAccess\n                ? `You've finished ${currentEar ? \"LEFT\" : \"RIGHT\"} ear.`\n                : \"Congrats!! You've finished the user assessment!\"}\n              {firstTimeAccess && !showNodeNumber ? (\n                <Button\n                  className={classes.button}\n                  variant=\"outlined\"\n                  color=\"primary\"\n                  onClick={this.onSubmit}\n                  component={Link}\n                  to=\"/assessmentpageSetup/second\"\n                >\n                  Proceed to the next ear\n                </Button>\n              ) : (\n                <Button\n                  className={classes.button}\n                  variant=\"outlined\"\n                  color=\"primary\"\n                  onClick={this.onSubmit}\n                  component={Link}\n                  to=\"/researcherpage\"\n                >\n                  Back to main menu\n                </Button>\n              )}\n            </Grid>\n          )}\n        </Grid>\n      </Paper>\n    );\n  }\n}\n\nAssessmentPage.propTypes = {\n  showNodeNumber: PropTypes.bool.isRequired\n};\n\nexport default compose(\n  withUserAuth,\n  withRouter,\n  withStyles(styles)\n)(AssessmentPage);\n"]},"metadata":{},"sourceType":"module"}