{"ast":null,"code":"import _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n/* eslint react/sort-comp:0 */\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport ReactDOM from 'react-dom';\nimport classNames from 'classnames';\nimport getUid from './uid';\nimport warning from 'warning';\nvar IFRAME_STYLE = {\n  position: 'absolute',\n  top: 0,\n  opacity: 0,\n  filter: 'alpha(opacity=0)',\n  left: 0,\n  zIndex: 9999\n}; // diferent from AjaxUpload, can only upload on at one time, serial seriously\n\nvar IframeUploader = function (_Component) {\n  _inherits(IframeUploader, _Component);\n\n  function IframeUploader() {\n    var _ref;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, IframeUploader);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = IframeUploader.__proto__ || Object.getPrototypeOf(IframeUploader)).call.apply(_ref, [this].concat(args))), _this), _this.state = {\n      uploading: false\n    }, _this.file = {}, _this.onLoad = function () {\n      if (!_this.state.uploading) {\n        return;\n      }\n\n      var _this2 = _this,\n          props = _this2.props,\n          file = _this2.file;\n      var response = void 0;\n\n      try {\n        var doc = _this.getIframeDocument();\n\n        var script = doc.getElementsByTagName('script')[0];\n\n        if (script && script.parentNode === doc.body) {\n          doc.body.removeChild(script);\n        }\n\n        response = doc.body.innerHTML;\n        props.onSuccess(response, file);\n      } catch (err) {\n        warning(false, 'cross domain error for Upload. Maybe server should return document.domain script. see Note from https://github.com/react-component/upload');\n        response = 'cross-domain';\n        props.onError(err, null, file);\n      }\n\n      _this.endUpload();\n    }, _this.onChange = function () {\n      var target = _this.getFormInputNode(); // ie8/9 don't support FileList Object\n      // http://stackoverflow.com/questions/12830058/ie8-input-type-file-get-files\n\n\n      var file = _this.file = {\n        uid: getUid(),\n        name: target.value && target.value.substring(target.value.lastIndexOf('\\\\') + 1, target.value.length)\n      };\n\n      _this.startUpload();\n\n      var _this3 = _this,\n          props = _this3.props;\n\n      if (!props.beforeUpload) {\n        return _this.post(file);\n      }\n\n      var before = props.beforeUpload(file);\n\n      if (before && before.then) {\n        before.then(function () {\n          _this.post(file);\n        }, function () {\n          _this.endUpload();\n        });\n      } else if (before !== false) {\n        _this.post(file);\n      } else {\n        _this.endUpload();\n      }\n    }, _this.saveIframe = function (node) {\n      _this.iframe = node;\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(IframeUploader, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.updateIframeWH();\n      this.initIframe();\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate() {\n      this.updateIframeWH();\n    }\n  }, {\n    key: 'getIframeNode',\n    value: function getIframeNode() {\n      return this.iframe;\n    }\n  }, {\n    key: 'getIframeDocument',\n    value: function getIframeDocument() {\n      return this.getIframeNode().contentDocument;\n    }\n  }, {\n    key: 'getFormNode',\n    value: function getFormNode() {\n      return this.getIframeDocument().getElementById('form');\n    }\n  }, {\n    key: 'getFormInputNode',\n    value: function getFormInputNode() {\n      return this.getIframeDocument().getElementById('input');\n    }\n  }, {\n    key: 'getFormDataNode',\n    value: function getFormDataNode() {\n      return this.getIframeDocument().getElementById('data');\n    }\n  }, {\n    key: 'getFileForMultiple',\n    value: function getFileForMultiple(file) {\n      return this.props.multiple ? [file] : file;\n    }\n  }, {\n    key: 'getIframeHTML',\n    value: function getIframeHTML(domain) {\n      var domainScript = '';\n      var domainInput = '';\n\n      if (domain) {\n        var script = 'script';\n        domainScript = '<' + script + '>document.domain=\"' + domain + '\";</' + script + '>';\n        domainInput = '<input name=\"_documentDomain\" value=\"' + domain + '\" />';\n      }\n\n      return '\\n    <!DOCTYPE html>\\n    <html>\\n    <head>\\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\\n    <style>\\n    body,html {padding:0;margin:0;border:0;overflow:hidden;}\\n    </style>\\n    ' + domainScript + '\\n    </head>\\n    <body>\\n    <form method=\"post\"\\n    encType=\"multipart/form-data\"\\n    action=\"\" id=\"form\"\\n    style=\"display:block;height:9999px;position:relative;overflow:hidden;\">\\n    <input id=\"input\" type=\"file\"\\n     name=\"' + this.props.name + '\"\\n     style=\"position:absolute;top:0;right:0;height:9999px;font-size:9999px;cursor:pointer;\"/>\\n    ' + domainInput + '\\n    <span id=\"data\"></span>\\n    </form>\\n    </body>\\n    </html>\\n    ';\n    }\n  }, {\n    key: 'initIframeSrc',\n    value: function initIframeSrc() {\n      if (this.domain) {\n        this.getIframeNode().src = 'javascript:void((function(){\\n        var d = document;\\n        d.open();\\n        d.domain=\\'' + this.domain + '\\';\\n        d.write(\\'\\');\\n        d.close();\\n      })())';\n      }\n    }\n  }, {\n    key: 'initIframe',\n    value: function initIframe() {\n      var iframeNode = this.getIframeNode();\n      var win = iframeNode.contentWindow;\n      var doc = void 0;\n      this.domain = this.domain || '';\n      this.initIframeSrc();\n\n      try {\n        doc = win.document;\n      } catch (e) {\n        this.domain = document.domain;\n        this.initIframeSrc();\n        win = iframeNode.contentWindow;\n        doc = win.document;\n      }\n\n      doc.open('text/html', 'replace');\n      doc.write(this.getIframeHTML(this.domain));\n      doc.close();\n      this.getFormInputNode().onchange = this.onChange;\n    }\n  }, {\n    key: 'endUpload',\n    value: function endUpload() {\n      if (this.state.uploading) {\n        this.file = {}; // hack avoid batch\n\n        this.state.uploading = false;\n        this.setState({\n          uploading: false\n        });\n        this.initIframe();\n      }\n    }\n  }, {\n    key: 'startUpload',\n    value: function startUpload() {\n      if (!this.state.uploading) {\n        this.state.uploading = true;\n        this.setState({\n          uploading: true\n        });\n      }\n    }\n  }, {\n    key: 'updateIframeWH',\n    value: function updateIframeWH() {\n      var rootNode = ReactDOM.findDOMNode(this);\n      var iframeNode = this.getIframeNode();\n      iframeNode.style.height = rootNode.offsetHeight + 'px';\n      iframeNode.style.width = rootNode.offsetWidth + 'px';\n    }\n  }, {\n    key: 'abort',\n    value: function abort(file) {\n      if (file) {\n        var uid = file;\n\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n\n        if (uid === this.file.uid) {\n          this.endUpload();\n        }\n      } else {\n        this.endUpload();\n      }\n    }\n  }, {\n    key: 'post',\n    value: function post(file) {\n      var _this4 = this;\n\n      var formNode = this.getFormNode();\n      var dataSpan = this.getFormDataNode();\n      var data = this.props.data;\n      var onStart = this.props.onStart;\n\n      if (typeof data === 'function') {\n        data = data(file);\n      }\n\n      var inputs = document.createDocumentFragment();\n\n      for (var key in data) {\n        if (data.hasOwnProperty(key)) {\n          var input = document.createElement('input');\n          input.setAttribute('name', key);\n          input.value = data[key];\n          inputs.appendChild(input);\n        }\n      }\n\n      dataSpan.appendChild(inputs);\n      new Promise(function (resolve) {\n        var action = _this4.props.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n\n        resolve(action);\n      }).then(function (action) {\n        formNode.setAttribute('action', action);\n        formNode.submit();\n        dataSpan.innerHTML = '';\n        onStart(file);\n      });\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _classNames;\n\n      var _props = this.props,\n          Tag = _props.component,\n          disabled = _props.disabled,\n          className = _props.className,\n          prefixCls = _props.prefixCls,\n          children = _props.children,\n          style = _props.style;\n\n      var iframeStyle = _extends({}, IFRAME_STYLE, {\n        display: this.state.uploading || disabled ? 'none' : ''\n      });\n\n      var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _defineProperty(_classNames, className, className), _classNames));\n      return React.createElement(Tag, {\n        className: cls,\n        style: _extends({\n          position: 'relative',\n          zIndex: 0\n        }, style)\n      }, React.createElement('iframe', {\n        ref: this.saveIframe,\n        onLoad: this.onLoad,\n        style: iframeStyle\n      }), children);\n    }\n  }]);\n\n  return IframeUploader;\n}(Component);\n\nIframeUploader.propTypes = {\n  component: PropTypes.string,\n  style: PropTypes.object,\n  disabled: PropTypes.bool,\n  prefixCls: PropTypes.string,\n  className: PropTypes.string,\n  accept: PropTypes.string,\n  onStart: PropTypes.func,\n  multiple: PropTypes.bool,\n  children: PropTypes.any,\n  data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n  action: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n  name: PropTypes.string\n};\nexport default IframeUploader;","map":{"version":3,"sources":["/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/rc-upload/es/IframeUploader.js"],"names":["_defineProperty","_extends","_classCallCheck","_createClass","_possibleConstructorReturn","_inherits","React","Component","PropTypes","ReactDOM","classNames","getUid","warning","IFRAME_STYLE","position","top","opacity","filter","left","zIndex","IframeUploader","_Component","_ref","_temp","_this","_ret","_len","arguments","length","args","Array","_key","__proto__","Object","getPrototypeOf","call","apply","concat","state","uploading","file","onLoad","_this2","props","response","doc","getIframeDocument","script","getElementsByTagName","parentNode","body","removeChild","innerHTML","onSuccess","err","onError","endUpload","onChange","target","getFormInputNode","uid","name","value","substring","lastIndexOf","startUpload","_this3","beforeUpload","post","before","then","saveIframe","node","iframe","key","componentDidMount","updateIframeWH","initIframe","componentDidUpdate","getIframeNode","contentDocument","getFormNode","getElementById","getFormDataNode","getFileForMultiple","multiple","getIframeHTML","domain","domainScript","domainInput","initIframeSrc","src","iframeNode","win","contentWindow","document","e","open","write","close","onchange","setState","rootNode","findDOMNode","style","height","offsetHeight","width","offsetWidth","abort","_this4","formNode","dataSpan","data","onStart","inputs","createDocumentFragment","hasOwnProperty","input","createElement","setAttribute","appendChild","Promise","resolve","action","submit","render","_classNames","_props","Tag","component","disabled","className","prefixCls","children","iframeStyle","display","cls","ref","propTypes","string","object","bool","accept","func","any","oneOfType"],"mappings":"AAAA,OAAOA,eAAP,MAA4B,sCAA5B;AACA,OAAOC,QAAP,MAAqB,+BAArB;AACA,OAAOC,eAAP,MAA4B,sCAA5B;AACA,OAAOC,YAAP,MAAyB,mCAAzB;AACA,OAAOC,0BAAP,MAAuC,iDAAvC;AACA,OAAOC,SAAP,MAAsB,gCAAtB;AACA;;AACA,OAAOC,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,QAAP,MAAqB,WAArB;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,OAAOC,MAAP,MAAmB,OAAnB;AACA,OAAOC,OAAP,MAAoB,SAApB;AAEA,IAAIC,YAAY,GAAG;AACjBC,EAAAA,QAAQ,EAAE,UADO;AAEjBC,EAAAA,GAAG,EAAE,CAFY;AAGjBC,EAAAA,OAAO,EAAE,CAHQ;AAIjBC,EAAAA,MAAM,EAAE,kBAJS;AAKjBC,EAAAA,IAAI,EAAE,CALW;AAMjBC,EAAAA,MAAM,EAAE;AANS,CAAnB,C,CASA;;AAEA,IAAIC,cAAc,GAAG,UAAUC,UAAV,EAAsB;AACzChB,EAAAA,SAAS,CAACe,cAAD,EAAiBC,UAAjB,CAAT;;AAEA,WAASD,cAAT,GAA0B;AACxB,QAAIE,IAAJ;;AAEA,QAAIC,KAAJ,EAAWC,KAAX,EAAkBC,IAAlB;;AAEAvB,IAAAA,eAAe,CAAC,IAAD,EAAOkB,cAAP,CAAf;;AAEA,SAAK,IAAIM,IAAI,GAAGC,SAAS,CAACC,MAArB,EAA6BC,IAAI,GAAGC,KAAK,CAACJ,IAAD,CAAzC,EAAiDK,IAAI,GAAG,CAA7D,EAAgEA,IAAI,GAAGL,IAAvE,EAA6EK,IAAI,EAAjF,EAAqF;AACnFF,MAAAA,IAAI,CAACE,IAAD,CAAJ,GAAaJ,SAAS,CAACI,IAAD,CAAtB;AACD;;AAED,WAAON,IAAI,IAAIF,KAAK,IAAIC,KAAK,GAAGpB,0BAA0B,CAAC,IAAD,EAAO,CAACkB,IAAI,GAAGF,cAAc,CAACY,SAAf,IAA4BC,MAAM,CAACC,cAAP,CAAsBd,cAAtB,CAApC,EAA2Ee,IAA3E,CAAgFC,KAAhF,CAAsFd,IAAtF,EAA4F,CAAC,IAAD,EAAOe,MAAP,CAAcR,IAAd,CAA5F,CAAP,CAAlC,EAA4JL,KAAhK,CAAL,EAA6KA,KAAK,CAACc,KAAN,GAAc;AAAEC,MAAAA,SAAS,EAAE;AAAb,KAA3L,EAAiNf,KAAK,CAACgB,IAAN,GAAa,EAA9N,EAAkOhB,KAAK,CAACiB,MAAN,GAAe,YAAY;AAC1Q,UAAI,CAACjB,KAAK,CAACc,KAAN,CAAYC,SAAjB,EAA4B;AAC1B;AACD;;AACD,UAAIG,MAAM,GAAGlB,KAAb;AAAA,UACImB,KAAK,GAAGD,MAAM,CAACC,KADnB;AAAA,UAEIH,IAAI,GAAGE,MAAM,CAACF,IAFlB;AAIA,UAAII,QAAQ,GAAG,KAAK,CAApB;;AACA,UAAI;AACF,YAAIC,GAAG,GAAGrB,KAAK,CAACsB,iBAAN,EAAV;;AACA,YAAIC,MAAM,GAAGF,GAAG,CAACG,oBAAJ,CAAyB,QAAzB,EAAmC,CAAnC,CAAb;;AACA,YAAID,MAAM,IAAIA,MAAM,CAACE,UAAP,KAAsBJ,GAAG,CAACK,IAAxC,EAA8C;AAC5CL,UAAAA,GAAG,CAACK,IAAJ,CAASC,WAAT,CAAqBJ,MAArB;AACD;;AACDH,QAAAA,QAAQ,GAAGC,GAAG,CAACK,IAAJ,CAASE,SAApB;AACAT,QAAAA,KAAK,CAACU,SAAN,CAAgBT,QAAhB,EAA0BJ,IAA1B;AACD,OARD,CAQE,OAAOc,GAAP,EAAY;AACZ1C,QAAAA,OAAO,CAAC,KAAD,EAAQ,2IAAR,CAAP;AACAgC,QAAAA,QAAQ,GAAG,cAAX;AACAD,QAAAA,KAAK,CAACY,OAAN,CAAcD,GAAd,EAAmB,IAAnB,EAAyBd,IAAzB;AACD;;AACDhB,MAAAA,KAAK,CAACgC,SAAN;AACD,KAvBc,EAuBZhC,KAAK,CAACiC,QAAN,GAAiB,YAAY;AAC9B,UAAIC,MAAM,GAAGlC,KAAK,CAACmC,gBAAN,EAAb,CAD8B,CAE9B;AACA;;;AACA,UAAInB,IAAI,GAAGhB,KAAK,CAACgB,IAAN,GAAa;AACtBoB,QAAAA,GAAG,EAAEjD,MAAM,EADW;AAEtBkD,QAAAA,IAAI,EAAEH,MAAM,CAACI,KAAP,IAAgBJ,MAAM,CAACI,KAAP,CAAaC,SAAb,CAAuBL,MAAM,CAACI,KAAP,CAAaE,WAAb,CAAyB,IAAzB,IAAiC,CAAxD,EAA2DN,MAAM,CAACI,KAAP,CAAalC,MAAxE;AAFA,OAAxB;;AAIAJ,MAAAA,KAAK,CAACyC,WAAN;;AACA,UAAIC,MAAM,GAAG1C,KAAb;AAAA,UACImB,KAAK,GAAGuB,MAAM,CAACvB,KADnB;;AAGA,UAAI,CAACA,KAAK,CAACwB,YAAX,EAAyB;AACvB,eAAO3C,KAAK,CAAC4C,IAAN,CAAW5B,IAAX,CAAP;AACD;;AACD,UAAI6B,MAAM,GAAG1B,KAAK,CAACwB,YAAN,CAAmB3B,IAAnB,CAAb;;AACA,UAAI6B,MAAM,IAAIA,MAAM,CAACC,IAArB,EAA2B;AACzBD,QAAAA,MAAM,CAACC,IAAP,CAAY,YAAY;AACtB9C,UAAAA,KAAK,CAAC4C,IAAN,CAAW5B,IAAX;AACD,SAFD,EAEG,YAAY;AACbhB,UAAAA,KAAK,CAACgC,SAAN;AACD,SAJD;AAKD,OAND,MAMO,IAAIa,MAAM,KAAK,KAAf,EAAsB;AAC3B7C,QAAAA,KAAK,CAAC4C,IAAN,CAAW5B,IAAX;AACD,OAFM,MAEA;AACLhB,QAAAA,KAAK,CAACgC,SAAN;AACD;AACF,KAlDc,EAkDZhC,KAAK,CAAC+C,UAAN,GAAmB,UAAUC,IAAV,EAAgB;AACpChD,MAAAA,KAAK,CAACiD,MAAN,GAAeD,IAAf;AACD,KApDc,EAoDZjD,KApDQ,CAAJ,EAoDInB,0BAA0B,CAACoB,KAAD,EAAQC,IAAR,CApDrC;AAqDD;;AAEDtB,EAAAA,YAAY,CAACiB,cAAD,EAAiB,CAAC;AAC5BsD,IAAAA,GAAG,EAAE,mBADuB;AAE5BZ,IAAAA,KAAK,EAAE,SAASa,iBAAT,GAA6B;AAClC,WAAKC,cAAL;AACA,WAAKC,UAAL;AACD;AAL2B,GAAD,EAM1B;AACDH,IAAAA,GAAG,EAAE,oBADJ;AAEDZ,IAAAA,KAAK,EAAE,SAASgB,kBAAT,GAA8B;AACnC,WAAKF,cAAL;AACD;AAJA,GAN0B,EAW1B;AACDF,IAAAA,GAAG,EAAE,eADJ;AAEDZ,IAAAA,KAAK,EAAE,SAASiB,aAAT,GAAyB;AAC9B,aAAO,KAAKN,MAAZ;AACD;AAJA,GAX0B,EAgB1B;AACDC,IAAAA,GAAG,EAAE,mBADJ;AAEDZ,IAAAA,KAAK,EAAE,SAAShB,iBAAT,GAA6B;AAClC,aAAO,KAAKiC,aAAL,GAAqBC,eAA5B;AACD;AAJA,GAhB0B,EAqB1B;AACDN,IAAAA,GAAG,EAAE,aADJ;AAEDZ,IAAAA,KAAK,EAAE,SAASmB,WAAT,GAAuB;AAC5B,aAAO,KAAKnC,iBAAL,GAAyBoC,cAAzB,CAAwC,MAAxC,CAAP;AACD;AAJA,GArB0B,EA0B1B;AACDR,IAAAA,GAAG,EAAE,kBADJ;AAEDZ,IAAAA,KAAK,EAAE,SAASH,gBAAT,GAA4B;AACjC,aAAO,KAAKb,iBAAL,GAAyBoC,cAAzB,CAAwC,OAAxC,CAAP;AACD;AAJA,GA1B0B,EA+B1B;AACDR,IAAAA,GAAG,EAAE,iBADJ;AAEDZ,IAAAA,KAAK,EAAE,SAASqB,eAAT,GAA2B;AAChC,aAAO,KAAKrC,iBAAL,GAAyBoC,cAAzB,CAAwC,MAAxC,CAAP;AACD;AAJA,GA/B0B,EAoC1B;AACDR,IAAAA,GAAG,EAAE,oBADJ;AAEDZ,IAAAA,KAAK,EAAE,SAASsB,kBAAT,CAA4B5C,IAA5B,EAAkC;AACvC,aAAO,KAAKG,KAAL,CAAW0C,QAAX,GAAsB,CAAC7C,IAAD,CAAtB,GAA+BA,IAAtC;AACD;AAJA,GApC0B,EAyC1B;AACDkC,IAAAA,GAAG,EAAE,eADJ;AAEDZ,IAAAA,KAAK,EAAE,SAASwB,aAAT,CAAuBC,MAAvB,EAA+B;AACpC,UAAIC,YAAY,GAAG,EAAnB;AACA,UAAIC,WAAW,GAAG,EAAlB;;AACA,UAAIF,MAAJ,EAAY;AACV,YAAIxC,MAAM,GAAG,QAAb;AACAyC,QAAAA,YAAY,GAAG,MAAMzC,MAAN,GAAe,oBAAf,GAAsCwC,MAAtC,GAA+C,MAA/C,GAAwDxC,MAAxD,GAAiE,GAAhF;AACA0C,QAAAA,WAAW,GAAG,0CAA0CF,MAA1C,GAAmD,MAAjE;AACD;;AACD,aAAO,8MAA8MC,YAA9M,GAA6N,6OAA7N,GAA6c,KAAK7C,KAAL,CAAWkB,IAAxd,GAA+d,wGAA/d,GAA0kB4B,WAA1kB,GAAwlB,4EAA/lB;AACD;AAXA,GAzC0B,EAqD1B;AACDf,IAAAA,GAAG,EAAE,eADJ;AAEDZ,IAAAA,KAAK,EAAE,SAAS4B,aAAT,GAAyB;AAC9B,UAAI,KAAKH,MAAT,EAAiB;AACf,aAAKR,aAAL,GAAqBY,GAArB,GAA2B,oGAAoG,KAAKJ,MAAzG,GAAkH,8DAA7I;AACD;AACF;AANA,GArD0B,EA4D1B;AACDb,IAAAA,GAAG,EAAE,YADJ;AAEDZ,IAAAA,KAAK,EAAE,SAASe,UAAT,GAAsB;AAC3B,UAAIe,UAAU,GAAG,KAAKb,aAAL,EAAjB;AACA,UAAIc,GAAG,GAAGD,UAAU,CAACE,aAArB;AACA,UAAIjD,GAAG,GAAG,KAAK,CAAf;AACA,WAAK0C,MAAL,GAAc,KAAKA,MAAL,IAAe,EAA7B;AACA,WAAKG,aAAL;;AACA,UAAI;AACF7C,QAAAA,GAAG,GAAGgD,GAAG,CAACE,QAAV;AACD,OAFD,CAEE,OAAOC,CAAP,EAAU;AACV,aAAKT,MAAL,GAAcQ,QAAQ,CAACR,MAAvB;AACA,aAAKG,aAAL;AACAG,QAAAA,GAAG,GAAGD,UAAU,CAACE,aAAjB;AACAjD,QAAAA,GAAG,GAAGgD,GAAG,CAACE,QAAV;AACD;;AACDlD,MAAAA,GAAG,CAACoD,IAAJ,CAAS,WAAT,EAAsB,SAAtB;AACApD,MAAAA,GAAG,CAACqD,KAAJ,CAAU,KAAKZ,aAAL,CAAmB,KAAKC,MAAxB,CAAV;AACA1C,MAAAA,GAAG,CAACsD,KAAJ;AACA,WAAKxC,gBAAL,GAAwByC,QAAxB,GAAmC,KAAK3C,QAAxC;AACD;AApBA,GA5D0B,EAiF1B;AACDiB,IAAAA,GAAG,EAAE,WADJ;AAEDZ,IAAAA,KAAK,EAAE,SAASN,SAAT,GAAqB;AAC1B,UAAI,KAAKlB,KAAL,CAAWC,SAAf,EAA0B;AACxB,aAAKC,IAAL,GAAY,EAAZ,CADwB,CAExB;;AACA,aAAKF,KAAL,CAAWC,SAAX,GAAuB,KAAvB;AACA,aAAK8D,QAAL,CAAc;AACZ9D,UAAAA,SAAS,EAAE;AADC,SAAd;AAGA,aAAKsC,UAAL;AACD;AACF;AAZA,GAjF0B,EA8F1B;AACDH,IAAAA,GAAG,EAAE,aADJ;AAEDZ,IAAAA,KAAK,EAAE,SAASG,WAAT,GAAuB;AAC5B,UAAI,CAAC,KAAK3B,KAAL,CAAWC,SAAhB,EAA2B;AACzB,aAAKD,KAAL,CAAWC,SAAX,GAAuB,IAAvB;AACA,aAAK8D,QAAL,CAAc;AACZ9D,UAAAA,SAAS,EAAE;AADC,SAAd;AAGD;AACF;AATA,GA9F0B,EAwG1B;AACDmC,IAAAA,GAAG,EAAE,gBADJ;AAEDZ,IAAAA,KAAK,EAAE,SAASc,cAAT,GAA0B;AAC/B,UAAI0B,QAAQ,GAAG7F,QAAQ,CAAC8F,WAAT,CAAqB,IAArB,CAAf;AACA,UAAIX,UAAU,GAAG,KAAKb,aAAL,EAAjB;AACAa,MAAAA,UAAU,CAACY,KAAX,CAAiBC,MAAjB,GAA0BH,QAAQ,CAACI,YAAT,GAAwB,IAAlD;AACAd,MAAAA,UAAU,CAACY,KAAX,CAAiBG,KAAjB,GAAyBL,QAAQ,CAACM,WAAT,GAAuB,IAAhD;AACD;AAPA,GAxG0B,EAgH1B;AACDlC,IAAAA,GAAG,EAAE,OADJ;AAEDZ,IAAAA,KAAK,EAAE,SAAS+C,KAAT,CAAerE,IAAf,EAAqB;AAC1B,UAAIA,IAAJ,EAAU;AACR,YAAIoB,GAAG,GAAGpB,IAAV;;AACA,YAAIA,IAAI,IAAIA,IAAI,CAACoB,GAAjB,EAAsB;AACpBA,UAAAA,GAAG,GAAGpB,IAAI,CAACoB,GAAX;AACD;;AACD,YAAIA,GAAG,KAAK,KAAKpB,IAAL,CAAUoB,GAAtB,EAA2B;AACzB,eAAKJ,SAAL;AACD;AACF,OARD,MAQO;AACL,aAAKA,SAAL;AACD;AACF;AAdA,GAhH0B,EA+H1B;AACDkB,IAAAA,GAAG,EAAE,MADJ;AAEDZ,IAAAA,KAAK,EAAE,SAASM,IAAT,CAAc5B,IAAd,EAAoB;AACzB,UAAIsE,MAAM,GAAG,IAAb;;AAEA,UAAIC,QAAQ,GAAG,KAAK9B,WAAL,EAAf;AACA,UAAI+B,QAAQ,GAAG,KAAK7B,eAAL,EAAf;AACA,UAAI8B,IAAI,GAAG,KAAKtE,KAAL,CAAWsE,IAAtB;AACA,UAAIC,OAAO,GAAG,KAAKvE,KAAL,CAAWuE,OAAzB;;AAEA,UAAI,OAAOD,IAAP,KAAgB,UAApB,EAAgC;AAC9BA,QAAAA,IAAI,GAAGA,IAAI,CAACzE,IAAD,CAAX;AACD;;AACD,UAAI2E,MAAM,GAAGpB,QAAQ,CAACqB,sBAAT,EAAb;;AACA,WAAK,IAAI1C,GAAT,IAAgBuC,IAAhB,EAAsB;AACpB,YAAIA,IAAI,CAACI,cAAL,CAAoB3C,GAApB,CAAJ,EAA8B;AAC5B,cAAI4C,KAAK,GAAGvB,QAAQ,CAACwB,aAAT,CAAuB,OAAvB,CAAZ;AACAD,UAAAA,KAAK,CAACE,YAAN,CAAmB,MAAnB,EAA2B9C,GAA3B;AACA4C,UAAAA,KAAK,CAACxD,KAAN,GAAcmD,IAAI,CAACvC,GAAD,CAAlB;AACAyC,UAAAA,MAAM,CAACM,WAAP,CAAmBH,KAAnB;AACD;AACF;;AACDN,MAAAA,QAAQ,CAACS,WAAT,CAAqBN,MAArB;AACA,UAAIO,OAAJ,CAAY,UAAUC,OAAV,EAAmB;AAC7B,YAAIC,MAAM,GAAGd,MAAM,CAACnE,KAAP,CAAaiF,MAA1B;;AAEA,YAAI,OAAOA,MAAP,KAAkB,UAAtB,EAAkC;AAChC,iBAAOD,OAAO,CAACC,MAAM,CAACpF,IAAD,CAAP,CAAd;AACD;;AACDmF,QAAAA,OAAO,CAACC,MAAD,CAAP;AACD,OAPD,EAOGtD,IAPH,CAOQ,UAAUsD,MAAV,EAAkB;AACxBb,QAAAA,QAAQ,CAACS,YAAT,CAAsB,QAAtB,EAAgCI,MAAhC;AACAb,QAAAA,QAAQ,CAACc,MAAT;AACAb,QAAAA,QAAQ,CAAC5D,SAAT,GAAqB,EAArB;AACA8D,QAAAA,OAAO,CAAC1E,IAAD,CAAP;AACD,OAZD;AAaD;AApCA,GA/H0B,EAoK1B;AACDkC,IAAAA,GAAG,EAAE,QADJ;AAEDZ,IAAAA,KAAK,EAAE,SAASgE,MAAT,GAAkB;AACvB,UAAIC,WAAJ;;AAEA,UAAIC,MAAM,GAAG,KAAKrF,KAAlB;AAAA,UACIsF,GAAG,GAAGD,MAAM,CAACE,SADjB;AAAA,UAEIC,QAAQ,GAAGH,MAAM,CAACG,QAFtB;AAAA,UAGIC,SAAS,GAAGJ,MAAM,CAACI,SAHvB;AAAA,UAIIC,SAAS,GAAGL,MAAM,CAACK,SAJvB;AAAA,UAKIC,QAAQ,GAAGN,MAAM,CAACM,QALtB;AAAA,UAMI9B,KAAK,GAAGwB,MAAM,CAACxB,KANnB;;AAQA,UAAI+B,WAAW,GAAGtI,QAAQ,CAAC,EAAD,EAAKY,YAAL,EAAmB;AAC3C2H,QAAAA,OAAO,EAAE,KAAKlG,KAAL,CAAWC,SAAX,IAAwB4F,QAAxB,GAAmC,MAAnC,GAA4C;AADV,OAAnB,CAA1B;;AAGA,UAAIM,GAAG,GAAG/H,UAAU,EAAEqH,WAAW,GAAG,EAAd,EAAkB/H,eAAe,CAAC+H,WAAD,EAAcM,SAAd,EAAyB,IAAzB,CAAjC,EAAiErI,eAAe,CAAC+H,WAAD,EAAcM,SAAS,GAAG,WAA1B,EAAuCF,QAAvC,CAAhF,EAAkInI,eAAe,CAAC+H,WAAD,EAAcK,SAAd,EAAyBA,SAAzB,CAAjJ,EAAsLL,WAAxL,EAApB;AACA,aAAOzH,KAAK,CAACiH,aAAN,CACLU,GADK,EAEL;AACEG,QAAAA,SAAS,EAAEK,GADb;AAEEjC,QAAAA,KAAK,EAAEvG,QAAQ,CAAC;AAAEa,UAAAA,QAAQ,EAAE,UAAZ;AAAwBK,UAAAA,MAAM,EAAE;AAAhC,SAAD,EAAsCqF,KAAtC;AAFjB,OAFK,EAMLlG,KAAK,CAACiH,aAAN,CAAoB,QAApB,EAA8B;AAC5BmB,QAAAA,GAAG,EAAE,KAAKnE,UADkB;AAE5B9B,QAAAA,MAAM,EAAE,KAAKA,MAFe;AAG5B+D,QAAAA,KAAK,EAAE+B;AAHqB,OAA9B,CANK,EAWLD,QAXK,CAAP;AAaD;AA9BA,GApK0B,CAAjB,CAAZ;;AAqMA,SAAOlH,cAAP;AACD,CA3QoB,CA2QnBb,SA3QmB,CAArB;;AA6QAa,cAAc,CAACuH,SAAf,GAA2B;AACzBT,EAAAA,SAAS,EAAE1H,SAAS,CAACoI,MADI;AAEzBpC,EAAAA,KAAK,EAAEhG,SAAS,CAACqI,MAFQ;AAGzBV,EAAAA,QAAQ,EAAE3H,SAAS,CAACsI,IAHK;AAIzBT,EAAAA,SAAS,EAAE7H,SAAS,CAACoI,MAJI;AAKzBR,EAAAA,SAAS,EAAE5H,SAAS,CAACoI,MALI;AAMzBG,EAAAA,MAAM,EAAEvI,SAAS,CAACoI,MANO;AAOzB1B,EAAAA,OAAO,EAAE1G,SAAS,CAACwI,IAPM;AAQzB3D,EAAAA,QAAQ,EAAE7E,SAAS,CAACsI,IARK;AASzBR,EAAAA,QAAQ,EAAE9H,SAAS,CAACyI,GATK;AAUzBhC,EAAAA,IAAI,EAAEzG,SAAS,CAAC0I,SAAV,CAAoB,CAAC1I,SAAS,CAACqI,MAAX,EAAmBrI,SAAS,CAACwI,IAA7B,CAApB,CAVmB;AAWzBpB,EAAAA,MAAM,EAAEpH,SAAS,CAAC0I,SAAV,CAAoB,CAAC1I,SAAS,CAACoI,MAAX,EAAmBpI,SAAS,CAACwI,IAA7B,CAApB,CAXiB;AAYzBnF,EAAAA,IAAI,EAAErD,SAAS,CAACoI;AAZS,CAA3B;AAgBA,eAAexH,cAAf","sourcesContent":["import _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n/* eslint react/sort-comp:0 */\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport ReactDOM from 'react-dom';\nimport classNames from 'classnames';\nimport getUid from './uid';\nimport warning from 'warning';\n\nvar IFRAME_STYLE = {\n  position: 'absolute',\n  top: 0,\n  opacity: 0,\n  filter: 'alpha(opacity=0)',\n  left: 0,\n  zIndex: 9999\n};\n\n// diferent from AjaxUpload, can only upload on at one time, serial seriously\n\nvar IframeUploader = function (_Component) {\n  _inherits(IframeUploader, _Component);\n\n  function IframeUploader() {\n    var _ref;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, IframeUploader);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = IframeUploader.__proto__ || Object.getPrototypeOf(IframeUploader)).call.apply(_ref, [this].concat(args))), _this), _this.state = { uploading: false }, _this.file = {}, _this.onLoad = function () {\n      if (!_this.state.uploading) {\n        return;\n      }\n      var _this2 = _this,\n          props = _this2.props,\n          file = _this2.file;\n\n      var response = void 0;\n      try {\n        var doc = _this.getIframeDocument();\n        var script = doc.getElementsByTagName('script')[0];\n        if (script && script.parentNode === doc.body) {\n          doc.body.removeChild(script);\n        }\n        response = doc.body.innerHTML;\n        props.onSuccess(response, file);\n      } catch (err) {\n        warning(false, 'cross domain error for Upload. Maybe server should return document.domain script. see Note from https://github.com/react-component/upload');\n        response = 'cross-domain';\n        props.onError(err, null, file);\n      }\n      _this.endUpload();\n    }, _this.onChange = function () {\n      var target = _this.getFormInputNode();\n      // ie8/9 don't support FileList Object\n      // http://stackoverflow.com/questions/12830058/ie8-input-type-file-get-files\n      var file = _this.file = {\n        uid: getUid(),\n        name: target.value && target.value.substring(target.value.lastIndexOf('\\\\') + 1, target.value.length)\n      };\n      _this.startUpload();\n      var _this3 = _this,\n          props = _this3.props;\n\n      if (!props.beforeUpload) {\n        return _this.post(file);\n      }\n      var before = props.beforeUpload(file);\n      if (before && before.then) {\n        before.then(function () {\n          _this.post(file);\n        }, function () {\n          _this.endUpload();\n        });\n      } else if (before !== false) {\n        _this.post(file);\n      } else {\n        _this.endUpload();\n      }\n    }, _this.saveIframe = function (node) {\n      _this.iframe = node;\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(IframeUploader, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.updateIframeWH();\n      this.initIframe();\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate() {\n      this.updateIframeWH();\n    }\n  }, {\n    key: 'getIframeNode',\n    value: function getIframeNode() {\n      return this.iframe;\n    }\n  }, {\n    key: 'getIframeDocument',\n    value: function getIframeDocument() {\n      return this.getIframeNode().contentDocument;\n    }\n  }, {\n    key: 'getFormNode',\n    value: function getFormNode() {\n      return this.getIframeDocument().getElementById('form');\n    }\n  }, {\n    key: 'getFormInputNode',\n    value: function getFormInputNode() {\n      return this.getIframeDocument().getElementById('input');\n    }\n  }, {\n    key: 'getFormDataNode',\n    value: function getFormDataNode() {\n      return this.getIframeDocument().getElementById('data');\n    }\n  }, {\n    key: 'getFileForMultiple',\n    value: function getFileForMultiple(file) {\n      return this.props.multiple ? [file] : file;\n    }\n  }, {\n    key: 'getIframeHTML',\n    value: function getIframeHTML(domain) {\n      var domainScript = '';\n      var domainInput = '';\n      if (domain) {\n        var script = 'script';\n        domainScript = '<' + script + '>document.domain=\"' + domain + '\";</' + script + '>';\n        domainInput = '<input name=\"_documentDomain\" value=\"' + domain + '\" />';\n      }\n      return '\\n    <!DOCTYPE html>\\n    <html>\\n    <head>\\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\\n    <style>\\n    body,html {padding:0;margin:0;border:0;overflow:hidden;}\\n    </style>\\n    ' + domainScript + '\\n    </head>\\n    <body>\\n    <form method=\"post\"\\n    encType=\"multipart/form-data\"\\n    action=\"\" id=\"form\"\\n    style=\"display:block;height:9999px;position:relative;overflow:hidden;\">\\n    <input id=\"input\" type=\"file\"\\n     name=\"' + this.props.name + '\"\\n     style=\"position:absolute;top:0;right:0;height:9999px;font-size:9999px;cursor:pointer;\"/>\\n    ' + domainInput + '\\n    <span id=\"data\"></span>\\n    </form>\\n    </body>\\n    </html>\\n    ';\n    }\n  }, {\n    key: 'initIframeSrc',\n    value: function initIframeSrc() {\n      if (this.domain) {\n        this.getIframeNode().src = 'javascript:void((function(){\\n        var d = document;\\n        d.open();\\n        d.domain=\\'' + this.domain + '\\';\\n        d.write(\\'\\');\\n        d.close();\\n      })())';\n      }\n    }\n  }, {\n    key: 'initIframe',\n    value: function initIframe() {\n      var iframeNode = this.getIframeNode();\n      var win = iframeNode.contentWindow;\n      var doc = void 0;\n      this.domain = this.domain || '';\n      this.initIframeSrc();\n      try {\n        doc = win.document;\n      } catch (e) {\n        this.domain = document.domain;\n        this.initIframeSrc();\n        win = iframeNode.contentWindow;\n        doc = win.document;\n      }\n      doc.open('text/html', 'replace');\n      doc.write(this.getIframeHTML(this.domain));\n      doc.close();\n      this.getFormInputNode().onchange = this.onChange;\n    }\n  }, {\n    key: 'endUpload',\n    value: function endUpload() {\n      if (this.state.uploading) {\n        this.file = {};\n        // hack avoid batch\n        this.state.uploading = false;\n        this.setState({\n          uploading: false\n        });\n        this.initIframe();\n      }\n    }\n  }, {\n    key: 'startUpload',\n    value: function startUpload() {\n      if (!this.state.uploading) {\n        this.state.uploading = true;\n        this.setState({\n          uploading: true\n        });\n      }\n    }\n  }, {\n    key: 'updateIframeWH',\n    value: function updateIframeWH() {\n      var rootNode = ReactDOM.findDOMNode(this);\n      var iframeNode = this.getIframeNode();\n      iframeNode.style.height = rootNode.offsetHeight + 'px';\n      iframeNode.style.width = rootNode.offsetWidth + 'px';\n    }\n  }, {\n    key: 'abort',\n    value: function abort(file) {\n      if (file) {\n        var uid = file;\n        if (file && file.uid) {\n          uid = file.uid;\n        }\n        if (uid === this.file.uid) {\n          this.endUpload();\n        }\n      } else {\n        this.endUpload();\n      }\n    }\n  }, {\n    key: 'post',\n    value: function post(file) {\n      var _this4 = this;\n\n      var formNode = this.getFormNode();\n      var dataSpan = this.getFormDataNode();\n      var data = this.props.data;\n      var onStart = this.props.onStart;\n\n      if (typeof data === 'function') {\n        data = data(file);\n      }\n      var inputs = document.createDocumentFragment();\n      for (var key in data) {\n        if (data.hasOwnProperty(key)) {\n          var input = document.createElement('input');\n          input.setAttribute('name', key);\n          input.value = data[key];\n          inputs.appendChild(input);\n        }\n      }\n      dataSpan.appendChild(inputs);\n      new Promise(function (resolve) {\n        var action = _this4.props.action;\n\n        if (typeof action === 'function') {\n          return resolve(action(file));\n        }\n        resolve(action);\n      }).then(function (action) {\n        formNode.setAttribute('action', action);\n        formNode.submit();\n        dataSpan.innerHTML = '';\n        onStart(file);\n      });\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _classNames;\n\n      var _props = this.props,\n          Tag = _props.component,\n          disabled = _props.disabled,\n          className = _props.className,\n          prefixCls = _props.prefixCls,\n          children = _props.children,\n          style = _props.style;\n\n      var iframeStyle = _extends({}, IFRAME_STYLE, {\n        display: this.state.uploading || disabled ? 'none' : ''\n      });\n      var cls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls, true), _defineProperty(_classNames, prefixCls + '-disabled', disabled), _defineProperty(_classNames, className, className), _classNames));\n      return React.createElement(\n        Tag,\n        {\n          className: cls,\n          style: _extends({ position: 'relative', zIndex: 0 }, style)\n        },\n        React.createElement('iframe', {\n          ref: this.saveIframe,\n          onLoad: this.onLoad,\n          style: iframeStyle\n        }),\n        children\n      );\n    }\n  }]);\n\n  return IframeUploader;\n}(Component);\n\nIframeUploader.propTypes = {\n  component: PropTypes.string,\n  style: PropTypes.object,\n  disabled: PropTypes.bool,\n  prefixCls: PropTypes.string,\n  className: PropTypes.string,\n  accept: PropTypes.string,\n  onStart: PropTypes.func,\n  multiple: PropTypes.bool,\n  children: PropTypes.any,\n  data: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n  action: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n  name: PropTypes.string\n};\n\n\nexport default IframeUploader;"]},"metadata":{},"sourceType":"module"}