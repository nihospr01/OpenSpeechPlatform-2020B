{"ast":null,"code":"import clipAntimeridian from \"../clip/antimeridian.js\";\nimport clipCircle from \"../clip/circle.js\";\nimport clipRectangle from \"../clip/rectangle.js\";\nimport compose from \"../compose.js\";\nimport identity from \"../identity.js\";\nimport { cos, degrees, radians, sin, sqrt } from \"../math.js\";\nimport { rotateRadians } from \"../rotation.js\";\nimport { transformer } from \"../transform.js\";\nimport { fitExtent, fitSize, fitWidth, fitHeight } from \"./fit.js\";\nimport resample from \"./resample.js\";\nvar transformRadians = transformer({\n  point: function point(x, y) {\n    this.stream.point(x * radians, y * radians);\n  }\n});\n\nfunction transformRotate(rotate) {\n  return transformer({\n    point: function point(x, y) {\n      var r = rotate(x, y);\n      return this.stream.point(r[0], r[1]);\n    }\n  });\n}\n\nfunction scaleTranslate(k, dx, dy, sx, sy) {\n  function transform(x, y) {\n    x *= sx;\n    y *= sy;\n    return [dx + k * x, dy - k * y];\n  }\n\n  transform.invert = function (x, y) {\n    return [(x - dx) / k * sx, (dy - y) / k * sy];\n  };\n\n  return transform;\n}\n\nfunction scaleTranslateRotate(k, dx, dy, sx, sy, alpha) {\n  var cosAlpha = cos(alpha),\n      sinAlpha = sin(alpha),\n      a = cosAlpha * k,\n      b = sinAlpha * k,\n      ai = cosAlpha / k,\n      bi = sinAlpha / k,\n      ci = (sinAlpha * dy - cosAlpha * dx) / k,\n      fi = (sinAlpha * dx + cosAlpha * dy) / k;\n\n  function transform(x, y) {\n    x *= sx;\n    y *= sy;\n    return [a * x - b * y + dx, dy - b * x - a * y];\n  }\n\n  transform.invert = function (x, y) {\n    return [sx * (ai * x - bi * y + ci), sy * (fi - bi * x - ai * y)];\n  };\n\n  return transform;\n}\n\nexport default function projection(project) {\n  return projectionMutator(function () {\n    return project;\n  })();\n}\nexport function projectionMutator(projectAt) {\n  var project,\n      k = 150,\n      // scale\n  x = 480,\n      y = 250,\n      // translate\n  lambda = 0,\n      phi = 0,\n      // center\n  deltaLambda = 0,\n      deltaPhi = 0,\n      deltaGamma = 0,\n      rotate,\n      // pre-rotate\n  alpha = 0,\n      // post-rotate angle\n  sx = 1,\n      // reflectX\n  sy = 1,\n      // reflectX\n  theta = null,\n      preclip = clipAntimeridian,\n      // pre-clip angle\n  x0 = null,\n      y0,\n      x1,\n      y1,\n      postclip = identity,\n      // post-clip extent\n  delta2 = 0.5,\n      // precision\n  projectResample,\n      projectTransform,\n      projectRotateTransform,\n      cache,\n      cacheStream;\n\n  function projection(point) {\n    return projectRotateTransform(point[0] * radians, point[1] * radians);\n  }\n\n  function invert(point) {\n    point = projectRotateTransform.invert(point[0], point[1]);\n    return point && [point[0] * degrees, point[1] * degrees];\n  }\n\n  projection.stream = function (stream) {\n    return cache && cacheStream === stream ? cache : cache = transformRadians(transformRotate(rotate)(preclip(projectResample(postclip(cacheStream = stream)))));\n  };\n\n  projection.preclip = function (_) {\n    return arguments.length ? (preclip = _, theta = undefined, reset()) : preclip;\n  };\n\n  projection.postclip = function (_) {\n    return arguments.length ? (postclip = _, x0 = y0 = x1 = y1 = null, reset()) : postclip;\n  };\n\n  projection.clipAngle = function (_) {\n    return arguments.length ? (preclip = +_ ? clipCircle(theta = _ * radians) : (theta = null, clipAntimeridian), reset()) : theta * degrees;\n  };\n\n  projection.clipExtent = function (_) {\n    return arguments.length ? (postclip = _ == null ? (x0 = y0 = x1 = y1 = null, identity) : clipRectangle(x0 = +_[0][0], y0 = +_[0][1], x1 = +_[1][0], y1 = +_[1][1]), reset()) : x0 == null ? null : [[x0, y0], [x1, y1]];\n  };\n\n  projection.scale = function (_) {\n    return arguments.length ? (k = +_, recenter()) : k;\n  };\n\n  projection.translate = function (_) {\n    return arguments.length ? (x = +_[0], y = +_[1], recenter()) : [x, y];\n  };\n\n  projection.center = function (_) {\n    return arguments.length ? (lambda = _[0] % 360 * radians, phi = _[1] % 360 * radians, recenter()) : [lambda * degrees, phi * degrees];\n  };\n\n  projection.rotate = function (_) {\n    return arguments.length ? (deltaLambda = _[0] % 360 * radians, deltaPhi = _[1] % 360 * radians, deltaGamma = _.length > 2 ? _[2] % 360 * radians : 0, recenter()) : [deltaLambda * degrees, deltaPhi * degrees, deltaGamma * degrees];\n  };\n\n  projection.angle = function (_) {\n    return arguments.length ? (alpha = _ % 360 * radians, recenter()) : alpha * degrees;\n  };\n\n  projection.reflectX = function (_) {\n    return arguments.length ? (sx = _ ? -1 : 1, recenter()) : sx < 0;\n  };\n\n  projection.reflectY = function (_) {\n    return arguments.length ? (sy = _ ? -1 : 1, recenter()) : sy < 0;\n  };\n\n  projection.precision = function (_) {\n    return arguments.length ? (projectResample = resample(projectTransform, delta2 = _ * _), reset()) : sqrt(delta2);\n  };\n\n  projection.fitExtent = function (extent, object) {\n    return fitExtent(projection, extent, object);\n  };\n\n  projection.fitSize = function (size, object) {\n    return fitSize(projection, size, object);\n  };\n\n  projection.fitWidth = function (width, object) {\n    return fitWidth(projection, width, object);\n  };\n\n  projection.fitHeight = function (height, object) {\n    return fitHeight(projection, height, object);\n  };\n\n  function recenter() {\n    var center = scaleTranslateRotate(k, 0, 0, sx, sy, alpha).apply(null, project(lambda, phi)),\n        transform = (alpha ? scaleTranslateRotate : scaleTranslate)(k, x - center[0], y - center[1], sx, sy, alpha);\n    rotate = rotateRadians(deltaLambda, deltaPhi, deltaGamma);\n    projectTransform = compose(project, transform);\n    projectRotateTransform = compose(rotate, projectTransform);\n    projectResample = resample(projectTransform, delta2);\n    return reset();\n  }\n\n  function reset() {\n    cache = cacheStream = null;\n    return projection;\n  }\n\n  return function () {\n    project = projectAt.apply(this, arguments);\n    projection.invert = project.invert && invert;\n    return recenter();\n  };\n}","map":{"version":3,"sources":["/opt/OpenSpeechPlatform-UCSD/Software/ewsnodejs-client/node_modules/d3-geo/src/projection/index.js"],"names":["clipAntimeridian","clipCircle","clipRectangle","compose","identity","cos","degrees","radians","sin","sqrt","rotateRadians","transformer","fitExtent","fitSize","fitWidth","fitHeight","resample","transformRadians","point","x","y","stream","transformRotate","rotate","r","scaleTranslate","k","dx","dy","sx","sy","transform","invert","scaleTranslateRotate","alpha","cosAlpha","sinAlpha","a","b","ai","bi","ci","fi","projection","project","projectionMutator","projectAt","lambda","phi","deltaLambda","deltaPhi","deltaGamma","theta","preclip","x0","y0","x1","y1","postclip","delta2","projectResample","projectTransform","projectRotateTransform","cache","cacheStream","_","arguments","length","undefined","reset","clipAngle","clipExtent","scale","recenter","translate","center","angle","reflectX","reflectY","precision","extent","object","size","width","height","apply"],"mappings":"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","sourcesContent":["import clipAntimeridian from \"../clip/antimeridian.js\";\nimport clipCircle from \"../clip/circle.js\";\nimport clipRectangle from \"../clip/rectangle.js\";\nimport compose from \"../compose.js\";\nimport identity from \"../identity.js\";\nimport {cos, degrees, radians, sin, sqrt} from \"../math.js\";\nimport {rotateRadians} from \"../rotation.js\";\nimport {transformer} from \"../transform.js\";\nimport {fitExtent, fitSize, fitWidth, fitHeight} from \"./fit.js\";\nimport resample from \"./resample.js\";\n\nvar transformRadians = transformer({\n  point: function(x, y) {\n    this.stream.point(x * radians, y * radians);\n  }\n});\n\nfunction transformRotate(rotate) {\n  return transformer({\n    point: function(x, y) {\n      var r = rotate(x, y);\n      return this.stream.point(r[0], r[1]);\n    }\n  });\n}\n\nfunction scaleTranslate(k, dx, dy, sx, sy) {\n  function transform(x, y) {\n    x *= sx; y *= sy;\n    return [dx + k * x, dy - k * y];\n  }\n  transform.invert = function(x, y) {\n    return [(x - dx) / k * sx, (dy - y) / k * sy];\n  };\n  return transform;\n}\n\nfunction scaleTranslateRotate(k, dx, dy, sx, sy, alpha) {\n  var cosAlpha = cos(alpha),\n      sinAlpha = sin(alpha),\n      a = cosAlpha * k,\n      b = sinAlpha * k,\n      ai = cosAlpha / k,\n      bi = sinAlpha / k,\n      ci = (sinAlpha * dy - cosAlpha * dx) / k,\n      fi = (sinAlpha * dx + cosAlpha * dy) / k;\n  function transform(x, y) {\n    x *= sx; y *= sy;\n    return [a * x - b * y + dx, dy - b * x - a * y];\n  }\n  transform.invert = function(x, y) {\n    return [sx * (ai * x - bi * y + ci), sy * (fi - bi * x - ai * y)];\n  };\n  return transform;\n}\n\nexport default function projection(project) {\n  return projectionMutator(function() { return project; })();\n}\n\nexport function projectionMutator(projectAt) {\n  var project,\n      k = 150, // scale\n      x = 480, y = 250, // translate\n      lambda = 0, phi = 0, // center\n      deltaLambda = 0, deltaPhi = 0, deltaGamma = 0, rotate, // pre-rotate\n      alpha = 0, // post-rotate angle\n      sx = 1, // reflectX\n      sy = 1, // reflectX\n      theta = null, preclip = clipAntimeridian, // pre-clip angle\n      x0 = null, y0, x1, y1, postclip = identity, // post-clip extent\n      delta2 = 0.5, // precision\n      projectResample,\n      projectTransform,\n      projectRotateTransform,\n      cache,\n      cacheStream;\n\n  function projection(point) {\n    return projectRotateTransform(point[0] * radians, point[1] * radians);\n  }\n\n  function invert(point) {\n    point = projectRotateTransform.invert(point[0], point[1]);\n    return point && [point[0] * degrees, point[1] * degrees];\n  }\n\n  projection.stream = function(stream) {\n    return cache && cacheStream === stream ? cache : cache = transformRadians(transformRotate(rotate)(preclip(projectResample(postclip(cacheStream = stream)))));\n  };\n\n  projection.preclip = function(_) {\n    return arguments.length ? (preclip = _, theta = undefined, reset()) : preclip;\n  };\n\n  projection.postclip = function(_) {\n    return arguments.length ? (postclip = _, x0 = y0 = x1 = y1 = null, reset()) : postclip;\n  };\n\n  projection.clipAngle = function(_) {\n    return arguments.length ? (preclip = +_ ? clipCircle(theta = _ * radians) : (theta = null, clipAntimeridian), reset()) : theta * degrees;\n  };\n\n  projection.clipExtent = function(_) {\n    return arguments.length ? (postclip = _ == null ? (x0 = y0 = x1 = y1 = null, identity) : clipRectangle(x0 = +_[0][0], y0 = +_[0][1], x1 = +_[1][0], y1 = +_[1][1]), reset()) : x0 == null ? null : [[x0, y0], [x1, y1]];\n  };\n\n  projection.scale = function(_) {\n    return arguments.length ? (k = +_, recenter()) : k;\n  };\n\n  projection.translate = function(_) {\n    return arguments.length ? (x = +_[0], y = +_[1], recenter()) : [x, y];\n  };\n\n  projection.center = function(_) {\n    return arguments.length ? (lambda = _[0] % 360 * radians, phi = _[1] % 360 * radians, recenter()) : [lambda * degrees, phi * degrees];\n  };\n\n  projection.rotate = function(_) {\n    return arguments.length ? (deltaLambda = _[0] % 360 * radians, deltaPhi = _[1] % 360 * radians, deltaGamma = _.length > 2 ? _[2] % 360 * radians : 0, recenter()) : [deltaLambda * degrees, deltaPhi * degrees, deltaGamma * degrees];\n  };\n\n  projection.angle = function(_) {\n    return arguments.length ? (alpha = _ % 360 * radians, recenter()) : alpha * degrees;\n  };\n\n  projection.reflectX = function(_) {\n    return arguments.length ? (sx = _ ? -1 : 1, recenter()) : sx < 0;\n  };\n\n  projection.reflectY = function(_) {\n    return arguments.length ? (sy = _ ? -1 : 1, recenter()) : sy < 0;\n  };\n\n  projection.precision = function(_) {\n    return arguments.length ? (projectResample = resample(projectTransform, delta2 = _ * _), reset()) : sqrt(delta2);\n  };\n\n  projection.fitExtent = function(extent, object) {\n    return fitExtent(projection, extent, object);\n  };\n\n  projection.fitSize = function(size, object) {\n    return fitSize(projection, size, object);\n  };\n\n  projection.fitWidth = function(width, object) {\n    return fitWidth(projection, width, object);\n  };\n\n  projection.fitHeight = function(height, object) {\n    return fitHeight(projection, height, object);\n  };\n\n  function recenter() {\n    var center = scaleTranslateRotate(k, 0, 0, sx, sy, alpha).apply(null, project(lambda, phi)),\n        transform = (alpha ? scaleTranslateRotate : scaleTranslate)(k, x - center[0], y - center[1], sx, sy, alpha);\n    rotate = rotateRadians(deltaLambda, deltaPhi, deltaGamma);\n    projectTransform = compose(project, transform);\n    projectRotateTransform = compose(rotate, projectTransform);\n    projectResample = resample(projectTransform, delta2);\n    return reset();\n  }\n\n  function reset() {\n    cache = cacheStream = null;\n    return projection;\n  }\n\n  return function() {\n    project = projectAt.apply(this, arguments);\n    projection.invert = project.invert && invert;\n    return recenter();\n  };\n}\n"]},"metadata":{},"sourceType":"module"}