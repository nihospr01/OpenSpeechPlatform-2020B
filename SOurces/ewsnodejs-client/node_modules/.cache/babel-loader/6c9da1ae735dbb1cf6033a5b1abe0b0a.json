{"ast":null,"code":"import _regeneratorRuntime from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/opt/osp/ewsnodejs-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{axios}from\"utils/utils\";import{withStyles}from\"@material-ui/styles\";import Paper from\"@material-ui/core/Paper\";import Checkbox from\"@material-ui/core/Checkbox\";import Toolbar from\"@material-ui/core/Toolbar\";import Typography from\"@material-ui/core/Typography\";import Button from\"@material-ui/core/Button\";import Table from\"@material-ui/core/Table\";import TableHead from\"@material-ui/core/TableHead\";import TableRow from\"@material-ui/core/TableRow\";import TableBody from\"@material-ui/core/TableBody\";import TableCell from\"@material-ui/core/TableCell\";import{withRouter}from\"react-router-dom\";import{compose}from\"recompose\";import withUserAuth from\"context/withUserAuth\";import ListenerSignup from\"components/listenerSignup\";import ListenerListRow from\"components/listenerListRow\";var styles=function styles(theme){return{root:{flexGrow:1},content:{padding:theme.spacing(3)},listenerSection:{marginTop:30,width:\"90%\",maxWidth:1000},listenerSectionContent:{display:\"flex\",flexDirection:\"column\",alignItems:\"center\"},topBarButton:{marginLeft:30},exportButton:{marginLeft:\"auto\"}};};var ListnerManagement=/*#__PURE__*/function(_Component){_inherits(ListnerManagement,_Component);var _super=_createSuper(ListnerManagement);function ListnerManagement(){var _this;_classCallCheck(this,ListnerManagement);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={signupDialogOpen:false,listenerList:[],selected:[]};_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var updateUser,user,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;updateUser=_this.props.context.updateUser;_context.next=4;return updateUser();case 4:user=_this.props.context.user;_context.next=7;return axios.get(\"/api/listener/\".concat(user));case 7:response=_context.sent;console.log(response.data);_this.setState({listenerList:response.data,selected:new Array(response.data.length).fill(false)});_context.next=16;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](0);alert(_context.t0);console.log(_context.t0);case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,12]]);}));_this.handleSignupDialogOpen=function(){_this.setState({signupDialogOpen:true});};_this.handleSignupDialogClose=function(){_this.setState({signupDialogOpen:false});};_this.handleSelectAllClick=function(e){_this.setState({selected:new Array(_this.state.selected.length).fill(e.target.checked)});};_this.handleSelectClick=function(index,e){var selected=_this.state.selected;selected[index]=e.target.checked;_this.setState({selected:selected});};_this.handleExport=function(){var _this$state=_this.state,selected=_this$state.selected,listenerList=_this$state.listenerList;var exportFiles={patient_history:\"\",PTA:\"\",use_assessment:\"\"};exportFiles[\"4AFC\"]=\"\";selected.forEach(function(select,index){if(select){var userLog=JSON.parse(listenerList[index].userLog);var listenerHeader=\"ListenerId,\".concat(listenerList[index].listenerID,\"\\n\");exportFiles.patient_history=exportFiles.patient_history.concat(listenerHeader,_this.handlePatientHistory(userLog.history),\"\\n\");exportFiles[\"4AFC\"]=exportFiles[\"4AFC\"].concat(listenerHeader,_this.handleAFCExport(userLog.AFC),\"\\n\");exportFiles.PTA=exportFiles.PTA.concat(listenerHeader,_this.handlePTAExport(userLog.PTA),\"\\n\");exportFiles.use_assessment=exportFiles.use_assessment.concat(listenerHeader,_this.handleAssessmentExport(userLog.assessment),\"\\n\");}});[\"patient_history\",\"4AFC\",\"PTA\",\"use_assessment\"].forEach(function(curr){var element=document.createElement(\"a\");var file=new Blob([exportFiles[curr]],{type:\"text/csv;encoding:utf-8\"});element.href=URL.createObjectURL(file);element.download=\"\".concat(curr,\"_log.csv\");document.body.appendChild(element);// Required for this to work in FireFox\nelement.click();});};_this.handlePatientHistory=function(history){if(!history){return\"N/A\\n\";}return\"\".concat(\"Patient History Log on, \",history.logOn,\"\\n\",\"Medical History\\n\",\"Left ear Condition,\",history.medicalHistory.leftEar,\"\\n\",\"Right ear Condition,\",history.medicalHistory.rightEar,\"\\n\",\"Illnesses had before\\n\",history.illnesses.length!==0?\",\"+Object.keys(history.illnesses).join(\",\")+\"\\n\"+\"When did it occur,\"+Object.keys(history.illnesses).map(function(illness){return\"\".concat(history.illnesses[illness][\"occur\"],\",\");})+\"\\n\"+\"How did it happen,\"+Object.keys(history.illnesses).map(function(illness){return\"\".concat(history.illnesses[illness][\"happen\"],\",\");})+\"\\n\"+\"When did it resolve,\"+Object.keys(history.illnesses).map(function(illness){return\"\".concat(history.illnesses[illness][\"resolve\"],\",\");})+\"\\n\":\"None\\n\",\"Development History\\n\",\"Age started to speak, \".concat(history.ageSpeak,\"\\n\\n\"),\"Education History\\n\",\"The highest education obtained, \".concat(history.highestEdu,\" \\n\"),\"Family History\\n\",\"Illnesses family members had before \\n\",history.illnessesFam.length!==0?\",\"+Object.keys(history.illnessesFam).join(\",\")+\"\\n\"+\"Relation(s),\"+Object.keys(history.illnessesFam).map(function(illness){return\"\".concat(history.illnessesFam[illness][\"relation\"],\",\");})+\"\\n\"+\"When did it occur,\"+Object.keys(history.illnessesFam).map(function(illness){return\"\".concat(history.illnessesFam[illness][\"occur\"],\",\");})+\"\\n\"+\"How did it happen,\"+Object.keys(history.illnessesFam).map(function(illness){return\"\".concat(history.illnessesFam[illness][\"happen\"],\",\");})+\"\\n\"+\"When did it resolve,\"+Object.keys(history.illnessesFam).map(function(illness){return\"\".concat(history.illnessesFam[illness][\"resolve\"],\",\");})+\"\\n\":\"None\\n\");};_this.handleAFCExport=function(AFC){if(!AFC){return\"N/A\\n\";}var ans=\"\";AFC.log.forEach(function(currLog,index){ans=ans.concat(\"Question \".concat(index,\"\\n\"),\"Current options,\",currLog.currentOptions.join(\",\"),\"\\n\",\"Correct answer,\",currLog.currentWord,\"\\n\",\"Selected,\",currLog.option,\"\\n\");});return\"\".concat(\"4AFC Log on,\".concat(AFC.logOn,\"\\n\"),ans);};_this.handlePTAExport=function(PTA){if(!PTA){return\"N/A\\n\";}var res=\"\";Object.keys(PTA.left).forEach(function(freq,index){res=res.concat(\"\".concat(freq,\",\"),PTA.left[freq]===\"\"?\"N/A,\":\"\".concat(PTA.left[freq],\",\"),PTA.right[freq]===\"\"?\"N/A\\n\":\"\".concat(PTA.right[freq],\"\\n\"));});return\"\".concat(\"PTA Log on,\".concat(PTA.logOn,\"\\n\"),\"AudiologistID, \".concat(PTA.audiologistID,\"\\n\"),\"Frequency(Hz),Left Ear(dBspl), Right Ear(dBspl)\\n\",res);};_this.handleAssessmentExport=function(assessment){if(!assessment){return\"N/A\\n\";}return\"\".concat(\"User Assessment Log on,\".concat(assessment.logOn,\"\\n\"),// assessment.log.forEach((currLog, index) => {\n//   return `Question ${index + 1}: ${currLog} \\n`;\n// })\nassessment.log.join('\\n'));};return _this;}_createClass(ListnerManagement,[{key:\"render\",value:function render(){var _this2=this;var classes=this.props.classes;var _this$state2=this.state,listenerList=_this$state2.listenerList,selected=_this$state2.selected;console.log(selected);return/*#__PURE__*/React.createElement(\"div\",{className:classes.content},/*#__PURE__*/React.createElement(Paper,{className:classes.listenerSection},/*#__PURE__*/React.createElement(Toolbar,null,/*#__PURE__*/React.createElement(Typography,{color:\"textSecondary\",gutterBottom:true},\"My Listeners\"),/*#__PURE__*/React.createElement(Button,{color:\"primary\",variant:\"contained\",className:classes.topBarButton,onClick:this.handleSignupDialogOpen},\"Create New Listener\"),/*#__PURE__*/React.createElement(Button,{color:\"primary\",variant:\"contained\",className:classes.exportButton,onClick:this.handleExport},\"Export\")),/*#__PURE__*/React.createElement(ListenerSignup,{open:this.state.signupDialogOpen,handleClose:this.handleSignupDialogClose}),/*#__PURE__*/React.createElement(\"div\",{className:classes.listenerSectionContent},/*#__PURE__*/React.createElement(Table,null,/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,{padding:\"checkbox\"},/*#__PURE__*/React.createElement(Checkbox//indeterminate={numSelected > 0 && numSelected < rowCount}\n//checked={rowCount > 0 && numSelected === rowCount}\n,{onChange:this.handleSelectAllClick,inputProps:{\"aria-label\":\"select all desserts\"}})),[\"Listener ID\",\"Created At\",\"Updated At\",\"Action\"].map(function(text){return/*#__PURE__*/React.createElement(TableCell,{key:text},/*#__PURE__*/React.createElement(Typography,{variant:\"subtitle1\",color:\"textSecondary\"},text));}))),/*#__PURE__*/React.createElement(TableBody,null,listenerList.map(function(listener,index){return/*#__PURE__*/React.createElement(ListenerListRow,{key:\"listener_\".concat(index,\"_\").concat(selected[index]),listener:listener,selected:selected[index],onClick:function onClick(e){return _this2.handleSelectClick(index,e);}});}))))));}}]);return ListnerManagement;}(Component);export default compose(withUserAuth,withRouter,withStyles(styles))(ListnerManagement);","map":{"version":3,"sources":["/opt/osp/ewsnodejs-client/src/pages/admin/listenerManagement.jsx"],"names":["React","Component","axios","withStyles","Paper","Checkbox","Toolbar","Typography","Button","Table","TableHead","TableRow","TableBody","TableCell","withRouter","compose","withUserAuth","ListenerSignup","ListenerListRow","styles","theme","root","flexGrow","content","padding","spacing","listenerSection","marginTop","width","maxWidth","listenerSectionContent","display","flexDirection","alignItems","topBarButton","marginLeft","exportButton","ListnerManagement","state","signupDialogOpen","listenerList","selected","componentDidMount","updateUser","props","context","user","get","response","console","log","data","setState","Array","length","fill","alert","handleSignupDialogOpen","handleSignupDialogClose","handleSelectAllClick","e","target","checked","handleSelectClick","index","handleExport","exportFiles","patient_history","PTA","use_assessment","forEach","select","userLog","JSON","parse","listenerHeader","listenerID","concat","handlePatientHistory","history","handleAFCExport","AFC","handlePTAExport","handleAssessmentExport","assessment","curr","element","document","createElement","file","Blob","type","href","URL","createObjectURL","download","body","appendChild","click","logOn","medicalHistory","leftEar","rightEar","illnesses","Object","keys","join","map","illness","ageSpeak","highestEdu","illnessesFam","ans","currLog","currentOptions","currentWord","option","res","left","freq","right","audiologistID","classes","text","listener"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { axios } from \"utils/utils\";\nimport { withStyles } from \"@material-ui/styles\";\nimport Paper from \"@material-ui/core/Paper\";\nimport Checkbox from \"@material-ui/core/Checkbox\";\nimport Toolbar from \"@material-ui/core/Toolbar\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Button from \"@material-ui/core/Button\";\nimport Table from \"@material-ui/core/Table\";\nimport TableHead from \"@material-ui/core/TableHead\";\nimport TableRow from \"@material-ui/core/TableRow\";\nimport TableBody from \"@material-ui/core/TableBody\";\nimport TableCell from \"@material-ui/core/TableCell\";\nimport { withRouter } from \"react-router-dom\";\nimport { compose } from \"recompose\";\nimport withUserAuth from \"context/withUserAuth\";\nimport ListenerSignup from \"components/listenerSignup\";\nimport ListenerListRow from \"components/listenerListRow\";\n\nconst styles = (theme) => ({\n  root: {\n    flexGrow: 1,\n  },\n  content: {\n    padding: theme.spacing(3),\n  },\n  listenerSection: {\n    marginTop: 30,\n    width: \"90%\",\n    maxWidth: 1000,\n  },\n  listenerSectionContent: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\",\n  },\n  topBarButton: {\n    marginLeft: 30,\n  },\n  exportButton: {\n    marginLeft: \"auto\",\n  },\n});\n\nclass ListnerManagement extends Component {\n  state = {\n    signupDialogOpen: false,\n    listenerList: [],\n    selected: [],\n  };\n\n  componentDidMount = async () => {\n    try {\n      const { updateUser } = this.props.context;\n      await updateUser();\n      const { user } = this.props.context;\n\n      const response = await axios.get(`/api/listener/${user}`);\n      console.log(response.data);\n      this.setState({\n        listenerList: response.data,\n        selected: new Array(response.data.length).fill(false),\n      });\n    } catch (error) {\n      alert(error);\n      console.log(error);\n    }\n  };\n\n  handleSignupDialogOpen = () => {\n    this.setState({\n      signupDialogOpen: true,\n    });\n  };\n\n  handleSignupDialogClose = () => {\n    this.setState({\n      signupDialogOpen: false,\n    });\n  };\n\n  handleSelectAllClick = (e) => {\n    this.setState({\n      selected: new Array(this.state.selected.length).fill(e.target.checked),\n    });\n  };\n\n  handleSelectClick = (index, e) => {\n    let { selected } = this.state;\n    selected[index] = e.target.checked;\n    this.setState({\n      selected,\n    });\n  };\n\n  handleExport = () => {\n    const { selected, listenerList } = this.state;\n    let exportFiles = {\n      patient_history: \"\",\n      PTA: \"\",\n      use_assessment: \"\",\n    };\n    exportFiles[\"4AFC\"] = \"\";\n    selected.forEach((select, index) => {\n      if (select) {\n        const userLog = JSON.parse(listenerList[index].userLog);\n        const listenerHeader = `ListenerId,${listenerList[index].listenerID}\\n`;\n        exportFiles.patient_history = exportFiles.patient_history.concat(\n          listenerHeader,\n          this.handlePatientHistory(userLog.history),\n          \"\\n\"\n        );\n        exportFiles[\"4AFC\"] = exportFiles[\"4AFC\"].concat(\n          listenerHeader,\n          this.handleAFCExport(userLog.AFC),\n          \"\\n\"\n        );\n        exportFiles.PTA = exportFiles.PTA.concat(\n          listenerHeader,\n          this.handlePTAExport(userLog.PTA),\n          \"\\n\"\n        );\n        exportFiles.use_assessment = exportFiles.use_assessment.concat(\n          listenerHeader,\n          this.handleAssessmentExport(userLog.assessment),\n          \"\\n\"\n        );\n      }\n    });\n\n    [\"patient_history\", \"4AFC\", \"PTA\", \"use_assessment\"].forEach((curr) => {\n      const element = document.createElement(\"a\");\n      const file = new Blob([exportFiles[curr]], {\n        type: \"text/csv;encoding:utf-8\",\n      });\n      element.href = URL.createObjectURL(file);\n      element.download = `${curr}_log.csv`;\n      document.body.appendChild(element); // Required for this to work in FireFox\n      element.click();\n    });\n  };\n\n  handlePatientHistory = (history) => {\n    if (!history) {\n      return \"N/A\\n\";\n    }\n    return \"\".concat(\n      \"Patient History Log on, \",\n      history.logOn,\n      \"\\n\",\n      \"Medical History\\n\",\n      \"Left ear Condition,\",\n      history.medicalHistory.leftEar,\n      \"\\n\",\n      \"Right ear Condition,\",\n      history.medicalHistory.rightEar,\n      \"\\n\",\n      \"Illnesses had before\\n\",\n      history.illnesses.length !== 0\n        ? \",\" +\n            Object.keys(history.illnesses).join(\",\") +\n            \"\\n\" +\n            \"When did it occur,\" +\n            Object.keys(history.illnesses).map((illness) => {\n              return \"\".concat(history.illnesses[illness][\"occur\"], \",\");\n            }) +\n            \"\\n\" +\n            \"How did it happen,\" +\n            Object.keys(history.illnesses).map((illness) => {\n              return \"\".concat(history.illnesses[illness][\"happen\"], \",\");\n            }) +\n            \"\\n\" +\n            \"When did it resolve,\" +\n            Object.keys(history.illnesses).map((illness) => {\n              return \"\".concat(history.illnesses[illness][\"resolve\"], \",\");\n            }) +\n            \"\\n\"\n        : \"None\\n\",\n      \"Development History\\n\",\n      `Age started to speak, ${history.ageSpeak}\\n\\n`,\n      \"Education History\\n\",\n      `The highest education obtained, ${history.highestEdu} \\n`,\n      \"Family History\\n\",\n      \"Illnesses family members had before \\n\",\n      history.illnessesFam.length !== 0\n        ? \",\" +\n            Object.keys(history.illnessesFam).join(\",\") +\n            \"\\n\" +\n            \"Relation(s),\" +\n            Object.keys(history.illnessesFam).map((illness) => {\n              return \"\".concat(history.illnessesFam[illness][\"relation\"], \",\");\n            }) +\n            \"\\n\" +\n            \"When did it occur,\" +\n            Object.keys(history.illnessesFam).map((illness) => {\n              return \"\".concat(history.illnessesFam[illness][\"occur\"], \",\");\n            }) +\n            \"\\n\" +\n            \"How did it happen,\" +\n            Object.keys(history.illnessesFam).map((illness) => {\n              return \"\".concat(history.illnessesFam[illness][\"happen\"], \",\");\n            }) +\n            \"\\n\" +\n            \"When did it resolve,\" +\n            Object.keys(history.illnessesFam).map((illness) => {\n              return \"\".concat(history.illnessesFam[illness][\"resolve\"], \",\");\n            }) +\n            \"\\n\"\n        : \"None\\n\"\n    );\n  };\n\n  handleAFCExport = (AFC) => {\n    if (!AFC) {\n      return \"N/A\\n\";\n    }\n\n    let ans = \"\";\n    AFC.log.forEach((currLog, index) => {\n      ans = ans.concat(\n        `Question ${index}\\n`,\n        \"Current options,\",\n        currLog.currentOptions.join(\",\"),\n        \"\\n\",\n        \"Correct answer,\",\n        currLog.currentWord,\n        \"\\n\",\n        \"Selected,\",\n        currLog.option,\n        \"\\n\"\n      );\n    });\n    return \"\".concat(`4AFC Log on,${AFC.logOn}\\n`,ans);\n  };\n\n  handlePTAExport = (PTA) => {\n    if (!PTA) {\n      return \"N/A\\n\";\n    }\n    let res = \"\";\n    Object.keys(PTA.left).forEach((freq, index) => {\n      res = res.concat(\n        `${freq},`,\n        PTA.left[freq] === \"\" ? \"N/A,\" : `${PTA.left[freq]},`,\n        PTA.right[freq] === \"\" ? \"N/A\\n\" : `${PTA.right[freq]}\\n`\n      );\n    });\n    return \"\".concat(\n      `PTA Log on,${PTA.logOn}\\n`,\n      `AudiologistID, ${PTA.audiologistID}\\n`,\n      \"Frequency(Hz),Left Ear(dBspl), Right Ear(dBspl)\\n\",\n      res\n    );\n  };\n\n  handleAssessmentExport = (assessment) => {\n    if (!assessment) {\n      return \"N/A\\n\";\n    }\n    return \"\".concat(\n      `User Assessment Log on,${assessment.logOn}\\n`,\n      // assessment.log.forEach((currLog, index) => {\n      //   return `Question ${index + 1}: ${currLog} \\n`;\n      // })\n      assessment.log.join('\\n')\n    );\n  };\n\n  render() {\n    const { classes } = this.props;\n    const { listenerList, selected } = this.state;\n\n    console.log(selected);\n    return (\n      <div className={classes.content}>\n        <Paper className={classes.listenerSection}>\n          <Toolbar>\n            <Typography color=\"textSecondary\" gutterBottom>\n              My Listeners\n            </Typography>\n            <Button\n              color=\"primary\"\n              variant=\"contained\"\n              className={classes.topBarButton}\n              onClick={this.handleSignupDialogOpen}\n            >\n              Create New Listener\n            </Button>\n            <Button\n              color=\"primary\"\n              variant=\"contained\"\n              className={classes.exportButton}\n              onClick={this.handleExport}\n            >\n              Export\n            </Button>\n          </Toolbar>\n          <ListenerSignup\n            open={this.state.signupDialogOpen}\n            handleClose={this.handleSignupDialogClose}\n          />\n          <div className={classes.listenerSectionContent}>\n            <Table>\n              <TableHead>\n                <TableRow>\n                  <TableCell padding=\"checkbox\">\n                    <Checkbox\n                      //indeterminate={numSelected > 0 && numSelected < rowCount}\n                      //checked={rowCount > 0 && numSelected === rowCount}\n                      onChange={this.handleSelectAllClick}\n                      inputProps={{ \"aria-label\": \"select all desserts\" }}\n                    />\n                  </TableCell>\n                  {[\"Listener ID\", \"Created At\", \"Updated At\", \"Action\"].map(\n                    (text) => (\n                      <TableCell key={text}>\n                        <Typography variant=\"subtitle1\" color=\"textSecondary\">\n                          {text}\n                        </Typography>\n                      </TableCell>\n                    )\n                  )}\n                </TableRow>\n              </TableHead>\n              <TableBody>\n                {listenerList.map((listener, index) => (\n                  <ListenerListRow\n                    key={`listener_${index}_${selected[index]}`}\n                    listener={listener}\n                    selected={selected[index]}\n                    onClick={(e) => this.handleSelectClick(index, e)}\n                  />\n                ))}\n              </TableBody>\n            </Table>\n          </div>\n        </Paper>\n      </div>\n    );\n  }\n}\n\nexport default compose(\n  withUserAuth,\n  withRouter,\n  withStyles(styles)\n)(ListnerManagement);\n"]},"metadata":{},"sourceType":"module"}