<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Open Speech Platform: libosp/peak_detect/peak_detect.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Open Speech Platform
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('peak__detect_8c.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">peak_detect.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="peak__detect_8h_source.html">peak_detect.h</a>&quot;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &lt;limits.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for peak_detect.c:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="peak__detect_8c__incl.svg" width="466" height="196"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpeak__detect__t.html">peak_detect_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Peak Detect data structure.  <a href="structpeak__detect__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1bb9895ff8c4b0457213e526fd4fab74"><td class="memItemLeft" align="right" valign="top"><a class="el" href="peak__detect_8h.html#a152d14cd03f6e1ac947c95921da5507c">Peak_detect</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="peak__detect_8c.html#a1bb9895ff8c4b0457213e526fd4fab74">peak_detect_init</a> (float fsamp, unsigned int num_bands)</td></tr>
<tr class="memdesc:a1bb9895ff8c4b0457213e526fd4fab74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to initialize the peak_detect data struct.  <a href="#a1bb9895ff8c4b0457213e526fd4fab74">More...</a><br /></td></tr>
<tr class="separator:a1bb9895ff8c4b0457213e526fd4fab74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28a24577ab91983936daee15fd88af54"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="peak__detect_8c.html#a28a24577ab91983936daee15fd88af54">peak_to_spl</a> (float *peak, float *pdb, size_t len)</td></tr>
<tr class="memdesc:a28a24577ab91983936daee15fd88af54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to convert the output from the peak detector into dB SPL (Sound Pressure Level).  <a href="#a28a24577ab91983936daee15fd88af54">More...</a><br /></td></tr>
<tr class="separator:a28a24577ab91983936daee15fd88af54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d0ec744b3cd1bf9acd7598def47748c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="peak__detect_8c.html#a3d0ec744b3cd1bf9acd7598def47748c">peak_detect</a> (<a class="el" href="peak__detect_8h.html#a152d14cd03f6e1ac947c95921da5507c">Peak_detect</a> pd, float *input, size_t len, float *peak, float attack_time, float release_time, int band_num)</td></tr>
<tr class="memdesc:a3d0ec744b3cd1bf9acd7598def47748c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to peak detect the signal. The attack and release times are specified as ANSI values which are then converted to filter time constants. The peak detector is given by Kates, Eq (8.1).  <a href="#a3d0ec744b3cd1bf9acd7598def47748c">More...</a><br /></td></tr>
<tr class="separator:a3d0ec744b3cd1bf9acd7598def47748c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0012f353d07e27778b050692205a717e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="peak__detect_8c.html#a0012f353d07e27778b050692205a717e">peak_detect_destroy</a> (<a class="el" href="peak__detect_8h.html#a152d14cd03f6e1ac947c95921da5507c">Peak_detect</a> pd)</td></tr>
<tr class="memdesc:a0012f353d07e27778b050692205a717e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to close and free the Peak_detect instance.  <a href="#a0012f353d07e27778b050692205a717e">More...</a><br /></td></tr>
<tr class="separator:a0012f353d07e27778b050692205a717e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a3d0ec744b3cd1bf9acd7598def47748c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d0ec744b3cd1bf9acd7598def47748c">&#9670;&nbsp;</a></span>peak_detect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void peak_detect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="peak__detect_8h.html#a152d14cd03f6e1ac947c95921da5507c">Peak_detect</a>&#160;</td>
          <td class="paramname"><em>pd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>peak</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>attack_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>release_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>band_num</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to peak detect the signal. The attack and release times are specified as ANSI values which are then converted to filter time constants. The peak detector is given by Kates, Eq (8.1). </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="structpeak__detect__t.html" title="Peak Detect data structure. ">peak_detect_t</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pd</td><td>The instance of the Peak_detect structure that was returned from peak_detect_init </td></tr>
    <tr><td class="paramname">input</td><td>Pointer to the signal array at the frequency sub-band (output from sub-band filtering) </td></tr>
    <tr><td class="paramname">len</td><td>Length of the input signal </td></tr>
    <tr><td class="paramname">peak</td><td>Pointer to the array that will have peak detection output. i.e. output from peak_detect </td></tr>
    <tr><td class="paramname">attack_time</td><td>Attack time in milliseconds </td></tr>
    <tr><td class="paramname">release_time</td><td>Release time in milliseconds </td></tr>
    <tr><td class="paramname">band_num</td><td>The sub-band number that is being operated on. Required to get the prev_peak value for that band </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a0012f353d07e27778b050692205a717e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0012f353d07e27778b050692205a717e">&#9670;&nbsp;</a></span>peak_detect_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int peak_detect_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="peak__detect_8h.html#a152d14cd03f6e1ac947c95921da5507c">Peak_detect</a>&#160;</td>
          <td class="paramname"><em>pd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to close and free the Peak_detect instance. </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="structpeak__detect__t.html" title="Peak Detect data structure. ">peak_detect_t</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pd</td><td>The instance of the Peak_detect structure that was returned from peak_detect_init </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if successful. -1 otherwise </dd></dl>

</div>
</div>
<a id="a1bb9895ff8c4b0457213e526fd4fab74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bb9895ff8c4b0457213e526fd4fab74">&#9670;&nbsp;</a></span>peak_detect_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="peak__detect_8h.html#a152d14cd03f6e1ac947c95921da5507c">Peak_detect</a> peak_detect_init </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>fsamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>num_bands</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to initialize the peak_detect data struct. </p>
<p>Allocates memory to the Peak_detect instance and initialize its parameters. prev_peak is set to zero for all bands for the first time.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fsamp</td><td>Sampling rate in Hz </td></tr>
    <tr><td class="paramname">num_bands</td><td>Number of sub-bands. Required to store prev_peak values for each band </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Peak_detect Returns the Peak_detect instance/object if memory is succesfully allocated or returns NULL. </dd></dl>

</div>
</div>
<a id="a28a24577ab91983936daee15fd88af54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28a24577ab91983936daee15fd88af54">&#9670;&nbsp;</a></span>peak_to_spl()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void peak_to_spl </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>peak</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>pdb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to convert the output from the peak detector into dB SPL (Sound Pressure Level). </p>
<p>The SPL output will be used by the wide dynamic-range compression (wdrc) function. The function assumes that an RMS signal value of 1 corresponds to <a class="el" href="peak__detect_8h.html#a4f9fe2f1309c3dbfcf132e9fffb11fb2" title="Default dB SPL level corresponding to signal RMS value of 1. ">DEFAULT_LEVEL(100)</a> dB SPL and converts the signal accordingly. The input WAV file therefore needs to be set to RMS = 1 at the start of processing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">peak</td><td>Pointer to the signal to be conveted to dB SPL. i.e. the output from the peak_detect </td></tr>
    <tr><td class="paramname">pdb</td><td>Pointer to the signal converted to dB SPL. i.e. the output of peak_to_spl </td></tr>
    <tr><td class="paramname">len</td><td>Length of the input signal to be converted to dB SPL </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_344a92ffc85f32daed969785c1237399.html">libosp</a></li><li class="navelem"><a class="el" href="dir_e4d4d3e4b2729fb205722b1fca19ad82.html">peak_detect</a></li><li class="navelem"><a class="el" href="peak__detect_8c.html">peak_detect.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
